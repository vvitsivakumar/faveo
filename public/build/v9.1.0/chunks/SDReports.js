import{ab as I,ac as oe,ad as ve,ae as ke,af as de,ag as ce,ah as ue,ai as pe,al as Fe,aj as Ce,r as b,o as i,c,f as d,t as D,b as v,d as h,ak as we,am as ze,e as T,a as R,q as fe,i as z,v as Je,F as L,h as ee,n as he,p as De,j as Se,w as j,g as Z,a1 as f,a3 as Oe,a8 as Ye,as as We,a6 as Ze,aq as Ke}from"./vendor.js";import{_ as M,Q as $,U as xe,f as x,p as $e,g as ge,z as Ge,D as Pe,j as Ae,q as Qe,k as Xe,s as Ue,e as K,W as et,G as tt}from"./bootstrap.js";import{c as at}from"./agentRouter.js";import{N as st,d as lt}from"./DataTableActions.js";import{T as rt}from"./PermaLink.js";import{a as it,b as nt,C as ot}from"./FormGenerator.js";const dt=e=>{let a=[],t=[],l=[];return e.forEach(s=>{a.push(s.value),t.push(s.label),l.push(s.redirectTo)}),{data:a,labels:t,redirectURLs:l}},hs=e=>{let a=[];return e.forEach(t=>{const l=dt(t.data);let s={chartId:t.id,panelTitle:t.name,axisLabel:t.dataLabel,data:l.data,labels:l.labels,redirectURLs:l.redirectURLs};a.push(s)}),a},ms=e=>{const a=JSON.parse(JSON.stringify(e));let t=[];for(let r=0;r<a.length;r++)for(let p=0;p<a[r].data.length;p++){const C=a[r].data[p],_={id:C.id,label:C.label};t.push(_)}const l=t.sort(ut);return ct(l,"label").map(r=>r.label)},ct=(e,a)=>Array.from(new Set(e.map(l=>l[a]))).map(l=>e.find(s=>s[a]===l)),ut=(e,a)=>isNaN(Number(e.id))?new Date(e.id)-new Date(a.id):Number(e.id)-Number(a.id);function pt(e,a,t,l,s){for(let r=0;r<e[s].data.length+1;r++)if(r===e[s].data.length)t.values.push(0),t.redirectTo.push(null);else if(e[s].data[r].label===a[l]){t.values.push(e[s].data[r].value||0),t.redirectTo.push(e[s].data[r].redirectTo);break}}function fs(e,a){const t=JSON.parse(JSON.stringify(e));let l=[];for(let s=0;s<t.length;s++){let r={chartId:"",label:"",values:[],redirectTo:[]};r.label=t[s].name,r.chartId=t[s].id;for(let p=0;p<a.length;p++)pt(t,a,r,p,s);l.push(r)}return l}const Te=(e,a=18)=>e.length>a?e.substr(0,a).trim()+"...":e,Ne=(e,a)=>{const t=/\.00$/,s=JSON.parse(JSON.stringify(a.dataset.data)).reduce((p,C)=>Number(p)+Number(C));let r=(Number(e)/s*100).toFixed(2)+"";return t.test(r)&&(r=r.replace(t,"")),r+"%"},me=(e,a,t)=>{try{const l=document.getElementById(a);l.style.cursor="default",e[0]&&t[e[0].index]&&(l.style.cursor="pointer")}catch{}};I.register(oe,ve,ke,de,ce,ue);I.register(pe);const ht={components:{Doughnut:Fe,Bar:Ce},props:{data:{type:Array,default:()=>[]},colors:{type:Array,default:()=>[]},redirectUrls:{type:Array,default:()=>[]},labelString:{type:String,default:"Count"},from:{type:String,default:""}},data(){return{chartData:"",options:{responsive:!0,maintainAspectRatio:!1,plugins:{datalabels:{color:"#000",anchor:"end",clamp:!0,align:"top"},legend:!1},layout:{padding:{left:0,right:0,top:24,bottom:0}},scales:{y:{beginAtZero:!0,title:{display:!0,text:this.labelString},border:{display:!1},grid:{display:!0,drawOnChartArea:!0,drawTicks:!0},ticks:{precision:0},min:0},x:{border:{display:!1},grid:{display:!0,drawOnChartArea:!0,drawTicks:!0},ticks:{callback:function(e,a){return Te(this.getLabelForValue(e))}}}},onClick:this.clickHandler,onHover:this.onHover}}},mounted(){let e=[],a=this.data.result?this.data.result:this.data.chart_parameters;for(var t in a)e.push(a[t].name);this.chartData={labels:e,datasets:[{label:this.labelString,backgroundColor:$(e.length),borderColor:xe(e.length),borderWidth:2,data:a.map(l=>l.count),barThickness:30}]}},methods:{clickHandler(e,a){if(x(a)&&x(this.redirectUrls)){const t=this.redirectUrls[a[0].index];if(x(t)){let l=JSON.parse('{"'+decodeURI(t.split("?")[1]).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');this.$router.push({path:t.replace(this.basePath(),""),query:l})}}},onHover(e,a,t){e.native.target.style.cursor=a[0]?"pointer":"default",me(a,this.chartId,this.redirectUrls)}}},mt={key:0,class:"dashboard-charts"},ft={class:"no-data-section"},_t={key:1,style:{height:"300px"}};function yt(e,a,t,l,s,r){const p=b("Bar");return t.from==="sd-reports"&&t.data.chart_parameters.length===0||t.from==="dashboard"&&t.data.result.length===0?(i(),c("div",mt,[d("div",ft,D(e.lang("no_data_available")),1)])):(i(),c("div",_t,[s.chartData?(i(),v(p,{key:0,data:s.chartData,options:s.options},null,8,["data","options"])):h("",!0)]))}const bt=M(ht,[["render",yt],["__scopeId","data-v-778cf10f"]]);I.register(de,ce,ue,we,oe);I.register(pe);const gt={components:{Pie:ze},props:{data:{type:Array,default:()=>[]},colors:{type:Array,default:()=>[]},redirectUrls:{type:Array,default:()=>[]},from:{type:String,default:""}},data(){return{chartData:"",options:{responsive:!0,plugins:{datalabels:{display:"auto",color:"#6c757d",anchor:"end",clamp:!0,align:"start",offset:10,font:{weight:"bold"},formatter:this.dataLabelFormatter},legend:{display:!0,position:"top"}},maintainAspectRatio:!1,onClick:this.clickHandler,onHover:this.onHover}}},mounted(){let e=[];e=this.data.chart_parameters.map(a=>a.name),this.chartData={labels:e,datasets:[{backgroundColor:$(e.length),borderColor:$(e.length),data:this.data.chart_parameters.map(a=>a.count)}]}},methods:{clickHandler(e,a){if(x(a)&&x(this.redirectUrls)){const t=this.redirectUrls[a[0].index];if(x(t)){let l=JSON.parse('{"'+decodeURI(t.split("?")[1]).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');this.$router.push({path:t.replace(this.basePath(),""),query:l})}}},dataLabelFormatter(e,a){return Ne(e,a)},onHover(e,a){e.native.target.style.cursor=a[0]?"pointer":"default",me(a,this.chartId,this.redirectUrls)}}},vt={key:0,class:"dashboard-charts"},kt={class:"no-data-section"},Ft={key:1};function Ct(e,a,t,l,s,r){const p=b("Pie");return t.from==="sd-reports"&&t.data.chart_parameters.length===0?(i(),c("div",vt,[d("div",kt,D(e.lang("no_data_available")),1)])):(i(),c("div",Ft,[s.chartData?(i(),v(p,{key:0,data:s.chartData,options:s.options},null,8,["data","options"])):h("",!0)]))}const wt=M(gt,[["render",Ct]]);I.register(oe,ve,ke,de,ce,ue);I.register(pe);const Dt={components:{Bar:Ce},props:{data:{type:Array,default:()=>[]},colors:{type:Array,default:()=>[]},redirectUrls:{type:Array,default:()=>[]},from:{type:String,default:""}},data(){return{chartData:"",options:{indexAxis:"y",responsive:!0,title:!1,maintainAspectRatio:!1,plugins:{datalabels:{display:"auto",color:"#000",anchor:"end",clamp:!0,align:"right",font:{weight:"20px"}},legend:!1},layout:{padding:{left:0,right:24,top:0,bottom:0}},scales:{y:{beginAtZero:!0,title:{display:!0,text:""},border:{display:!1},grid:{display:!0,drawOnChartArea:!0,drawTicks:!0}},x:{border:{display:!1},title:{display:!0,text:"count"},grid:{display:!0,drawOnChartArea:!0,drawTicks:!0},ticks:{precision:0,callback:function(e,a){return Te(this.getLabelForValue(e))}}}},onClick:this.clickHandler,onHover:this.onHover}}},mounted(){let e=[],a=this.data.chart_parameters;for(var t in a)e.push(a[t].name);this.chartData={labels:e,datasets:[{label:"",backgroundColor:$(e.length),borderColor:xe(e.length),borderWidth:2,data:a.map(l=>l.count),barThickness:30}]}},methods:{clickHandler(e,a){if(x(a)&&x(this.redirectUrls)){const t=this.redirectUrls[a[0].index];if(x(t)){let l=JSON.parse('{"'+decodeURI(t.split("?")[1]).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');this.$router.push({path:t.replace(this.basePath(),""),query:l})}}},onHover(e,a,t){e.native.target.style.cursor=a[0]?"pointer":"default",me(a,this.chartId,this.redirectUrls)}}},St={key:0,class:"dashboard-charts"},Ot={class:"no-data-section"},xt={key:1,style:{height:"300px"}};function Pt(e,a,t,l,s,r){const p=b("Bar");return t.from==="sd-reports"&&t.data.chart_parameters.length===0?(i(),c("div",St,[d("div",Ot,D(e.lang("no_data_available")),1)])):(i(),c("div",xt,[s.chartData?(i(),v(p,{key:0,data:s.chartData,options:s.options},null,8,["data","options"])):h("",!0)]))}const At=M(Dt,[["render",Pt],["__scopeId","data-v-c1b16956"]]);I.register(de,ce,ue,we,oe);I.register(pe);const Ut={components:{Doughnut:Fe},props:{data:{type:Array,default:()=>[]},colors:{type:Array,default:()=>[]},redirectUrls:{type:Array,default:()=>[]},from:{type:String,default:""}},data(){return{chartDetail:"",chartData:"",options:{responsive:!0,plugins:{datalabels:{display:"auto",color:"#6c757d",anchor:"end",clamp:!0,align:"start",offset:10,font:{weight:"bold"},formatter:this.dataLabelFormatter},legend:{display:!0,position:"top"}},maintainAspectRatio:!1,onClick:this.clickHandler,onHover:this.onHover}}},beforeMount(){this.chartDetail=this.data.result?this.data.result:this.data.chart_parameters},mounted(){let e=[];e=this.chartDetail.map(a=>a.name),this.chartData={labels:e,datasets:[{backgroundColor:$(e.length),borderColor:$(e.length),data:this.chartDetail.map(a=>a.count)}]}},methods:{clickHandler(e,a){if(x(a)&&x(this.redirectUrls)){const t=this.redirectUrls[a[0].index];if(x(t)){let l=JSON.parse('{"'+decodeURI(t.split("?")[1]).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');this.$router.push({path:t.replace(this.basePath(),""),query:l})}}},dataLabelFormatter(e,a){return Ne(e,a)},onHover(e,a){e.native.target.style.cursor=a[0]?"pointer":"default",me(a,this.chartId,this.redirectUrls)}}},Tt={key:0,class:"dashboard-charts"},Nt={class:"no-data-section"},Vt={key:1};function Et(e,a,t,l,s,r){const p=b("Doughnut");return t.from==="sd-reports"&&t.data.chart_parameters.length===0||t.from==="dashboard"&&t.data.result.length===0?(i(),c("div",Tt,[d("div",Nt,D(e.lang("no_data_available")),1)])):(i(),c("div",Vt,[s.chartData?(i(),v(p,{key:0,data:s.chartData,options:s.options},null,8,["data","options"])):h("",!0)]))}const Mt=M(Ut,[["render",Et]]);const Rt={props:{chartData:{type:[Object,Array,String],default:()=>[]},redirectUrls:{type:[Array],default:()=>[]},type:{type:String,default:"pie"},showTitle:{type:Boolean,default:!0},from:{type:String,default:""}},components:{"bar-chart":bt,"pie-chart":wt,"horizontal-chart":At,"doughnut-chart":Mt},data(){return{colors:[]}},beforeMount(){this.getRandomColor()},methods:{getRandomColor(){for(;this.colors.length<100;){do var e=Math.floor(Math.random()*1e6+1);while(this.colors.indexOf(e)>=0);this.colors.push("#"+("000000"+e.toString(16)).slice(-6))}}}},Lt={key:0,class:"container container-1"},It={class:"col-sm-12"},Ht={key:0,class:"Chart"},qt={key:0,style:{"text-align":"center"},id:"type"},Bt={key:1,class:"Chart"},jt={key:0,style:{"text-align":"center"},id:"type"},zt={key:2,class:"Chart"},Jt={key:0,style:{"text-align":"center"},id:"type"},Yt={key:3,class:"Chart"},Wt={key:0,style:{"text-align":"center"},id:"type"};function Zt(e,a,t,l,s,r){const p=b("bar-chart"),C=b("pie-chart"),_=b("horizontal-chart"),g=b("doughnut-chart");return t.chartData?(i(),c("div",Lt,[d("div",It,[t.type==="bar"?(i(),c("div",Ht,[t.showTitle?(i(),c("h1",qt,"Barchart")):h("",!0),T(p,{from:t.from,data:t.chartData,colors:s.colors,redirectUrls:t.redirectUrls},null,8,["from","data","colors","redirectUrls"])])):h("",!0),t.type==="pie"?(i(),c("div",Bt,[t.showTitle?(i(),c("h1",jt,"Piechart")):h("",!0),T(C,{from:t.from,data:t.chartData,colors:s.colors,redirectUrls:t.redirectUrls},null,8,["from","data","colors","redirectUrls"])])):h("",!0),t.type==="horizontal"?(i(),c("div",zt,[t.showTitle?(i(),c("h1",Jt,"Horizontalchart")):h("",!0),T(_,{from:t.from,data:t.chartData,colors:s.colors,redirectUrls:t.redirectUrls},null,8,["from","data","colors","redirectUrls"])])):h("",!0),t.type==="doughnut"?(i(),c("div",Yt,[t.showTitle?(i(),c("h1",Wt,"Doughnutchart")):h("",!0),T(g,{from:t.from,data:t.chartData,colors:s.colors,redirectUrls:t.redirectUrls},null,8,["from","data","colors","redirectUrls"])])):h("",!0)])])):h("",!0)}const Kt=M(Rt,[["render",Zt]]);const $t={name:"custom-filter",description:"Custom Fields Filter Component",props:{updateFilterFields:{type:Function,default:()=>{}},selectedFilterFields:{type:Array,default:()=>[]},endPoint:{type:String,required:!0}},data(){return{customFields:[],loading:!0,selectedFields:this.selectedFilterFields,search:"",locale:"",hasMoreData:!0,page:1}},created(){window.emitter.on("clearCustomFields",this.clearFields)},computed:{filteredList(){return this.customFields.filter(e=>e.label.toLowerCase().includes(this.search.toLowerCase()))}},methods:{handleFilterScroll(){const e=document.getElementById("filter-dropdown"),a=e.scrollHeight,t=e.scrollTop,l=e.clientHeight;t+l>=a-100&&!this.loading&&this.hasMoreData&&this.getFields()},clearFields(){this.selectedFields=[]},subString(e){return $e(e,30)},onCancel(){var e=document.getElementById("filter-div");e.classList.remove("open")},onClick(e){if(this.selectedFields.map(t=>t.id).includes(e.id)){for(var a in this.selectedFields)if(this.selectedFields[a].id===e.id){this.selectedFields.splice(a,1);break}}else e.name="custom_"+e.id,e.isCustom=!0,e.value="",e.className="col-sm-4",this.selectedFields.push(e);this.updateFilterFields(this.selectedFields)},async getFields(){try{this.loading=!0;const e=await R.get(`${this.endPoint}&page=${this.page}`);e.data.data.data.length>0?(this.customFields=[...this.customFields,...e.data.data.data],this.page++):this.hasMoreData=!1}catch(e){console.error("Error fetching data:",e)}finally{this.loading=!1}},getCustomFields(e,a){this.customFields=[],this.selectedFields=[],R.get(e).then(t=>{let l=t.data.data.data;if(this.page++,l.length){for(var s in l){if(a.length)for(var r in a)a[r].key===l[s].key&&(l[s].name=a[r].key,l[s].isCustom=!0,l[s].className="col-sm-4",l[s].value||(l[s].data_type==="checkbox"?l[s].value=a[r].value.split(","):l[s].value=a[r].value,this.selectedFields.push(l[s]),this.selectedFields.length===a.length&&this.updateFilterFields(this.selectedFields)));for(var p in this.selectedFields)this.selectedFields[p].id===l[s].id&&(l[s].value=this.selectedFields[p].value)}this.customFields=l}}).catch(t=>{})}}},Gt=e=>(De("data-v-dd048500"),e=e(),Se(),e),Qt={id:"filter-div",class:"card-tools"},Xt=Gt(()=>d("i",{class:"glyphicon glyphicon-plus"},null,-1)),ea=[Xt],ta={key:0,class:"nav-item"},aa={class:"form-group has-feedback has-search filter_div"},sa=["placeholder"],la=["onClick"],ra={key:0,class:"fa fa-check field_select"},ia={id:"field_title"},na={key:1},oa={class:"text-center"},da={key:2,class:"field_loader nav-item"};function ca(e,a,t,l,s,r){const p=b("loader"),C=fe("tooltip");return i(),c("div",Qt,[z((i(),c("button",{type:"button",class:"btn btn-tool dropdown-toggle","data-toggle":"dropdown",id:"labels-button",onClick:a[0]||(a[0]=_=>r.getFields())},ea)),[[C,e.trans("add_custom_field")]]),d("ul",{id:"filter-dropdown",class:"dropdown-menu dropdown-menu-right filter_menu",onClick:a[2]||(a[2]=_=>_.stopPropagation()),onScroll:a[3]||(a[3]=_=>r.handleFilterScroll())},[s.loading?h("",!0):(i(),c("li",ta,[d("div",aa,[z(d("input",{type:"text",class:"form-control",name:"label",placeholder:e.trans("search"),"onUpdate:modelValue":a[1]||(a[1]=_=>s.search=_)},null,8,sa),[[Je,s.search]])])])),(i(!0),c(L,null,ee(r.filteredList,_=>z((i(),c("li",{class:"nav-item fields",onClick:g=>r.onClick(_)},[d("a",{class:he(["nav-link",{active:s.selectedFields.map(g=>g.id).includes(_.id)}]),href:"javascript:;"},[s.selectedFields.map(g=>g.id).includes(_.id)?(i(),c("i",ra)):h("",!0),d("span",ia,D(r.subString(_.label)),1)],2)],8,la)),[[C,_.hover?_.hover:e.trans(_.label)]])),256)),!s.loading&&s.customFields.length===0?(i(),c("li",na,[d("p",oa,D(e.trans("no_results_found")),1)])):h("",!0),s.loading?(i(),c("li",da,[T(p,{size:30,duration:4e3,color:"#1d78ff"})])):h("",!0)],32)])}const ua=M($t,[["render",ca],["__scopeId","data-v-dd048500"]]),pa={name:"custom-form-fields",props:{formField:{type:Object,required:!0},allFields:{type:Array,default:()=>[]},classname:{type:String,default:"col-sm-6"}},data(){return{selectedVal:this.formField.value,uniqueId:this.formField.key,updatedFields:this.allFields,dropdownOptions:[],dropdownLabel:"label",country_code:null,showMobileField:!1}},watch:{allFields(e,a){this.updatedFields=e},formField(e,a){this.uniqueId=e.key,this.selectedVal=e.value,e.data_type==="checkbox"&&(this.selectedVal=Array.isArray(this.selectedVal)?this.selectedVal:this.selectedVal.split(",")),e.data_type==="mobile"&&this.selectedVal&&this.selectedVal.includes(" ")&&(this.selectedVal=this.selectedVal.split(" ")[1])}},beforeMount(){this.formField.data_type==="mobile"&&this.formField.value&&this.formField.value.includes(" ")?(this.country_code=this.formField.value.split(" ")[0],this.showMobileField=!0):this.showMobileField=!0},computed:{apiInfoUrl(){let e=ge.convertStringOfPropertiesToObject(this.formField.api_info).url;return!e&&this.formField.api_info&&(e=this.formField.api_info),e},dropdownKey(){return ge.convertStringOfPropertiesToObject(this.formField.api_info).key||"label"},selectedValue(){let e=this.updatedFields.findIndex(a=>a.key==this.uniqueId);if(e!=-1){if(this.formField.data_type==="mobile"&&this.selectedVal&&this.selectedVal.includes(" "))return this.selectedVal.split(" ")[1];if(Array.isArray(this.selectedVal)&&this.selectedVal!=null){let a=[];return this.selectedVal.forEach(t=>{typeof t=="object"?a.push(t.label):a.push(t)}),this.updatedFields[e].value=a.map(t=>t).toString(),this.updatedFields[e].options.filter(t=>a.includes(t.label))}else if(x(this.updatedFields[e].options)){let a="";return typeof this.selectedVal=="object"?a=this.selectedVal.label:a=this.selectedVal,this.updatedFields[e].options.find(t=>t.label===a)}else return this.selectedVal?this.selectedVal:""}else return this.selectedVal}},methods:{keypressEvent(e,a,t){if(t==="number"||t==="mobile"){e=e||window.event;var l=e.which?e.which:e.keyCode;if(l>31&&(l<48||l>57))e.preventDefault();else return!0}else if(t==="float"||t==="decimal"){e=e||window.event;var l=e.which?e.which:e.keyCode;if(l>=48&&l<=57||l==46)return!0;e.preventDefault()}},pasteEvent(e,a,t){if(t==="number"||t==="mobile")e=e||window.event,e.clipboardData.getData("Text").match(/[^\d]/)&&e.preventDefault();else if(t==="float"||t==="decimal"){e=e||window.event;var l=e.clipboardData||window.clipboardData,s=l.getData("Text");/^\d*\.\d*$/.test(s)||e.preventDefault()}},onCountryCodeUpdate(e,a){this[a]=e},onChange(e,a){let t=this.updatedFields.findIndex(l=>l.key==a);Array.isArray(e)&&e!=null?(this.updatedFields[t].value=e.map(l=>l.label).toString(),this.selectedVal=e):typeof e=="object"&&e!=null?(this.updatedFields[t].value=e[this.dropdownLabel],this.selectedVal=e):this.formField.data_type==="mobile"?(this.updatedFields[t].value=e?this.country_code+" "+e:"",this.selectedVal=e?this.country_code+" "+e:""):(this.updatedFields[t].value=e||"",this.selectedVal=e||""),this.$emit("updated",this.updatedFields)}},components:{MobileField:Ge,"dynamic-select":Pe,"text-field":Ae,"radio-field":it,"checkbox-field":nt,"date-time-field":Qe}};function ha(e,a,t,l,s,r){const p=b("date-time-field"),C=b("dynamic-select"),_=b("text-field"),g=b("radio-field"),H=b("checkbox-field"),P=b("MobileField");return i(),c("div",{class:he(t.classname)},[t.formField.data_type==="date"?(i(),v(p,{key:0,type:"datetime",label:t.formField.label,value:r.selectedValue,id:t.formField.key,required:!1,name:t.formField.key,onChange:r.onChange,format:"MMMM DD YYYY HH:mm",clearable:!0,outputFormat:"YYYY-MM-DD HH:mm:ss"},null,8,["label","value","id","name","onChange"])):h("",!0),t.formField.data_type==="select"?(i(),v(C,{key:1,id:t.formField.key,label:t.formField.label,multiple:!1,name:t.formField.key,apiEndpoint:r.apiInfoUrl,value:r.selectedValue,onChange:r.onChange,optionLabel:s.dropdownLabel},null,8,["id","label","name","apiEndpoint","value","onChange","optionLabel"])):h("",!0),t.formField.data_type==="text"||t.formField.data_type==="textarea"||t.formField.data_type==="number"||t.formField.data_type==="decimal"||t.formField.data_type==="email"?(i(),v(_,{key:2,id:t.formField.key,label:t.formField.label,type:t.formField.data_type,name:t.formField.key,value:r.selectedValue,onChange:r.onChange,from:"filter",keypressEvt:r.keypressEvent,pasteEvt:r.pasteEvent},null,8,["id","label","type","name","value","onChange","keypressEvt","pasteEvt"])):h("",!0),t.formField.data_type==="radio"?(i(),v(g,{key:3,name:t.formField.key,label:t.formField.label,options:t.formField.options,value:r.selectedValue,onChange:r.onChange,from:"filter"},null,8,["name","label","options","value","onChange"])):h("",!0),t.formField.data_type==="checkbox"?(i(),v(H,{key:4,name:t.formField.key,label:t.formField.label,options:t.formField.options,value:r.selectedValue,onChange:r.onChange,from:"filter"},null,8,["name","label","options","value","onChange"])):h("",!0),s.showMobileField&&t.formField.data_type==="mobile"?(i(),v(P,{key:5,id:t.formField.key,label:t.formField.label,type:t.formField.data_type,name:t.formField.key,value:r.selectedValue,onChange:r.onChange,isInlineForm:!1,countryCode:s.country_code,onCountryCode:a[0]||(a[0]=S=>r.onCountryCodeUpdate(S,"country_code")),keypressEvt:r.keypressEvent,pasteEvt:r.pasteEvent,extensionEnabled:0,ext:[]},null,8,["id","label","type","name","value","onChange","countryCode","keypressEvt","pasteEvt"])):h("",!0)],2)}const ma=M(pa,[["render",ha]]),fa={name:"save-report-modal",props:{modalMode:{type:String,required:!0},reportDataObj:{type:Object,required:!0},onClose:{type:Function,required:!0},from:{type:String,default:""},filterValues:{type:Object,default:()=>{}},filterArray:{type:Array,default:()=>[]},chartType:{type:String,default:""}},data(){return{title:"",name:"",description:"",isPublic:!0,isLoading:!1}},beforeMount(){this.setUpComponentPropertiesBasisOfMode()},methods:{setUpComponentPropertiesBasisOfMode(){this.modalMode==="fork"?this.title="fork_this_report":this.modalMode==="update"&&(this.name=this.reportDataObj.name,this.description=this.reportDataObj.description,this.isPublic=this.reportDataObj.is_public,this.title="update_this_report")},onSubmit(){this.isLoading=!0;let e;e=this.from==="sd_report"||this.from==="sd_report_home"?"service-desk/api/fork/sd-report":"api/agent/report-config",this.modalMode==="fork"&&(e=this.from==="sd_report"||this.from==="sd_report_home"?e:e+"/"+Xe(window.location.pathname)),R.post(e,this.from==="sd_report"||this.from==="sd_report_home"?this.getSdReportParams():this.getSaveReportParams()).then(a=>{setTimeout(()=>this.onClose(),1e3),Ue(a,"save-report-modal"),this.modalMode==="fork"?this.redirectToReporListPage():window.emitter.emit(this.from==="sd_report"?"refreshSdReport":this.from==="report-list"||this.from==="sd_report_home"?"refreshReportHomePage":"refreshReportEntryPage"),window.emitter.emit("updateAgentSidebar")}).catch(a=>{K(a,"save-report-modal")}).finally(a=>{this.isLoading=!1})},getSaveReportParams(){const e=JSON.parse(JSON.stringify(this.reportDataObj));return this.modalMode==="fork"&&(e.id=null),e.name=this.name,e.description=this.description,e.is_public=this.isPublic,e},getSdReportParams(){const e={},a=JSON.parse(JSON.stringify(this.reportDataObj));return this.modalMode==="update"&&(e.id=a.id),e.name=this.name,e.description=this.description,e.is_public=this.isPublic,e.chart_type=this.chartType,e.filters=this.formattedFilterData(),e.is_plugin=1,e.type=parseInt(a.type),e.is_default=0,e.parentId=a.id,e},formattedFilterData(){let e=et(this.filterArray,this.filterValues);return Object.keys(e).filter(a=>x(e[a])).map(a=>{let t=e[a];return{key:a,value:t}})},redirectToReporListPage(){setTimeout(()=>this.$router.push({name:"Reports Index"}),1e3)},onPropertyChange(e,a){this[a]=e}},components:{"text-field":Ae,checkbox:ot}},_a={class:"modal-title"},ya={key:0},ba={class:"save-report"},ga=["disabled"];function va(e,a,t,l,s,r){const p=b("alert"),C=b("custom-loader"),_=b("text-field"),g=b("checkbox"),H=b("modal"),P=fe("focus-first-input");return i(),v(H,{showModal:!0,onClose:t.onClose},{title:j(()=>[d("h4",_a,D(e.lang(s.title)),1)]),alert:j(()=>[T(p,{componentName:"save-report-modal"})]),fields:j(()=>[s.isLoading?(i(),c("div",ya,[T(C)])):h("",!0),z((i(),c("div",ba,[T(_,{id:"name",label:e.lang("name"),type:"text",name:"name",classname:"col-md-12",value:s.name,onChange:r.onPropertyChange,placehold:e.lang("enter_a_value"),required:!0},null,8,["label","value","onChange","placehold"]),T(_,{id:"description",label:e.lang("description"),type:"textarea",name:"description",classname:"col-md-12",value:s.description,onChange:r.onPropertyChange,placehold:e.lang("enter_a_value"),required:!0,"show-word-limit":!0,length:"180"},null,8,["label","value","onChange","placehold"]),T(g,{name:"isPublic",value:s.isPublic,label:e.lang("make_this_report_public"),onChange:r.onPropertyChange,classname:"col-md-12",id:"allow-only-ldap-login"},null,8,["value","label","onChange"])])),[[P]])]),controls:j(()=>[d("button",{class:"btn btn-primary",id:"new-report-submit",onClick:a[0]||(a[0]=(...S)=>r.onSubmit&&r.onSubmit(...S)),disabled:s.isLoading},[d("span",null,[d("i",{class:he(t.modalMode==="fork"?"fas fa-save":"fas fa-sync-alt")},null,2)]),Z(" "+D(e.trans(t.modalMode==="fork"?"save":"update")),1)],8,ga)]),_:1},8,["onClose"])}const ka=M(fa,[["render",va]]);const te=e=>(De("data-v-ea80bb50"),e=e(),Se(),e),Fa={key:0,class:"card-body"},Ca={class:"row"},wa={key:1,id:"table-filter"},Da={class:"row"},Sa={class:"card-footer"},Oa=te(()=>d("span",{class:"fas fa-check"},null,-1)),xa=te(()=>d("span",{class:"fas fa-sync"},null,-1)),Pa=te(()=>d("span",{class:"fas fa-clone"},null,-1)),Aa=te(()=>d("span",{class:"fas fa-undo"},null,-1)),Ua=te(()=>d("span",{class:"fas fa-times"},null,-1)),Ta={__name:"SdReportFilter",props:{metaData:{type:Array,required:!0},appliedFilters:{type:Object,default:()=>{}},from:{type:String,default:""},showCustomFilter:{type:Boolean,default:!1},updateFields:{type:Function,default:()=>{}},selectedFields:{type:Array,default:()=>[]},endPoint:{type:String,default:""},saveFilter:{type:Boolean,default:!1},filterFor:{type:String,default:""},filterNum:{type:[String,Number],default:""},redirectTo:{type:String,default:""},deleteUrl:{type:String,default:""},closeFilter:{type:Function,default:()=>{}},save_endpoint:{type:String,default:""},filterData:{type:Object,default:()=>{}},chartType:{type:String,default:()=>""}},emits:["selectedFilters"],setup(e,{emit:a}){const t=e,l=a,s=f(t.appliedFilters),r=f(t.metaData),p=f(!1),C=f({width:"49.5%"}),_=f({width:"20%"}),g=f(!1),H=f(""),P=f(t.filterNum),S=f(""),N=f("");Oe(()=>{G(),t.filterNum&&le(),N.value=t.filterData});const ae=m=>{for(var w in m)V(m[w].value,m[w].name)},G=()=>{t.updateFields(t.selectedFields);for(var m in t.selectedFields)V(t.selectedFields[m].value,t.selectedFields[m].name)},V=(m,w)=>{s.value[w]=m},q=()=>{l("selectedFilters",s.value)},J=()=>{l("selectedFilters","closeEvent")},Y=m=>{l("selectedFilters",s.value),S.value=m,g.value=!0},se=()=>{g.value=!1},W=()=>{s.value={},p.value=!0,setTimeout(()=>{p.value=!1},1e3),l("selectedFilters","resetEvent")},le=()=>{p.value=!0,axios.get("/service-desk/api/agent/sd-filter/"+P.value).then(m=>{p.value=!1;let w={},B=[];m.data.data.fields.map(A=>{A.key.indexOf("custom_")!==-1?(B.push(A),w[A.key]=A.value):w[A.key]=A.value_meta}),B.length&&re(B),s.value=w,r.value.map(function(A){A.section.map(function(E){w.hasOwnProperty(E.name)&&(E.value=w[E.name])})}),P.value=m.data.data.id,H.value=m.data.data.name}).catch(m=>{p.value=!1})},re=m=>{context.$refs.custom_table_filter.getCustomFields(t.endPoint,m)},Q=m=>{g.value=m};return(m,w)=>{const B=b("custom-loader"),A=b("faveo-box");return i(),v(A,{"box-class":"card card-light ",title:m.lang("filter")},{customActions:j(()=>[e.showCustomFilter?(i(),v(ua,{key:0,updateFilterFields:e.updateFields,selectedFilterFields:e.selectedFields,endPoint:e.endPoint,ref:"custom_table_filter"},null,8,["updateFilterFields","selectedFilterFields","endPoint"])):h("",!0)]),actions:j(()=>[d("div",Sa,[d("button",{id:"filter-apply-btn",class:"btn btn-primary",type:"button",onClick:q},[Oa,Z("  "+D(m.lang("apply")),1)]),N.value.is_default?h("",!0):(i(),c("button",{key:0,id:"filter-upd",class:"btn btn-primary",type:"button",onClick:w[0]||(w[0]=E=>Y("update"))},[xa,Z("  "+D(m.lang("edit")),1)])),d("button",{id:"filter-upd",class:"btn btn-primary",type:"button",onClick:w[1]||(w[1]=E=>Y("fork"))},[Pa,Z("  "+D(m.lang("fork")),1)]),d("button",{id:"reset-btn",class:"btn btn-primary",type:"button",onClick:W},[Aa,Z("  "+D(m.lang("reset")),1)]),d("button",{id:"filter-cancel-btn",class:"btn btn-danger",type:"button",onClick:J},[Ua,Z("  "+D(m.lang("cancel")),1)])])]),default:j(()=>[p.value?(i(),c("div",Fa,[d("div",Ca,[T(B,{"animation-duration":4e3,color:"#1d78ff",size:60})])])):(i(),c("div",wa,[(i(!0),c(L,null,ee(r.value,E=>(i(),c("div",Da,[(i(!0),c(L,null,ee(E.section,u=>(i(),c(L,null,[u.isCustom?(i(),v(ma,{key:0,formField:u,allFields:e.selectedFields,onUpdated:ae,classname:u.className},null,8,["formField","allFields","classname"])):(i(),c(L,{key:1},[u.type!=="date"&&u.type!=="number"&&u.type!=="text"?(i(),v(Pe,{key:u.name,id:u.name,name:u.name,apiEndpoint:u.url,classname:u.className,elements:u.elements,multiple:u.isMultiple,label:m.lang(u.label),value:u.value,onChange:V,strlength:"35",hint:m.lang(u.hint)},null,8,["id","name","apiEndpoint","classname","elements","multiple","label","value","hint"])):h("",!0),u.type==="number"?(i(),v(st,{label:m.lang(u.label),formStyle:C.value,value:u.value,key:u.name,id:u.name,name:u.name,classname:u.className,type:"text",onChange:V,min_placeholder:u.min_placeholder,max_placeholder:u.max_placeholder,required:!1},null,8,["label","formStyle","value","id","name","classname","min_placeholder","max_placeholder"])):h("",!0),u.type==="text"?(i(),v(rt,{label:m.lang(u.label),value:u.value,key:u.name,id:u.name,name:u.name,onChange:V,classname:u.className,required:!1},null,8,["label","value","id","name","classname"])):h("",!0),u.type==="date"?(i(),v(lt,{label:u.label,value:u.value,type:"datetime",key:u.name,id:u.name,name:u.name,onChange:V,range:u.range,required:!1,format:"MMMM DD YYYY, h:mm a",classname:u.className,clearable:!1,disabled:!1,editable:!0,currentYearDate:!1,"time-picker-options":u.timeOptions,isDateSelector:!1,numberStyle:_.value,confirm:!0},null,8,["label","value","id","name","range","classname","time-picker-options","numberStyle"])):h("",!0)],64))],64))),256))]))),256))])),g.value?(i(),v(ka,{key:2,onClose:se,filterArray:r.value,toggleFilterPopUp:Q,closeFilter:e.closeFilter,filterValues:s.value,reportDataObj:N.value,from:e.filterFor,"modal-mode":S.value,chartType:e.chartType},null,8,["filterArray","closeFilter","filterValues","reportDataObj","from","modal-mode","chartType"])):h("",!0)]),_:1},8,["title"])}}},Na=M(Ta,[["__scopeId","data-v-ea80bb50"]]),Va={1:[{section:[{name:"problem_ids",url:"/service-desk/api/dependency/problems",label:"problems"},{name:"dept_ids",url:"api/dependency/departments",label:"departments"},{name:"impact_ids",url:"/service-desk/api/dependency/impacts",label:"impact_type"}]},{section:[{name:"problem_statuses",url:"/service-desk/api/status/list?module=1",label:"status"},{name:"location_ids",url:"api/dependency/locations",label:"location"},{name:"priority_ids",url:"api/dependency/priorities",label:"priority"}]},{section:[{name:"assigned_ids",url:"api/dependency/agents?meta=true",label:"assigned"},{name:"asset_ids",url:"/service-desk/api/asset-list?meta=true",label:"assets"},{name:"ticket_ids",url:"api/dependency/tickets",label:"tickets"}]},{section:[{name:"requester_ids",url:"/api/dependency/users?meta=true",label:"requester"},{name:"change_ids",url:"/service-desk/api/dependency/changes",label:"changes"},{name:"created_at",type:"date",label:["created_at","created_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},range:!0}]},{section:[{name:"updated_at",type:"date",label:["updated_at","updated_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},range:!0}]},{section:[]}],2:[{section:[{name:"change_ids",url:"/service-desk/api/dependency/changes?meta=true",label:"changes",isCustom:!1},{name:"department_ids",url:"/api/dependency/departments",label:"departments",isCustom:!1},{name:"team_ids",url:"/api/dependency/teams",label:"teams",isCustom:!1}]},{section:[{name:"requester_ids",url:"/api/dependency/users?meta=true",label:"requester",isCustom:!1},{name:"status_ids",url:"/service-desk/api/status/list?module=2",label:"status",isCustom:!1},{name:"priority_ids",url:"/service-desk/api/dependency/change_priorities",label:"priority",isCustom:!1}]},{section:[{name:"change_type_ids",url:"/service-desk/api/dependency/change_types",label:"change_type",isCustom:!1},{name:"impact_ids",url:"/service-desk/api/dependency/impacts",label:"impact",isCustom:!1},{name:"location_ids",url:"/api/dependency/locations",label:"location",isCustom:!1}]},{section:[{name:"asset_ids",url:"/service-desk/api/asset-list?meta=true",label:"assets",isCustom:!1},{name:"release_ids",url:"/service-desk/api/dependency/releases",label:"releases",isCustom:!1},{name:"ticket_ids",url:"/api/dependency/tickets",label:"tickets",isCustom:!1}]},{section:[{name:"problem_ids",url:"/service-desk/api/dependency/problems",label:"problems",isCustom:!1},{name:"assignee-ids",url:"/api/dependency/agents",label:"Agent"},{name:"pending_approvers",url:"/api/dependency/users",label:"Pending Approvers"}]},{section:[{name:"created_at",type:"date",label:["created_at","created_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},range:!0,isCustom:!1},{name:"updated_at",type:"date",label:["updated_at","updated_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},pickers:!0,range:!0,isCustom:!1}]},{section:[]}],3:[{section:[{name:"release_ids",url:"/service-desk/api/dependency/releases",label:"releases"},{name:"release_statuses",url:"/service-desk/api/status/list?module=3",label:"status"},{name:"location_ids",url:"/api/dependency/locations",label:"location"}]},{section:[{name:"priority_ids",url:"/service-desk/api/dependency/release_priorities",label:"priority"},{name:"release_type_ids",url:"/service-desk/api/dependency/release_types",label:"release_type"},{name:"asset_ids",url:"/service-desk/api/dependency/assets",label:"assets"}]},{section:[{name:"change_ids",url:"/service-desk/api/dependency/changes",label:"changes"},{name:"planned_start_date",type:"date",label:["planned_start_date","planned_start_date_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},range:!0},{name:"planned_end_date",type:"date",label:["planned_end_date","planned_end_date_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},range:!0}]},{section:[{name:"created_at",type:"date",label:["created_at","created_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},range:!0},{name:"updated_at",type:"date",label:["updated_at","updated_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},range:!0}]},{section:[]}],4:[{section:[{name:"asset_ids",url:"/service-desk/api/dependency/assets",label:"assets",isCustom:!1},{name:"problem_ids",url:"/service-desk/api/dependency/problems",label:"problems",isCustom:!1},{name:"change_ids",url:"/service-desk/api/dependency/changes",label:"changes",isCustom:!1}]},{section:[{name:"release_ids",url:"/service-desk/api/dependency/releases",label:"releases",isCustom:!1},{name:"contract_ids",url:"/service-desk/api/dependency/contracts",label:"contracts",isCustom:!1},{name:"asset_type_ids",url:"/service-desk/api/dependency/asset_types",label:"asset_types",isCustom:!1}]},{section:[{name:"used_by_ids",url:"api/dependency/users?meta=true",label:"used_by",isCustom:!1},{name:"managed_by_ids",url:"api/dependency/agents?meta=true",label:"managed_by",isCustom:!1},{name:"location_ids",url:"api/dependency/locations",label:"location",isCustom:!1}]},{section:[{name:"dept_ids",url:"api/dependency/departments",label:"departments",isCustom:!1},{name:"org_ids",url:"api/dependency/organizations",label:"organizations",isCustom:!1},{name:"product_ids",url:"/service-desk/api/dependency/products",label:"products",isCustom:!1}]},{section:[{name:"assigned_on",type:"date",label:["assigned_on","assigned_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},isCustom:!1,range:!0},{name:"created_at",type:"date",label:["created_at","created_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},isCustom:!1,range:!0},{name:"updated_at",type:"date",label:["updated_at","updated_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},isCustom:!1,range:!0}]},{section:[{name:"impact_type_ids",url:"/service-desk/api/dependency/impacts",label:"impact_types",isCustom:!1},{name:"ticket_ids",url:"/api/dependency/tickets",label:"ticket",isCustom:!1},{name:"asset_status_ids",url:"/service-desk/api/status/list?module=4",label:"asset_status",isCustom:!1}]},{section:[{name:"depreciation_ids",url:"/service-desk/api/dependency/depreciation",label:"Depreciation",isCustom:!1}]},{section:[]}],5:[{section:[{name:"contract_ids",url:"/service-desk/api/dependency/contracts",label:"contracts"},{name:"contract_type_ids",url:"/service-desk/api/dependency/contract_types",label:"contract_type"},{name:"approver_ids",url:"/api/dependency/agents?meta=true",label:"approver"}]},{section:[{name:"vendor_ids",url:"/service-desk/api/dependency/vendors",label:"vendors"},{name:"license_type_ids",url:"/service-desk/api/dependency/license_types",label:"license_type"},{name:"contract_statuses",url:"/service-desk/api/status/list?module=5",label:"status"}]},{section:[{name:"renewal_status_ids",url:"/service-desk/api/dependency/contract_renewal_statuses",label:"renewal_status"},{name:"owner_ids",url:"/api/dependency/agents",label:"owner"},{name:"asset_ids",url:"/service-desk/api/dependency/assets",label:"assets"}]},{section:[{name:"notify_agent_ids",url:"/api/dependency/agents?meta=true",label:"notify_agents"},{name:"cost",label:"cost",type:"number"},{name:"notify_in_days",label:"notify_before",type:"number"}]},{section:[{name:"contract_start_date",type:"date",label:["contract_start_date","contract_start_date_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},range:!0},{name:"contract_end_date",type:"date",label:["contract_end_date","contract_end_date_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},range:!0},{name:"created_at",type:"date",label:["created_at","created_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},range:!0}]},{section:[{name:"updated_at",type:"date",label:["updated_at","updated_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},range:!0}]},{section:[]}],7:[{section:[{name:"software_licenses_ids",url:"service-desk/api/dependency/softwarelicense",label:"Software License",isCustom:!1},{name:"license_type",url:"/service-desk/api/dependency/license_types",label:"License type",isCustom:!1},{name:"depreciation_ids",url:"/service-desk/api/dependency/depreciation",label:"Depreciation",isCustom:!1}]},{section:[{name:"vendor_ids",url:"/service-desk/api/dependency/vendors",label:"Vendor",isCustom:!1},{name:"manufacturer_ids",url:"/service-desk/api/dependency/manufacturer",label:"Manufacturer",isCustom:!1},{name:"org_ids",url:"/api/dependency/organizations",label:"Organization",isCustom:!1}]},{section:[{name:"asset_ids",url:"service-desk/api/dependency/assets",label:"Assets",isCustom:!1},{name:"used_by_ids",url:"api/dependency/users?meta=true",label:"Users",isCustom:!1},{name:"created_at",type:"date",label:["created_at","created_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},range:!0,isCustom:!1}]},{section:[{name:"updated_at",type:"date",label:["updated_at","updated_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},pickers:!0,range:!0,isCustom:!1}]},{section:[]}]},Ea={class:"col-sm-12",id:"sd-report-template"},Ma={class:"card card-light report-box-primary"},Ra={class:"card-header"},La={class:"card-title"},Ia={class:"card-tools"},Ha={class:"btn-group"},qa=d("i",{class:"glyphicon glyphicon-filter"},null,-1),Ba=[qa],ja=d("i",{class:"fas fa-paper-plane","aria-hidden":"true"},null,-1),za=[ja],Ja=d("i",{class:"fas fa-calendar","aria-hidden":"true"},null,-1),Ya=[Ja],Wa={class:"card-body"},Za={class:"row mb-3"},Ka={class:"col-sm-12"},$a={class:"float-right btn-group"},Ga={class:"btn btn-sm btn-default dropdown-toggle",id:"chart-type-dropdown","data-toggle":"dropdown"},Qa={class:"dropdown-menu dropdown-menu-right",style:{},"aria-labelledby":"chart-type-dropdown"},Xa=["onClick"],es={class:"data-widget"},ts={class:"row"},as={class:"card card-light"},ss={class:"card-header"},ls={class:"card-title"},rs={class:"card-body"},_s={__name:"SDReports",props:{id:{type:Number,default:""},type:{type:String,default:""},module:{type:Number,default:""},schedule:{type:Number,default:""}},setup(e){const a=e,t=Ye(),l=f(""),s=f(""),r=f(""),p=f([]),C=f([]),_=f([]),g=f(!1),H=f(["bar","horizontal","pie","doughnut"]),P=f(""),S=f([]),N=f(!1),ae=f({}),G=f([]),V=f([]),q=f(""),J=f(""),Y=f(!1),se=f(""),W=f(!1),le=f(""),re=f(!1),Q=f(0);Oe(()=>{l.value=a.id,J.value=a.type,S.value=Va[a.module];const n={"change-report":"/custom-field-flattened?category=changes&type=changes","asset-report":"/custom-field-flattened?category=asset&type=asset","software-license-report":"/custom-field-flattened?category=license&type=license","problem-report":"/custom-field-flattened?category=problem&type=problem","contract-report":"/custom-field-flattened?category=contract&type=contract","release-report":"/custom-field-flattened?category=release&type=release"};W.value=n.hasOwnProperty(J.value),le.value=n[J.value]||"",se.value=W.value?S.value.length-1:S.value.length,ye(),a.schedule&&Ie(a.schedule),B()}),We(()=>{window.emitter.on("updateFilter",m),window.emitter.on("refreshSdReport",()=>Y.value=!0)}),Ze(Y,(n,o)=>{n===!0&&(N.value=!1,ye()),Y.value=!1});const m=n=>{S.value.map(function(o){o.section.map(function(y){n.name===y.name&&(y.value=n.value)})})},w=n=>{n.forEach(o=>{o.isCustom&&o.type==="checkbox"&&o.value&&(o.value=Array.isArray(o.value)?o.value:o.value.split(","))}),W.value&&(G.value=n,S.value[se.value].section=n)},B=()=>{S.value.map(function(n){n.section.map(function(o){o.isCustom||(o.elements=[],o.isMultiple=!0),o.isPrepopulate=!1,o.value="",o.className="col-sm-4"})})},A=n=>n==="closeEvent"?N.value=!1:n==="resetEvent"?E():u(n),E=()=>{q.value="/service-desk/api/sd-report/"+s.value+"/"+l.value,ie(),w([]),window.emitter.emit("clearCustomFields"),S.value=S.value.map(function(n){return n.section.map(function(o){o.isCustom||(o.elements=[],o.isMultiple=!0),o.isPrepopulate=!1,o.value="",o.className="col-sm-4"}),n})},u=n=>{ae.value=n,G.value.forEach(U=>{n.hasOwnProperty(U.name)&&(U.value=n[U.name])});const o=`/service-desk/api/sd-report/${s.value}/${l.value}?`,y=new URLSearchParams(tt(S.value,n));let O=y.toString();O.endsWith("&")&&(O=O.slice(0,-1));const F=new URLSearchParams(y),k=Object.fromEntries(F);V.value=Ve(k),q.value=o+decodeURIComponent(O),ie("fromFilter")},Ve=n=>{const o={};for(const y in n){const O=y.match(/([a-zA-Z_]+)\[(\d+)\]/);if(O){const[F,k,U]=O;o[k]=o[k]||[],o[k][U]=parseInt(n[y],10)}}return o},_e=()=>{N.value=!N.value},ye=async()=>{g.value=!0;try{const o=(await R.get(`service-desk/api/report/details/${l.value}?include_filters=1`)).data.data,{sd_filter:y,name:O,type:F}=o;p.value=o,C.value=y?y.id:"",r.value=O,s.value=F;let k="";if(C.value){const{filter_meta:U}=y;U.forEach((X,qe)=>{const{key:Be,value:ne}=X;(Array.isArray(ne)?ne:[ne]).forEach((je,be)=>{k+=`${qe||be?"&":""}${Be}${Array.isArray(ne)?`[${be}]`:""}=${je}`})})}q.value=`/service-desk/api/sd-report/${s.value}/${l.value}${k?`?${k}`:""}`,await a.schedule||ie()}catch(n){g.value=!1,K(n,"sd-reports-view")}},ie=n=>{R.get(q.value).then(o=>{_.value=o.data.data,Ee();const y=_.value.charts[0].chart_type;Q.value++,n||(P.value=y==="donut_chart"?"doughnut":y)}).catch(o=>{K(o,"sd-reports-view")}).finally(()=>{g.value=!1})},Ee=()=>{const{charts:n=[],widgets:o=[]}=_.value,y=n.every(F=>F.chart_parameters.length===0),O=o.every(F=>F.value===0);re.value=!y||!O},Me=n=>{P.value=n,Re(n)},Re=n=>{let o={};o.report_id=l.value,o.chart_type=n,R.post("service-desk/api/report/update/chart-type",o).then(y=>{}).catch(y=>{K(y,"sd-reports-view")})},Le=async()=>{const n=new FormData,o=document.getElementById("sd-report-template"),y=o.querySelectorAll(".btn-group");N.value===!0&&(N.value=!1),y.forEach(F=>{F.style.display="none"}),o.querySelectorAll("h3").forEach(F=>{F.style.whiteSpace="nowrap"});try{const F=await Ke(o);y.forEach(X=>{X.style.display="block"});const k=await fetch(F).then(X=>X.blob());n.append("report_id",l.value),n.append("image",k,"report.png"),g.value=!0;const U=await R.post("api/export/graphical-report",n);Ue(U,"sd-reports-view"),g.value=!1}catch(F){g.value=!1,K(F,"sd-reports-view")}},Ie=n=>{R.get("/api/schedule-filters/"+n).then(o=>{const y=`/service-desk/api/sd-report/${a.module}/${l.value}?`;q.value=y+o.data.data,ie()}).catch(o=>{K(o,"sd-reports-view")})},He=()=>{let n=JSON.stringify(V.value);t.push({path:"/reports/schedule/add/"+J.value+"/"+l.value,query:{params:n,type:"sd-reports"}})};return(n,o)=>{const y=b("alert"),O=b("custom-loader"),F=fe("tooltip");return i(),c("div",Ea,[T(y,{componentName:"sd-reports-view"}),d("div",Ma,[d("div",Ra,[d("h3",La,D(r.value),1),d("div",Ia,[d("div",Ha,[z((i(),c("button",{id:"report-filter",type:"button",class:"btn btn-tool",onClick:_e},Ba)),[[F,n.lang("Report configuration/filter")]]),re.value?(i(),c(L,{key:0},[z((i(),c("button",{id:"export-report-btn",type:"button",class:"btn btn-tool",onClick:Le},za)),[[F,n.lang("export")]]),z((i(),c("button",{id:"schedule-report",class:"btn btn-tool",onClick:He},Ya)),[[F,n.lang("schedule")]])],64)):h("",!0)])])]),d("div",Wa,[N.value?(i(),v(Na,{key:0,id:"filter-box",metaData:S.value,selectedFields:G.value,onSelectedFilters:A,showCustomFilter:W.value,updateFields:w,appliedFilters:ae.value,saveFilter:!0,endPoint:le.value,filterNum:C.value,filterFor:"sd_report",redirectTo:"/service-desk/reports'",closeFilter:_e,save_endpoint:"/service-desk/api/agent/sd-filter/",filterData:p.value,chartType:P.value},null,8,["metaData","selectedFields","showCustomFilter","appliedFilters","endPoint","filterNum","filterData","chartType"])):h("",!0),d("div",null,[d("div",null,[g.value?(i(),v(O,{key:0,"animation-duration":4e3,color:"#1d78ff",size:60})):h("",!0),d("div",Za,[d("div",Ka,[d("div",$a,[d("button",Ga,D(n.lang("chart_type")),1),d("div",Qa,[(i(!0),c(L,null,ee(H.value,k=>(i(),c("a",{key:k,class:he(["dropdown-item",P.value===k?"active":""]),href:"javascript:;",onClick:U=>Me(k)},D(n.trans("view_by"))+" "+D(n.trans(k)),11,Xa))),128))])])])]),d("div",es,[_.value.widgets?(i(),v(at,{"data-widget-data":_.value.widgets,key:Q.value},null,8,["data-widget-data"])):h("",!0)]),d("div",ts,[(i(!0),c(L,null,ee(_.value.charts,k=>(i(),c("div",{class:"col-sm-6",key:k.id},[d("div",as,[d("div",ss,[d("h3",ls,D(k.name),1)]),d("div",rs,[(i(),v(Kt,{chartData:k,type:P.value,showTitle:!1,from:"sd-reports",redirectUrls:k.chart_parameters.map(U=>U.redirect_url),key:Q.value},null,8,["chartData","type","redirectUrls"]))])])]))),128))])])])])])])}}};export{Kt as C,ka as S,_s as _,ua as a,ma as b,ms as c,hs as d,Ne as g,me as h,fs as p,Te as t};
