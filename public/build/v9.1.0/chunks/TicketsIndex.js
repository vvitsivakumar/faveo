import{a as S,r as u,o as n,b as C,w as f,f as a,t as r,c as l,d,e as _,g as m,q as z,i as k,G as E,F as T,h as P,n as M,T as q,p as N,j as V,a4 as he,u as H,m as O,y as Ce,B as ce,s as ve,v as Te,a0 as we,V as Ge,ax as ue,W as Ze,aA as De,K as Je,A as Ye}from"./vendor.js";import{_ as A,s as x,e as L,Z as Se,l as Q,f as te,p as Z,D as K,v as Me,w as Ae,R as Ie,C as Fe,A as Le,b as Re,M as me,V as oe,c as se,r as Qe,j as ie,S as Xe,q as $e,o as Pe,k as J,a3 as Oe}from"./bootstrap.js";import{i as je,M as et,j as xe,C as Ne,T as tt}from"./FormGenerator.js";import{C as Ve}from"./Loader.js";import{A as st,a as it,v as at}from"./approvalTicketRules.js";import{f as ot}from"./DataTableActions.js";const nt={name:"delete-ticket-modal",description:"Delete ticket Modal component",props:{showModal:{type:Boolean,default:!1},ticketIds:{type:Array},onClose:{type:Function},componentTitle:{type:String,default:"UserTickets"},reloadTickets:{type:Function}},data:()=>({isDisabled:!1,containerStyle:{width:"600px"},loading:!1,size:60}),methods:{onSubmit(){this.loading=!0,this.isDisabled=!0;const e={"ticket-ids":this.ticketIds};S.post("api/ticket/delete-forever",e).then(t=>{this.loading=!1,this.isDisabled=!0,this.reloadTickets(),x(t,this.componentTitle),this.onClose()}).catch(t=>{this.loading=!1,this.isDisabled=!1,L(t,this.componentTitle)})}}},lt={class:"modal-title"},rt={key:0},dt={key:1,class:"row"},ct=["disabled"],ht=a("i",{class:"fas fa-trash"},null,-1);function ut(e,t,s,c,i,o){const h=u("reuse-loader"),p=u("modal");return s.showModal?(n(),C(p,{key:0,showModal:s.showModal,onClose:s.onClose,containerStyle:e.containerStyle},{title:f(()=>[a("h4",lt,r(e.lang("delete_ticekt_forever")),1)]),fields:f(()=>[e.loading?d("",!0):(n(),l("div",rt,[a("span",null,r(e.lang("are_you_sure_you_want_to_delete")),1)])),e.loading?(n(),l("div",dt,[_(h,{"animation-duration":4e3,color:"#1d78ff",size:e.size},null,8,["size"])])):d("",!0)]),controls:f(()=>[a("button",{type:"button",onClick:t[0]||(t[0]=g=>o.onSubmit()),class:"btn btn-danger",disabled:e.isDisabled},[ht,m(" "+r(e.lang("delete")),1)],8,ct)]),_:1},8,["showModal","onClose","containerStyle"])):d("",!0)}const mt=A(nt,[["render",ut]]);const _t={name:"ticket-actions",description:"Ticket actions component",props:{selectedTickets:{type:[Array,String],default:()=>[]},tickets:{type:[Array,String],default:()=>[]},buttonStyle:{type:Object,default:()=>{}},loadTickets:{type:Function},page:{type:String,default:""},archive:{type:Boolean,default:!1},label:{type:String,default:""}},data(){return{loading:!1,parent_tickets:[],showStatusModal:!1,change_status:"",statusList:"",showAssignModal:!1,showMergeModal:!1,showDeleteModal:!1,statusDiv:0}},methods:{modalMethod(e,t){e!=="merge-ticket"?this.selectedTickets.length>0?this[t]=!0:alert("Please select tickets."):this.mergeTicket(e)},getStatusList(){if(this.statusList="",this.selectedTickets.length>0){this.loading=!0;let e={meta:!0,supplements:Se(this.selectedTickets),limit:"all"};S.get("/api/dependency/statuses",{params:e}).then(t=>{this.loading=!1,this.statusList=t.data.data.statuses}).catch(t=>{this.loading=!1})}else this.statusDiv+=1,alert("Please select tickets.")},getStatus(e){this.selectedTickets.length>0?(this.showStatusModal=!0,this.change_status=e):(alert("Please select tickets."),this.showStatusModal=!1)},mergeTicket(e){this.selectedTickets.length>1?this.showMergeModal=!0:(this.showMergeModal=!1,alert(Q("please_select_more_than_2_tickets")))},onClose(){this.statusDiv++,this.showStatusModal=!1,this.showAssignModal=!1,this.showMergeModal=!1,this.showDeleteModal=!1,this.$store.dispatch("unsetValidationError")}},components:{"change-status-modal":je,"merge-ticket-modal":et,"assign-ticket-modal":xe,"delete-ticket-modal":mt}},ne=e=>(N("data-v-6ff646cc"),e=e(),V(),e),pt={key:0,class:"display_in"},gt=ne(()=>a("i",{class:"far fa-hand-point-right"},null,-1)),ft=[gt],kt=ne(()=>a("i",{class:"fas fa-cogs"},null,-1)),bt=[kt],yt=ne(()=>a("i",{class:"fas fa-trash"},null,-1)),vt=ne(()=>a("i",{class:"fas fa-exchange-alt"},null,-1)),wt=[vt],Ct={key:0,class:"dropdown-menu status-list"},Tt={key:0,class:"row"},Dt=["onClick"],St={key:1,class:"dropdown-item",href:"javascript:;"};function Mt(e,t,s,c,i,o){const h=u("reuse-loader"),p=u("change-status-modal"),g=u("assign-ticket-modal"),v=u("merge-ticket-modal"),D=u("delete-ticket-modal"),b=z("tooltip");return s.archive?d("",!0):(n(),l("div",pt,[k((n(),l("button",{type:"button",style:E(s.buttonStyle),class:"btn btn-md bg-white btn-default",onClick:t[0]||(t[0]=w=>o.modalMethod("assign_ticket","showAssignModal")),id:"assign"},ft,4)),[[b,e.lang("assign-ticket")]]),k((n(),l("button",{type:"button",class:"btn btn-md bg-white btn-default",style:E(s.buttonStyle),onClick:t[1]||(t[1]=w=>o.modalMethod("merge-ticket")),id:"merge"},bt,4)),[[b,e.lang("merge-ticket")]]),s.page==="trash"?k((n(),l("button",{key:0,type:"button",class:"btn btn-md btn-danger",onClick:t[2]||(t[2]=w=>o.modalMethod("delete-ticket","showDeleteModal")),id:"delete"},[yt,m(" "+r(e.lang("delete_forever")),1)])),[[b,e.lang("delete-tickets")]]):d("",!0),(n(),l("div",{class:"btn-group",key:i.statusDiv},[k((n(),l("button",{type:"button",class:"btn btn-md bg-white btn-default dropdown-toggle","data-toggle":"dropdown",style:E(s.buttonStyle),onClick:t[3]||(t[3]=w=>o.getStatusList()),id:"status"},wt,4)),[[b,e.lang("change_status")]]),s.selectedTickets.length>0?(n(),l("div",Ct,[i.loading?(n(),l("div",Tt,[_(h,{"animation-duration":4e3,color:"#1d78ff",size:30})])):d("",!0),i.loading?d("",!0):(n(),l(T,{key:1},[i.statusList&&i.statusList.length>0?(n(!0),l(T,{key:0},P(i.statusList,w=>(n(),l("a",{class:"dropdown-item",onClick:F=>o.getStatus(w),href:"javascript:;"},[a("i",{class:M(w.icon),style:E({color:w.icon_color})},null,6),m("  "+r(w.name),1)],8,Dt))),256)):d("",!0),i.statusList&&i.statusList.length===0?(n(),l("a",St,r(e.lang("no-records")),1)):d("",!0)],64))])):d("",!0)])),_(q,{name:"modal"},{default:f(()=>[i.showStatusModal?(n(),C(p,{key:0,onClose:o.onClose,showModal:i.showStatusModal,ticketIds:s.selectedTickets,status:i.change_status,componentTitle:"inbox",reloadTickets:s.loadTickets,label:!0},null,8,["onClose","showModal","ticketIds","status","reloadTickets"])):d("",!0)]),_:1}),_(q,{name:"modal"},{default:f(()=>[i.showAssignModal?(n(),C(g,{key:0,onClose:o.onClose,showModal:i.showAssignModal,ticketIds:s.selectedTickets,componentTitle:"inbox",reloadTickets:s.loadTickets,tickets:s.tickets},null,8,["onClose","showModal","ticketIds","reloadTickets","tickets"])):d("",!0)]),_:1}),_(q,{name:"modal"},{default:f(()=>[i.showMergeModal?(n(),C(v,{key:0,onClose:o.onClose,showModal:i.showMergeModal,ticketIds:s.selectedTickets,componentTitle:"inbox",reloadTickets:s.loadTickets},null,8,["onClose","showModal","ticketIds","reloadTickets"])):d("",!0)]),_:1}),_(q,{name:"modal"},{default:f(()=>[i.showDeleteModal?(n(),C(D,{key:0,onClose:o.onClose,showModal:i.showDeleteModal,ticketIds:s.selectedTickets,componentTitle:"inbox",reloadTickets:s.loadTickets},null,8,["onClose","showModal","ticketIds","reloadTickets"])):d("",!0)]),_:1})]))}const At=A(_t,[["render",Mt],["__scopeId","data-v-6ff646cc"]]);const It={props:{from:{type:Object,default:()=>{}},tableHeader:{type:String,default:""},archive:{type:Boolean,default:!1}},computed:{fullName(){return te(this.from)?`${this.from.first_name} ${this.from.last_name}`:""},getUserName(){return te(this.from)&&(this.from.first_name==""||this.from.first_name==null)&&this.from.user_name?this.from.user_name:""},isUnassigned(){return this.fullName===""&&this.getUserName===""},hoverContent(){return te(this.from)?`
            <div class='card card-light card-widget mb-0'>

              <div class='card-header pad-7'>

              <div class="user-panel d-flex">
                
                <div>

                  <img src=${this.from.profile_pic} class="img-circle" alt="User Image">
                </div>
                
                <div class="info">
                  
                  <a class="d-block">
                    ${this.from.first_name!==""?this.subString(this.from.first_name+" "+this.from.last_name):this.subString(this.from.user_name)}
                  </a>
                </div>
              </div>
              </div>

              <div class='card-body info-body'>

                <ul class='nav nav-stacked'>

                  <li id='b_bottom'>
                    <a id='cus-link' title=${this.from.email} >

                      <i class='fas fa-envelope'></i>&nbsp;
                        ${this.from.email?this.subString(this.from.email):"---"}
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          `:""}},methods:{subString(e,t){return Z(e,e.includes("@")?50:25)},showUser(e){return te(e)?"/user/"+e.id:""},showArchiveduser(e){return this.basePath()+"/panel/user/"+e.id}}},_e=e=>(N("data-v-aab616c5"),e=e(),V(),e),Ft={class:"inbox-info"},Lt={class:"emphasize"},Rt={key:1},Pt=["href","data-content"],Ot={class:"emphasize"},jt={class:"card card-light card-widget mb-0"},xt={class:"card-header pad-7"},Nt={class:"user-panel d-flex"},Vt={class:"hover-img"},Et=["src"],Bt={key:1,src:"https://www.kindpng.com/picc/m/24-248253_user-profile-default-image-png-clipart-png-download.png",class:"img-circle",alt:"Image"},Ut={class:"info"},qt={class:"d-block font-weight-bold font-size-14"},zt={class:"card-body info-body"},Ht={class:"nav nav-stacked"},Kt={id:"b_bottom"},Wt=["title"],Gt=_e(()=>a("i",{class:"fas fa-envelope"},null,-1)),Zt=_e(()=>a("br",null,null,-1)),Jt=["title"],Yt=_e(()=>a("i",{class:"fas fa-phone mr-1"},null,-1)),Qt={key:0,style:{color:"red"}};function Xt(e,t,s,c,i,o){const h=u("router-link"),p=u("popover");return n(),l("span",Ft,[_(p,{hover:"",arrow:"",placement:"top"},he({default:f(()=>[s.archive?(n(),l("div",Rt,[a("a",{href:o.showArchiveduser(s.from),"data-content":o.hoverContent,target:"_blank"},[a("span",Ot,[m(r(o.subString(o.fullName))+" ",1),a("span",null,r(o.subString(o.getUserName)),1)])],8,Pt)])):(n(),C(h,{key:0,class:"user_name pop",to:o.showUser(s.from),"data-container":"body","data-toggle":"popover","data-placement":"right","data-content":o.hoverContent,target:"_blank"},{default:f(()=>[a("span",Lt,[m(r(o.subString(o.fullName))+" ",1),a("span",null,r(o.subString(o.getUserName)),1)])]),_:1},8,["to","data-content"]))]),_:2},[s.from?{name:"content",fn:f(()=>[a("div",jt,[a("div",xt,[a("div",Nt,[a("div",Vt,[s.from.profile_pic?(n(),l("img",{key:0,src:s.from.profile_pic,class:"img-circle imgupdate",alt:"User Image"},null,8,Et)):(n(),l("img",Bt))]),a("div",Ut,[a("a",qt,r(s.from.first_name!=""?o.subString(s.from.first_name+" "+s.from.last_name):o.subString(s.from.user_name)),1)])])]),a("div",zt,[a("ul",Ht,[a("li",Kt,[a("a",{id:"cus-link",title:s.from.email},[Gt,m(" "+r(s.from.email?o.subString(s.from.email):"---"),1)],8,Wt),Zt,this.from.mobile||this.from.phone_number?(n(),l("a",{key:0,id:"cus-link mt-1",title:s.from.mobile},[Yt,m(" "+r(s.from.mobile?o.subString(s.from.mobile):"---"),1)],8,Jt)):d("",!0)])])])])]),key:"0"}:void 0]),1024),o.isUnassigned?(n(),l("span",Qt,r(e.lang("unassigned")),1)):d("",!0)])}const Ee=A(It,[["render",Xt],["__scopeId","data-v-aab616c5"]]);const $t={name:"ticket-popover",setup(){const e=H();return{formattedTime:O(()=>e.getters.formattedTime)}},props:{details:{type:Object,default:()=>{}},tableHeader:{type:String,default:""},onTicketClick:{type:Function},archive:{type:Boolean,default:!1}},data(){return{bgStyle:{background:this.tableHeader},hasData:!1,popUpData:"",delay:300,clicks:0,timer:null}},mounted(){console.log("details",this.details)},methods:{subString(e,t=10){return Z(e,t)},getPopData(e){this.hasData=!1,S.get("/ticket/tooltip?ticketid="+e).then(t=>{this.hasData=!0,this.popUpData=t.data}).catch(t=>{this.hasData=!1})},onClick(e,t){!t.target.className.includes("tic-pop")&&!t.target.className.includes("tic-pop-i")&&(this.$store.dispatch("setTicketId",e),this.clicks++,this.clicks===1?this.timer=setTimeout(()=>{this.clicks=0,this.onTicketClick(e)},this.delay):this.redirectMethod(e))},redirectMethod(e,t){this.clicks=0,clearTimeout(this.timer),t=="_blank"?window.open(this.basePath()+"/panel/thread/"+e,"_blank"):this.$router.push({path:"/thread/"+e})},openContextMenu(e){let t=this.$refs.right_click_menu;this.archive?t.href=this.basePath()+"/admin/tickets-archive/show":t.href=this.basePath()+"/panel/thread/"+this.details.id},scrollClick(e){e.button===1&&this.openContextMenu()}}},pe=e=>(N("data-v-f551e43c"),e=e(),V(),e),es={class:"inbox-pop"},ts=["data-pjax"],ss=pe(()=>a("i",{class:"fas fa-question-circle tic-pop-i"},null,-1)),is=[ss],as={key:0,class:"row",id:"load_margin"},os={key:1,class:"card card-light card-widget m_5"},ns={class:"card-header pad-10"},ls={class:"user-block"},rs={class:"username text-capitalize mb-6"},ds={href:"javascript:;"},cs={class:"description fw-400"},hs={class:"card-body pb-0 pad-10"},us=["innerHTML"],ms={key:0,class:"mr-1"},_s=pe(()=>a("i",{class:"glyphicon glyphicon-paperclip"},null,-1)),ps=[_s],gs={key:1,class:"mr-1"},fs=pe(()=>a("i",{class:"fas fa-users"},null,-1)),ks=[fs];function bs(e,t,s,c,i,o){const h=u("reuse-loader"),p=u("faveo-image-element"),g=u("popover"),v=z("tooltip");return n(),l("div",es,[k((n(),l("a",{href:"javascript:;",ref:"right_click_menu",onContextmenu:t[0]||(t[0]=D=>o.openContextMenu(D)),class:M({"fw-400":s.details.isanswered}),onMousedown:t[1]||(t[1]=D=>o.scrollClick(D))},[a("span",{class:"ticket-no","data-pjax":s.details.id},"[#"+r(s.details.ticket_number)+"] ‏",9,ts),m(" "+r(o.subString(s.details.title,50))+" ‏(‎"+r(s.details.thread_count)+") ",1)],34)),[[v,s.details.title]]),_(g,{click:"",arrow:"",placement:"right"},{content:f(()=>[i.hasData?d("",!0):(n(),l("div",as,[_(h,{"animation-duration":4e3,color:"#1d78ff",size:30})])),i.hasData?(n(),l("div",os,[a("div",ns,[a("div",ls,[_(p,{id:"popover-img","source-url":s.details.from.profile_pic,classes:["img-circle"]},null,8,["source-url"]),a("div",null,[k((n(),l("span",rs,[a("a",ds,r(i.popUpData.user_name?o.subString(i.popUpData.user_name,30):o.subString(i.popUpData.email,30)),1)])),[[v,i.popUpData.user_name?i.popUpData.user_name:i.popUpData.email]]),a("span",cs,r(e.lang("created_at"))+" : "+r(c.formattedTime(i.popUpData.created_at)),1)])])]),a("div",hs,[a("p",{innerHTML:i.popUpData.body},null,8,us)])])):d("",!0)]),default:f(()=>[s.archive?d("",!0):k((n(),l("a",{key:0,class:"tic-pop mr-1",href:"javascript:;",onClick:t[2]||(t[2]=D=>o.getPopData(s.details.id))},is)),[[v,e.trans("click_to_see_details")]])]),_:1}),s.details.attachment_count!==0?(n(),l("span",ms,ps)):d("",!0),s.details.collaborator_count!==0&&s.details.collaborator_count!==null?(n(),l("span",gs,ks)):d("",!0),(n(!0),l(T,null,P(s.details.labels,(D,b)=>k((n(),l("a",{href:"javascript:;",class:"badge mr-1",style:E({backgroundColor:D.color,color:"#FFF"})},[m(r(o.subString(D.value)),1)],4)),[[v,e.lang(D.value)]])),256))])}const ys=A($t,[["render",bs],["__scopeId","data-v-f551e43c"]]);const vs={props:{from:{type:Object,default:()=>{}}},computed:{hoverContent(){return te(this.from)?`
            <div class='card card-light card-widget mb-0 org-toolip'>

              <div class='card-header pad-7'>

              <div class="user-panel d-flex">

                <div>

                  <img src=${this.from.logo!==null?this.from.logo:this.basePathVersion()+"/themes/default/common/images/org.png"} class="img-circle" id="org_img" alt="Org Image">
                </div>

                <div class="info">

                  <a class="d-block">
                    ${this.subString(this.from.name)}
                  </a>
                </div>
              </div>
              </div>

              <div class='card-body info-body'>

                <ul class='nav nav-stacked'>

                  <li id='b_bottom'>
                    <a id='cus-link'>

                        ${this.from.tootlip?this.from.tooltip:"---"}
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          `:""}},methods:{subString(e,t=25){return Z(e,t)}}},ws=e=>(N("data-v-dbc3a8d6"),e=e(),V(),e),Cs={class:"inbox-info"},Ts=["href","data-content"],Ds={class:"card card-light card-widget mb-0 org-toolip"},Ss={class:"card-header pad-7"},Ms={class:"user-panel d-flex"},As={class:"hover-img"},Is=["src"],Fs={class:"info"},Ls={class:"d-block"},Rs={class:"card-body info-body"},Ps={class:"nav nav-stacked"},Os={id:"b_bottom"},js={id:"cus-link"},xs=ws(()=>a("i",{class:"fas fa-map-marker-alt"},null,-1)),Ns=["innerHTML"];function Vs(e,t,s,c,i,o){const h=u("popover");return n(),l("span",Cs,[_(h,{hover:"",arrow:"",placement:"right"},he({default:f(()=>[a("a",{href:s.from.link,target:"_blank","data-container":"body","data-toggle":"popover","data-placement":"right","data-content":o.hoverContent},r(s.from.name),9,Ts)]),_:2},[s.from?{name:"content",fn:f(()=>[a("div",Ds,[a("div",Ss,[a("div",Ms,[a("div",As,[a("img",{src:s.from.logo?s.from.logo:e.basePathVersion()+"/themes/default/common/images/org.png",class:"img-fluid img-circle",id:"org_img",alt:"Org Image"},null,8,Is)]),a("div",Fs,[a("a",Ls,r(this.subString(s.from.name)),1)])])]),a("div",Rs,[a("ul",Ps,[a("li",Os,[a("a",js,[xs,m("  "),a("span",{innerHTML:s.from.tooltip?s.from.tooltip:"---"},null,8,Ns)])])])])])]),key:"0"}:void 0]),1024)])}const Es=A(vs,[["render",Vs],["__scopeId","data-v-dbc3a8d6"]]);const Bs={name:"ticket-details",description:"Ticket details component",setup(){const e=H();return{formattedTime:O(()=>e.getters.formattedTime),timeDiffForPast:O(()=>e.getters.timeDiffForPast),timeDiffForFuture:O(()=>e.getters.timeDiffForFuture),getStoredTicketId:O(()=>e.getters.getStoredTicketId)}},props:{color:{type:String,default:""},ticket:{type:Object,default:()=>{}},appendSelect:{type:Function},onSelect:{type:Function},archive:{type:Boolean,default:!1},timelineId:{type:[String,Number],default:""}},data(){return{countdownForDuedate:"",countUpForCreated:"",countUpForUpdated:"",countUpForOverdue:"",checked:!1}},watch:{checked:function(e){this.appendSelect(this.ticket.id,e)}},beforeMount(){window.emitter.on("selectTicket",this.selectAllTicket),window.emitter.on("unCheckTicket",this.unCheck)},mounted(){this.timerActions()},methods:{subString(e,t=15){return Z(e,t)},canViewProfile(e){return this.archive?!0:e.profileAccessPermission},canViewAssignedProfile(e){return this.archive?!0:e.assignedprofileAccessPermission},onRowClick(e,t){this.$refs.ticketPopover.onClick(e,t)},redirectToTab(e){this.$refs.ticketPopover.redirectMethod(e,"_blank")},timerActions(){this.ticket.is_overdue?this.updateCountUp("duedate"):this.updateCountDownForDueDate(),this.updateCountUp("created_at"),this.updateCountUp("updated_at")},ticketClicked(e){this.onSelect(e)},selectAllTicket(e){this.checked=e},unCheck(){this.checked=!1},updateCountDownForDueDate(){this.countdownForDuedate=this.timeDiffForFuture(this.ticket.duedate),this.countdownForDuedate===0?(this.ticket.is_overdue=!0,this.ticket.due_today=!1,this.updateCountUp("duedate")):setTimeout(()=>{this.updateCountDownForDueDate(this.ticket.duedate)},1e3)},updateCountUp(e){switch(e){case"duedate":this.countUpForOverdue=this.timeDiffForPast(this.ticket[e]);break;case"created_at":this.countUpForCreated=this.timeDiffForPast(this.ticket[e]);break;case"updated_at":this.countUpForUpdated=this.timeDiffForPast(this.ticket[e]);break;default:return}var t=this;setTimeout(function(){t.updateCountUp(e)},1e4)}},components:{"org-info":Es,"user-info":Ee,"ticket-popover":ys}},Us={id:"ticket_user"},qs={class:"user-image"},zs=["id"],Hs=["for"],Ks={class:"name td-ticket-details"},Ws={class:"ticket_subject"},Gs={class:"info-data"},Zs={class:"information ellipsis"},Js={style:{color:"#3c8dbc"}},Ys={style:{color:"#3c8dbc"}},Qs={style:{color:"#3c8dbc"}},Xs={style:{color:"red"}},$s={class:"departm"},ei={style:{color:"#3c8dbc"}},ti={class:"ticket-list-custom-box"},si={class:"org-extra-field d-block"},ii={key:0},ai={key:0},oi={key:0},ni={key:1},li={key:0},ri=["innerHTML"],di={class:"td-ticket-status hideForList"},ci={class:"source source-icon hideForList"},hi={class:"status-source source-detailed-phone"},ui={class:"source-icon hideForList"},mi={class:"status-source source-detailed-phone"},_i={class:"assign hideForList"},pi={style:{padding:"0px",margin:"0px","list-style":"none","font-size":"medium"}},gi={class:"emphasize"},fi={class:"emphasize"},ki={key:0},bi={class:"emphasize"},yi={key:1},vi={class:"emphasize"};function wi(e,t,s,c,i,o){const h=u("faveo-image-element"),p=u("ticket-popover"),g=u("user-info"),v=u("org-info"),D=z("tooltip");return n(),l("tr",{class:M({unanswered:s.ticket.isanswered==0,active_ticket:c.getStoredTicketId==s.ticket.id&&s.timelineId})},[k(a("td",{class:"priority-border",style:E({background:s.ticket.priority.priority_color+" !important"})},null,4),[[D,e.lang("priority_is")+s.ticket.priority.name]]),a("td",Us,[a("div",qs,[_(h,{id:"user_img_"+s.ticket.id,"source-url":s.ticket.from.profile_pic,"alternative-text":"User","img-width":40,"img-height":40},null,8,["id","source-url"]),k(a("input",{id:s.ticket.id,type:"checkbox",name:"check-row",class:"checkbox","onUpdate:modelValue":t[0]||(t[0]=b=>i.checked=b)},null,8,zs),[[Ce,i.checked]]),a("label",{for:s.ticket.id,class:""},null,8,Hs)])]),a("td",Ks,[a("div",Ws,[a("h3",{class:"ticket-description-tip overdue_ticket break-word",onClick:[t[1]||(t[1]=b=>o.onRowClick(s.ticket.id,b)),t[2]||(t[2]=ce(b=>o.redirectToTab(s.ticket.id),["ctrl"]))]},[_(p,{details:s.ticket,tableHeader:s.color,archive:s.archive,onTicketClick:o.ticketClicked,ref:"ticketPopover"},null,8,["details","tableHeader","archive","onTicketClick"])]),a("div",Gs,[a("div",Zs,[o.canViewProfile(s.ticket)?(n(),l(T,{key:0},[a("span",null,r(e.lang("from"))+": ",1),_(g,{from:s.ticket.from,tableHeader:s.color,archive:s.archive},null,8,["from","tableHeader","archive"]),m("  ")],64)):(n(),l(T,{key:1},[a("span",null,r(e.lang("from"))+": ",1),k((n(),l("a",Js,[m(r(o.subString(s.ticket.from.full_name)),1)])),[[D,e.trans("access_denied_now")]]),m("  ")],64)),o.canViewAssignedProfile(s.ticket)&&s.ticket.assigned?(n(),l(T,{key:2},[a("span",null,r(e.lang("assigned_to"))+": ",1),_(g,{from:s.ticket.assigned,tableHeader:s.color,archive:s.archive},null,8,["from","tableHeader","archive"]),m("  ")],64)):s.ticket.assigned?(n(),l(T,{key:3},[a("span",null,r(e.lang("assigned_to"))+": ",1),k((n(),l("a",Ys,[m(r(o.subString(s.ticket.assigned.full_name)),1)])),[[D,e.trans("access_denied_now")]]),m("  ")],64)):d("",!0),Array.isArray(s.ticket.assigned_team)?d("",!0):(n(),l(T,{key:4},[a("span",null,r(e.lang("assigned_team"))+": ",1),a("a",Qs,r(s.ticket.assigned_team.name),1),m("  ")],64)),!s.ticket.assigned&&Array.isArray(s.ticket.assigned_team)?(n(),l(T,{key:5},[a("span",null,r(e.lang("assigned_to"))+": ",1),a("span",Xs,r(e.lang("unassigned")),1),m("  ")],64)):d("",!0),a("span",$s,r(e.lang("department"))+": ",1),a("span",ei,r(s.ticket.department.name),1),m("  "),a("div",ti,[(n(!0),l(T,null,P(s.ticket.extra_fields,b=>(n(),l("span",si,[b.label===e.lang("organisation")&&Array.isArray(b.value)?(n(),l("span",ii,[b.value&&b.value.length>0?(n(),l("span",ai,[m(r(b.label)+": ",1),(n(!0),l(T,null,P(b.value,(w,F)=>(n(),l(T,null,[_(v,{from:w},null,8,["from"]),F<b.value.length-1?(n(),l("span",oi,", ")):d("",!0)],64))),256))])):d("",!0)])):(n(),l("span",ni,[b.value?(n(),l("span",li,r(b.label)+": ",1)):d("",!0),b.value?(n(),l("span",{key:1,class:"extra-field",innerHTML:b.value},null,8,ri)):d("",!0)]))]))),256))])])])])]),a("td",di,[k(a("span",{class:"badge badge-danger text-xs"},r(e.lang("overdue")),513),[[ve,s.ticket.is_overdue]]),k(a("span",{class:"badge badge-warning text-xs"},r(e.lang("due_today")),513),[[ve,s.ticket.due_today]])]),a("td",ci,[k((n(),l("div",hi,[a("i",{class:M(s.ticket.source.css_class),id:"ticket-source-icon"},null,2)])),[[D,e.lang("ticket_is_generated_via")+e.lang(s.ticket.source.name)]])]),a("td",ui,[k((n(),l("div",mi,[a("i",{class:M(s.ticket.status.icon),id:"ticket-source-icon",style:E({color:s.ticket.status.icon_color})},null,6)])),[[D,e.lang("ticket_is")+s.ticket.status.name]])]),a("td",_i,[a("ul",pi,[a("li",null,[m(r(e.lang("created"))+": ",1),a("span",gi,r(i.countUpForCreated),1)]),a("li",null,[m(r(e.lang("updated"))+": ",1),a("span",fi,r(i.countUpForUpdated),1)]),s.ticket.is_overdue?(n(),l("li",ki,[m(r(e.lang("overdue"))+": ",1),a("span",bi,r(i.countUpForOverdue),1)])):d("",!0),s.ticket.is_overdue?d("",!0):(n(),l("li",yi,[m(r(e.lang("due_in"))+" ",1),a("span",vi,r(i.countdownForDuedate?i.countdownForDuedate:"---"),1)]))])])],2)}const Ci=A(Bs,[["render",wi],["__scopeId","data-v-011d9ec1"]]);const Ti={props:{tableHeader:{type:String,default:""},perpage:{type:[Number,String],default:""}},data(){return{buttonStyle:{"background-color":this.tableHeader+" !important",color:"#fff"},ticketCounts:[10,25,50,100]}},methods:{changeCount(e){this.$emit("ticketCount",e)}}},Di={class:"btn-group",id:"ticket-count"},Si={type:"button",class:"btn btn-md btn-default dropdown-toggle bg-white","data-toggle":"dropdown"},Mi={class:"dropdown-menu dropdown-menu-left"},Ai=["onClick"];function Ii(e,t,s,c,i,o){return n(),l("div",Di,[a("button",Si,r(s.perpage),1),a("div",Mi,[(n(!0),l(T,null,P(i.ticketCounts,h=>(n(),l("a",{class:"dropdown-item",onClick:p=>o.changeCount(h),href:"javascript:;"},r(h),9,Ai))),256))])])}const Fi=A(Ti,[["render",Ii],["__scopeId","data-v-07550893"]]);const Li={props:{selected:{type:Array,default:()=>[]},tickets:{type:Array,default:()=>[]}},computed:{selectAll:{get(){return this.tickets.length&&this.tickets?this.selected.length==this.tickets.length:!1},set(e){e?window.emitter.emit("selectTicket",e):window.emitter.emit("selectTicket",!1)}}}},Ri=e=>(N("data-v-4e6e2410"),e=e(),V(),e),Pi={class:"select-all"},Oi=Ri(()=>a("label",{for:"all",class:"maxi-lab"},null,-1));function ji(e,t,s,c,i,o){return n(),l("div",Pi,[k(a("input",{type:"checkbox",id:"all","onUpdate:modelValue":t[0]||(t[0]=h=>o.selectAll=h),class:"cursor_pointer"},null,512),[[Ce,o.selectAll]]),Oi])}const xi=A(Li,[["render",ji],["__scopeId","data-v-4e6e2410"]]),Ni={props:{tableHeader:{type:String,default:""}},data(){return{buttonStyle:{"background-color":this.tableHeader+" !important",color:"#fff","margin-top":"2px"},extraMenu:[{name:"all",value:"",class:"fas fa-list-ul"}],sortingMenu:[{name:"ticket_number",value:"ticket_number",order:"asc",class:"fas fa-sort-amount-down",order_name:"ascending"},{name:"updated_date",value:"updated_at",order:"asc",class:"fas fa-sort-amount-down",order_name:"ascending"},{name:"created-date",value:"created_at",order:"asc",class:"fas fa-sort-amount-down",order_name:"ascending"},{name:"answered",value:"isanswered",order:"desc",class:"fas fa-check"},{name:"un_answered",value:"isanswered",order:"asc",class:"fas fa-times"}]}},methods:{filter(e){this.$emit("filter",e),$(".sortval").html(this.trans(e.name)+" "+this.trans("tickets")+'&nbsp<span class="caret"></span>')},sort(e,t){e.value=="isanswered"?(this.$emit("sort",e),$(".sortval").html(this.trans(e.name)+" "+this.trans("tickets")+'&nbsp<span class="caret"></span>')):e.order=="asc"?(this.$emit("sort",e),$(".sortval").html(this.trans(e.name)+" "+this.trans(e.order_name)+'&nbsp<span class="caret"></span>'),this.sortingMenu[t].order="desc",this.sortingMenu[t].class="fas fa-sort-amount-up",this.sortingMenu[t].order_name=this.trans("descending")):(this.$emit("sort",e),$(".sortval").html(this.trans(e.name)+" "+this.trans(e.order_name)+'&nbsp<span class="caret"></span>'),this.sortingMenu[t].order="asc",this.sortingMenu[t].class="fas fa-sort-amount-down",this.sortingMenu[t].order_name=this.trans("ascending"))}}},Vi={class:"btn-group",id:"ticket-sort"},Ei=a("button",{type:"button",class:"btn btn-md btn-default dropdown-toggle sortval bg-white","data-toggle":"dropdown"},[a("i",{class:"fas fa-sort"}),m("  ")],-1),Bi={class:"dropdown-menu dropdown-menu-left",style:{}},Ui=["onClick"],qi=["onClick"];function zi(e,t,s,c,i,o){return n(),l("div",Vi,[Ei,a("div",Bi,[(n(!0),l(T,null,P(i.sortingMenu,(h,p)=>(n(),l("a",{class:"dropdown-item",onClick:g=>o.sort(h,p),href:"javascript:;"},[a("i",{class:M(h.class)},null,2),m(" "+r(e.trans(h.name))+" "+r(e.trans(h.order_name)),1)],8,Ui))),256)),(n(!0),l(T,null,P(i.extraMenu,h=>(n(),l("a",{class:"dropdown-item",onClick:p=>o.filter(h),href:"javascript:;"},[a("i",{class:M(h.class)},null,2),m(" "+r(e.trans(h.name)),1)],8,qi))),256))])])}const Hi=A(Ni,[["render",zi]]);const Ki={name:"ticket-label",description:"Ticket label component",props:{ticketObj:{type:Object,default:()=>{}},reloadDetails:{type:Function},archive:{type:Boolean,default:!0}},data(){return{labels:"",loading:!0,checked:!1,selectedLabels:[],show_loader:!1,search:""}},beforeMount(){this.getSelectedLabels()},methods:{getSelectedLabels(){this.ticketObj.labels&&this.ticketObj.labels.forEach(e=>{this.selectedLabels.push(e.name)})},subString(e){return Z(e,30)},onCreate(){this.redirect("/labels/create")},onCancel(){var e=document.getElementById("label-dropdown");e.classList.remove("show"),this.loading=!1},onClick(e){if(this.selectedLabels.includes(e)){for(var t in this.selectedLabels)if(this.selectedLabels[t]===e){this.selectedLabels.splice(t,1);break}}else this.selectedLabels.push(e)},getLabels(e){S.get("/api/dependency/labels?limit=all&meta=true&limit-by-status=false&search-query="+e).then(t=>{this.loading=!1,this.labels=t.data.data.labels}).catch(t=>{this.loading=!1})},onSubmit(){this.loading=!0;const e={};e.ticket_id=this.ticketObj.id,e.labels=this.selectedLabels,S.post("/labels-ticket",e).then(t=>{this.onCancel(),this.reloadDetails("label"),this.loading=!1,x(t,"timeline")}).catch(t=>{this.onCancel(),this.loading=!1,L(t,"timeline")})}}},le=e=>(N("data-v-9ac3da91"),e=e(),V(),e),Wi={id:"labels-div",class:"btn-group"},Gi=le(()=>a("i",{class:"fab fa-lastfm"},null,-1)),Zi=le(()=>a("span",{class:"caret"},null,-1)),Ji={key:0},Yi=["placeholder"],Qi=["onClick"],Xi={id:"label_title"},$i={key:0},ea={class:"text-center"},ta={class:"label_button"},sa=le(()=>a("i",{class:"fas fa-times"},null,-1)),ia=["disabled"],aa=le(()=>a("i",{class:"fas fa-check"},null,-1));function oa(e,t,s,c,i,o){const h=u("loader"),p=z("tooltip");return n(),l("div",Wi,[a("button",{type:"button",class:"btn btn-xs btn-default dropdown-toggle","data-toggle":"dropdown",id:"labels-button",onClick:t[0]||(t[0]=g=>o.getLabels(i.search))},[Gi,m(" "+r(e.lang("labels"))+" ",1),Zi]),a("ul",{id:"label-dropdown",class:"dropdown-menu label_menu",onClick:t[5]||(t[5]=g=>g.stopPropagation())},[i.loading?(n(),l("li",Ji,[_(h,{size:30,duration:4e3,color:"#1d78ff"})])):d("",!0),i.loading?d("",!0):(n(),l(T,{key:1},[a("li",null,[k(a("input",{type:"search",class:"form-control",name:"label",placeholder:e.lang("search"),"onUpdate:modelValue":t[1]||(t[1]=g=>i.search=g),onInput:t[2]||(t[2]=g=>o.getLabels(i.search))},null,40,Yi),[[Te,i.search]])]),(n(!0),l(T,null,P(i.labels,g=>(n(),l(T,null,[g.status||i.selectedLabels.includes(g.name)?(n(),l("li",{key:0,class:M(["labels",{active:i.selectedLabels.includes(g.name)}]),onClick:v=>o.onClick(g.name)},[a("div",{class:"color mr-2",id:"label_color",style:E({backgroundColor:g.color})},null,4),k((n(),l("label",Xi,[m(r(o.subString(g.name)),1)])),[[p,e.lang(g.name)]]),i.selectedLabels.includes(g.name)?(n(),l("i",{key:0,class:M(["fas fa-times",{cancel_ar:e.isRtlLayout,cancel:!e.isRtlLayout}])},null,2)):d("",!0)],10,Qi)):d("",!0)],64))),256)),i.labels.length===0?(n(),l("li",$i,[a("p",ea,r(e.lang("no_results_found")),1)])):d("",!0),a("li",ta,[a("button",{class:M(["btn btn-xs btn-default",{right:e.isRtlLayout,left:!e.isRtlLayout}]),onClick:t[3]||(t[3]=g=>o.onCancel())},[sa,m(" "+r(e.lang("cancel")),1)],2),a("button",{class:M(["btn btn-xs btn-primary left",{left:e.isRtlLayout,right:!e.isRtlLayout}]),onClick:t[4]||(t[4]=g=>o.onSubmit()),disabled:s.ticketObj.labels.length===0&&i.selectedLabels.length===0},[aa,m(" "+r(e.lang("apply")),1)],10,ia)])],64))])])}const na=A(Ki,[["render",oa],["__scopeId","data-v-9ac3da91"]]);const la={name:"ticket-label",description:"Ticket label component",props:{ticketObj:{type:Object,default:()=>{}},reloadDetails:{type:Function},archive:{type:Boolean,default:!0}},data(){return{tags:[],loading:!1,checked:!1,selectedTags:[],show_loader:!1,search:"",labelStyle:{display:"none"}}},beforeMount(){this.getSelectedTags()},methods:{onChange(e,t){this[t]=e},getSelectedTags(){this.ticketObj.tags&&this.ticketObj.tags.forEach(e=>{this.selectedTags.push(e.name)})},subString(e){return Z(e,30)},onCancel(){var e=document.getElementById("dropdown-tag");e.classList.remove("show"),this.loading=!1},onClick(e){if(this.selectedTags.includes(e)){for(var t in this.selectedTags)if(this.selectedTags[t]===e){this.selectedTags.splice(t,1);break}}else this.selectedTags.push(e)},onSubmit(){this.tags.length>0&&this.tags.forEach(t=>{this.selectedTags.includes(t.name)||this.selectedTags.push(t.name)}),this.loading=!0;const e={};e.ticket_id=this.ticketObj.id,e.tags=this.selectedTags,S.post("/add-tag",e).then(t=>{this.loading=!1,this.tags=[],this.onCancel(),this.reloadDetails("tag"),x(t,"timeline")}).catch(t=>{this.loading=!1,L(t,"timeline"),this.selectedTags=this.selectedTags.filter(s=>s.length<21)})}},components:{"dynamic-select":K}},re=e=>(N("data-v-fa625789"),e=e(),V(),e),ra={id:"tags-div",class:"btn-group"},da={type:"button",class:"btn btn-xs btn-default dropdown-toggle","data-toggle":"dropdown",id:"tags-button"},ca=re(()=>a("i",{class:"fas fa-tag"},null,-1)),ha=re(()=>a("span",{class:"caret"},null,-1)),ua={key:0},ma={class:"tags_menu",id:"tags-dropdown"},_a={key:0,class:"mt-3 mb-2"},pa=["onClick"],ga={id:"tag_title"},fa={class:"tag_button"},ka=re(()=>a("i",{class:"fas fa-times"},null,-1)),ba=["disabled"],ya=re(()=>a("i",{class:"fas fa-check"},null,-1));function va(e,t,s,c,i,o){const h=u("dynamic-select"),p=u("loader"),g=z("tooltip");return n(),l("div",ra,[a("button",da,[ca,m(" "+r(e.lang("tags"))+" ",1),ha]),a("ul",{class:"dropdown-menu",onClick:t[2]||(t[2]=v=>v.stopPropagation()),id:"dropdown-tag"},[i.loading?d("",!0):(n(),l("li",ua,[_(h,{label:e.lang("tags"),multiple:!0,name:"tags",classname:"col-sm-12",apiEndpoint:"/api/dependency/tags",value:i.tags,onChange:o.onChange,labelStyle:i.labelStyle,taggable:!0},null,8,["label","value","onChange","labelStyle"])])),a("div",ma,[i.loading?(n(),l("li",_a,[_(p,{size:30,duration:4e3,color:"#1d78ff"})])):d("",!0),i.loading?d("",!0):(n(),l(T,{key:1},[(n(!0),l(T,null,P(i.selectedTags,v=>(n(),l("li",{class:"tags active",onClick:D=>o.onClick(v)},[a("i",{class:M(["fas fa-tag",{cancel:e.isRtlLayout,cancel_ar:!e.isRtlLayout}])},null,2),k((n(),l("label",ga,[m(r(o.subString(v)),1)])),[[g,e.lang(v)]]),a("i",{class:M(["fas fa-times",{cancel_ar:e.isRtlLayout,cancel:!e.isRtlLayout}])},null,2)],8,pa))),256)),a("li",fa,[a("button",{class:M(["btn btn-xs btn-default",{right:e.isRtlLayout,left:!e.isRtlLayout}]),onClick:t[0]||(t[0]=v=>o.onCancel())},[ka,m(" "+r(e.lang("cancel")),1)],2),a("button",{class:M(["btn btn-xs btn-primary left",{left:e.isRtlLayout,right:!e.isRtlLayout}]),onClick:t[1]||(t[1]=v=>o.onSubmit()),disabled:s.ticketObj.tags.length===0&&i.tags.length===0},[ya,m(" "+r(e.lang("apply")),1)],10,ba)])],64))])])])}const wa=A(la,[["render",va],["__scopeId","data-v-fa625789"]]),Ca={name:"change-requester-modal",description:"Change requester modal component",props:{showModal:{type:Boolean,default:!1},onClose:{type:Function},ticketId:{type:[String,Number],default:""},reloadDetails:{type:Function}},data(){return{isDisabled:!1,loading:!1,user:"",divStyle:{width:"500px"}}},beforeMount(){this.isDisabled=!this.user},methods:{onChange(e,t){this[t]=e,this.isDisabled=!e},onSubmit(){this.loading=!0,this.isDisabled=!0;const e={};e.owner_id=this.user.id,S.post("/api/change-owner/"+this.ticketId,e).then(t=>{this.reloadDetails("requester"),x(t,"timeline"),this.loading=!1,this.isDisabled=!1,this.onClose()}).catch(t=>{L(t,"timeline"),this.loading=!1,this.isDisabled=!1,this.onClose()})}},components:{"dynamic-select":K}},Ta={class:"modal-title"},Da={key:0,class:"row"},Sa={key:1,class:"row"},Ma=["disabled"],Aa=a("i",{class:"fas fa-sync-alt"},null,-1);function Ia(e,t,s,c,i,o){const h=u("dynamic-select"),p=u("reuse-loader"),g=u("modal");return s.showModal?(n(),C(g,{key:0,showModal:s.showModal,onClose:s.onClose,containerStyle:i.divStyle},{title:f(()=>[a("h4",Ta,r(e.lang("change_requester")),1)]),fields:f(()=>[i.loading?d("",!0):(n(),l("div",Da,[_(h,{label:e.lang("users"),multiple:!1,name:"user",required:!0,classname:"col-sm-12",apiEndpoint:"/api/dependency/users?meta=true&package_filter=true",value:i.user,onChange:o.onChange,clearable:!!i.user,strlength:"60"},null,8,["label","value","onChange","clearable"])])),i.loading?(n(),l("div",Sa,[_(p,{duration:4e3,size:60})])):d("",!0)]),controls:f(()=>[a("button",{type:"button",onClick:t[0]||(t[0]=(...v)=>o.onSubmit&&o.onSubmit(...v)),class:"btn btn-primary",disabled:i.isDisabled},[Aa,m(" "+r(e.lang("update")),1)],8,Ma)]),_:1},8,["showModal","onClose","containerStyle"])):d("",!0)}const Fa=A(Ca,[["render",Ia]]);const La={name:"fork-ticket-modal",description:"Fork Ticket modal Component",props:{showModal:{type:Boolean,default:!1},onClose:{type:Function},ticketId:{type:[String,Number],default:""},componentTitle:{type:String,default:""},reloadDetails:{type:Function},selectedFormData:{type:Object,default:()=>{}}},data:()=>({formUniqueKey:null,submitFormInProgress:!1,scenario:"fork",panel:"agent",category:"ticket",keepTicketStatusOpenAfterFork:1,Parent:1,radioOptions:[{name:"yes",value:1},{name:"no",value:0}]}),mixins:[Me],created(){window.emitter.on("updateTicketCategory",this.updateTicketCategory)},methods:{updateTicketCategory(){window.emitter.emit("storeCategoryId",this.selectedFormData.id)},popUpSubmit(){document.getElementById("fork-ticket-submit").click()},formSubmit(e,t){this.$store.dispatch("setRecaptchaKey",t),this.onSubmit({keep_status_of_parent_ticket_as_open_after_forking:this.keepTicketStatusOpenAfterFork,parent_ticket_thread_copy:this.Parent})},onChange(e,t){this[t]=e},afterSubmit(e){window.emitter.emit("reset-captcha"),setTimeout(()=>{let t=e.data.data.id;this.$router.push("/thread/"+t),window.emitter.emit("refreshTableAndData",!0),this.reloadDetails("fork"),this.onClose()},1e3)}},beforeDestroy(){this.$store.dispatch("unsetAlert")},components:{FormWithCaptcha:Ae,RadioButton:Ie,CustomLoader:Fe,Loader:Ve,Alert:Le,FormRenderer:Re,Modal:me}},Be=e=>(N("data-v-fd74c415"),e=e(),V(),e),Ra={class:"modal-title"},Pa={id:"ticket_fork_body"},Oa={key:0,class:"row ml-0 p-2"},ja=Be(()=>a("br",null,null,-1)),xa=["disabled"],Na=Be(()=>a("span",null,[a("i",{class:"fas fa-code-branch"})],-1));function Va(e,t,s,c,i,o){const h=u("CustomLoader"),p=u("Loader"),g=u("Alert"),v=u("FormRenderer"),D=u("ValidationObserver"),b=u("FormWithCaptcha"),w=u("RadioButton"),F=u("Modal");return n(),l("div",null,[e.submitFormInProgress?(n(),C(h,{key:0})):d("",!0),s.showModal?(n(),C(F,{key:1,showModal:s.showModal,onClose:s.onClose,containerStyle:{width:"1200px",maxWidth:"1200px !important"}},{title:f(()=>[a("h4",Ra,r(e.lang("fork_ticket")),1)]),fields:f(()=>[e.showLoader?(n(),C(p,{key:0})):d("",!0),a("div",Pa,[_(g,{componentName:"faveo-form"}),_(b,{loading:!e.showLoader,btnClass:"btn btn-primary pull-right",btnName:"submit",componentName:"faveo-form",btn_id:"fork-ticket-submit",formSubmit:o.formSubmit,page:"ticket_fork_agent",recaptchaContainerClass:"mt-2",disableSubmit:e.submitFormInProgress},{fields:f(()=>[_(D,{ref:"faveoFormObserver"},{default:f(({values:U,errors:I,validate:R})=>[_(v,{category:"ticket",fetchFormFieldApi:"api/agent/edit-mode-ticket-details/"+this.ticketId,scenario:e.scenario,panel:e.panel,isInlineForm:!1,formUniqueKey:e.formUniqueKey,selectDependencyId:s.ticketId,selectDependencyKey:"id"},null,8,["fetchFormFieldApi","scenario","panel","formUniqueKey","selectDependencyId"])]),_:1},512)]),_:1},8,["loading","formSubmit","disableSubmit"]),e.showLoader?d("",!0):(n(),l("div",Oa,[_(w,{options:e.radioOptions,label:e.trans("ticket_fork_keep_status_of_parent_ticket_as_open_after_forking"),name:"keepTicketStatusOpenAfterFork",value:e.keepTicketStatusOpenAfterFork,onChange:o.onChange,classname:"col-sm-6"},null,8,["options","label","value","onChange"]),ja,_(w,{options:e.radioOptions,label:e.trans("parent_ticket_thread"),name:"Parent",value:e.Parent,onChange:o.onChange,classname:"col-sm-6"},null,8,["options","label","value","onChange"])]))])]),controls:f(()=>[e.showLoader?d("",!0):(n(),l("button",{key:0,type:"submit",class:"btn btn-primary pull-right",onClick:t[0]||(t[0]=U=>o.popUpSubmit()),disabled:e.submitFormInProgress},[Na,m("  "+r(e.trans("ticket-fork")),1)],8,xa))]),_:1},8,["showModal","onClose"])):d("",!0)])}const Ea=A(La,[["render",Va],["__scopeId","data-v-fd74c415"]]);function Ba(e){const{description:t,worktime:s,actions:c,worktime_type:i}=e;let o={description:[t,"isRequired"],worktime:[s,"isRequired","minValue(1)","maxValue(609940)"]};c.show_worktime_type&&c.require_worktime_type_field&&s&&(o.worktime_type=[i,"isRequired"]);const h=new oe(Q),{errors:p,isValid:g}=h.validate(o);return se.dispatch("setValidationError",p),{errors:p,isValid:g}}const Ua={name:"time-field",description:"time field component along with error block",props:{label:{type:String,required:!0},hint:{type:String,default:""},value:{required:!0},name:{type:String,required:!0},type:{type:String,default:"number"},onChange:{type:Function,Required:!0},classname:{type:String,default:""},required:{type:Boolean,default:!1},labelStyle:{type:Object},formStyle:{type:Object}},data(){return{hoursValue:0,minutesValue:0}},created(){window.emitter.on("removeVal",this.initialState)},mounted(){this.value!==""&&this.value!==0?(this.hoursValue=Math.floor(this.value/60),this.minutesValue=this.value%60):(this.hoursValue=0,this.minutesValue=0)},methods:{onInput(){this.onChange(+this.hoursValue*60+ +this.minutesValue,this.name)},checkValue(e){e=e||window.event;var t=e.which?e.which:e.keyCode;if(t>31&&(t<48||t>57))e.preventDefault();else return!0},onPaste(e){e=e||window.event,e.clipboardData.getData("Text").match(/[^\d]/)&&e.preventDefault()},minutesValidation(e){e=e||window.event,e.which?e.which:e.keyCode;var t=this.minutesValue;(t<0||t>59)&&(this.minutesValue=59,this.onChange(+this.hoursValue*60+ +this.minutesValue,this.name))},initialState(){this.hoursValue=0,this.minutesValue=0}},components:{"form-field-template":Qe}},qa={class:"inline"},za=["type"],Ha=["type"];function Ka(e,t,s,c,i,o){const h=u("form-field-template");return n(),C(h,{label:s.label,labelStyle:s.labelStyle,name:s.name,classname:s.classname,hint:s.hint,required:s.required},{default:f(()=>[a("span",qa,[k(a("input",{class:"form-control",style:E(s.formStyle),maxlength:"4",type:s.type,id:"txtHours","onUpdate:modelValue":t[0]||(t[0]=p=>i.hoursValue=p),onInput:t[1]||(t[1]=p=>o.onInput()),placeholder:"0",onKeypress:t[2]||(t[2]=(...p)=>o.checkValue&&o.checkValue(...p)),onPaste:t[3]||(t[3]=(...p)=>o.onPaste&&o.onPaste(...p))},null,44,za),[[we,i.hoursValue]]),m(" "+r(e.lang("hrs"))+" ",1),k(a("input",{class:"form-control",style:E(s.formStyle),maxlength:"4",type:s.type,id:"txtMins","onUpdate:modelValue":t[4]||(t[4]=p=>i.minutesValue=p),onInput:t[5]||(t[5]=p=>o.onInput()),placeholder:"0",onKeypress:t[6]||(t[6]=(...p)=>o.checkValue&&o.checkValue(...p)),onPaste:t[7]||(t[7]=(...p)=>o.onPaste&&o.onPaste(...p)),onKeyup:t[8]||(t[8]=(...p)=>o.minutesValidation&&o.minutesValidation(...p))},null,44,Ha),[[we,i.minutesValue]]),m(" "+r(e.lang("minute")),1)])]),_:1},8,["label","labelStyle","name","classname","hint","required"])}const ge=A(Ua,[["render",Ka],["__scopeId","data-v-3c473f32"]]),Wa={name:"change-requester-modal",description:"Change requester modal component",setup(){const e=H();return{getTicketActions:O(()=>e.getters.getTicketActions)}},props:{showModal:{type:Boolean,default:!1},onClose:{type:Function},ticketId:{type:[String,Number],default:""},reloadDetails:{type:Function},deleteTrack:{type:Boolean,default:!1},editTrack:{type:Boolean,default:!1},trackData:{type:Object,default:()=>{}},updateData:{type:Function}},data(){return{isDisabled:!1,loading:!1,description:"",worktime:0,divStyle:{width:"700px"},formStyle:{width:"30%"},btnName:"save",iconClass:"fas fa-save",btnClass:"btn btn-primary",apiUrl:"ticket/"+this.ticketId+"/time-track",actions:"",worktime_type:""}},beforeMount(){this.getInitialValues(),this.actions=this.getTicketActions},methods:{getInitialValues(){this.editTrack&&(this.btnName="update",this.iconClass="fas fa-sync-alt",this.description=this.trackData.description,this.worktime=this.trackData.work_time,this.apiUrl="ticket/"+this.trackData.ticket_id+"/time-track/"+this.trackData.id,this.trackData.worktime_type&&(this.worktime_type={id:this.trackData.worktime_type.id,name:this.trackData.worktime_type.name})),this.deleteTrack&&(this.btnName="delete",this.iconClass="fas fa-trash",this.btnClass="btn btn-danger")},onChange(e,t){this[t]=e},isValid(){const{errors:e,isValid:t}=Ba(this.$data);return!!t},onSubmit(){if(this.deleteTrack)this.deleteTime();else if(this.worktime_type=this.worktime_type||"",this.isValid()){this.loading=!0,this.isDisabled=!0;const e={};e.description=this.description,e.work_time=this.worktime,e.entrypoint="popup",this.worktime_type&&(e.worktime_type=this.worktime_type.id),S.post(this.apiUrl,e).then(t=>{x(t,"timeline"),this.updateData("track"),this.loading=!1,this.isDisabled=!1,this.onClose()}).catch(t=>{L(t,"timeline"),this.loading=!1,this.isDisabled=!1,this.onClose()})}},deleteTime(){this.loading=!0,this.isDisabled=!0,S.delete("ticket/time-track/"+this.trackData.id).then(e=>{this.loading=!1,this.isDisabled=!0,x(e,"timeline"),this.updateData("track"),this.onClose()}).catch(e=>{L(e,"timeline"),this.loading=!1,this.isDisabled=!0,this.onClose()})}},components:{"text-field":ie,"time-field":ge,"dynamic-select":K}},Ga={class:"modal-title"},Za={key:0,class:"row"},Ja={class:"col-sm-12"},Ya={key:1},Qa={class:"row"},Xa={class:"row"},$a={key:2,class:"row"},eo=["disabled"];function to(e,t,s,c,i,o){const h=u("time-field"),p=u("dynamic-select"),g=u("text-field"),v=u("reuse-loader"),D=u("modal"),b=z("focus-first-input");return s.showModal?(n(),C(D,{key:0,showModal:s.showModal,onClose:s.onClose,containerStyle:i.divStyle},{title:f(()=>[a("h4",Ga,r(e.lang("time-track")),1)]),fields:f(()=>[!i.loading&&s.deleteTrack?(n(),l("div",Za,[a("div",Ja,[a("span",null,r(e.lang("are_you_sure_you_want_to_delete")),1)])])):d("",!0),!i.loading&&!s.deleteTrack?(n(),l("div",Ya,[k((n(),l("div",Qa,[_(h,{label:e.lang("worktime"),value:i.worktime,formStyle:i.formStyle,type:"number",name:"worktime",onChange:o.onChange,classname:"col-sm-6",required:!0},null,8,["label","value","formStyle","onChange"]),c.getTicketActions.show_worktime_type&&i.worktime?(n(),C(p,{key:0,label:e.trans("worktime_type"),name:"worktime_type",value:i.worktime_type,onChange:o.onChange,strlength:30,multiple:!1,classname:"col-sm-6",apiEndpoint:"api/worktime-type-list",required:c.getTicketActions.show_worktime_type&&c.getTicketActions.require_worktime_type_field&&i.worktime},null,8,["label","value","onChange","required"])):d("",!0)])),[[b]]),a("div",Xa,[_(g,{label:e.lang("description"),value:i.description,type:"textarea",name:"description",onChange:o.onChange,required:!0,classname:"col-md-12"},null,8,["label","value","onChange"])])])):d("",!0),i.loading?(n(),l("div",$a,[_(v,{duration:4e3,size:60})])):d("",!0)]),controls:f(()=>[a("button",{type:"button",onClick:t[0]||(t[0]=(...w)=>o.onSubmit&&o.onSubmit(...w)),class:M(i.btnClass),disabled:i.isDisabled},[a("i",{class:M(i.iconClass)},null,2),m(" "+r(e.lang(i.btnName)),1)],10,eo)]),_:1},8,["showModal","onClose","containerStyle"])):d("",!0)}const Ue=A(Wa,[["render",to]]);function so(e){const{title:t,parentTicket:s,childTicket:c}=e;let i={parentTicket:[s,"isRequired"],childTicket:[c,"isRequired"],title:[t,"isRequired"]};const o=new oe(Q),{errors:h,isValid:p}=o.validate(i);return se.dispatch("setValidationError",h),{errors:h,isValid:p}}const io={name:"timeline-merge-modal",description:"Timeline merge ticket Modal component",props:{showModal:{type:Boolean,default:!1},ticketId:{type:[Number,String],default:""},onClose:{type:Function},componentTitle:{type:String,default:"timeline"},reloadTickets:{type:Function}},data:()=>({isDisabled:!1,containerStyle:{width:"800px"},loading:!1,size:60,merge_reason:"",title:"",parent_tickets:"",parentTicket:"",parentTicketId:"",childTicket:""}),computed:{getApiParameters(){return{"ticket-id":this.ticketId}}},methods:{isValid(){const{errors:e,isValid:t}=so(this.$data);return!!t},onChange(e,t){t==="parentTicket"?(this.title=e.name,this.parentTicket=e,this.parentTicketId=e.ticket_id):this[t]=e},onSubmit(){if(this.isValid()){this.loading=!0,this.isDisabled=!0;const e={};e.title=this.title,e.p_id=this.parentTicketId,e.reason=this.merge_reason,e._method="PATCH",e.t_id=this.childTicket.map(t=>t.ticket_id),S.post("/merge-tickets/"+this.ticketId,e).then(t=>{this.loading=!1,this.isDisabled=!0,this.reloadTickets("timeline_merge"),x(t,this.componentTitle),this.onClose()}).catch(t=>{this.loading=!1,this.isDisabled=!1,L(t,this.componentTitle),this.onClose()})}}},components:{"text-field":ie,"static-select":Xe,"dynamic-select":K}},ao={class:"modal-title"},oo={key:0,id:"merge_content"},no={class:"row"},lo={class:"row"},ro={key:1,class:"row"},co=["disabled"],ho=a("i",{class:"fas fa-check"},null,-1);function uo(e,t,s,c,i,o){const h=u("dynamic-select"),p=u("text-field"),g=u("reuse-loader"),v=u("modal");return s.showModal?(n(),C(v,{key:0,showModal:s.showModal,onClose:s.onClose,containerStyle:e.containerStyle},{title:f(()=>[a("h4",ao,r(e.lang("merge-ticket")),1)]),fields:f(()=>[e.loading?d("",!0):(n(),l("div",oo,[a("div",no,[_(h,{"api-parameters":o.getApiParameters,optionLabel:"title",label:e.lang("select-pparent-ticket"),name:"parentTicket",classname:"col-sm-4","api-endpoint":"/api/agent/tickets/get-merge-tickets",value:e.parentTicket,onChange:o.onChange,strlength:"30",required:!0},null,8,["api-parameters","label","value","onChange"]),_(h,{"api-parameters":o.getApiParameters,optionLabel:"title",label:e.lang("select_tickets"),multiple:!0,name:"childTicket",classname:"col-sm-4","api-endpoint":"/api/agent/tickets/get-merge-tickets",value:e.childTicket,onChange:o.onChange,strlength:"30",required:!0},null,8,["api-parameters","label","value","onChange"]),_(p,{label:e.lang("title"),value:e.title,type:"text",name:"title",onChange:o.onChange,classname:"col-sm-4",required:!0,placehold:e.lang("enter_a_value")},null,8,["label","value","onChange","placehold"])]),a("div",lo,[_(p,{label:e.lang("merge-reason"),value:e.merge_reason,type:"textarea",name:"merge_reason",onChange:o.onChange,classname:"col-sm-12",placehold:e.lang("enter_a_value")},null,8,["label","value","onChange","placehold"])])])),e.loading?(n(),l("div",ro,[_(g,{"animation-duration":4e3,color:"#1d78ff",size:e.size},null,8,["size"])])):d("",!0)]),controls:f(()=>[a("button",{type:"button",id:"submit_btn",onClick:t[0]||(t[0]=(...D)=>o.onSubmit&&o.onSubmit(...D)),class:"btn btn-primary",disabled:e.isDisabled},[ho,m(" "+r(e.lang("proceed")),1)],8,co)]),_:1},8,["showModal","onClose","containerStyle"])):d("",!0)}const mo=A(io,[["render",uo]]),_o={name:"surrender-modal",description:"Surrender modal Component",props:{showModal:{type:Boolean,default:!1},onClose:{type:Function},ticketId:{type:[String,Number],default:""},reloadDetails:{type:Function}},data(){return{isDisabled:!1,loading:!1,divStyle:{width:"500px"}}},methods:{onSubmit(){this.loading=!0,this.isDisabled=!0,S.get("/ticket/surrender/"+this.ticketId).then(e=>{this.reloadDetails("surrender"),x(e,"timeline"),this.loading=!1,this.isDisabled=!1,this.onClose()}).catch(e=>{L(e,"timeline"),this.loading=!1,this.isDisabled=!1,this.onClose()})}}},po={class:"modal-title"},go={key:0,class:"row"},fo=["disabled"],ko=a("i",{class:"fas fa-sync-alt"},null,-1);function bo(e,t,s,c,i,o){const h=u("reuse-loader"),p=u("modal");return s.showModal?(n(),C(p,{key:0,showModal:s.showModal,onClose:s.onClose,containerStyle:i.divStyle},{title:f(()=>[a("h4",po,r(e.lang("surrender")),1)]),fields:f(()=>[a("span",null,r(e.lang("are_you_sure_you_want_to_surrender_this_ticket"))+"?",1),i.loading?(n(),l("div",go,[_(h,{duration:4e3,size:60})])):d("",!0)]),controls:f(()=>[a("button",{type:"button",onClick:t[0]||(t[0]=(...g)=>o.onSubmit&&o.onSubmit(...g)),class:"btn btn-primary",disabled:i.isDisabled},[ko,m(" "+r(e.lang("update")),1)],8,fo)]),_:1},8,["showModal","onClose","containerStyle"])):d("",!0)}const yo=A(_o,[["render",bo]]),vo={name:"department-modal",description:"Department modal Component",props:{showModal:{type:Boolean,default:!1},onClose:{type:Function},ticketId:{type:[String,Number],default:""},reloadDetails:{type:Function}},data(){return{isDisabled:!1,loading:!1,department:"",divStyle:{width:"500px"}}},beforeMount(){this.isDisabled=!this.department},methods:{onChange(e,t){this[t]=e,this.isDisabled=!e},onSubmit(){this.loading=!0,this.isDisabled=!0;const e={};e["ticket-id"]=this.ticketId,e["dept-id"]=this.department.id,S.post("/api/ticket/change-department",e).then(t=>{this.reloadDetails("department"),x(t,"timeline"),this.loading=!1,this.isDisabled=!1,this.onClose()}).catch(t=>{L(t,"timeline"),this.loading=!1,this.isDisabled=!1,this.onClose()})}},components:{"dynamic-select":K}},wo={class:"modal-title"},Co={key:0,class:"row"},To={key:1,class:"row"},Do=["disabled"],So=a("i",{class:"fas fa-sync-alt"},null,-1);function Mo(e,t,s,c,i,o){const h=u("dynamic-select"),p=u("reuse-loader"),g=u("modal");return s.showModal?(n(),C(g,{key:0,showModal:s.showModal,onClose:s.onClose,containerStyle:i.divStyle},{title:f(()=>[a("h4",wo,r(e.lang("change_department")),1)]),fields:f(()=>[i.loading?d("",!0):(n(),l("div",Co,[_(h,{label:e.lang("departments"),multiple:!1,name:"department",required:!0,classname:"col-sm-12",apiEndpoint:"/api/dependency/departments",value:i.department,onChange:o.onChange,clearable:!!i.department,strlength:"60"},null,8,["label","value","onChange","clearable"])])),i.loading?(n(),l("div",To,[_(p,{duration:4e3,size:60})])):d("",!0)]),controls:f(()=>[a("button",{type:"button",onClick:t[0]||(t[0]=(...v)=>o.onSubmit&&o.onSubmit(...v)),class:"btn btn-primary",disabled:i.isDisabled},[So,m(" "+r(e.lang("update")),1)],8,Do)]),_:1},8,["showModal","onClose","containerStyle"])):d("",!0)}const Ao=A(vo,[["render",Mo]]),Io={name:"apply-approval-workflow",description:"applies selected workflow on the given ticketId",props:{showModal:{type:Boolean,default:!1},onClose:{type:Function},ticketId:{type:[String,Number],default:""},reloadDetails:{type:Function}},data(){return{isDisabled:!1,loading:!1,workflow:"",divStyle:{width:"500px"}}},beforeMount(){this.isDisabled=!this.workflow},methods:{onChange(e,t){this[t]=e,this.isDisabled=!e},onSubmit(){this.loading=!0,this.isDisabled=!0;const e={};e.ticket_id=this.ticketId,e.workflow_id=this.workflow.id,S.post("/api/apply-approval-workflow",e).then(t=>{window.emitter.emit("approvalWorkflowApplied"),this.reloadDetails("approval"),x(t,"timeline"),this.loading=!1,this.isDisabled=!1,this.onClose()}).catch(t=>{L(t,"timeline"),this.loading=!1,this.isDisabled=!1,this.onClose()})}},components:{"dynamic-select":K}},Fo={class:"modal-title"},Lo={key:0,class:"row"},Ro={key:1,class:"row"},Po=["disabled"],Oo=a("i",{class:"fas fa-sync-alt"},null,-1);function jo(e,t,s,c,i,o){const h=u("dynamic-select"),p=u("reuse-loader"),g=u("modal");return s.showModal?(n(),C(g,{key:0,showModal:s.showModal,onClose:s.onClose,containerStyle:i.divStyle},{title:f(()=>[a("h4",Fo,r(e.lang("apply_approval_workflow")),1)]),fields:f(()=>[i.loading?d("",!0):(n(),l("div",Lo,[_(h,{label:e.lang("approval_workflow"),multiple:!1,name:"workflow",required:!0,classname:"col-sm-12",apiEndpoint:"/api/dependency/approval-workflows",value:i.workflow,onChange:o.onChange,clearable:!!i.workflow,strlength:"60"},null,8,["label","value","onChange","clearable"])])),i.loading?(n(),l("div",Ro,[_(p,{duration:4e3,size:60})])):d("",!0)]),controls:f(()=>[a("button",{type:"button",onClick:t[0]||(t[0]=(...v)=>o.onSubmit&&o.onSubmit(...v)),class:"btn btn-primary",disabled:i.isDisabled},[Oo,m(" "+r(e.lang("update")),1)],8,Po)]),_:1},8,["showModal","onClose","containerStyle"])):d("",!0)}const xo=A(Io,[["render",jo]]);const No={name:"forward-modal",description:"applies selected workflow on the given ticketId",props:{showModal:{type:Boolean,default:!1},onClose:{type:Function},ticketId:{type:[String,Number],default:""},reloadDetails:{type:Function}},data(){return{isDisabled:!1,loading:!1,users:[],description:null,sendAttachments:!1,divStyle:{width:"700px"}}},beforeMount(){this.isDisabled=!(this.users.length>0)},methods:{onChange(e,t){this[t]=e,t==="users"&&(this.isDisabled=!(e&&e.length>0))},onSubmit(){let e=this.users.map(s=>s.hasOwnProperty("email")?s.email:s.name);this.loading=!0,this.isDisabled=!0;const t={};t.ticket_id=this.ticketId,t.emails=e,t.send_attachments=this.sendAttachments,t.description=this.description?this.description.replaceAll(`
`,"<br>"):this.description,S.post("/api/forward-ticket",t).then(s=>{this.reloadDetails("forward"),x(s,"timeline"),this.loading=!1,this.isDisabled=!1,this.onClose()}).catch(s=>{L(s,"timeline"),this.loading=!1,this.isDisabled=!1})}},components:{"dynamic-select":K,checkbox:Ne,"text-field":ie}},Vo={class:"modal-title"},Eo={key:0,class:"row"},Bo={key:1,class:"row"},Uo=["disabled"],qo=a("i",{class:"fas fa-sync-alt"},null,-1);function zo(e,t,s,c,i,o){const h=u("dynamic-select"),p=u("text-field"),g=u("checkbox"),v=u("reuse-loader"),D=u("modal");return s.showModal?(n(),C(D,{key:0,showModal:s.showModal,onClose:s.onClose,containerStyle:i.divStyle},{title:f(()=>[a("h4",Vo,r(e.lang("forward_ticket")),1)]),fields:f(()=>[i.loading?d("",!0):(n(),l("div",Eo,[_(h,{label:e.lang("users"),multiple:!0,name:"users",required:!0,classname:"col-sm-12",apiEndpoint:"/api/dependency/users?meta=true",value:i.users,onChange:o.onChange,taggable:!0},null,8,["label","value","onChange"]),_(p,{label:e.lang("description"),id:"forward-modal-description-field",value:i.description,type:"textarea",name:"description",onChange:o.onChange,placehold:e.lang("enter_a_value"),classname:"col-sm-12",rows:"5",length:!1},null,8,["label","value","onChange","placehold"]),_(g,{id:"forward-modal-send-attachments",name:"sendAttachments",value:i.sendAttachments,label:e.lang("send_attachments_along_with_ticket"),onChange:o.onChange,classname:"col-sm-12"},null,8,["value","label","onChange"])])),i.loading?(n(),l("div",Bo,[_(v,{duration:4e3,size:60})])):d("",!0)]),controls:f(()=>[a("button",{type:"button",onClick:t[0]||(t[0]=(...b)=>o.onSubmit&&o.onSubmit(...b)),class:"btn btn-primary",disabled:i.isDisabled},[qo,m(" "+r(e.lang("update")),1)],8,Uo)]),_:1},8,["showModal","onClose","containerStyle"])):d("",!0)}const Ho=A(No,[["render",zo]]);const Ko={name:"due-date-modal",description:"Due Date modal Component",props:{showModal:{type:Boolean,default:!1},onClose:{type:Function},ticketId:{type:[String,Number],default:""},reloadDetails:{type:Function}},data(){return{isDisabled:!1,loading:!1,due_date:"",divStyle:{width:"500px"}}},beforeMount(){this.isDisabled=!this.due_date},methods:{onChange(e,t){this[t]=e,this.isDisabled=!e},onSubmit(){this.loading=!0,this.isDisabled=!0;const e={};e["ticket-id"]=this.ticketId,e.duedate=Ge(this.due_date).format("YYYY-MM-DD HH:mm:ss"),S.post("/api/ticket/change-duedate",e).then(t=>{this.reloadDetails("duedate"),x(t,"timeline"),this.loading=!1,this.isDisabled=!1,this.onClose()}).catch(t=>{L(t,"timeline"),this.loading=!1,this.isDisabled=!1,this.onClose()})}},components:{"date-time-field":$e}},Wo={class:"modal-title"},Go={key:0,class:"row"},Zo={key:1,class:"row"},Jo=["disabled"],Yo=a("i",{class:"fas fa-sync-alt"},null,-1);function Qo(e,t,s,c,i,o){const h=u("date-time-field"),p=u("reuse-loader"),g=u("modal");return s.showModal?(n(),C(g,{key:0,showModal:s.showModal,onClose:s.onClose,containerStyle:i.divStyle},{title:f(()=>[a("h4",Wo,r(e.lang("change_due_date")),1)]),fields:f(()=>[i.loading?d("",!0):(n(),l("div",Go,[_(h,{label:e.lang("select_date"),value:"",type:"datetime",key:"due_date",id:"due_date",name:"due_date",onChange:o.onChange,required:!0,format:"YYYY-MM-DD HH:mm:ss",classname:"col-sm-12 due_picker",clearable:!0,disabled:!1,editable:!0,currentYearDate:!1,notBefore:new Date},null,8,["label","onChange","notBefore"])])),i.loading?(n(),l("div",Zo,[_(p,{duration:4e3,size:60})])):d("",!0)]),controls:f(()=>[a("button",{type:"button",onClick:t[0]||(t[0]=(...v)=>o.onSubmit&&o.onSubmit(...v)),class:"btn btn-primary",disabled:i.isDisabled},[Yo,m(" "+r(e.lang("update")),1)],8,Jo)]),_:1},8,["showModal","onClose","containerStyle"])):d("",!0)}const Xo=A(Ko,[["render",Qo]]),$o={name:"generate-pdf-modal",props:{showModal:{type:Boolean,default:!1},ticket:{type:Object,default:()=>{}},onClose:{type:Function,default:()=>{}}},data:()=>({containerStyle:{width:"860px"},loading:!1,pdf:"default",radioOptions:[],defaultOptions:[{key:"ticketConversation",name:"ticket_conversations",checked:!1},{key:"internalNote",name:"ticket_conversation_with_notes",checked:!1},{key:"allTicketDetails",name:"ticket_conversation_with_details",checked:!1},{key:"requesterDetails",name:"ticket_conversation_with_requester_details",checked:!1},{key:"assignedAgentDetails",name:"ticket_conversation_with_agent_details",checked:!1}],template:""}),beforeMount(){this.radioOptions=this.loggedUserRole=="agent"?[{name:"default_pdf_template",value:"default"}]:[{name:"default_pdf_template",value:"default"},{name:"customized_pdf_template",value:"custom"}]},methods:{onCheck(e,t){this.defaultOptions.forEach(function(s){if(s.key==t){s.checked=e;return}})},onChange(e,t){this[t]=e,t==="pdf"&&this.defaultOptions.forEach(function(s){s.checked=!1})},generatePdf(){let e="";if(this.pdf==="default")for(let t in this.defaultOptions)e+=this.defaultOptions[t].key+"="+this.defaultOptions[t].checked+"&";else if(this.template)e="template_id="+this.template.id,this.$store.dispatch("unsetValidationError");else{this.$store.dispatch("setValidationError",{template:"This field is required"});return}e[e.length-1]==="&"&&(e=e.slice(0,-1)),this.loading=!0,S.get("/ticket/print/"+this.ticket.id+"?"+e).then(t=>{t.data.message?(x(t,"timeline"),this.onClose(),this.loading=!1):(this.loading=!1,this.openInNewTab(this.basePath()+"/ticket/print/"+this.ticket.id+"?"+e),this.onClose())}).catch(t=>{this.onClose(),L(t,"timeline")})},openInNewTab(e){const t=window.open(e,"_blank");t&&t.focus()}},components:{checkbox:Ne,"dynamic-select":K,"radio-button":Ie,"text-field":ie}},en={class:"modal-title"},tn={class:"row"},sn={key:0,class:"row"},an={key:1,class:"row"},on={key:1,class:"row"},nn=a("i",{class:"fas fa-check"},null,-1);function ln(e,t,s,c,i,o){const h=u("radio-button"),p=u("checkbox"),g=u("dynamic-select"),v=u("reuse-loader"),D=u("modal");return s.showModal?(n(),C(D,{key:0,showModal:s.showModal,onClose:s.onClose,containerStyle:e.containerStyle},{title:f(()=>[a("h4",en,r(e.trans("generate_pdf")),1)]),fields:f(()=>[e.loading?d("",!0):(n(),l(T,{key:0},[a("div",tn,[_(h,{options:e.radioOptions,label:e.trans("select_an_action"),name:"pdf",value:e.pdf,onChange:o.onChange,classname:"form-group col-sm-12",optionClass:"col-sm-4"},null,8,["options","label","value","onChange"])]),e.pdf==="default"?(n(),l("div",sn,[e.loggedUserRole=="agent"?(n(!0),l(T,{key:0},P(e.defaultOptions.slice(0,3),b=>(n(),l("div",{class:"col-sm-12",key:b.key},[_(p,{name:b.key,value:b.checked,label:b.name,title:b.name,onChange:o.onCheck,id:b.key,defaultClass:"",labelClass:"fw-400"},null,8,["name","value","label","title","onChange","id"])]))),128)):(n(!0),l(T,{key:1},P(e.defaultOptions,b=>(n(),l("div",{class:"col-sm-12",key:b.key},[_(p,{name:b.key,value:b.checked,label:b.name,title:b.name,onChange:o.onCheck,id:b.key,defaultClass:"",labelClass:"fw-400"},null,8,["name","value","label","title","onChange","id"])]))),128))])):d("",!0),e.pdf==="custom"?(n(),l("div",an,[_(g,{label:e.trans("templates"),multiple:!1,name:"template",required:!0,classname:"col-sm-12",apiEndpoint:"/api/get/pdfTemplates",value:e.template,onChange:o.onChange},null,8,["label","value","onChange"])])):d("",!0)],64)),e.loading?(n(),l("div",on,[_(v,{"animation-duration":4e3,color:"#1d78ff",size:e.size},null,8,["size"])])):d("",!0)]),controls:f(()=>[a("button",{type:"button",onClick:t[0]||(t[0]=(...b)=>o.generatePdf&&o.generatePdf(...b)),class:"btn btn-primary",id:"submit_btn"},[nn,m(" "+r(e.trans("generate_pdf")),1)])]),_:1},8,["showModal","onClose","containerStyle"])):d("",!0)}const rn=A($o,[["render",ln]]);const dn={props:{actions:{type:Object,default:()=>{}},ticket:{type:Object,default:()=>{}},user:{type:Object,default:()=>{}},updateDetails:{type:Function}},data(){return{showRequesterModal:!1,showMergeModal:!1,showForkModal:!1,showTimeModal:!1,showDueModal:!1,showApprovalModal:!1,showForwardModal:!1,showSurrenderModal:!1,showDeptModal:!1,showGenerateModal:!1,loading:!1,actionsList:this.actions}},methods:{reloadData(e){this.updateDetails(e)},updateTimeTrack(){window.emitter.emit("refreshTimeTrack")},onClose(){this.showRequesterModal=!1,this.showMergeModal=!1,this.showForkModal=!1,this.showTimeModal=!1,this.showDueModal=!1,this.showSurrenderModal=!1,this.showDeptModal=!1,this.showApprovalModal=!1,this.showForwardModal=!1,this.showGenerateModal=!1},requestFeedback(){this.loading=!0,S.post("/api/request/rating/"+this.ticket.id).then(e=>{this.loading=!1,x(e,"timeline")}).catch(e=>{this.loading=!1,L(e,"timeline")})}},components:{"change-requester-modal":Fa,"ticket-fork-modal":Ea,"record-time-modal":Ue,"timeline-merge-modal":mo,"surrender-modal":yo,"change-dept-modal":Ao,"approval-modal":xo,"forward-modal":Ho,"due-date-modal":Xo,"generate-pdf-modal":rn}},W=e=>(N("data-v-863ac489"),e=e(),V(),e),cn={class:"btn-group",id:"more-evt"},hn={type:"button",class:"btn btn-xs btn-default","data-toggle":"dropdown"},un=W(()=>a("i",{class:"fas fa-ellipsis-v"},null,-1)),mn=[un],_n={class:"dropdown-menu dropdown-menu-right"},pn=W(()=>a("i",{class:"far fa-user"},null,-1)),gn=W(()=>a("i",{class:"fas fa-cog"},null,-1)),fn=W(()=>a("i",{class:"fas fa-code-branch"},null,-1)),kn=W(()=>a("i",{class:"far fa-star"},null,-1)),bn=W(()=>a("i",{class:"far fa-clock"},null,-1)),yn=W(()=>a("i",{class:"far fa-calendar"},null,-1)),vn=W(()=>a("i",{class:"fas fa-arrows-alt"},null,-1)),wn=W(()=>a("i",{class:"far fa-hand-point-right"},null,-1)),Cn=W(()=>a("i",{class:"far fa-file-pdf"},null,-1)),Tn=W(()=>a("i",{class:"fas fa-pause"},null,-1)),Dn=W(()=>a("i",{class:"fas fa-forward"},null,-1)),Sn={key:0,class:"row"};function Mn(e,t,s,c,i,o){const h=u("due-date-modal"),p=u("generate-pdf-modal"),g=u("surrender-modal"),v=u("change-dept-modal"),D=u("approval-modal"),b=u("forward-modal"),w=u("change-requester-modal"),F=u("timeline-merge-modal"),U=u("ticket-fork-modal"),I=u("record-time-modal"),R=u("custom-loader"),y=z("tooltip");return n(),l("div",cn,[k((n(),l("button",hn,mn)),[[y,e.lang("more-actions")]]),a("div",_n,[a("a",{class:"dropdown-item",href:"javascript:;",onClick:t[0]||(t[0]=j=>i.showRequesterModal=!0)},[pn,m(" "+r(e.lang("change_requester")),1)]),a("a",{class:"dropdown-item",href:"javascript:;",onClick:t[1]||(t[1]=j=>i.showMergeModal=!0)},[gn,m(" "+r(e.lang("merge-ticket")),1)]),a("a",{class:"dropdown-item",href:"javascript:;",onClick:t[2]||(t[2]=j=>i.showForkModal=!0)},[fn,m(" "+r(e.lang("ticket-fork")),1)]),a("a",{href:"javascript:;",class:"dropdown-item",onClick:t[3]||(t[3]=(...j)=>o.requestFeedback&&o.requestFeedback(...j))},[kn,m(r(e.lang("request-feedback")),1)]),s.actions.time_track_enabled?(n(),l("a",{key:0,class:"dropdown-item",href:"javascript:;",onClick:t[4]||(t[4]=j=>i.showTimeModal=!0)},[bn,m(" "+r(e.lang("record_time")),1)])):d("",!0),i.actionsList.change_duedate?(n(),l("a",{key:1,class:"dropdown-item",href:"javascript:;",onClick:t[5]||(t[5]=j=>i.showDueModal=!0)},[yn,m(" "+r(e.lang("change_due_date")),1)])):d("",!0),i.actionsList.surrender?(n(),l("a",{key:2,class:"dropdown-item",href:"javascript:;",onClick:t[6]||(t[6]=j=>i.showSurrenderModal=!0)},[vn,m(" "+r(e.lang("surrender")),1)])):d("",!0),i.actionsList.transfer?(n(),l("a",{key:3,class:"dropdown-item",href:"javascript:;",onClick:t[7]||(t[7]=j=>i.showDeptModal=!0)},[wn,m(" "+r(e.lang("change_department")),1)])):d("",!0),a("a",{href:"javascript:;",class:"dropdown-item",onClick:t[8]||(t[8]=j=>i.showGenerateModal=!0)},[Cn,m(" "+r(e.lang("generate_pdf")),1)]),i.actionsList.allowed_enforce_approval_workflow?(n(),l("a",{key:4,class:"dropdown-item",href:"javascript:;",onClick:t[9]||(t[9]=j=>i.showApprovalModal=!0)},[Tn,m(" "+r(e.lang("apply_approval_workflow")),1)])):d("",!0),a("a",{class:"dropdown-item",href:"javascript:;",onClick:t[10]||(t[10]=j=>i.showForwardModal=!0)},[Dn,m(" "+r(e.lang("forward_ticket")),1)])]),_(q,{name:"modal"},{default:f(()=>[i.showDueModal?(n(),C(h,{key:0,onClose:o.onClose,showModal:i.showDueModal,ticketId:s.ticket.id,componentTitle:"timeline",reloadDetails:o.reloadData},null,8,["onClose","showModal","ticketId","reloadDetails"])):d("",!0)]),_:1}),_(q,{name:"modal"},{default:f(()=>[i.showGenerateModal?(n(),C(p,{key:0,onClose:o.onClose,showModal:i.showGenerateModal,ticket:s.ticket},null,8,["onClose","showModal","ticket"])):d("",!0)]),_:1}),_(q,{name:"modal"},{default:f(()=>[i.showSurrenderModal?(n(),C(g,{key:0,onClose:o.onClose,showModal:i.showSurrenderModal,ticketId:s.ticket.id,componentTitle:"timeline",reloadDetails:o.reloadData},null,8,["onClose","showModal","ticketId","reloadDetails"])):d("",!0)]),_:1}),_(q,{name:"modal"},{default:f(()=>[i.showDeptModal?(n(),C(v,{key:0,onClose:o.onClose,showModal:i.showDeptModal,ticketId:s.ticket.id,componentTitle:"timeline",reloadDetails:o.reloadData},null,8,["onClose","showModal","ticketId","reloadDetails"])):d("",!0)]),_:1}),_(q,{name:"modal"},{default:f(()=>[i.showApprovalModal?(n(),C(D,{key:0,onClose:o.onClose,showModal:i.showApprovalModal,ticketId:s.ticket.id,componentTitle:"timeline",reloadDetails:o.reloadData},null,8,["onClose","showModal","ticketId","reloadDetails"])):d("",!0)]),_:1}),_(q,{name:"modal"},{default:f(()=>[i.showForwardModal?(n(),C(b,{key:0,onClose:o.onClose,showModal:i.showForwardModal,ticketId:s.ticket.id,componentTitle:"timeline",reloadDetails:o.reloadData},null,8,["onClose","showModal","ticketId","reloadDetails"])):d("",!0)]),_:1}),_(q,{name:"modal"},{default:f(()=>[i.showRequesterModal?(n(),C(w,{key:0,onClose:o.onClose,showModal:i.showRequesterModal,ticketId:s.ticket.id,componentTitle:"timeline",reloadDetails:o.reloadData},null,8,["onClose","showModal","ticketId","reloadDetails"])):d("",!0)]),_:1}),_(q,{name:"modal"},{default:f(()=>[i.showMergeModal?(n(),C(F,{key:0,onClose:o.onClose,showModal:i.showMergeModal,ticketId:s.ticket.id,componentTitle:"timeline",reloadTickets:o.reloadData},null,8,["onClose","showModal","ticketId","reloadTickets"])):d("",!0)]),_:1}),_(q,{name:"modal"},{default:f(()=>[i.showForkModal?(n(),C(U,{key:0,onClose:o.onClose,showModal:i.showForkModal,ticketId:s.ticket.id,componentTitle:"timeline",reloadDetails:o.reloadData,selectedFormData:s.ticket.form},null,8,["onClose","showModal","ticketId","reloadDetails","selectedFormData"])):d("",!0)]),_:1}),_(q,{name:"modal"},{default:f(()=>[i.showTimeModal?(n(),C(I,{key:0,onClose:o.onClose,showModal:i.showTimeModal,ticketId:s.ticket.id,componentTitle:"timeline",updateData:o.updateTimeTrack},null,8,["onClose","showModal","ticketId","updateData"])):d("",!0)]),_:1}),i.loading?(n(),l("div",Sn,[_(R,{size:60})])):d("",!0)])}const An=A(dn,[["render",Mn],["__scopeId","data-v-863ac489"]]);const In={props:{actions:{type:[Object,String],default:""},id:{type:[String,Number],default:""},data:{type:Object,default:()=>{}},afterAction:{type:Function,default:()=>{}}},data(){return{actionsList:this.actions}},methods:{reloadData(e){this.afterAction(e)},timelineActionBarMounted(){this.data.alertName="timeline",window.emitter.emit("timeline-action-bar-mounted",this.data)},timelineActionDivMounted(){this.data.alertName="timeline",this.data.showTaskCount=!0,this.data.ticket_id=this.id,this.data.entity_id=this.id,this.data.entity_type="ticket",window.emitter.emit("timeline-action-div-mounted",this.data)}},components:{"ticket-label":na,"ticket-tag":wa,"more-events":An}},Fn={class:"timeline-actions-span"},Ln={id:"timeline-action-div",class:"inline-block"},Rn={id:"timeline-action-bar",class:"inline-block"};function Pn(e,t,s,c,i,o){const h=u("ticket-label"),p=u("ticket-tag"),g=u("more-events");return n(),l("span",Fn,[!s.actions.block_ticket_actions&&s.actions.view_tickets_without_actions?(n(),l(T,{key:0},[_(h,{ticketObj:s.data,reloadDetails:o.reloadData},null,8,["ticketObj","reloadDetails"]),_(p,{ticketObj:s.data,reloadDetails:o.reloadData},null,8,["ticketObj","reloadDetails"]),a("div",Ln,r(o.timelineActionDivMounted()),1),a("div",Rn,r(o.timelineActionBarMounted()),1)],64)):d("",!0),ue(e.$slots,"left-actions"),!s.actions.block_ticket_actions&&s.actions.view_tickets_without_actions?(n(),C(g,{key:1,actions:i.actionsList,ticket:s.data,updateDetails:o.reloadData},null,8,["actions","ticket","updateDetails"])):d("",!0)])}const On=A(In,[["render",Pn]]);const jn={name:"edit-ticket-modal",description:"Edit Ticket modal Component",props:{showModal:{type:Boolean,default:!1},onClose:{type:Function},ticketId:{type:[String,Number],default:""},reloadDetails:{type:Function},selectedFormData:{type:Object,default:()=>{}}},data(){return{formUniqueKey:"",submitFormInProgress:!1,scenario:"edit",panel:"agent",category:"ticket",selectedForm:this.selectedFormData,formSelected:!0,fetchFormFieldApi:"api/agent/edit-mode-ticket-details/"+this.ticketId}},mixins:[Me],created(){window.emitter.on("updateTicketCategory",this.updateTicketCategory)},methods:{updateTicketCategory(){window.emitter.emit("storeCategoryId",this.selectedForm.id)},onChange(e,t){this[t]=e,this.formSelected=!1,this.updateFetchApi()},updateFetchApi(){this.$store.dispatch("destroyFormInsatnce",this.formUniqueKey),this.$store.dispatch("unsetValidationError"),this.fetchFormFieldApi="/api/agent/edit-mode-ticket-details/"+this.ticketId+"?form_category_id="+this.selectedForm.id,setTimeout(()=>{this.$store.dispatch("createNewFormInstance",{formUniqueKey:this.formUniqueKey,scenario:this.scenario}),this.formSelected=!0},1)},popUpSubmit(){document.getElementById("edit-ticket-submit").click()},formSubmit(e,t){this.$store.dispatch("setRecaptchaKey",t),this.onSubmit()},afterSubmit(e){window.emitter.emit("reset-captcha"),setTimeout(()=>{window.emitter.emit("refreshTableAndData",!0),this.reloadDetails("edit"),this.onClose()},1e3)}},beforeDestroy(){this.$store.dispatch("unsetAlert")},components:{DynamicSelect:K,Alert:Le,Modal:me,CustomLoader:Fe,Loader:Ve,FormWithCaptcha:Ae,FormRenderer:Re}},xn=e=>(N("data-v-ebc5893f"),e=e(),V(),e),Nn={class:"modal-title"},Vn={id:"ticket_modal_body"},En={key:0,class:"form_select"},Bn=["disabled"],Un=xn(()=>a("i",{class:"fas fa-sync"},null,-1));function qn(e,t,s,c,i,o){const h=u("CustomLoader"),p=u("Loader"),g=u("Alert"),v=u("DynamicSelect"),D=u("FormRenderer"),b=u("ValidationObserver"),w=u("FormWithCaptcha"),F=u("Modal");return n(),l("div",null,[i.submitFormInProgress?(n(),C(h,{key:0})):d("",!0),s.showModal?(n(),C(F,{key:1,showModal:s.showModal,onClose:s.onClose,containerStyle:{width:"1200px",maxWidth:"1200px !important"}},{title:f(()=>[a("h4",Nn,r(e.lang("edit_ticket")),1)]),fields:f(()=>[e.showLoader?(n(),C(p,{key:0})):d("",!0),a("div",Vn,[_(g,{componentName:"faveo-form"}),e.showLoader?d("",!0):(n(),l("div",En,[_(v,{label:e.trans("select_form"),multiple:!1,name:"selectedForm",apiEndpoint:"/api/ticket/forms",value:i.selectedForm,showIcon:!1,onChange:o.onChange,clearable:!1,"label-style":{display:"none"}},null,8,["label","value","onChange"])])),i.formUniqueKey&&i.formSelected?(n(),C(w,{key:1,loading:!e.showLoader,btnClass:"btn btn-primary pull-right",btnName:"submit",componentName:"faveo-form",btn_id:"edit-ticket-submit",formSubmit:o.formSubmit,page:"ticket_edit_agent",recaptchaContainerClass:"mt-2",disableSubmit:i.submitFormInProgress},{fields:f(()=>[_(b,{ref:"faveoFormObserver"},{default:f(({values:U,errors:I,validate:R})=>[_(D,{category:"ticket",fetchFormFieldApi:i.fetchFormFieldApi,scenario:i.scenario,panel:i.panel,isInlineForm:!1,formUniqueKey:i.formUniqueKey,selectDependencyId:s.ticketId,selectDependencyKey:"id"},null,8,["fetchFormFieldApi","scenario","panel","formUniqueKey","selectDependencyId"])]),_:1},512)]),_:1},8,["loading","formSubmit","disableSubmit"])):d("",!0)])]),controls:f(()=>[e.showLoader?d("",!0):(n(),l("button",{key:0,type:"button",class:"btn btn-primary pull-right",disabled:i.submitFormInProgress,onClick:t[0]||(t[0]=U=>o.popUpSubmit())},[Un,m(" "+r(e.trans("update")),1)],8,Bn))]),_:1},8,["showModal","onClose"])):d("",!0)])}const zn=A(jn,[["render",qn],["__scopeId","data-v-ebc5893f"]]);const Hn={name:"timeline-data",setup(){const e=H();return{formattedTime:O(()=>e.getters.formattedTime),customFormattedTime:O(()=>e.getters.customFormattedTime)}},props:{ticket:{type:Object,default:()=>{}},color:{type:String,default:""},actions:{type:[Object,String],default:""},afterAction:{type:Function,default:()=>{}},archive:{type:Boolean,default:!0},id:{type:[String,Number],default:""}},data(){return{timelineData:this.ticket,showEditModal:!1,showAssignModal:!1,showStatusModal:!1,change_status:"",statusList:"",loading:!1}},watch:{ticket(e,t){this.timelineData.custom_field_values=[],setTimeout(()=>{this.timelineData=e},1e3)}},methods:{getStatusList(){this.loading=!0;let e={meta:!0,supplements:Se([this.id]),limit:"all"};S.get("/api/dependency/statuses",{params:e}).then(t=>{this.loading=!1,this.statusList=t.data.data.statuses}).catch(t=>{this.loading=!1})},getStatus(e){this.showStatusModal=!0,this.change_status=e},reloadData(e){this.afterAction(e)},subString(e,t=15){return Z(e,t)},timelineMetaListBoxMounted(){window.emitter.emit("timeline-meta-box-mounted",this.ticket)},onClose(){this.showEditModal=!1,this.showAssignModal=!1,this.showStatusModal=!1,this.$store.dispatch("unsetValidationError")}},components:{"edit-ticket-modal":zn,"assign-ticket-modal":xe,"change-status-modal":je,UserInfo:Ee}},fe=e=>(N("data-v-6cfdf0be"),e=e(),V(),e),Kn={class:"row"},Wn={class:"col-sm-12"},Gn={class:"card card-light"},Zn={key:0,class:"card-header pbt-8"},Jn={class:"card-tools"},Yn={class:"badge badge-success text-xs"},Qn={key:1},Xn={class:"badge badge-danger text-xs"},$n={key:0,class:"col-sm-6"},el={class:"badge badge-success text-xs"},tl={key:1},sl={class:"badge badge-danger text-xs"},il=fe(()=>a("i",{class:"far fa-edit"},null,-1)),al=fe(()=>a("i",{class:"far fa-hand-point-right"},null,-1)),ol={class:"btn-group"},nl=fe(()=>a("i",{class:"fas fa-exchange-alt"},null,-1)),ll={class:"dropdown-menu status-list dropdown-menu-right"},rl={key:0,class:"row"},dl=["onClick"],cl={key:1,class:"dropdown-item",href:"javascript:;"},hl={class:"card-body",id:"ticket_data"},ul={class:"row"},ml={class:"col-md-12 info-row"},_l={class:"row"},pl={class:"col-sm-6"},gl={class:"col-sm-6"},fl={class:"col-md-12 info-row"},kl={class:"row"},bl={class:"col-sm-6"},yl={class:"col-sm-6"},vl={class:"col-md-12 info-row"},wl={class:"row"},Cl={class:"col-sm-6"},Tl={class:"col-sm-6"},Dl={class:"col-md-12 info-row"},Sl={class:"row"},Ml={class:"col-sm-6"},Al={class:"col-sm-6"},Il={key:0,class:"col-md-12 info-row"},Fl={class:"row"},Ll={class:"col-sm-6"},Rl={key:1,class:"col-md-12 info-row"},Pl={class:"row"},Ol={class:"col-sm-6"},jl={key:2,class:"col-md-12 info-row"},xl={class:"row"},Nl={class:"col-sm-6"},Vl={class:"permssion-update"},El={key:3,class:"col-md-12 info-row"},Bl={class:"row"},Ul={class:"col-sm-6"},ql={key:4,class:"col-md-12 info-row"},zl={class:"row"},Hl={class:"col-sm-6"},Kl={class:"permssion-update"},Wl={key:5,class:"col-md-12 info-row"},Gl={class:"row"},Zl={class:"col-sm-6"},Jl={key:6,class:"col-md-12 info-row"},Yl={class:"row"},Ql={class:"col-sm-6"},Xl={class:"permssion-update"},$l={key:7,class:"col-md-12 info-row"},er={class:"row"},tr={class:"col-sm-6"},sr={key:8,class:"col-md-12 info-row"},ir={class:"row"},ar={class:"col-sm-6"},or={class:"permssion-update"},nr={key:9,class:"col-md-12 info-row"},lr={class:"row"},rr={class:"col-sm-6"},dr={key:10,class:"col-md-12 info-row"},cr={class:"row"},hr={class:"col-sm-6"},ur={key:11,class:"col-md-12 info-row"},mr={class:"row"},_r={class:"col-sm-6"},pr={key:12,class:"col-md-12 info-row"},gr={class:"row"},fr={class:"col-sm-6"},kr={key:13,class:"col-md-12 info-row"},br={class:"row"},yr={class:"col-sm-6"},vr={key:14,class:"col-md-12 info-row"},wr={class:"row"},Cr={class:"col-sm-6"},Tr={key:15,class:"col-md-12 info-row"},Dr={class:"row"},Sr={class:"col-sm-6"},Mr={key:16,class:"col-md-12 info-row"},Ar={class:"row"},Ir={class:"col-sm-6"},Fr={key:17,class:"col-md-12 info-row"},Lr={class:"row"},Rr={class:"col-sm-6"},Pr={class:"col-md-12 info-row"},Or={key:0,class:"row"},jr={class:"col-sm-6"},xr={key:0,class:"col-sm-6"},Nr={id:"timeline-meta-list-box",class:"col-sm-12"};function Vr(e,t,s,c,i,o){var F,U,I,R;const h=u("router-link"),p=u("reuse-loader"),g=u("user-info"),v=u("edit-ticket-modal"),D=u("assign-ticket-modal"),b=u("change-status-modal"),w=z("tooltip");return n(),l("div",Kn,[a("div",Wn,[a("div",Gn,[s.actions.block_ticket_actions?d("",!0):(n(),l("div",Zn,[a("div",Jn,[s.archive?(n(),l(T,{key:1},[s.ticket.assignee?k((n(),l("a",$n,[a("span",el,r(e.trans("assigned")),1)])),[[w,s.ticket.assignee.name]]):(n(),l("span",tl,[a("span",sl,r(e.trans("unassigned")),1),m("  ")]))],64)):(n(),l(T,{key:0},[s.ticket.assignee?k((n(),C(h,{key:0,class:"col-sm-6",to:s.ticket.assignee.href.replace(e.basePath(),"")},{default:f(()=>[a("span",Yn,r(e.trans("assigned")),1)]),_:1},8,["to"])),[[w,s.ticket.assignee.name]]):(n(),l("span",Qn,[a("span",Xn,r(e.trans("unassigned")),1),m("  ")]))],64)),s.actions.view_tickets_without_actions?(n(),l("button",{key:2,type:"button",class:"btn btn-xs btn-default",onClick:t[0]||(t[0]=y=>i.showEditModal=!0)},[il,m(" "+r(e.trans("edit")),1)])):d("",!0),s.actions.assign?(n(),l("button",{key:3,type:"button",class:"btn btn-xs btn-default",onClick:t[1]||(t[1]=y=>i.showAssignModal=!0)},[al,m(" "+r(e.trans("assign")),1)])):d("",!0),a("div",ol,[s.actions.view_tickets_without_actions?(n(),l("button",{key:0,type:"button",class:"btn btn-xs btn-default dropdown-toggle","data-toggle":"dropdown",onClick:t[2]||(t[2]=y=>o.getStatusList()),id:"status"},[nl,m(" "+r(e.trans("change_status")),1)])):d("",!0),a("div",ll,[i.loading?(n(),l("div",rl,[_(p,{"animation-duration":4e3,color:"#1d78ff",size:20})])):d("",!0),i.loading?d("",!0):(n(),l(T,{key:1},[i.statusList&&i.statusList.length>0?(n(!0),l(T,{key:0},P(i.statusList,y=>(n(),l("a",{class:"dropdown-item",id:"change_status",onClick:j=>o.getStatus(y),href:"javascript:;"},[a("i",{class:M(y.icon),style:E({color:y.icon_color})},null,6),m("  "+r(y.name),1)],8,dl))),256)):d("",!0),i.statusList&&i.statusList.length===0?(n(),l("a",cl,r(e.trans("no-records")),1)):d("",!0)],64))])])])])),a("div",hl,[a("div",ul,[a("div",ml,[a("div",_l,[a("label",pl,r(e.trans("created_at")),1),k((n(),l("a",gl,[m(r(c.formattedTime(s.ticket.created_at)),1)])),[[w,c.formattedTime(s.ticket.created_at)]])])]),a("div",fl,[a("div",kl,[a("label",bl,r(e.trans("updated_at")),1),k((n(),l("a",yl,[m(r(c.formattedTime(s.ticket.updated_at)),1)])),[[w,c.formattedTime(s.ticket.updated_at)]])])]),a("div",vl,[a("div",wl,[a("label",Cl,r(e.trans("status-changed-at")),1),k((n(),l("a",Tl,[m(r(c.formattedTime(s.ticket.status_changed_at)),1)])),[[w,c.formattedTime(s.ticket.status_changed_at)]])])]),a("div",Dl,[a("div",Sl,[a("label",Ml,r(e.trans("assigned_at")),1),k((n(),l("a",Al,[m(r(c.formattedTime(s.ticket.assigned_at)),1)])),[[w,c.formattedTime(s.ticket.assigned_at)]])])]),s.ticket.status?(n(),l("div",Il,[a("div",Fl,[a("label",Ll,r(e.trans("status")),1),_(h,{class:"col-sm-6",to:s.ticket.status.href.replace(e.basePath(),""),target:"_blank"},{default:f(()=>[k((n(),l("span",null,[m(r(o.subString(s.ticket.status.name,30)),1)])),[[w,s.ticket.status.name]])]),_:1},8,["to"])])])):d("",!0),s.ticket.last_replier&&s.ticket.canViewLastReplierProfile?(n(),l("div",Rl,[a("div",Pl,[a("label",Ol,r(e.trans("last_replier")),1),_(g,{from:s.ticket.last_replier,tableHeader:s.color,class:"custom-user-info"},null,8,["from","tableHeader"])])])):s.ticket.last_replier?(n(),l("div",jl,[a("div",xl,[a("label",Nl,r(e.trans("last_replier")),1),k((n(),l("a",Vl,[m(r(o.subString((F=s.ticket.last_replier)==null?void 0:F.full_name)),1)])),[[w,e.trans("access_denied_now")]]),m("  ")])])):d("",!0),s.ticket.user&&s.ticket.canViewRequestorProfile?(n(),l("div",El,[a("div",Bl,[a("label",Ul,r(e.trans("requester")),1),_(g,{from:s.ticket.user,archive:s.archive,tableHeader:s.color,class:"custom-user-info"},null,8,["from","archive","tableHeader"])])])):(n(),l("div",ql,[a("div",zl,[a("label",Hl,r(e.trans("requester")),1),k((n(),l("a",Kl,[m(r(o.subString((U=s.ticket.user)==null?void 0:U.full_name)),1)])),[[w,e.trans("access_denied_now")]]),m("  ")])])),s.ticket.creator&&s.ticket.canViewCreatorProfile?(n(),l("div",Wl,[a("div",Gl,[a("label",Zl,r(e.trans("creator")),1),_(g,{from:s.ticket.creator,archive:s.archive,tableHeader:s.color,class:"custom-user-info"},null,8,["from","archive","tableHeader"])])])):(n(),l("div",Jl,[a("div",Yl,[a("label",Ql,r(e.trans("creator")),1),k((n(),l("a",Xl,[m(r(o.subString((I=s.ticket.creator)==null?void 0:I.full_name)),1)])),[[w,e.trans("access_denied_now")]]),m("  ")])])),s.ticket.assigned&&s.ticket.canViewAssigneeProfile?(n(),l("div",$l,[a("div",er,[a("label",tr,r(e.trans("assigned_to")),1),_(g,{from:s.ticket.assigned,tableHeader:s.color,archive:s.archive,class:"custom-user-info"},null,8,["from","tableHeader","archive"])])])):s.ticket.assigned?(n(),l("div",sr,[a("div",ir,[a("label",ar,r(e.trans("assigned_to")),1),k((n(),l("a",or,[m(r(o.subString((R=s.ticket.assigned)==null?void 0:R.full_name)),1)])),[[w,e.trans("access_denied_now")]]),m("  ")])])):d("",!0),Array.isArray(s.ticket.assigned_team)?d("",!0):(n(),l("div",nr,[a("div",lr,[a("label",rr,r(e.trans("assigned_team")),1),_(h,{class:"col-sm-6",to:s.ticket.assigned_team.href.replace(e.basePath(),""),target:"_blank"},{default:f(()=>[k((n(),l("span",null,[m(r(o.subString(s.ticket.assigned_team.name,30)),1)])),[[w,s.ticket.assigned_team.name]])]),_:1},8,["to"])])])),s.ticket.source?(n(),l("div",dr,[a("div",cr,[a("label",hr,r(e.trans("source")),1),_(h,{class:"col-sm-6",to:s.ticket.source.href.replace(e.basePath(),""),target:"_blank"},{default:f(()=>[k((n(),l("span",null,[m(r(o.subString(s.ticket.source.name,30)),1)])),[[w,s.ticket.source.name]])]),_:1},8,["to"])])])):d("",!0),s.ticket.type?(n(),l("div",ur,[a("div",mr,[a("label",_r,r(e.trans("type")),1),_(h,{class:"col-sm-6",to:s.ticket.type.href.replace(e.basePath(),""),target:"_blank"},{default:f(()=>[k((n(),l("span",null,[m(r(o.subString(s.ticket.type.name,30)),1)])),[[w,s.ticket.type.name]])]),_:1},8,["to"])])])):d("",!0),s.ticket.priority?(n(),l("div",pr,[a("div",gr,[a("label",fr,r(e.trans("priority")),1),_(h,{class:"col-sm-6",to:s.ticket.priority.href.replace(e.basePath(),""),target:"_blank"},{default:f(()=>[k((n(),l("span",null,[m(r(o.subString(s.ticket.priority.name,30)),1)])),[[w,s.ticket.priority.name]])]),_:1},8,["to"])])])):d("",!0),s.ticket.departments?(n(),l("div",kr,[a("div",br,[a("label",yr,r(e.trans("departments")),1),_(h,{class:"col-sm-6",to:s.ticket.departments.href.replace(e.basePath(),""),target:"_blank"},{default:f(()=>[k((n(),l("span",null,[m(r(o.subString(s.ticket.departments.name,30)),1)])),[[w,s.ticket.departments.name]])]),_:1},8,["to"])])])):d("",!0),s.ticket.sla_plan?(n(),l("div",vr,[a("div",wr,[a("label",Cr,r(e.trans("sla_plan")),1),_(h,{class:"col-sm-6",to:s.ticket.sla_plan.href.replace(e.basePath(),""),target:"_blank"},{default:f(()=>[k((n(),l("span",null,[m(r(o.subString(s.ticket.sla_plan.name,30)),1)])),[[w,s.ticket.sla_plan.name]])]),_:1},8,["to"])])])):d("",!0),s.ticket.helptopic?(n(),l("div",Tr,[a("div",Dr,[a("label",Sr,r(e.trans("helptopic")),1),_(h,{class:"col-sm-6",to:s.ticket.helptopic.href.replace(e.basePath(),""),target:"_blank"},{default:f(()=>[k((n(),l("span",null,[m(r(o.subString(s.ticket.helptopic.name,30)),1)])),[[w,s.ticket.helptopic.name]])]),_:1},8,["to"])])])):d("",!0),s.ticket.location?(n(),l("div",Mr,[a("div",Ar,[a("label",Ir,r(e.trans("location")),1),_(h,{class:"col-sm-6",to:s.ticket.location.href.replace(e.basePath(),""),target:"_blank"},{default:f(()=>[k((n(),l("span",null,[m(r(o.subString(s.ticket.location.name,30)),1)])),[[w,s.ticket.location.name]])]),_:1},8,["to"])])])):d("",!0),s.ticket.form?(n(),l("div",Fr,[a("div",Lr,[a("label",Rr,r(e.trans("form")),1),_(h,{class:"col-sm-6",to:s.ticket.form.href?s.ticket.form.href.replace(e.basePath(),""):"",target:"_blank"},{default:f(()=>[k((n(),l("span",null,[m(r(o.subString(s.ticket.form.name,30)),1)])),[[w,s.ticket.form.name]])]),_:1},8,["to"])])])):d("",!0),i.timelineData.custom_field_values&&i.timelineData.custom_field_values.length>0?(n(!0),l(T,{key:18},P(i.timelineData.custom_field_values,y=>(n(),l("div",Pr,[e.boolean(y.value)?(n(),l("div",Or,[a("label",jr,r(y.label),1),Array.isArray(y.value)?(n(),l("ul",xr,[(n(!0),l(T,null,P(y.value,(j,Y)=>(n(),l("li",null,[_(h,{to:y.href[Y].replace(e.basePath(),""),target:"_blank"},{default:f(()=>[k((n(),l("span",null,[m(r(o.subString(j,30)),1)])),[[w,j]]),m("  ")]),_:2},1032,["to"])]))),256))])):(n(),l(T,{key:1},[y.field_type==="date"?k((n(),C(h,{key:0,class:"col-sm-6",to:y.href.replace(e.basePath(),""),target:"_blank"},{default:f(()=>[m(r(y.value),1)]),_:2},1032,["to"])),[[w,y.value]]):(n(),C(h,{key:1,class:"col-sm-6",to:y.href.replace(e.basePath(),""),target:"_blank"},{default:f(()=>[k((n(),l("span",null,[m(r(o.subString(y.value,30)),1)])),[[w,y.value]])]),_:2},1032,["to"]))],64))])):d("",!0)]))),256)):d("",!0),a("div",Nr,r(o.timelineMetaListBoxMounted()),1)])])])]),_(q,{name:"modal"},{default:f(()=>[i.showEditModal?(n(),C(v,{key:0,onClose:o.onClose,showModal:i.showEditModal,ticketId:s.id,componentTitle:"timeline",reloadDetails:o.reloadData,selectedFormData:s.ticket.form},null,8,["onClose","showModal","ticketId","reloadDetails","selectedFormData"])):d("",!0)]),_:1}),_(q,{name:"modal"},{default:f(()=>[i.showAssignModal?(n(),C(D,{key:0,onClose:o.onClose,showModal:i.showAssignModal,ticketIds:[s.id],componentTitle:"timeline",reloadTickets:o.reloadData,deptId:s.ticket.departments?s.ticket.departments.id:"",teamId:s.ticket.assignee&&s.ticket.assignee.type=="team"?s.ticket.assignee.id:""},null,8,["onClose","showModal","ticketIds","reloadTickets","deptId","teamId"])):d("",!0)]),_:1}),_(q,{name:"modal"},{default:f(()=>[i.showStatusModal?(n(),C(b,{key:0,onClose:o.onClose,showModal:i.showStatusModal,ticketIds:[s.id],status:i.change_status,componentTitle:"timeline",reloadTickets:o.reloadData},null,8,["onClose","showModal","ticketIds","status","reloadTickets"])):d("",!0)]),_:1})])}const Er=A(Hn,[["render",Vr],["__scopeId","data-v-6cfdf0be"]]);const Br={name:"timeline-requester",props:{user:{type:Object,default:()=>{}},org:{type:Array,default:()=>[]},archive:{type:Boolean,default:!1}},methods:{subString(e,t=15){return Z(e,t)},showUserProfile(e){return this.basePath()+"/panel/user/"+e}}},qe=e=>(N("data-v-aa840755"),e=e(),V(),e),Ur={class:"card card-light"},qr={class:"card-header pad-7"},zr={class:"card-title"},Hr=["src"],Kr={class:"card-body box-profile"},Wr={class:"list-group list-group-unbordered mb-3"},Gr={class:"list-group-item"},Zr={class:"float-right"},Jr={class:"list-group-item"},Yr={class:"float-right"},Qr={class:"list-group-item"},Xr={class:"float-right"},$r={key:0,class:"list-group-item"},ed=qe(()=>a("i",{class:"fas fa-info-circle"},null,-1)),td=["href"],sd=qe(()=>a("i",{class:"fas fa-info-circle"},null,-1));function id(e,t,s,c,i,o){const h=u("router-link"),p=z("tooltip");return n(),l("div",Ur,[a("div",qr,[a("h3",zr,[a("img",{class:"img-circle img-bordered-sm",src:s.user.profile_pic,alt:"user image",style:{width:"30px",height:"30px"}},null,8,Hr),m(" "+r(s.user.full_name),1)])]),a("div",Kr,[a("ul",Wr,[a("li",Gr,[a("label",null,r(e.trans("role")),1),m(),a("a",Zr,r(s.user.role),1)]),a("li",Jr,[a("label",null,r(e.trans("email")),1),m(),k((n(),l("a",Yr,[m(r(o.subString(s.user.email,30)),1)])),[[p,s.user.email]])]),a("li",Qr,[a("label",null,r(e.trans("mobile")),1),m(),a("a",Xr,r(s.user.mobile),1)]),e.boolean(s.org)?(n(),l("li",$r,[a("label",null,r(e.trans("organization")),1),a("ul",null,[(n(!0),l(T,null,P(s.org,g=>(n(),l("li",null,[k((n(),C(h,{to:g.href.replace(e.basePath(),"")},{default:f(()=>[m(r(o.subString(g.name,30)),1)]),_:2},1032,["to"])),[[p,g.name]])]))),256))])])):d("",!0)]),s.archive?(n(),l("a",{key:1,href:o.showUserProfile(s.user.id),target:"_blank",class:"btn btn-primary btn-block"},[sd,m(" "+r(e.trans("view_more_info")),1)],8,td)):(n(),C(h,{key:0,to:"/user/"+s.user.id,class:"btn btn-primary btn-block"},{default:f(()=>[ed,m(" "+r(e.trans("view_more_info")),1)]),_:1},8,["to"]))])])}const ad=A(Br,[["render",id],["__scopeId","data-v-aa840755"]]);const od={name:"RatingPopOver",data:()=>({value:""}),props:{ratings:{type:Array,default:()=>[]}}};function nd(e,t,s,c,i,o){const h=u("star-rating"),p=u("faveo-box");return n(),l("div",null,[_(p,{class:"mb-0",title:"Additional Ratings"},{default:f(()=>[a("table",null,[a("tbody",null,[(n(!0),l(T,null,P(s.ratings,(g,v)=>(n(),l("tr",{key:v},[a("td",null,r(g.name)+" ",1),a("td",null,[_(h,{class:"tooltip-target additional-rating",rating:g.value,"max-rating":g.scale,"read-only":!0,"star-size":15,"show-rating":!1},null,8,["rating","max-rating"])])]))),128))])])]),_:1})])}const ld=A(od,[["render",nd],["__scopeId","data-v-87dbd6ed"]]);const rd={components:{RatingPopOver:ld},setup(){const e=H();return{getDefaultRatings:O(()=>e.getters.getDefaultRatings),getRatingTypes:O(()=>e.getters.getRatingTypes)}},props:{rating:{type:Object},ratings:{type:Array},labelStyle:{type:Object,default:()=>{}},classname:{type:String,default:""},readOnlyStar:{type:Boolean,default:!1}},data(){return{matched_rating:{},rating_value:0,lang_locale:"",all_ratings:""}},watch:{rating(e,t){return e}},computed:{toolTipMessage(){return this.rating.questions?{content:this.rating.questions,html:!0,classes:["star-rating-tooltip"],delay:{show:500,hide:300}}:""}},created(){this.lang_locale=localStorage.getItem("LANGUAGE")},beforeMount(){this.ratingTypes()},methods:{ratingTypes(){this.all_ratings=this.getDefaultRatings,this.loading=!1}}},dd={class:"row"},cd={class:"col-md-12"},hd={class:"star-rating-control"};function ud(e,t,s,c,i,o){const h=u("star-rating");return n(),l("div",dd,[a("div",cd,[a("div",{class:M([[s.classname,{left1:i.lang_locale=="ar"}],"ticketratings"]),id:"ticketratings"},[m("   "),a("table",null,[a("tbody",null,[a("tr",null,[a("th",null,[a("div",{class:"ticketratingtitle",style:E(s.labelStyle)},r(e.lang(s.rating.name))+" ",5)]),a("td",hd,[_(h,{modelValue:i.all_ratings.rating_value,"onUpdate:modelValue":t[0]||(t[0]=p=>i.all_ratings.rating_value=p),"star-size":18,"read-only":s.readOnlyStar,"show-rating":!1,"max-rating":i.all_ratings.rating_scale,rating:i.all_ratings.rating_value},null,8,["modelValue","read-only","max-rating","rating"])])])])])],2)])])}const ze=A(rd,[["render",ud]]);const md={name:"thread-body",description:"Thread Body Component",setup(){const e=H();return{formattedTime:O(()=>e.getters.formattedTime),getRatingTypes:O(()=>e.getters.getRatingTypes)}},props:{thread:{type:Object,default:()=>{}},index:{type:[String,Number],default:""},max:{type:Boolean,default:!1},archive:{type:Boolean,default:!1}},data(){return{ratings:[],labelStyle:{display:"none"},isEditing:!1,showDropdown:!1,selectedText:"",newselectedText:"",showPopupUndo:!1,nonRedactedResponse:[],isRedactionTypeSelected:!1,redactionSelections:[],topPosition:0,leftPosition:0,isViewingRedaction:!1,previousRedactedContent:"",combinedText:""}},methods:{isHTMLContent(e){return/<[a-z][\s\S]*>/i.test(e)},handleSelection(){const e=window.getSelection();if(e&&e.rangeCount>0){const t=e.getRangeAt(0),c=t.getBoundingClientRect().left/2;this.leftPosition=c/2;const i=t.toString();let o=t.commonAncestorContainer;if(t.commonAncestorContainer.parentNode.outerHTML.includes("<permanent>")){this.showDropdown=!1;return}for(;o&&o!==document.body;){if(o.tagName==="REDACTED"||o.tagName==="BLOCKQUOTE"||o.tagName==="REDACTEDIMG"||o.tagName==="REDACTEDATTACHMENT"){if(o.tagName==="BLOCKQUOTE"){this.showDropdown=!1;return}this.showDropdown=!0;break}o=o.parentNode}let p=o&&(o.tagName==="REDACTED"||o.tagName==="REDACTEDIMG"||o.tagName==="REDACTEDATTACHMENT");const v=t.cloneRange().cloneContents(),D=document.createElement("div");D.appendChild(v),this.combinedText=D.innerHTML;const b=D.querySelectorAll("img");let w="";b.length>0&&b.forEach(U=>{const I=document.createElement("p");I.appendChild(U.cloneNode(!0)),w=I.outerHTML});const F=p?o.outerHTML:i;if(this.isEditing){this.showDropdown=!e.isCollapsed,this.selectedText=i||F||w,this.selectedText.replace(/^<p>|<\/p>$/g,"")!==this.combinedText?this.showDropdown=!1:this.showDropdown=!e.isCollapsed,this.newselectedText=F,this.showPopupUndo=p;const I=/<redactedattachment id="(\d+)">/,R=this.newselectedText.match(I);this.redactedImgId=R?R[1]:null}p&&this.isEditing&&(this.showPopupUndo=!0,this.showDropdown=!1),i.includes("█")&&(this.showDropdown=!1)}},markForRedaction(e,t){var c,i;this.isRedactionTypeSelected=!0;const s=window.getSelection();if(!s.isCollapsed){const o=this.selectedText.toString().trim(),h=this.selectedText.match(/<img[^>]*\sid="(\d+)"[^>]*>/),p=h?h[1]:null;this.redactionSelections.push({text:o,type:e,attachmentId:p});const g=v=>{const D=document.createElement("span");return D.style.backgroundColor="rgba(255, 0, 0, 0.1)",D.style.border=`2px solid ${v}`,D.style.display="inline-block",D.className="redacted-span",D};if(s.rangeCount>0&&o.includes("<img")){const v=s.getRangeAt(0),b=((c=this.redactionSelections[this.redactionSelections.length-1])==null?void 0:c.type)==="temporary"?"#495057":"black";v.surroundContents(g(b)),this.thread.body=document.getElementById(t).innerHTML}else{const D=((i=this.redactionSelections[this.redactionSelections.length-1])==null?void 0:i.type)==="temporary"?"#495057":"black";s.getRangeAt(0).surroundContents(g(D)),this.thread.body=document.getElementById(t).innerHTML}this.isViewingRedaction&&(this.thread.body=this.previousRedactedContent,this.isViewingRedaction=!1,this.previousRedactedContent=""),this.submitRedaction(t),s.removeAllRanges(),this.showDropdown=!1}},cancelEditing(){this.isEditing=!1,this.redactionSelections.forEach(e=>{this.thread.body=this.thread.body.replace(new RegExp(`<span[^>]*>${e.text}</span>`,"g"),e.text)}),this.redactionSelections=[],window.getSelection().removeAllRanges(),window.emitter.emit("updateTimelineThreads"),this.showDropdown=!1},async submitRedaction(e){try{let t=this.thread.body;const s={};this.redactionSelections.forEach(i=>{if(i&&i.text&&i.type){const o=i.type==="permanent"?"<permanentRedacted>":"<redacted>",h=i.type==="permanent"?"</permanentRedacted>":"</redacted>";document.querySelectorAll("#"+e+" span.redacted-span").forEach(g=>{if(i.text.includes("<img src")){let v=this.selectedText.replace(/^<p>|<\/p>$/g,"");t=t.replace(g.outerHTML,`${o}${v}${h}`)}else t=t.replace(g.outerHTML,`${o}${i.text}${h}`)}),i.attachmentId&&(s[i.attachmentId]=i.type)}});const c=await axios.post("api/thread/redact",{threadId:this.thread.id,text:t,attachments:s});x(c,"timeline"),window.emitter.emit("updateTimelineThreads")}catch(t){L(t,"timeline")}},viewRedaction(){this.isViewingRedaction=!0,this.previousRedactedContent=this.thread.body;const e=this.newselectedText.replace(/<redactedImg/gi,"<redactedimg").replace(/<\/redactedimg>/g,"</redactedimg>"),t=this.newselectedText.replace(/<redactedimg/gi,"<redacted").replace(/<\/redactedimg>/g,"</redacted>");axios.post("api/thread/viewRedaction",{threadId:this.thread.id,text:t,attachment:this.redactedImgId}).then(s=>{this.nonRedactedResponse=s.data.data[0],this.thread.attach.forEach(c=>{c.id===this.nonRedactedResponse.id&&(c.thumbnail_url=this.nonRedactedResponse.thumbnail_url,c.view_url=this.nonRedactedResponse.view_url,c.name=this.nonRedactedResponse.filename,c.download_url=this.nonRedactedResponse.download_url)}),this.thread.body=this.thread.body.replaceAll(e,s.data.data),x(s,"timeline"),this.showPopupUndo=!1}).catch(s=>{L(s,"timeline")})},undoRedaction(){const e=this.newselectedText.replace(/<redactedimg/gi,"<redactedImg").replace(/<\/redactedimg>/g,"</redactedImg>").replace(/redactedImg|redacted/g,"unredacted");axios.post("api/thread/rollbackRedaction",{threadId:this.thread.id,text:e,attachments:this.redactedImgId}).then(t=>{x(t,"timeline"),window.emitter.emit("updateTimelineThreads"),window.emitter.emit("refreshData"),this.isEditing=!1,this.showPopupUndo=!1}).catch(t=>{L(t,"timeline")})},makeEditable(){this.isEditing=!this.isEditing},updatedBody(e){return"<div>"+e.replace(/\r?\n/g,"").trim()+"</div>"},replyThread(e,t,s){const c="On "+this.formattedTime(s)+" <b>"+t+"</b> wrote :";var i;i="<p id='extra_p'>&nbsp;</p><blockquote>"+c+"<figure  id='mine'>"+e+"</figure></blockquote>",this.thread.content=i,window.emitter.emit("threadReply",this.thread)},ratingTypes(e){this.ratings=e;var t=[];if(this.thread.ratings.length!=0)for(var s in this.ratings)for(var c in this.thread.ratings)this.ratings[s].id==this.thread.ratings[c].rating_id&&this.ratings[s].rating_area=="Comment Area"&&(this.ratings[s].rating_value=this.thread.ratings[c].rating_value,this.ratings[s].ticket_id=this.thread.ticket_id,t.push(this.ratings[s]));this.ratings=t},deleteThreadClicked(e){const{id:t}=e;window.emitter.emit("threadDelete",{id:t})},editThreadClicked(e){const{id:t,originalText:s,attach:c}=e;window.emitter.emit("threadEdit",{id:t,originalText:s,attach:c})}},computed:{positionFix(){return{top:this.topPosition+"px",left:this.leftPosition+"px",position:"absolute"}},tooltipContent(){return`${this.thread.user.name}<br>${this.thread.user.email}<br>${this.thread.user.role}`}},components:{"rating-component":ze,attachment:st,"activity-parser":Pe}},X=e=>(N("data-v-0b3bd6b7"),e=e(),V(),e),_d={class:"inbox-thread-body"},pd={class:"timeline-item"},gd={class:"time thread_right"},fd={class:"thread_rating"},kd={key:0,class:"mt_4"},bd={key:1},yd=X(()=>a("i",{class:"fas fa-reply"},null,-1)),vd=[yd],wd={"data-toggle":"dropdown","aria-expanded":"true",class:"pointer margin_5px"},Cd=X(()=>a("i",{class:"fas fa-ellipsis-v"},null,-1)),Td=[Cd],Dd={class:"dropdown-menu dropdown-menu-right",role:"menu"},Sd=X(()=>a("i",{class:"fas fa-edit"},null,-1)),Md=[Sd],Ad=X(()=>a("i",{class:"fas fa-trash"},null,-1)),Id=[Ad],Fd={class:"timeline-header bg-light"},Ld={class:"hover-card"},Rd={key:1},Pd=["href"],Od={class:"hover-card-content"},jd={class:"d-flex align-items-center mb-2"},xd=["src"],Nd={class:"ml-2"},Vd={class:"email-wrapper"},Ed=X(()=>a("i",{class:"fas fa-envelope"},null,-1)),Bd={class:"email"},Ud={class:"thread_time"},qd=X(()=>a("i",{class:"far fa-clock"},null,-1)),zd={key:0,class:"thread_time",id:"redactioninfo"},Hd=["id","contentEditable"],Kd=["contentEditable"],Wd={class:"mailbox-attachments align-items-stretch clearfix mb-0 clearfixapply"},Gd={key:0},Zd=["innerHTML"],Jd={key:1,class:"d-flex"},Yd={key:3,class:"timeline-footer",id:"editableContent_footer"},Qd=X(()=>a("i",{class:"fas fa-times mr-1"},null,-1));function Xd(e,t,s,c,i,o){const h=u("rating-component"),p=u("faveo-image-element"),g=u("router-link"),v=u("activity-parser"),D=u("attachment"),b=z("tooltip");return n(),l("div",_d,[k(a("i",{class:M(s.thread.thread_type_icon_class)},null,2),[[b,s.thread.thread_type_text]]),a("div",pd,[a("span",gd,[k((n(),l("span",fd,[(n(!0),l(T,null,P(i.ratings,w=>(n(),C(h,{key:w.id,rating:w,labelStyle:i.labelStyle},null,8,["rating","labelStyle"]))),128))])),[[b,e.lang("reply_rating")]]),i.ratings.length>0?(n(),l("span",kd," |  ")):d("",!0),s.archive?d("",!0):(n(),l("div",bd,[s.thread.is_internal!==1&&!s.max?k((n(),l("a",{key:0,class:"pointer margin_5px",onClick:t[0]||(t[0]=w=>o.replyThread(s.thread.body,s.thread.user.name,s.thread.created_at))},vd)),[[b,e.lang("reply_to_this_thread")]]):d("",!0),k((n(),l("a",wd,Td)),[[b,e.lang("redact_to_this_thread")]]),a("div",Dd,[a("a",{class:"dropdown-item",href:"javascript:;",onClick:t[1]||(t[1]=w=>o.makeEditable())},r(e.lang("redact")),1)])])),s.thread.allows_modification?(n(),l(T,{key:2},[k((n(),l("a",{class:"pointer margin_5px",onClick:t[2]||(t[2]=ce(w=>o.editThreadClicked(s.thread),["prevent"]))},Md)),[[b,e.trans("edit")]]),k((n(),l("a",{class:"pointer margin_5px",onClick:t[3]||(t[3]=ce(w=>o.deleteThreadClicked(s.thread),["prevent"]))},Id)),[[b,e.trans("delete")]])],64)):d("",!0)]),a("h3",Fd,[_(p,{id:"thread_img","source-url":s.thread.user.profile_pic,classes:["img-circle","img-bordered-sm"],"alternative-text":"User Image","img-width":25,"img-height":25},null,8,["source-url"]),a("div",Ld,[s.archive?(n(),l("div",Rd,[a("a",{class:"ml-1",href:this.basePath()+"/panel/user/"+this.thread.user.id,target:"_blank"},r(s.thread.user.name),9,Pd)])):(n(),C(g,{key:0,to:"/user/"+this.thread.user.id,id:"thread_head_name",class:"ml-1"},{default:f(()=>[m(r(s.thread.user.name),1)]),_:1},8,["to"])),a("div",Od,[a("div",jd,[a("img",{src:s.thread.user.profile_pic,style:{height:"40px",width:"40px","border-radius":"24px",border:"2px solid #3788d8"},alt:"Profile Picture"},null,8,xd),a("div",Nd,[a("div",null,r(s.thread.user.name),1)])]),a("div",Vd,[Ed,a("span",Bd,r(s.thread.user.email),1)])])]),a("span",Ud,[m(" -  "),qd,m(" "+r(c.formattedTime(s.thread.created_at)),1)]),i.isEditing?(n(),l("p",zd,[m(r(e.lang("highlight_redact_text"))+" ",1),a("strong",null,r(e.lang("mark_for_redaction_option")),1)])):d("",!0)]),a("div",{class:"timeline-body thread_desc",id:"thread_desc_"+s.thread.id,contentEditable:i.isEditing.toString(),onMouseup:t[4]||(t[4]=(...w)=>o.handleSelection&&o.handleSelection(...w))},[_(v,{data:o.updatedBody(s.thread.body)},null,8,["data"])],40,Hd),i.showDropdown&&i.isEditing?(n(),l("div",{key:0,class:"rounded dropadded",style:E(o.positionFix)},[a("a",{class:"dropdown-item cursor-pointer",href:"javascript:;",onClick:t[5]||(t[5]=w=>o.markForRedaction("permanent","thread_desc_"+s.thread.id))},r(e.lang("mark_for_permanent_redaction")),1),a("a",{class:"dropdown-item cursor-pointer",href:"javascript:;",onClick:t[6]||(t[6]=w=>o.markForRedaction("temporary","thread_desc_"+s.thread.id))},r(e.lang("mark_for_temporary_redaction")),1)],4)):d("",!0),s.thread.attach.length?(n(),l("div",{key:1,class:"timeline-footer",contentEditable:i.isEditing.toString(),onMouseup:t[7]||(t[7]=(...w)=>o.handleSelection&&o.handleSelection(...w))},[a("ul",Wd,[(n(!0),l(T,null,P(s.thread.attach,(w,F)=>(n(),l(T,null,[w.poster==="ATTACHMENT"&&w.temporary_redaction===0&&w.permanent_redaction===0?(n(),C(D,{key:0,attachment:w},null,8,["attachment"])):w.temporary_redaction===1||w.permanent_redaction===1?(n(),l(T,{key:1},[o.isHTMLContent(w.thumbnail_url)?(n(),l("div",Gd,[a("div",{innerHTML:w.thumbnail_url},null,8,Zd)])):(n(),l("div",Jd,[_(D,{attachment:w},null,8,["attachment"])]))],64)):d("",!0)],64))),256))])],40,Kd)):d("",!0),i.showPopupUndo?(n(),l("div",{key:2,style:E(o.positionFix),id:"popup_undo",class:"rounded dropadded"},[a("a",{class:"dropdown-item",href:"javascript:;",onClick:t[8]||(t[8]=(...w)=>o.viewRedaction&&o.viewRedaction(...w)),id:"viewButton"},r(e.lang("view")),1),a("a",{class:"dropdown-item",href:"javascript:;",onClick:t[9]||(t[9]=(...w)=>o.undoRedaction&&o.undoRedaction(...w)),id:"undoButton"},r(e.lang("undo")),1)],4)):d("",!0),i.isEditing?(n(),l("div",Yd,[a("button",{type:"button",id:"editableContent_cancelBtn",class:"btn btn-light border btn-sm",onClick:t[10]||(t[10]=(...w)=>o.cancelEditing&&o.cancelEditing(...w))},[Qd,m(r(e.lang("cancel")),1)])])):d("",!0)])])}const He=A(md,[["render",Xd],["__scopeId","data-v-0b3bd6b7"]]);const $d={name:"inbox-threads",description:"Inbox Threads Component",setup(){const e=H();return{formattedTime:O(()=>e.getters.formattedTime),formattedDate:O(()=>e.getters.formattedDate)}},props:{ticketId:{type:[String,Number],default:""},archive:{type:Boolean,default:!1},maximized:{type:Boolean,default:!1}},data(){return{inboxThreads:[],page:1,showLoader:!1,ticketNum:this.ticketId,refreshThreads:!1}},created(){window.emitter.on("updateTimelineThreads",()=>this.refreshThreads=!0)},watch:{showLoader(e,t){return this.$emit("loaderState",e),this.showLoader=e,e},refreshThreads(e){e===!0&&this.updateLogs(),this.refreshThreads=!1}},methods:{updateLogs(){this.showLoader=!0,this.inboxThreads=[],this.page=1,this.getThreads(void 0,!0)},getData(e,t=!1){this.archive==!0?this.getArchiveThread(e,t):this.getThreads(e,t)},getThreads(e,t=!1){this.showLoader=!0,this.ticketNum=this.ticketId?this.ticketId:J(window.location.pathname),S.get("/api/agent/ticket-conversation/"+this.ticketNum+"?time="+Date.now(),{params:{page:this.page}}).then(s=>{t?this.inboxThreads=s.data.data.data:this.inboxThreads.push(...s.data.data.data),e&&e.loaded(),s.data.data.data.length<10&&e&&e.complete(),this.page++,this.showLoader=!1}).catch(s=>{L(s,"inbox-threads"),this.inboxThreads=[],this.showLoader=!1})},getArchiveThread(e,t=!1){this.showLoader=!0,this.ticketNum=this.ticketId?this.ticketId:J(window.location.pathname),S.get("/ticket-archive/ticket-conversation/"+this.ticketNum,{params:{page:this.page}}).then(s=>{t?this.inboxThreads=s.data.data.data:this.inboxThreads.push(...s.data.data.data),e&&e.loaded(),s.data.data.data.length<10&&e&&e.complete(),this.page++,this.showLoader=!1}).catch(s=>{L(s,"inbox-threads"),this.inboxThreads=[],this.showLoader=!1})},checkDate(e){if(e==0)return!0;var t=this.formattedDate(this.inboxThreads[e-1].created_at),s=this.formattedDate(this.inboxThreads[e].created_at);if(t!=s)return!0},showThreadEnd(e){return e===this.inboxThreads.length-1}},components:{"thread-body":He}},ke=e=>(N("data-v-90a47ad8"),e=e(),V(),e),ec={class:"inbox-threads"},tc={key:0,class:"timeline"},sc={key:0,class:"time-label"},ic={class:"bg-default border"},ac={key:1},oc=ke(()=>a("i",{class:"fas fa-history bg-gray"},null,-1)),nc=[oc],lc=ke(()=>a("span",null,null,-1)),rc=ke(()=>a("span",null,null,-1));function dc(e,t,s,c,i,o){const h=u("thread-body"),p=u("infinite-loading");return n(),l("div",ec,[a("div",{class:M({"scrollable-thread":!s.maximized}),id:"thread_scroll"},[i.inboxThreads?(n(),l("div",tc,[(n(!0),l(T,null,P(i.inboxThreads,(g,v)=>(n(),l(T,{key:"thread"+v},[o.checkDate(v)?(n(),l("div",sc,[a("span",ic,r(c.formattedDate(g.created_at)),1)])):d("",!0),_(h,{thread:g,archive:s.archive,index:v,max:s.maximized},null,8,["thread","archive","index","max"]),o.showThreadEnd(v)?(n(),l("div",ac,nc)):d("",!0)],64))),128)),_(p,{onInfinite:o.getData,ref:"infiniteLoading"},{spinner:f(()=>[lc]),complete:f(()=>[rc]),_:1},8,["onInfinite"])])):d("",!0)],2)])}const cc=A($d,[["render",dc],["__scopeId","data-v-90a47ad8"]]);const hc={name:"inbox-ticket-activity-log",description:"Inbox Ticket Activity Log Component",setup(){const e=H();return{formattedTime:O(()=>e.getters.formattedTime),formattedDate:O(()=>e.getters.formattedDate)}},props:{archive:{type:Boolean,default:!1},ticketId:{type:[String,Number],default:""},maximized:{type:Boolean,default:!1}},data(){return{activityLogs:[],page:1,showLoader:!1,ticketNum:this.ticketId}},beforeMount(){this.archive?this.getArchiveLogs():this.getLogs()},created(){window.emitter.on("updateTimelineActivity",this.updateLogs)},watch:{showLoader(e,t){return this.$emit("loaderState",e),this.showLoader=e,e}},methods:{updateLogs(){this.showLoader=!0,this.activityLogs=[],this.page=1,this.getLogs(void 0,!0)},getLogs(e,t=!1){this.showLoader=!0,this.ticketNum=this.ticketId?this.ticketId:J(window.location.pathname),setTimeout(()=>{S.get("/api/agent/ticket-activity-log/"+this.ticketNum+"?time="+Date.now(),{params:{page:this.page}}).then(s=>{t?this.activityLogs=s.data.data.data:this.activityLogs.push(...s.data.data.data),e&&e.loaded(),s.data.data.data.length<10&&e&&e.complete(),this.page++,this.activityLogs.forEach(function(c,i){c.text="<div>"+c.text+"</div>"}),this.showLoader=!1}).catch(s=>{L(s,"inbox-threads"),this.activityLogs=[],this.showLoader=!1})},1)},getArchiveLogs(e,t=!1){this.showLoader=!0,this.ticketNum=this.ticketId?this.ticketId:J(window.location.pathname),setTimeout(()=>{S.get("/ticket-archive/ticket-activity-log/"+this.ticketNum,{params:{page:this.page}}).then(s=>{t?this.activityLogs=s.data.data.data:this.activityLogs.push(...s.data.data.data),e&&e.loaded(),s.data.data.data.length<10&&e&&e.complete(),this.page++,this.activityLogs.forEach(function(c,i){c.text="<div>"+c.text+"</div>"}),this.showLoader=!1}).catch(s=>{L(s,"inbox-threads"),this.activityLogs=[],this.showLoader=!1})},1)},checkDate(e){if(e==0)return!0;var t=this.formattedDate(this.activityLogs[e-1].created_at),s=this.formattedDate(this.activityLogs[e].created_at);if(t!=s)return!0},showThreadEnd(e){return e===this.activityLogs.length-1}},components:{"thread-body":He,"activity-parser":Pe}},ae=e=>(N("data-v-3abe6e90"),e=e(),V(),e),uc={class:"inbox-tic-activity"},mc={key:0,class:"timeline timeline-inverse"},_c={key:0,class:"time-label"},pc={class:"bg-default border"},gc=ae(()=>a("i",{class:"far fa-dot-circle"},null,-1)),fc={class:"timeline-item"},kc={class:"time"},bc=ae(()=>a("i",{class:"far fa-clock"},null,-1)),yc={class:"timeline-body",id:"activity	_desc"},vc={key:1},wc=ae(()=>a("i",{class:"fas fa-history bg-gray"},null,-1)),Cc=[wc],Tc=ae(()=>a("span",null,null,-1)),Dc=ae(()=>a("span",null,null,-1)),Sc={key:1},Mc={class:"text-center"};function Ac(e,t,s,c,i,o){const h=u("activity-parser"),p=u("infinite-loading");return n(),l("div",uc,[a("div",{class:M({"scrollable-log":!s.maximized}),id:"activity_scroll"},[i.activityLogs.length>0?(n(),l("div",mc,[(n(!0),l(T,null,P(i.activityLogs,(g,v)=>(n(),l(T,null,[o.checkDate(v)?(n(),l("div",_c,[a("span",pc,r(c.formattedDate(g.created_at)),1)])):d("",!0),a("div",null,[gc,a("div",fc,[a("span",kc,[bc,m(" "+r(c.formattedTime(g.created_at)),1)]),a("div",yc,[_(h,{data:g.text},null,8,["data"])])])]),o.showThreadEnd(v)?(n(),l("div",vc,Cc)):d("",!0)],64))),256)),_(p,{onInfinite:o.getLogs,ref:"infiniteLoading"},{spinner:f(()=>[Tc]),complete:f(()=>[Dc]),_:1},8,["onInfinite"])])):d("",!0),!i.showLoader&&!i.activityLogs.length?(n(),l("div",Sc,[a("h6",Mc,r(e.trans("no-records")),1)])):d("",!0)],2)])}const Ic=A(hc,[["render",Ac],["__scopeId","data-v-3abe6e90"]]);const Fc={name:"associated-ticket-crt",setup(){const e=H();return{formattedTime:O(()=>e.getters.formattedTime),formattedDate:O(()=>e.getters.formattedDate)}},data(){return{apiUrl:"",columns:["ticket_number","ticket_title","status","type"],options:{},cardOpen:!1,showTemplate:!1,loading:!0}},props:{ticketId:{type:[String,Number]},archive:{type:Boolean,default:!1}},beforeMount(){if(this.archive)return;this.apiUrl=`api/agent/associated-tickets?ticket_id=${this.ticketId}`,this.checkForVisibility();const e=this;this.options={headings:{ticket_number:this.trans("ticket_number"),type:this.trans("parent/child"),ticket_title:this.trans("subject"),status:this.trans("status")},columnsClasses:{ticket_number:"ticket-number",ticket_type_for_crt:"ticket-type-parent-or-child",ticket_title:"ticket-subject",ticket_status:"associated-ticket-status"},sortIcon:{base:"glyphicon",up:"glyphicon-chevron-up",down:"glyphicon-chevron-down"},texts:{filter:"",limit:""},templates:{ticket_number:(t,s)=>{let c=s.id;return c?e.h(Ze,{to:"/thread/"+c},s.ticket_number):"--"},status:(t,s)=>{let c=s.status,i=s.status_icon_color;return c?e.h("span",{class:"badge",style:`background-color: ${i}; color: white`},c):"--"}},sortable:["ticket_number"],filterable:!1,pagination:{chunk:5,nav:"fixed",edge:!0},requestAdapter(t){return{sort_field:t.orderBy?t.orderBy:"id",sort_order:t.ascending?"desc":"asc",search_term:t.query,page:t.page,limit:t.limit}},responseAdapter({data:t}){return{data:t.data.data,count:t.data.total}}}},methods:{toggleCard(){this.cardOpen=!this.cardOpen},async checkForVisibility(){try{let{data:e}=await S.get(this.apiUrl+"&count=1");e.data.count&&(this.showTemplate=!0)}catch(e){console.log("Error, while checking visibility of associated tickets",e)}},handelLoader(e){this.loading=e}}},Lc=e=>(N("data-v-721908be"),e=e(),V(),e),Rc={key:0,class:"card card-light"},Pc={class:"card-title"},Oc={class:"card-tools"},jc={key:0,type:"button",class:"btn btn-tool rotating","data-card-widget":"refresh"},xc=Lc(()=>a("i",{class:"fas fa-sync-alt"},null,-1)),Nc=[xc],Vc={type:"button",class:"btn btn-tool"},Ec={key:0,class:"card-body",id:"crt-associated-tickets"};function Bc(e,t,s,c,i,o){const h=u("data-table");return i.showTemplate?(n(),l("div",Rc,[a("div",{class:"card-header pointer",onClick:t[0]||(t[0]=(...p)=>o.toggleCard&&o.toggleCard(...p))},[a("h3",Pc,r(e.trans("ticket_details_associated_tickets")),1),a("div",Oc,[i.loading&&i.cardOpen?(n(),l("button",jc,Nc)):d("",!0),a("button",Vc,[a("i",{class:M([{"fas fa-angle-up":i.cardOpen,"fas fa-angle-down":!i.cardOpen},"fs-25"])},null,2)])])]),i.cardOpen?(n(),l("div",Ec,[_(h,{url:i.apiUrl,dataColumns:i.columns,onLoaderState:o.handelLoader,disableLoader:"true",scroll_to:"crt-associated-tickets",option:i.options},null,8,["url","dataColumns","onLoaderState","option"])])):d("",!0)])):d("",!0)}const Uc=A(Fc,[["render",Bc],["__scopeId","data-v-721908be"]]);function qc(e){const{add_approver:t,approver_comment:s,addRemoveType:c}=e;let i={approver_comment:[s,"isRequired",{"max(250)":"The reason should be less than 250 characters."}]};c==="add"&&(i.add_approver=[t,"isRequired"]);const o=new oe(Q),{errors:h,isValid:p}=o.validate(i);return se.dispatch("setValidationError",h),{errors:h,isValid:p}}const zc={name:"approval-progress",description:"Handles Approval Progress of a ticket at any given time",setup(){const e=H();return{shallApprovalActionsBeVisible:O(()=>e.getters.getApprovalActionVisibility)}},props:{ticketId:{type:[Number,String],required:!0},actions:{type:Object,default:()=>{}},alertName:{type:String,default:""}},data(){return{modalLoad:!1,showAddRemoveModal:!1,add_approver:"",approver_comment:"",addRemoveLevelId:"",addRemoveType:"",loading:!1,workflowData:[],comment:"",showModal:!1,action:"",cardOpen:!1}},created(){window.emitter.on("approvalWorkflowApplied",this.getDataFromServer)},methods:{closeAddModal(){this.showAddRemoveModal=!1,this.approver_comment="",this.$store.dispatch("unsetValidationError"),this.$store.dispatch("unsetAlert")},isAddRemoveValid(){const{errors:e,isValid:t}=qc(this.$data);return t},onAddRemoveConfirm(){if(this.isAddRemoveValid()){this.endPoint=this.addRemoveType==="add"?"add-approver":"remove-approver",this.modalLoad=!0;let e={};e.action=this.addRemoveType,e.approver_id=this.addRemoveType==="add"?this.add_approver.id:this.add_approver,e.ticket_id=this.ticketId,e.level_id=this.addRemoveLevelId,e.comment=this.approver_comment,S.post("/api/workflow/"+this.endPoint,e).then(t=>{this.modalLoad=!1,x(t,"timeline"),window.emitter.emit("approvalWorkflowApplied"),window.emitter.emit("workflowUpdated","approval"),this.showAddRemoveModal=!1,this.addRemoveType="",this.addRemoveLevelId="",this.add_approver=""}).catch(t=>{this.modalLoad=!1,L(t,"add_remove_approver")})}},addRemoveApprover(e,t,s=""){this.addRemoveType=e,this.addRemoveLevelId=t,this.add_approver=s,this.showAddRemoveModal=!0},resumeReminder(e){this.loading=!0,S.get("/api/resume-auto-reminder/"+e).then(t=>{this.getDataFromServer(),x(t,"timeline")}).catch(t=>{this.loading=!1,L(t,"timeline")})},stopReminder(e){this.loading=!0,S.get("/api/stop-auto-reminder/"+e).then(t=>{this.getDataFromServer(),x(t,"timeline")}).catch(t=>{this.loading=!1,L(t,"timeline")})},sendReminder(e,t="",s=""){this.loading=!0;let c={};c.type=e,c.ticket_id=this.ticketId,c[e==="level"?"level_id":null]=t,e==="approver"&&(c.user_id=s,c.level_id=t),S.post("/api/send_approval_reminder",c).then(i=>{this.getDataFromServer(),x(i,"timeline")}).catch(i=>{this.loading=!1,L(i,"timeline")})},closeModal(){this.showModal=!1,this.$store.dispatch("unsetValidationError")},subString(e,t=15){return Z(e,t)},toggleCard(){this.cardOpen=!this.cardOpen,this.cardOpen&&this.getDataFromServer()},getDataFromServer(){this.workflowData=[],this.loading=!0,S.get("/api/ticket-approval-status/"+this.ticketId).then(e=>{this.workflowData=e.data.data}).catch(e=>{L(e,"timeline")}).finally(e=>{this.loading=!1})},isValid(){const{errors:e,isValid:t}=it(this.$data);return!!t},onChange(e,t){this[t]=e},onWorkflowAction(e){this.showModal=!0,this.action=e},getIconStyle(e,t="icon"){switch(e){case"PENDING":return t=="icon"?"glyphicon glyphicon-time text-warning":"#eee";case"APPROVED":return t=="icon"?"glyphicon glyphicon-check text-success":"#cbe0d3";case"DENIED":return t=="icon"?"glyphicon glyphicon-exclamation-sign text-danger":"#f6ddd8";default:return null}},getOpacity(e){return e==1?1:.5},onWorkflowActionConfirm(){this.action!=="remove"?this.isValid()&&(this.loading=!0,S.post("/api/approval-action-without-hash/"+this.ticketId,{action_type:this.action,comment:this.comment}).then(e=>{x(e,this.alertName)}).catch(e=>{L(e)}).finally(e=>{window.emitter.emit("workflowUpdated","approval"),this.showModal=!1,this.action="",this.comment="",this.workflowData=[],this.getDataFromServer()})):(this.loading=!0,S.delete("/api/remove-approval-workflow/"+this.ticketId).then(e=>{x(e,this.alertName),window.emitter.emit("workflowUpdated","approval"),this.showModal=!1,this.action="",this.comment="",this.workflowData=[]}).catch(e=>{L(e)}))},initialActions(){this.showModal=!1,this.action="",this.comment=""}},computed:{modalTitle(){return this.action=="approve"?"approve_ticket":this.action=="remove"?"remove_workflow":"deny_ticket"},modalQuestion(){let e=`${Q("are_you_sure_you_want_to")} ${this.action}?`;return this.action=="remove"?e:`${e} ${Q("mention_a_reason")}`}},components:{DynamicSelect:K,Modal:me,"text-field":ie}},B=e=>(N("data-v-8d6103dc"),e=e(),V(),e),Hc={class:"card card-light"},Kc={class:"card-title"},Wc={class:"card-tools"},Gc={key:0,type:"button",class:"btn btn-tool rotating","data-card-widget":"refresh"},Zc=B(()=>a("i",{class:"fas fa-sync-alt"},null,-1)),Jc=[Zc],Yc={type:"button",class:"btn btn-tool"},Qc={key:0,class:"card-body"},Xc={id:"approval-progress",class:"appproval"},$c={key:0,id:"approval-progress"},eh=["id"],th={class:"card-title"},sh={class:"card-tools approval-tools"},ih=["onClick"],ah=B(()=>a("i",{class:"fas fa-play"},null,-1)),oh=[ah],nh=["onClick"],lh=B(()=>a("i",{class:"fas fa-stop"},null,-1)),rh=[lh],dh={class:"card-body"},ch={class:"levels"},hh=["id"],uh={class:"card-title ml-2"},mh={class:"card-tools toolsKit"},_h={key:0},ph=["onClick"],gh=B(()=>a("i",{class:"fas fa-paper-plane pr-2"},null,-1)),fh=[gh],kh={key:1,class:"btn btn-tool not-cursor p-0"},bh=B(()=>a("i",{class:"fas fa-paper-plane pr-2"},null,-1)),yh=[bh],vh=["onClick"],wh=B(()=>a("i",{class:"fas fa-plus"},null,-1)),Ch=[wh],Th={key:3,class:"btn btn-tool not-cursor p-0"},Dh=B(()=>a("i",{class:"fas fa-plus"},null,-1)),Sh=[Dh],Mh={class:"card-body"},Ah=["id"],Ih={class:"list-group list-group-unbordered"},Fh={id:"highlight",class:"list-group-item border-0 p-2p pl-2 pr-2 rounded"},Lh={class:"approver-name"},Rh={class:"float-right"},Ph=["onClick"],Oh=B(()=>a("i",{class:"fas fa-paper-plane"},null,-1)),jh=[Oh],xh={key:1,class:"text-dark mr-3 not-cursor"},Nh=B(()=>a("i",{class:"fas fa-paper-plane"},null,-1)),Vh=[Nh],Eh=["onClick"],Bh=B(()=>a("i",{class:"fas fa-times"},null,-1)),Uh=[Bh],qh={key:3,class:"text-danger mr-3 not-cursor"},zh=B(()=>a("i",{class:"fas fa-times"},null,-1)),Hh=[zh],Kh=["id"],Wh={class:"list-group list-group-unbordered"},Gh={id:"highlight",class:"list-group-item border-0 p-2p pl-2 pr-2 rounded"},Zh={class:"approver-name"},Jh={class:"float-right"},Yh=["onClick"],Qh=B(()=>a("i",{class:"fas fa-paper-plane"},null,-1)),Xh=[Qh],$h={key:1,class:"text-dark mr-3 not-cursor"},eu=B(()=>a("i",{class:"fas fa-paper-plane"},null,-1)),tu=[eu],su=["onClick"],iu=B(()=>a("i",{class:"fas fa-times"},null,-1)),au=[iu],ou={key:3,class:"text-danger mr-3 not-cursor"},nu=B(()=>a("i",{class:"fas fa-times"},null,-1)),lu=[nu],ru={key:1,id:"approval-workflow-actions"},du=B(()=>a("span",{class:"glyphicon glyphicon-ok"},null,-1)),cu=B(()=>a("span",{class:"glyphicon glyphicon-remove"},null,-1)),hu=B(()=>a("span",{class:"fas fa-trash"},null,-1)),uu={class:"modal-title"},mu={key:1},_u={class:"row"},pu=B(()=>a("i",{class:"glyphicon glyphicon-ok","aria-hidden":"true"},null,-1)),gu={class:"modal-title"},fu={key:1,class:"row"},ku=B(()=>a("i",{class:"fas fa-check","aria-hidden":"true"},null,-1));function bu(e,t,s,c,i,o){const h=u("alert"),p=u("reuse-loader"),g=u("text-field"),v=u("modal"),D=u("dynamic-select"),b=z("tooltip"),w=z("focus-first-input");return n(),l("div",Hc,[a("div",{class:"card-header pointer",onClick:t[0]||(t[0]=(...F)=>o.toggleCard&&o.toggleCard(...F))},[a("h3",Kc,r(e.lang("approval_progress")),1),a("div",Wc,[i.loading&&i.cardOpen?k((n(),l("button",Gc,Jc)),[[b,e.lang("refresh")]]):d("",!0),a("button",Yc,[a("i",{class:M([{"fas fa-angle-up":i.cardOpen,"fas fa-angle-down":!i.cardOpen},"fs-25"])},null,2)])])]),i.cardOpen?(n(),l("div",Qc,[a("div",Xc,[i.loading?d("",!0):(n(),l("div",$c,[(n(!0),l(T,null,P(i.workflowData,(F,U)=>(n(),l("div",{class:"card",key:"workflow"+U,id:"approval-progress-element-"+U,style:E({"border-color":o.getIconStyle(F.status,"color")})},[a("div",{class:"card-header",style:E({"background-color":o.getIconStyle(F.status,"color")})},[a("h3",th,r(F.name),1),a("div",sh,[F.status=="PENDING"?(n(),l(T,{key:0},[F.send_auto_reminders?d("",!0):k((n(),l("button",{key:0,class:"btn btn-tool",onClick:I=>o.resumeReminder(F.id)},oh,8,ih)),[[b,e.trans("resume_reminder")]]),F.send_auto_reminders?k((n(),l("button",{key:1,class:"btn btn-tool",onClick:I=>o.stopReminder(F.id)},rh,8,nh)),[[b,e.trans("stop_reminder")]]):d("",!0)],64)):d("",!0),k(a("button",{class:M(["btn btn-tool",o.getIconStyle(F.status)])},null,2),[[b,F.status]])])],4),a("div",dh,[a("div",ch,[(n(!0),l(T,null,P(F.approval_levels,(I,R)=>(n(),l("div",{class:"approval-level",id:"approval-level-"+R,style:E({opacity:o.getOpacity(I.is_active)})},[a("div",{class:"card",style:E({"border-color":o.getIconStyle(I.status,"color")})},[a("div",{class:"card-header",style:E({"background-color":o.getIconStyle(I.status,"color")})},[a("h3",uh,r(I.name),1),a("div",mh,[I.status=="PENDING"?(n(),l("div",_h,[I.is_active?k((n(),l("button",{key:0,class:"btn btn-tool p-0",onClick:y=>o.sendReminder("level",I.id)},fh,8,ph)),[[b,e.trans("send_reminder")]]):k((n(),l("button",kh,yh)),[[b,e.trans("cant_send_reminder_level")]]),I.is_active?k((n(),l("button",{key:2,class:"btn btn-tool p-0",onClick:y=>o.addRemoveApprover("add",I.id)},Ch,8,vh)),[[b,e.trans("add_approver")]]):d("",!0),I.is_active?d("",!0):k((n(),l("button",Th,Sh)),[[b,e.trans("you_cant_add_approver")]]),k(a("button",{class:M(["btn btn-tool",[o.getIconStyle(I.status)]])},null,2),[[b,I.status]])])):d("",!0)])],4),a("div",Mh,[(n(!0),l(T,null,P(I.approve_users,(y,j)=>(n(),l("div",{id:"level-user-"+j},[a("ul",Ih,[a("li",Fh,[a("span",Lh,r(y.name)+"    ",1),a("span",Rh,[y.status=="PENDING"?(n(),l(T,{key:0},[I.is_active?k((n(),l("a",{key:0,href:"javascript:;",class:"text-dark mr-3",onClick:Y=>o.sendReminder("approver",I.id,y.id)},jh,8,Ph)),[[b,e.trans("send_reminder")]]):k((n(),l("a",xh,Vh)),[[b,e.trans("cant_send_reminder_approver")]]),I.is_active?k((n(),l("a",{key:2,class:"text-danger mr-3",href:"javascript:;",onClick:Y=>o.addRemoveApprover("remove",I.id,y.id)},Uh,8,Eh)),[[b,e.trans("remove_approver")]]):d("",!0),I.is_active?d("",!0):k((n(),l("a",qh,Hh)),[[b,e.trans("you_cant_remove_approver")]])],64)):d("",!0),k(a("span",{class:M(["approver-status",o.getIconStyle(y.status)])},null,2),[[b,y.status]])])])])],8,Ah))),256)),(n(!0),l(T,null,P(I.approve_user_types,(y,j)=>(n(),l("div",{id:"level-user-type-"+j},[a("ul",Wh,[a("li",Gh,[k((n(),l("span",Zh,[m(r(o.subString(e.lang(y.name),25)),1)])),[[b,e.lang(y.name)]]),a("span",Jh,[y.status=="PENDING"?(n(),l(T,{key:0},[I.is_active?k((n(),l("a",{key:0,href:"javascript:;",class:"text-dark mr-3",onClick:Y=>o.sendReminder("approver",I.id,y.id)},Xh,8,Yh)),[[b,e.trans("send_reminder")]]):k((n(),l("a",$h,tu)),[[b,e.trans("cant_send_reminder_approver_type")]]),I.is_active?k((n(),l("a",{key:2,class:"text-danger mr-3",href:"javascript:;",onClick:Y=>o.addRemoveApprover("remove",I.id,y.id)},au,8,su)),[[b,e.trans("remove_approver_type")]]):d("",!0),I.is_active?d("",!0):k((n(),l("a",ou,lu)),[[b,e.trans("you_cant_remove_approver_type")]])],64)):d("",!0),k(a("span",{class:M(["approver-status",o.getIconStyle(y.status)])},null,2),[[b,y.status]])])])])],8,Kh))),256))])],4)],12,hh))),256))])])],12,eh))),128))])),i.loading?d("",!0):(n(),l("div",ru,[c.shallApprovalActionsBeVisible?(n(),l("button",{key:0,class:"btn btn-success",id:"approve-button",onClick:t[1]||(t[1]=F=>o.onWorkflowAction("approve")),name:"button"},[du,m(" "+r(e.lang("approve")),1)])):d("",!0),c.shallApprovalActionsBeVisible?(n(),l("button",{key:1,class:"btn btn-danger",id:"deny-button",onClick:t[2]||(t[2]=F=>o.onWorkflowAction("deny")),name:"button"},[cu,m(" "+r(e.lang("deny")),1)])):d("",!0),s.actions.remove_approval_workflow?(n(),l("button",{key:2,class:"btn btn-danger",id:"remove-button",onClick:t[3]||(t[3]=F=>o.onWorkflowAction("remove")),name:"button"},[hu,m(" "+r(e.lang("remove")),1)])):d("",!0)])),i.showModal?(n(),C(v,{key:2,showModal:!0,onClose:()=>i.showModal=!1},{title:f(()=>[a("h4",uu,r(e.lang(o.modalTitle)),1)]),alert:f(()=>[_(h)]),fields:f(()=>[i.loading?(n(),C(p,{key:0})):d("",!0),i.loading?d("",!0):(n(),l("span",mu,r(e.lang(o.modalQuestion)),1)),k((n(),l("div",_u,[!i.loading&&i.action!=="remove"?(n(),C(g,{key:0,id:"textarea",label:e.lang("comment"),value:i.comment,type:"textarea",name:"comment",onChange:o.onChange,classname:"col-sm-12",required:!0},null,8,["label","value","onChange"])):d("",!0)])),[[w]])]),controls:f(()=>[a("button",{id:"approval-action-confirm",type:"button",onClick:t[4]||(t[4]=F=>o.onWorkflowActionConfirm()),class:"btn btn-primary"},[pu,m(" "+r(e.lang("confirm")),1)])]),_:1},8,["onClose"])):d("",!0),i.showAddRemoveModal?(n(),C(v,{key:3,showModal:!0,onClose:o.closeAddModal,containerStyle:e.containerStyle},{title:f(()=>[a("h4",gu,r(i.addRemoveType==="add"?e.lang("add_approver"):e.lang("remove_approver")),1)]),alert:f(()=>[_(h,{componentName:"add_remove_approver"})]),fields:f(()=>[i.modalLoad?(n(),C(p,{key:0})):(n(),l("div",fu,[i.addRemoveType==="add"?(n(),C(D,{key:0,label:e.lang("approver"),value:i.add_approver,onChange:o.onChange,name:"add_approver",apiEndpoint:"/api/dependency/users?meta=true",multiple:!1,classname:"col-md-12",strlength:"50",required:!0},null,8,["label","value","onChange"])):d("",!0),_(g,{id:"textarea",label:e.lang("reason"),value:i.approver_comment,autofocus:i.addRemoveType!="add",type:"textarea",name:"approver_comment",onChange:o.onChange,classname:"col-sm-12",required:!0},null,8,["label","value","autofocus","onChange"])]))]),controls:f(()=>[a("button",{type:"button",onClick:t[5]||(t[5]=F=>o.onAddRemoveConfirm()),class:"btn btn-primary"},[ku,m(" "+r(e.lang("proceed")),1)])]),_:1},8,["onClose","containerStyle"])):d("",!0)])])):d("",!0)])}const yu=A(zc,[["render",bu],["__scopeId","data-v-8d6103dc"]]),vu={props:{id:{type:[String,Number],required:!0},actions:{type:Object,default:()=>{}}},data(){return{counter:0}},created(){window.emitter.on("approvalWorkflowApplied",this.updateData)},methods:{updateData(){this.counter+=1}},components:{"approval-progress":yu}},wu={class:"inbox-approval"};function Cu(e,t,s,c,i,o){const h=u("approval-progress");return n(),l("div",wu,[(n(),C(h,{ticketId:s.id,actions:s.actions,alertName:"timeline",key:"approval"+i.counter},null,8,["ticketId","actions"]))])}const Tu=A(vu,[["render",Cu]]);const Du={name:"record-row",description:"Time track table row component",setup(){const e=H();return{formattedTime:O(()=>e.getters.formattedTime),formattedDate:O(()=>e.getters.formattedDate)}},props:{track:{type:Object,default:()=>{}},current:{type:[Number,String],default:""},reloadData:{type:Function}},components:{"record-event":Ue},data(){return{show:null,showModal:!1,deleteTrack:!1,editTrack:!1,trackData:{},paramsObj:{},curPage:this.current}},methods:{showButton(e){this.show=e},hideButton(e){this.show=null},editTimeTrack(e){this.trackData=e,this.editTrack=!0,this.showModal=!0},onClose(){this.paramsObj.page=this.curPage,this.showModal=!1,this.deleteTrack=!1,this.editTrack=!1,this.trackData="",this.$store.dispatch("unsetValidationError")},getDeleteId(e){this.trackData=e,this.deleteTrack=!0,this.showModal=!0}}},de=e=>(N("data-v-29eae39d"),e=e(),V(),e),Su={key:0},Mu={class:"mailbox-name",style:{"border-bottom":"1px solid #f4f4f4","border-top":"none !important"}},Au={for:"Time and amount details"},Iu={class:"row-label"},Fu={key:0},Lu=de(()=>a("span",{style:{color:"#bab8b8","font-size":"12px","font-weight":"normal"}}," logged ",-1)),Ru=de(()=>a("span",{style:{color:"#bab8b8","font-size":"12px","font-weight":"normal"}}," (hr:min) :   ",-1)),Pu={style:{"font-weight":"bold"}},Ou={key:0,class:"float-right"},ju=de(()=>a("i",{class:"far fa-edit"},null,-1)),xu=[ju],Nu=de(()=>a("i",{class:"fas fa-trash"},null,-1)),Vu=[Nu],Eu={for:"description"},Bu={style:{"word-wrap":"break-word"}},Uu={for:"created time details",style:{"margin-top":"-15px"}},qu={id:"span"},zu={id:"span"},Hu={key:0,id:"span"},Ku=["href"];function Wu(e,t,s,c,i,o){const h=u("router-link"),p=u("record-event");return s.track?(n(),l("tbody",Su,[a("tr",{style:{background:"none !important"},id:"row",onMouseenter:t[3]||(t[3]=g=>o.showButton(s.track.id)),onMouseleave:t[4]||(t[4]=g=>o.hideButton(s.track.id))},[a("td",Mu,[a("div",Au,[a("label",Iu,[s.track.user?(n(),l("span",Fu,[_(h,{to:"/agent/"+s.track.user.id,target:"_blank"},{default:f(()=>[m(r(s.track.user.full_name),1)]),_:1},8,["to"]),Lu])):d("",!0),a("a",{href:"javascript:;",onClick:t[0]||(t[0]=g=>o.editTimeTrack(s.track))},[m(r(e.lang("worktime"))+" ",1),Ru])]),a("span",Pu,r(Math.floor(s.track.work_time/60)<10?"0"+Math.floor(s.track.work_time/60):Math.floor(s.track.work_time/60))+":"+r(s.track.work_time%60<10?"0"+s.track.work_time%60:s.track.work_time%60),1),m("   "),i.show===s.track.id?(n(),l("div",Ou,[a("button",{id:"btn",class:"btn btn-primary btn-xs",onClick:t[1]||(t[1]=g=>o.editTimeTrack(s.track))},xu),a("button",{id:"del",class:"btn btn-danger btn-xs",onClick:t[2]||(t[2]=g=>o.getDeleteId(s.track))},Vu)])):d("",!0)]),a("div",Eu,[a("p",Bu,r(e.trans(s.track.description)),1)]),a("div",Uu,[a("span",qu,r(e.trans("created_on"))+": "+r(c.formattedTime(s.track.created_at))+" ",1),m("   "),a("span",zu,r(e.trans("modified_on"))+": "+r(c.formattedTime(s.track.updated_at))+" ",1),s.track.worktime_type?(n(),l("span",Hu,[a("a",{href:"worktime-type/"+s.track.worktime_type.id},r(e.trans("worktime_type"))+": "+r(s.track.worktime_type.name),9,Ku)])):d("",!0)])])],32),_(q,{name:"modal"},{default:f(()=>[i.showModal?(n(),C(p,{key:0,onClose:o.onClose,showModal:i.showModal,trackData:i.trackData,deleteTrack:i.deleteTrack,editTrack:i.editTrack,updateData:s.reloadData},null,8,["onClose","showModal","trackData","deleteTrack","editTrack","updateData"])):d("",!0)]),_:1})])):d("",!0)}const Gu=A(Du,[["render",Wu],["__scopeId","data-v-29eae39d"]]);const Zu={name:"timetrack-event",description:"time track table page",props:{id:{type:[String,Number],default:""}},data(){return{loading:!0,data:[],per_page:null,total:null,pagination:1,paramsObj:{},totalTime:null,cardOpen:!1}},created(){window.emitter.on("refreshTimeTrack",this.updateTableData)},methods:{toggleCard(){this.cardOpen=!this.cardOpen,this.cardOpen&&this.getTableData()},updateData(){this.getTableData()},updateTableData(){this.loading=!0,this.pagination=1,this.getTableData()},getTableData(e){this.loading=!0;var t=e;S.get("ticket/"+this.id+"/time-track",{params:t}).then(s=>{this.loading=!1,this.data=s.data.data.data,this.per_page=s.data.data.per_page,this.total=s.data.data.total;var c=this.data.map(i=>i.work_time);this.totalTime=c.reduce((i,o)=>i+o)}).catch(s=>{this.loading=!1,L(s)})},pageChanged(){this.paramsObj.page=this.pagination,this.getTableData(this.paramsObj);var e=document.getElementById("inbox-actions");e.scrollIntoView({behavior:"smooth"})}},components:{"table-row":Gu}},Ke=e=>(N("data-v-01d914de"),e=e(),V(),e),Ju={class:"card card-light"},Yu={class:"card-title"},Qu={class:"card-tools"},Xu={key:0,type:"button",class:"btn btn-tool rotating","data-card-widget":"refresh"},$u=Ke(()=>a("i",{class:"fas fa-sync-alt"},null,-1)),em=[$u],tm={type:"button",class:"btn btn-tool"},sm={key:0,class:"card-body"},im={class:"table table-striped"},am={key:1},om={style:{background:"none !important"}},nm={class:"mailbox-name"},lm={class:"ticket_subject"},rm={style:{"font-weight":"bold"}},dm={for:"Time and amount details",style:{"margin-bottom":"5px"}},cm={style:{color:"#878686"}},hm=Ke(()=>a("span",{style:{color:"#bab8b8","font-size":"12px","font-weight":"normal"}}," (hr:min) :  ",-1)),um={style:{"font-weight":"bold"}},mm={key:2,class:"pull-right"},_m={key:0},pm={style:{"text-align":"center"}};function gm(e,t,s,c,i,o){const h=u("table-row"),p=u("uib-pagination"),g=z("tooltip");return n(),l("div",Ju,[a("div",{class:"card-header pointer",onClick:t[0]||(t[0]=(...v)=>o.toggleCard&&o.toggleCard(...v))},[a("h3",Yu,r(e.trans("time-track")),1),a("div",Qu,[i.loading&&i.cardOpen?k((n(),l("button",Xu,em)),[[g,e.lang("refresh")]]):d("",!0),a("button",tm,[a("i",{class:M([{"fas fa-angle-up":i.cardOpen,"fas fa-angle-down":!i.cardOpen},"fs-25"])},null,2)])])]),i.cardOpen?(n(),l("div",sm,[a("table",im,[i.total>0?(n(!0),l(T,{key:0},P(i.data,v=>(n(),C(h,{key:v.id,track:v,current:i.pagination,reloadData:o.updateData},null,8,["track","current","reloadData"]))),128)):d("",!0),i.total>0?(n(),l("tbody",am,[a("tr",om,[a("td",nm,[a("div",lm,[a("h4",rm,r(e.lang("total")),1),a("div",dm,[a("label",null,[a("a",cm,[m(r(e.lang("worktime"))+" ",1),hm])]),a("span",um,r(Math.floor(i.totalTime/60)<10?"0"+Math.floor(i.totalTime/60):Math.floor(i.totalTime/60))+":"+r(i.totalTime%60<10?"0"+i.totalTime%60:i.totalTime%60),1),m("   ")])])])])])):d("",!0),i.total>10?(n(),l("div",mm,[_(p,{records:i.total,modelValue:i.pagination,"onUpdate:modelValue":t[1]||(t[1]=v=>i.pagination=v),class:"pagination","boundary-links":!0,"per-page":i.per_page,onPaginate:t[2]||(t[2]=v=>o.pageChanged()),options:{chunk:3,chunksNavigation:"scroll"}},null,8,["records","modelValue","per-page"])])):d("",!0)]),i.total==0?(n(),l("div",_m,[a("p",pm,r(e.lang("no-data-to-show")),1)])):d("",!0)])):d("",!0)])}const fm=A(Zu,[["render",gm],["__scopeId","data-v-01d914de"]]),km={name:"inbox-associates",description:"Inbox Assciates Component",setup(){const e=H();return{getTicketActions:O(()=>e.getters.getTicketActions)}},props:{ticketId:{type:[String,Number],default:""},ticketData:{type:Object,default:()=>{}},archive:{type:Boolean,default:!1}},created(){window.emitter.on("updateTimelineActivity",()=>{this.refreshKey++})},data(){return{refreshKey:Math.floor(Math.random()*1e4+1)}},methods:{scrollCurrent(e="inbox-associates",t=140){return Oe(e,t)},timelineTabVisible(){(this.getTicketActions||this.archive)&&window.emitter.emit("ticket-tab-mounted",{...this.getTicketActions,disableLoader:"true",archive:this.archive})},timelineBoxVisibleTasks(){window.emitter.emit("ticket-timeline-mounted-tasks",this.ticketId)},timelineBoxVisible(){window.emitter.emit("ticket-timeline-boxes-mounted",this.ticketData)}},components:{"ticket-approval-progress":Tu,"ticket-time-track":fm,"associated-tickets":Uc}},bm={id:"inbox-associates"},ym={id:"timeline-tab"},vm={id:"timeline-display-box-tasks"},wm={id:"timeline-boxes"};function Cm(e,t,s,c,i,o){const h=u("ticket-approval-progress"),p=u("ticket-time-track"),g=u("associated-tickets");return n(),l("div",bm,[c.getTicketActions.view_approval_progress?(n(),C(h,{key:0,actions:c.getTicketActions,id:s.ticketId},null,8,["actions","id"])):d("",!0),c.getTicketActions.time_track_enabled?(n(),C(p,{key:1,id:s.ticketId},null,8,["id"])):d("",!0),(n(),C(g,{"ticket-id":s.ticketId,archive:s.archive,key:i.refreshKey},null,8,["ticket-id","archive"])),a("div",ym,r(o.timelineTabVisible()),1),a("div",vm,r(o.timelineBoxVisibleTasks()),1),a("div",wm,r(o.timelineBoxVisible()),1)])}const Tm=A(km,[["render",Cm]]);const Dm={kb:"article-create",page:"page-create",reply:"inboxActions",internal_note:"inboxActions",canned:"canned-create-edit",problem_bulk_action:"problem-associated-ticket-alert",task_comment:"task-comment-threads"},Sm={name:"add-media",description:"Media files uploader component",props:{description:{type:String,default:""},classname:{type:String,default:"form-group"},show_error:{type:Boolean,default:!1},noDropdown:{type:Boolean,default:!1},page_name:{type:String,default:""},attachments:{type:Array,default:()=>[]},inlineFile:{type:Array,default:()=>[]},onAttach:{type:Function,default:()=>!0},onInline:{type:Function,default:()=>!0},onInput:{type:Function,default:()=>!0},chunkApi:{type:String,default:"/chunk/upload"},filesApi:{type:String,default:"/media/files"},name:{type:String,default:"description"},id:{type:String,default:""},labelName:{type:String,default:"description"}},data(){return{attchments:this.attachments,inline:this.inlineFile,labelStyle:{display:"none"},loading:!1}},watch:{attachments(e,t){this.attchments=e}},methods:{async addInlinePdf(e){let t=JSON.stringify(e.files),s="";this.loading=!0;try{let c={names:t,disk:e.disk};this.page_name==="kb"&&(c.auth=!1),(await S.get("file-manager/inline-files-info",{params:c})).data.data.forEach(h=>{s+=`<a target='_blank' href=${h.link}>${h.name}</a><br>`}),s&&this.getPDF(s)}catch(c){L(c,Dm[this.page_name])}finally{this.loading=!1}},async getAttachmentInfo(e){let t=JSON.stringify(e.files);this.loading=!0;try{let s={names:t,disk:e.disk};this.page_name==="Kb"&&(s.auth=!1),(await S.get("file-manager/files-info",{params:s})).data.data.forEach(o=>{this.attachments.push(o)})}catch{await this.$store.dispatch("setAlert",{type:"danger",message:this.lang("file-manager-modal-error-message"),component_name:"inboxActions"})}finally{this.loading=!1}},onChange(e,t){this.onInput(e,t)},getPDF(e){this.onInput(this.description+"<br>"+e,this.name)},getAttachment(e){this.attchments.push(e),this.onAttach(this.attchments)},removeAttachment(e){this.attchments.splice(e,1),this.onAttach(this.attchments)},getInline(e){this.inline.push(e),this.onInline(this.inline)}}},Mm=e=>(N("data-v-a5e6a330"),e=e(),V(),e),Am={class:"form-group",id:"reply_content_class"},Im={class:"col-md-12"},Fm=Mm(()=>a("span",{class:"text-red"}," *",-1)),Lm={key:1,class:"text-danger"},Rm={key:2,id:"file_details"},Pm={key:0,id:"hidden-attach",contenteditable:"false"},Om=["onClick"];function jm(e,t,s,c,i,o){const h=u("file-manager-container"),p=u("custom-loader"),g=u("tiny-editor");return n(),l("div",null,[a("div",Am,[a("div",Im,[a("label",{style:E([s.show_error?{color:"#dc3545 "}:{color:"black"}]),for:"Reply Content"},r(e.lang(s.labelName)),5),Fm,_(h,{page:s.page_name,onFilesChosen:o.getAttachmentInfo,onFileChosenInlinePdf:o.addInlinePdf},{templateBtn:f(()=>[ue(e.$slots,"template",{},void 0,!0)]),_:3},8,["page","onFilesChosen","onFileChosenInlinePdf"]),i.loading?(n(),C(p,{key:0})):d("",!0),_(g,{value:s.description,type:"text",onChange:o.onChange,name:s.name,label:e.lang("description"),classname:"",required:!1,labelStyle:i.labelStyle,lang:"en",page:s.page_name,id:s.id},null,8,["value","onChange","name","label","labelStyle","page","id"]),s.show_error?(n(),l("span",Lm,r(e.lang("this_field_is_required")),1)):d("",!0),s.page_name!="kb"?(n(),l("div",Rm,[(n(!0),l(T,null,P(i.attchments,(v,D)=>(n(),l(T,null,[v.disposition!=="inline"?(n(),l("div",Pm,[m(r(v.name)+"("+r(v.size?v.size:v.file_size)+" bytes) ",1),a("i",{class:"fa fa-times close-icon","aria-hidden":"true",onClick:b=>o.removeAttachment(D)},null,8,Om)])):d("",!0)],64))),256))])):d("",!0)])])])}const We=A(Sm,[["render",jm],["__scopeId","data-v-a5e6a330"]]);const xm={name:"inbox-reply",description:"Inbox Reply Component",setup(){const e=H();return{getTicketActions:O(()=>e.getters.getTicketActions)}},props:{id:{type:[String,Number],default:""},user:{type:Object,default:()=>{}},ticket:{type:Object,default:()=>{}},ccArray:{type:[Array,String],default:()=>[]},updateThreads:{type:Function}},data(){return{worktime:0,worktime_type:"",reply:"",to:this.user,cc:this.ccArray,response:"",attachments:[],inline:[],isDisabled:!1,loading:!1,formStyle:{width:"40%"},fieldLoader:!1,replyZindex:!1,resetCC:0,showCanned:!1,rules:"",panel:"agent",notify_department:[],notify_agent:[],notify_team:[]}},watch:{user(e,t){this.to=e}},created(){window.emitter.on("updateContent",this.updateReply),window.emitter.on("fileModal",this.getModal)},methods:{toggleCanned(){this.showCanned=!this.showCanned},getModal(e){this.replyZindex=e},updateReply(e){this.reply=e.content},isMail(e,t,s){var c=/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,20}$/;return c.test(e.email?e.email:e.name)},onChange(e,t){this[t]=e,t=="cc"&&(e.length?this.rules=e.every(this.isMail)?"":"email":this.rules=""),t=="response"&&(e?S.get("/get-canned-response-message/"+e.id+"/"+this.id).then(s=>{this.reply=s.data.data.message+this.reply.replace("<p id='extra_p'>&nbsp;</p>",""),this.attachments=s.data.data.attachments}).catch(s=>{this.reply="",this.attachments=[]}):(this.reply="",this.attachments=[]))},isValid(){const{errors:e,isValid:t}=at(this.$data);return!!t},getAttachments(e){this.attachments=e},getInlineImages(e){this.inline=e},onSubmit(){if(this.worktime_type=this.worktime_type||"",this.isValid()){this.loading=!0,this.isDisabled=!0,this.worktime!=0&&this.saveTimeTrack(),this.getNotifyIds();const e={};e.content=this.reply,e.attachment=this.attachments,e.ticket_id=this.id,e.to=[this.to.id],this.cc.length>0?e.cc=this.cc.map(t=>t.hasOwnProperty("email")&&t.email?t.email:t.name):e.cc=[],e.notify_department=this.notify_department.length?this.notify_department.toString():"",e.notify_team=this.notify_team.length?this.notify_team.toString():"",e.notify_agent=this.notify_agent.length?this.notify_agent.toString():"",S.post("api/thread/reply/"+this.id,e).then(t=>{this.initialState(),x(t,"timeline"),window.emitter.emit("refreshTableAndData",!0),this.updateThreads("reply"),window.emitter.emit("closeReplyBox"),this.resetCC+=1}).catch(t=>{this.loading=!1,this.isDisabled=!1,L(t,"timeline")})}},initialState(){this.loading=!1,this.isDisabled=!1,this.reply="",this.to=this.ticket.user,this.attachments=[],this.response="",this.worktime=0,this.fieldLoader=!0,setTimeout(()=>{this.fieldLoader=!1},1)},saveTimeTrack(){const e={};e.work_time=this.worktime,e.entrypoint="reply",this.worktime_type&&(e.worktime_type=this.worktime_type.id),S.post("ticket/"+this.id+"/time-track",e).then(t=>{this.worktime=0,this.worktime_type="",window.emitter.emit("refreshTimeTrack")}).catch(t=>{this.worktime=0,this.worktime_type=""})},getNotifyIds(){var e=new DOMParser,t=e.parseFromString(this.reply,"text/html");t.getElementsByTagName("body")[0].querySelectorAll('[title="mention_link"]').forEach(i=>{let h=i.href.replace(this.basePath(),"").split("/").filter(p=>p);h[h.length-2]=="user"&&this.notify_agent.push(h[h.length-1]),h[h.length-2]=="department"&&this.notify_department.push(h[h.length-1]),h[h.length-2]=="team"&&this.notify_team.push(h[h.length-1])})}},components:{"add-media":We,"time-field":ge,"dynamic-select":K}},be=e=>(N("data-v-3125779b"),e=e(),V(),e),Nm={class:"card-header"},Vm={class:"card-title"},Em={class:"card-tools"},Bm=be(()=>a("i",{class:"fas fa-minus"},null,-1)),Um=be(()=>a("i",{class:"glyphicon glyphicon-plus"},null,-1)),qm={class:"card-body"},zm={class:"row"},Hm={class:"row"},Km={key:3,class:"col-sm-6 load_margin"},Wm={class:"row mr-3"},Gm={key:0},Zm={class:"card-footer"},Jm=["disabled"],Ym=be(()=>a("i",{class:"fas fa-sync-alt"},null,-1));function Qm(e,t,s,c,i,o){const h=u("dynamic-select"),p=u("time-field"),g=u("reuse-loader"),v=u("add-media"),D=u("custom-loader");return n(),l("div",{class:M(["card card-light",{"reply-card":!i.replyZindex}])},[a("div",Nm,[a("h3",Vm,r(e.trans("reply")),1),a("div",Em,[i.showCanned?(n(),l("button",{key:0,class:"btn btn-default btn-sm",onClick:t[0]||(t[0]=(...b)=>o.toggleCanned&&o.toggleCanned(...b))},[Bm,m(" "+r(e.trans("hide_canned_response")),1)])):(n(),l("button",{key:1,class:"btn btn-default btn-sm",onClick:t[1]||(t[1]=(...b)=>o.toggleCanned&&o.toggleCanned(...b))},[Um,m(" "+r(e.trans("add_canned_response")),1)]))])]),a("div",qm,[a("div",zm,[_(h,{label:e.trans("to"),name:"to",value:i.to,onChange:o.onChange,disabled:!0,strlength:30,multiple:!1,classname:"col-sm-6",clearable:!1,optionLabel:"meta_name"},null,8,["label","value","onChange"]),(n(),C(h,{label:e.trans("cc"),name:"cc",value:i.cc,onChange:o.onChange,taggable:!0,close_on_select:!0,apiEndpoint:"/api/dependency/users?meta=true",multiple:!0,strlength:30,classname:"col-sm-6 cc_field",rules:i.rules,key:i.resetCC},null,8,["label","value","onChange","rules"]))]),a("div",Hm,[i.showCanned?(n(),C(h,{key:0,label:e.trans("response"),name:"response",value:i.response,onChange:o.onChange,strlength:30,multiple:!1,classname:"col-sm-6",apiEndpoint:"/api/dependency/canned-responses"},null,8,["label","value","onChange"])):d("",!0),c.getTicketActions.show_thread_worktime&&!i.fieldLoader?(n(),C(p,{key:1,label:e.trans("worktime"),formStyle:i.formStyle,value:i.worktime,type:"number",name:"worktime",onChange:o.onChange,classname:"col-sm-6",required:c.getTicketActions.require_thread_worktime},null,8,["label","formStyle","value","onChange","required"])):d("",!0),c.getTicketActions.show_worktime_type&&!i.fieldLoader&&i.worktime?(n(),C(h,{key:2,label:e.trans("worktime_type"),name:"worktime_type",value:i.worktime_type,onChange:o.onChange,strlength:30,multiple:!1,classname:"col-sm-6",apiEndpoint:"api/worktime-type-list",required:c.getTicketActions.require_worktime_type_field&&i.worktime},null,8,["label","value","onChange","required"])):d("",!0),c.getTicketActions.show_thread_worktime&&i.fieldLoader?(n(),l("div",Km,[_(g,{size:30,duration:4e3})])):d("",!0)]),a("div",Wm,[_(v,{attachments:i.attachments,inlineFile:i.inline,description:i.reply,id:"focus_editor",classname:"col-sm-12",name:"reply",onAttach:o.getAttachments,onInline:o.getInlineImages,onInput:o.onChange,page_name:"reply"},null,8,["attachments","inlineFile","description","onAttach","onInline","onInput"])]),i.loading?(n(),l("div",Gm,[_(D,{size:60,duration:4e3})])):d("",!0)]),a("div",Zm,[a("button",{type:"button",class:"btn btn-primary",onClick:t[2]||(t[2]=(...b)=>o.onSubmit&&o.onSubmit(...b)),disabled:i.isDisabled},[Ym,m(" "+r(e.trans("update")),1)],8,Jm)])],2)}const Xm=A(xm,[["render",Qm],["__scopeId","data-v-3125779b"]]);function $m(e){const{internal_note:t,worktime:s,worktime_type:c}=e;let i={internal_note:[t,"isRequired"]},o=se.getters.getTicketActions;o.show_thread_worktime&&o.require_thread_worktime&&(i.worktime=[s,"isRequired","minValue(1)"]),o.show_worktime_type&&o.require_worktime_type_field&&s&&(i.worktime_type=[c,"isRequired"]);const h=new oe(Q),{errors:p,isValid:g}=h.validate(i);return se.dispatch("setValidationError",p),{errors:p,isValid:g}}const e_={name:"inbox-notes",description:"Inbox Internal Notes Component",setup(){const e=H();return{getTicketActions:O(()=>e.getters.getTicketActions)}},props:{id:{type:[String,Number],default:""},updateThreads:{type:Function}},data(){return{worktime:0,worktime_type:"",internal_note:"",loading:!1,formStyle:{width:"40%"},fieldLoader:!1,attachments:[],inline:[],counter:0,replyZindex:!1,notify_department:[],notify_agent:[],notify_team:[],showCanned:!1}},created(){window.emitter.on("fileModal",this.getModal)},methods:{toggleCanned(){this.showCanned=!this.showCanned},getModal(e){this.replyZindex=e},setAttachments(e){this.attachments=e},setInlineImages(e){this.inline=e},onChange(e,t){this[t]=e,t=="response"&&(e?S.get("/get-canned-response-message/"+e.id+"/"+this.id).then(s=>{this.internal_note=s.data.data.message+this.internal_note.replace("<p id='extra_p'>&nbsp;</p>",""),this.attachments=s.data.data.attachments}).catch(s=>{this.internal_note="",this.attachments=[]}):(this.internal_note="",this.attachments=[]))},isValid(){const{errors:e,isValid:t}=$m(this.$data);return t},onSubmit(){if(this.worktime_type=this.worktime_type||"",this.isValid()){if(!this.internal_note)return;this.loading=!0,this.worktime!=0&&this.saveTimeTrack(),this.getNotifyIds();const e={content:this.internal_note,ticket_id:this.id,is_internal_note:!0,attachment:this.attachments,notify_department:this.notify_department.length?this.notify_department.toString():"",notify_team:this.notify_team.length?this.notify_team.toString():"",notify_agent:this.notify_agent.length?this.notify_agent.toString():""};S.post("api/thread/reply/"+this.id,e).then(t=>{this.counter++,this.loading=!1,this.internal_note="",this.notify_agent=[],this.notify_team=[],this.notify_department=[],this.attachments=[],this.worktime=0,this.fieldLoader=!0,setTimeout(()=>{this.fieldLoader=!1},1),x(t,"timeline"),this.updateThreads("note"),window.emitter.emit("closeNoteBox")}).catch(t=>{this.loading=!1,L(t,"timeline")})}},getNotifyIds(){var e=new DOMParser,t=e.parseFromString(this.internal_note,"text/html");t.getElementsByTagName("body")[0].querySelectorAll('[title="mention_link"]').forEach(i=>{let h=i.href.replace(this.basePath(),"").split("/").filter(p=>p);h[h.length-2]=="user"&&this.notify_agent.push(h[h.length-1]),h[h.length-2]=="department"&&this.notify_department.push(h[h.length-1]),h[h.length-2]=="team"&&this.notify_team.push(h[h.length-1])})},saveTimeTrack(){const e={};e.work_time=this.worktime,e.entrypoint="note",this.worktime_type&&(e.worktime_type=this.worktime_type.id),S.post("ticket/"+this.id+"/time-track",e).then(t=>{this.worktime=0,this.worktime_type="",window.emitter.emit("refreshTimeTrack")}).catch(t=>{this.worktime_type="",this.worktime=0})}},components:{"time-field":ge,"add-media":We,"dynamic-select":K}},ye=e=>(N("data-v-1418b56b"),e=e(),V(),e),t_={class:"card-header"},s_={class:"card-title"},i_={class:"card-tools"},a_=ye(()=>a("i",{class:"fas fa-minus"},null,-1)),o_=ye(()=>a("i",{class:"glyphicon glyphicon-plus"},null,-1)),n_={class:"card-body"},l_={class:"row"},r_={class:"form-group"},d_={key:2,class:"col-sm-6 load_margin"},c_={key:0},h_={class:"card-footer"},u_=["disabled"],m_=ye(()=>a("i",{class:"fas fa-sync-alt"},null,-1));function __(e,t,s,c,i,o){const h=u("dynamic-select"),p=u("time-field"),g=u("reuse-loader"),v=u("add-media"),D=u("custom-loader"),b=z("focus-first-input");return n(),l("div",{class:M(["card card-light",{"note-card":!i.replyZindex}])},[a("div",t_,[a("h3",s_,r(e.trans("add_note")),1),a("div",i_,[i.showCanned?(n(),l("button",{key:0,class:"btn btn-default btn-sm",onClick:t[0]||(t[0]=(...w)=>o.toggleCanned&&o.toggleCanned(...w))},[a_,m(" "+r(e.trans("hide_canned_response")),1)])):(n(),l("button",{key:1,class:"btn btn-default btn-sm",onClick:t[1]||(t[1]=(...w)=>o.toggleCanned&&o.toggleCanned(...w))},[o_,m(" "+r(e.trans("add_canned_response")),1)]))])]),a("div",n_,[a("div",l_,[i.showCanned?(n(),C(h,{key:0,label:e.trans("response"),name:"response",value:e.response,onChange:o.onChange,strlength:30,multiple:!1,classname:"col-sm-6",apiEndpoint:"/api/dependency/canned-responses"},null,8,["label","value","onChange"])):d("",!0)]),a("div",r_,[k((n(),l("div",{class:"row mr-3",key:i.counter},[c.getTicketActions.show_thread_worktime&&!i.fieldLoader?(n(),C(p,{key:0,label:e.trans("worktime"),formStyle:i.formStyle,value:i.worktime,type:"number",name:"worktime",onChange:o.onChange,classname:"col-sm-6",required:c.getTicketActions.require_thread_worktime},null,8,["label","formStyle","value","onChange","required"])):d("",!0),c.getTicketActions.show_worktime_type&&!i.fieldLoader&&i.worktime?(n(),C(h,{key:1,label:e.trans("worktime_type"),name:"worktime_type",value:i.worktime_type,onChange:o.onChange,strlength:30,multiple:!1,classname:"col-sm-6",apiEndpoint:"api/worktime-type-list",required:c.getTicketActions.require_worktime_type_field&&i.worktime},null,8,["label","value","onChange","required"])):d("",!0),c.getTicketActions.show_thread_worktime&&i.fieldLoader?(n(),l("div",d_,[_(g,{size:30,duration:4e3})])):d("",!0)])),[[b]]),(n(),l("div",{class:"row mr-3",key:i.counter},[_(v,{attachments:i.attachments,inlineFile:i.inline,description:i.internal_note,classname:"col-sm-12",name:"internal_note",onAttach:o.setAttachments,onInline:o.setInlineImages,onInput:o.onChange,page_name:"internal_note",id:c.getTicketActions.show_thread_worktime?"":"focus_editor"},null,8,["attachments","inlineFile","description","onAttach","onInline","onInput","id"]),i.loading?(n(),l("div",c_,[_(D,{size:60,duration:4e3})])):d("",!0)]))])]),a("div",h_,[a("button",{type:"button",class:"btn btn-primary",onClick:t[2]||(t[2]=(...w)=>o.onSubmit&&o.onSubmit(...w)),disabled:!i.internal_note||i.loading},[m_,m(" "+r(e.trans("update")),1)],8,u_)])],2)}const p_=A(e_,[["render",__],["__scopeId","data-v-1418b56b"]]);const g_={name:"ticket-timeline",description:"Ticket Timeline",setup(){const e=H();return{formattedTime:O(()=>e.getters.formattedTime),getDefaultRatings:O(()=>e.getters.getDefaultRatings),getTicketActions:O(()=>e.getters.getTicketActions),timeDiffForPast:O(()=>e.getters.timeDiffForPast),timeDiffForFuture:O(()=>e.getters.timeDiffForFuture)}},props:{archive:{type:Boolean,default:!1},ticketId:{type:[String,Number],default:""},from:{type:String,default:""},fromComp:{type:String,default:""},updateTable:{type:Function,default:()=>{}}},data(){return{ticketNum:this.ticketId,ticketData:"",loading:!0,hasDataPopulated:!1,actionsPopulated:!1,system_ratings:[],ticket_ratings:[],refresh:!1,currentActivity:"ticket-conversation",activityCompBtn:"hide_activity",associateCompBtn:"show_associates",styleObj:{},replyCompBtn:"reply",internalCompBtn:"add_note",dataCounter:0,activityCounter:0,replyUser:"",updateMCE:0,viewAll:!1,countdownForDuedate:"",countUpForOverdue:"",expand:!1,maximized:!1,userCompBtn:"show_requester",showLoader:!1}},beforeMount(){this.from==="timeline"&&(this.ticketNum=J(window.location.pathname)),this.archive?this.getArchiveData():this.getTicketData()},mounted(){this.timerActions()},computed:{activityComponent(){return this.currentActivity},styleData(){let e={};return this.ticketData.priority!=null&&(e["border-top"]="3px solid "+this.ticketData.priority.priority_color),e}},created(){window.emitter.on("workflowUpdated",this.updateTimeline),window.emitter.on("actionDone",this.updateTimeline),window.emitter.on("showHidedData",this.hideMethod),window.emitter.on("threadReply",this.replyOnThread),window.emitter.on("closeReplyBox",this.replyMethod),window.emitter.on("closeNoteBox",this.noteMethod)},methods:{formattedTimeAndHours(e){let t=this.formattedTime(e.duedate);return e.departmentDueTrack!==null&&e.departmentDueTrack?e.departmentDueTrack.forEach(s=>{t=t+` <br> ${s.department} : ${s.workingHours}`}):t=t+" <br>",t},getMsg(e){let t=e.labels.length+e.tags.length;return this.viewAll?"View less":"View all "+t},expandView(){this.expand=!this.expand},maxView(){this.maximized=!this.maximized},userMethod(){this.userCompBtn=this.userCompBtn=="hide_requester"?"show_requester":"hide_requester"},timerActions(){this.ticketData.is_overdue?this.updateCountUp("duedate"):this.updateCountDownForDueDate()},updateCountDownForDueDate(){this.countdownForDuedate=this.timeDiffForFuture(this.ticketData.duedate),this.countdownForDuedate===0?(this.ticketData.is_overdue=!0,this.ticketData.due_today=!1,this.updateCountUp("duedate")):setTimeout(()=>{this.updateCountDownForDueDate(this.ticketData.duedate)},1e3)},updateCountUp(e){switch(e){case"duedate":this.countUpForOverdue=this.timeDiffForPast(this.ticketData[e]);break;default:return}var t=this;setTimeout(function(){t.updateCountUp(e)},1e4)},toggleAll(){this.viewAll=!this.viewAll},reloadTimeline(){this.hasDataPopulated=!1,this.loading=!0,this.getTicketData()},replyOnThread(e){this.updateMCE+=1,this.replyCompBtn="hide_reply",this.internalCompBtn="add_note",this.scrollToTarget("actions-card"),this.replyUser=e.user,setTimeout(()=>{window.emitter.emit("updateContent",e)},1e3)},updateTimeline(e){if(window.emitter.emit("updateAgentSidebar"),this.updateTable(e),e=="external"){this.actionsPopulated=!1,window.emitter.emit("closeTimelineActions"),this.getTicketData();return}window.emitter.emit("closeTimelineActions"),this.associateCompBtn="show_associates",["forward"].includes(e)&&window.emitter.emit("updateTimelineActivity"),["status","note","reply"].includes(e)&&(this.activityCounter+=1,this.getTicketData()),["edit","assign","surrender","department","label","tag","approval","requester","timeline_merge","delete","fork"].includes(e)&&(window.emitter.emit("updateTimelineActivity"),this.getTicketData()),e=="duedate"&&(this.loading=!0,this.hasDataPopulated=!1,this.ticketData="",window.emitter.emit("updateTimelineActivity"),this.getTicketData())},scrollToTarget(e){return Oe(e)},replyMethod(){this.replyCompBtn=this.replyCompBtn=="reply"?"hide_reply":"reply",this.internalCompBtn="add_note",this.replyCompBtn=="hide_reply"&&this.scrollToTarget("actions-card")},noteMethod(){this.internalCompBtn=this.internalCompBtn=="add_note"?"hide_note":"add_note",this.replyCompBtn="reply",this.internalCompBtn=="hide_note"&&this.scrollToTarget("actions-card")},activityMethod(){this.activityCompBtn=this.activityCompBtn=="show_activity"?"hide_activity":"show_activity",this.currentActivity=this.currentActivity=="ticket-conversation"?"ticket-activity":"ticket-conversation"},hideMethod(){this.associateCompBtn="hide_associates",setTimeout(()=>{this.$refs.inboxAssociates.scrollCurrent(),setTimeout(()=>{window.emitter.emit("showHideDiv")},1500)},1)},subString(e){return Z(e,30)},getTicketData(){this.$store.dispatch("setRatingTypes",this.ticketNum),this.$store.dispatch("setTicketId",this.ticketNum),this.$store.dispatch("updateTicketActions",this.ticketNum),S.get("/api/agent/ticket-details/"+this.ticketNum).then(e=>{this.dataCounter+=1,this.loading=!1,this.refresh=!1,this.hasDataPopulated=!0,this.actionsPopulated=!0,this.ticketData=e.data.data.ticket,this.replyUser=this.ticketData.user,this.ticket_ratings=this.ticketData.ratings,this.ratingTypes(),this.timerActions()}).catch(e=>{this.loading=!1,this.hasDataPopulated=!0,this.actionsPopulated=!0})},getArchiveData(){S.get("/ticket-archive/ticket-details/"+this.ticketNum).then(e=>{this.loading=!1,this.refresh=!1,this.hasDataPopulated=!0,this.actionsPopulated=!0,this.ticketData=e.data.data.ticket,this.ticketData.labels=!1,this.ticketData.tags=""})},ratingTypes(){this.system_ratings=this.getDefaultRatings},handelLoader(e){this.showLoader=e}},components:{BulletListLoader:De,"timeline-actions":On,"timeline-data":Er,"timeline-user":ad,"rating-component":ze,"ticket-conversation":cc,"ticket-activity":Ic,"inbox-associates":Tm,"ticket-reply":Xm,"ticket-note":p_}},G=e=>(N("data-v-59e912c7"),e=e(),V(),e),f_={key:0,class:"col-sm-12"},k_={key:0,class:"alert alert-danger"},b_={key:0,class:"card-header"},y_={class:"card-title"},v_=G(()=>a("i",{class:"fas fa-ticket"},null,-1)),w_={key:0,class:"card-tools timelinebtns"},C_=G(()=>a("i",{class:"fas fa-reply"},null,-1)),T_=G(()=>a("i",{class:"fas fa-edit"},null,-1)),D_=G(()=>a("i",{class:"fas fa-user"},null,-1)),S_=G(()=>a("i",{class:"fas fa-sync-alt"},null,-1)),M_=[S_],A_={key:1,class:"card-body"},I_={class:"row mb-2"},F_={class:"col-sm-9"},L_={class:"mr-1"},R_={key:0,class:"badge badge-danger mr-1"},P_={key:1,class:"badge badge-warning mr-1"},O_=["href"],j_=["href"],x_=G(()=>a("i",{class:"fas fa-tag"},null,-1)),N_=G(()=>a("i",{class:"fas fa-tag"},null,-1)),V_=G(()=>a("i",{class:"fas fa-ellipsis-h"},null,-1)),E_={class:"col-sm-3"},B_={class:"row"},U_={id:"actions-card"},q_={class:"card card-light card-tabs"},z_={class:"card-header p-0 pt-2"},H_={class:"nav nav-tabs",role:"tablist"},K_={class:"nav-item"},W_=G(()=>a("i",{class:"far fa-comments"},null,-1)),G_={class:"nav-item"},Z_=G(()=>a("i",{class:"fas fa-history"},null,-1)),J_={class:"nav-item ml-auto mt-04"},Y_={key:0,type:"button",class:"btn btn-tool rotating","data-card-widget":"refresh"},Q_=G(()=>a("i",{class:"fas fa-sync-alt"},null,-1)),X_=[Q_],$_={key:1,class:"btn-tool text-small",href:"javascript:;"},ep={key:2,class:"btn-tool text-small",href:"javascript:;"},tp=G(()=>a("i",{class:"fas fa-expand"},null,-1)),sp=[tp],ip={key:0,class:"col-sm-4"},ap={key:2,class:"bullet-load"};function op(e,t,s,c,i,o){const h=u("alert"),p=u("timeline-actions"),g=u("router-link"),v=u("rating-component"),D=u("ticket-reply"),b=u("ticket-note"),w=u("inbox-associates"),F=u("timeline-user"),U=u("timeline-data"),I=u("BulletListLoader"),R=z("tooltip");return i.ticketNum?(n(),l("div",f_,[_(h,{componentName:"timeline"}),i.hasDataPopulated&&!i.ticketData?(n(),l("div",k_,r(e.trans("no-ticket-found")),1)):d("",!0),i.hasDataPopulated?(n(),l("div",{key:1,class:"card card-light",style:E(o.styleData)},[i.ticketData?(n(),l("div",b_,[a("h3",y_,[v_,m(" #"+r(i.ticketData.ticket_number)+"‏ ",1)]),i.actionsPopulated?(n(),l("div",w_,[(n(),C(p,{id:i.ticketNum,data:i.ticketData,afterAction:o.updateTimeline,actions:c.getTicketActions,ref:"timelineActions",key:i.dataCounter},{"left-actions":f(()=>[c.getTicketActions.view_tickets_without_actions?(n(),l("button",{key:0,type:"button",class:M(["btn btn-default btn-xs",{"bg-primary border-b":i.replyCompBtn=="hide_reply"}]),onClick:t[0]||(t[0]=(...y)=>o.replyMethod&&o.replyMethod(...y))},[C_,m(" "+r(e.trans("reply")),1)],2)):d("",!0),c.getTicketActions.view_tickets_without_actions?(n(),l("button",{key:1,type:"button",class:M(["btn btn-default btn-xs",{"bg-primary border-b":i.internalCompBtn=="hide_note"}]),onClick:t[1]||(t[1]=(...y)=>o.noteMethod&&o.noteMethod(...y))},[T_,m(" "+r(e.trans("add_note")),1)],2)):d("",!0),i.ticketData.user&&!i.expand?(n(),l("button",{key:2,type:"button",class:M(["btn btn-xs btn-default",{"bg-primary border-b":i.userCompBtn=="hide_requester"}]),onClick:t[2]||(t[2]=(...y)=>o.userMethod&&o.userMethod(...y)),id:"user_btn"},[D_,m(" "+r(e.trans("requester")),1)],2)):d("",!0),s.fromComp!="index"?k((n(),l("button",{key:3,class:"btn btn-default btn-xs",onClick:t[3]||(t[3]=(...y)=>o.reloadTimeline&&o.reloadTimeline(...y))},M_)),[[R,e.trans("refresh")]]):d("",!0),k((n(),l("button",{type:"button",class:"btn btn-xs btn-default",onClick:t[4]||(t[4]=(...y)=>o.expandView&&o.expandView(...y))},[a("i",{class:M({"fas fa-expand":!i.expand,"fas fa-compress":i.expand})},null,2)])),[[R,i.expand?e.trans("show_sidebar"):e.trans("hide_sidebar")]])]),_:1},8,["id","data","afterAction","actions"])),ue(e.$slots,"headerMenu",{},void 0,!0)])):d("",!0)])):d("",!0),i.ticketData?(n(),l("div",A_,[a("div",I_,[a("div",F_,[a("h5",L_,[m(r(i.ticketData.title)+"  ",1),a("span",null,[i.ticketData.is_overdue||i.ticketData.due_today?(n(),l(T,{key:0},[i.ticketData.is_overdue?k((n(),l("span",R_,[m(r(e.trans("overdue")),1)])),[[R,e.trans("this_ticket_is_marked_as_overdue")]]):d("",!0),i.ticketData.due_today?k((n(),l("span",P_,[m(r(e.trans("due_today")),1)])),[[R,e.trans("this_ticket_is_marked_as_duetoday")]]):d("",!0)],64)):d("",!0),!i.viewAll&&!s.archive&&i.ticketData.labels.length>2?(n(!0),l(T,{key:1},P(i.ticketData.labels.slice(0,2),(y,j)=>k((n(),l("a",{target:"_blank",href:y.href,class:"badge mr-1",style:E({backgroundColor:y.color,color:"#FFF"})},[m(r(o.subString(y.name)),1)],12,O_)),[[R,e.trans(y.name)]])),256)):d("",!0),!i.viewAll&&!s.archive&&i.ticketData.tags.length>2?(n(!0),l(T,{key:2},P(i.ticketData.tags.slice(0,2),(y,j)=>k((n(),l("a",{target:"_blank",href:y.href,class:"badge mr-1",id:"ticket_tags"},[x_,m(" "+r(o.subString(y.name)),1)],8,j_)),[[R,e.trans(y.name)]])),256)):d("",!0),i.viewAll&&!s.archive||i.ticketData.labels.length<=2&&i.ticketData.tags.length<=2&&!s.archive?(n(),l(T,{key:3},[(n(!0),l(T,null,P(i.ticketData.labels,(y,j)=>k((n(),C(g,{to:y.href.replace(e.basePath(),""),class:"badge mr-1",style:E({backgroundColor:y.color,color:"#FFF"})},{default:f(()=>[m(r(o.subString(y.name)),1)]),_:2},1032,["to","style"])),[[R,e.trans(y.name)]])),256)),(n(!0),l(T,null,P(i.ticketData.tags,(y,j)=>k((n(),C(g,{to:y.href.replace(e.basePath(),""),class:"badge mr-1",id:"ticket_tags"},{default:f(()=>[N_,m(" "+r(o.subString(y.name)),1)]),_:2},1032,["to"])),[[R,e.trans(y.name)]])),256))],64)):d("",!0),i.ticketData.labels.length>2&&!s.archive||i.ticketData.tags.length>2&&!s.archive?(n(),l("a",{key:4,href:"javascript:;",class:"badge mr-1",onClick:t[5]||(t[5]=(...y)=>o.toggleAll&&o.toggleAll(...y))},[V_,m(" "+r(o.getMsg(i.ticketData)),1)])):d("",!0)])])]),a("div",E_,[i.system_ratings.name&&!i.refresh?(n(),C(v,{key:0,url:"rating/",rating:i.system_ratings,ticket_id:"",classname:"mb-2 lh-1",readOnlyStar:!0},null,8,["rating"])):d("",!0)])]),a("div",B_,[a("div",{class:M({"col-sm-12":i.expand,"col-sm-8":!i.expand})},[a("div",U_,[i.replyCompBtn=="hide_reply"?(n(),C(D,{id:i.ticketNum,user:i.replyUser,ccArray:i.ticketData.collaborators,ticket:i.ticketData,updateThreads:o.updateTimeline,key:i.updateMCE},null,8,["id","user","ccArray","ticket","updateThreads"])):d("",!0),i.internalCompBtn=="hide_note"?(n(),C(b,{key:1,id:i.ticketNum,updateThreads:o.updateTimeline},null,8,["id","updateThreads"])):d("",!0)]),a("div",q_,[a("div",z_,[a("ul",H_,[a("li",K_,[a("a",{class:M(["nav-link",{active:i.activityCompBtn=="hide_activity"}]),"data-toggle":"pill",role:"tab",href:"javascript:;",onClick:t[6]||(t[6]=y=>o.activityMethod("ticket_conversation"))},[W_,m(" "+r(e.trans("ticket_conversation")),1)],2)]),a("li",G_,[a("a",{class:M(["nav-link",{active:i.activityCompBtn=="show_activity"}]),"data-toggle":"pill",role:"tab",href:"javascript:;",onClick:t[7]||(t[7]=y=>o.activityMethod("ticket_activity"))},[Z_,m(" "+r(e.trans("ticket_activity")),1)],2)]),a("li",J_,[i.showLoader?k((n(),l("button",Y_,X_)),[[R,e.lang("refresh")]]):d("",!0),i.ticketData.is_overdue?k((n(),l("a",$_,[a("em",null,[m(r(e.trans("overdue"))+" - ",1),a("b",null,r(i.countUpForOverdue),1)])])),[[R,{content:c.getTicketActions.block_ticket_actions?"--":o.formattedTimeAndHours({duedate:i.ticketData.duedate,departmentDueTrack:i.ticketData["department-due-track"]}),html:!0}]]):d("",!0),i.ticketData.is_overdue?d("",!0):k((n(),l("a",ep,[a("em",null,[m(r(e.trans("due_in"))+" - ",1),a("b",null,r(i.countdownForDuedate?i.countdownForDuedate:"--"),1)])])),[[R,{content:c.getTicketActions.block_ticket_actions?"--":o.formattedTimeAndHours({duein:i.ticketData.duedate,departmentDueTrack:i.ticketData["department-due-track"]}),html:!0}]]),k((n(),l("button",{type:"button",class:"btn btn-tool","data-card-widget":"maximize",onClick:t[8]||(t[8]=(...y)=>o.maxView&&o.maxView(...y))},sp)),[[R,i.maximized?e.trans("minimize"):e.trans("maximize")]])])])]),a("div",{class:M(["card-body",{"maximized-logs":i.maximized}])},[(n(),C(Je(o.activityComponent),{ticketId:i.ticketNum,archive:s.archive,key:i.activityCounter,onLoaderState:o.handelLoader,maximized:i.maximized},null,40,["ticketId","archive","onLoaderState","maximized"]))],2)]),i.hasDataPopulated?(n(),C(w,{key:0,ticketId:i.ticketNum,archive:s.archive,ticketData:i.ticketData,ref:"inboxAssociates"},null,8,["ticketId","archive","ticketData"])):d("",!0)],2),i.expand?d("",!0):(n(),l("div",ip,[i.ticketData.user&&i.userCompBtn=="hide_requester"?(n(),C(F,{key:0,user:i.ticketData.user,archive:s.archive,org:i.ticketData.organizations},null,8,["user","archive","org"])):d("",!0),(n(),C(U,{id:i.ticketNum,archive:s.archive,ticket:i.ticketData,key:i.dataCounter,actions:c.getTicketActions,afterAction:o.updateTimeline},null,8,["id","archive","ticket","actions","afterAction"]))]))])])):d("",!0)],4)):d("",!0),i.loading?(n(),l("div",ap,[_(I,{viewBox:"0 0 300 200"})])):d("",!0)])):d("",!0)}const np=A(g_,[["render",op],["__scopeId","data-v-59e912c7"]]);const lp={props:{selectedColor:{type:String,default:""},ticketPage:{type:String,default:""},archive:{type:Boolean,default:!1}},data(){return{buttonStyle:{"background-color":this.selectedColor+" !important",color:"#fff"},loading:!0,ticketsArray:[],ticketResponse:"",perpage:"",pagination:1,paramsObj:{},hasDataPopulated:!0,search:"",selectedTickets:[],timelineId:"",url_params:[],isApplyClicked:!1,activePage:this.ticketPage,isShowFilter:!1,counter:0,next_page:"",prev_page:"",searchShortCode:"",searchFilter:["id"],filterArray:[],sourceType:""}},beforeMount(){let e=new URLSearchParams(window.location.search);this.timelineId=e.get("timelineId")?e.get("timelineId"):"",this.archive?this.getArchiveList():this.activePage=="filter"?(this.activePage="",this.paramsObj.filter_id=J(window.location.pathname),this.getTicketList(this.paramsObj)):this.getTicketList(),this.getSearchShorCodes(),this.search=this.formatSearchFilter(),this.filterArray.push(this.search),window.emitter.emit("updateAgentSidebar")},mounted(){this.timelineId&&$("html, body").animate({scrollTop:$("#ticket-timeline").offset().top-70},"slow")},created(){window.emitter.on("refreshInbox",this.getRefreshList),window.emitter.on("closeTimelineView",this.closeTimeline)},computed:{isHighlighted(){const e=this.searchFilter.map(t=>"is:"+t+" ").join("");return this.search===e}},methods:{refreshArchive(){this.hasDataPopulated=!0,this.paramsObj.page=1,this.getArchiveList(this.paramsObj),this.pagination=1},refreshDetails(){this.$refs.ticketTimeline.reloadTimeline()},backToInbox(){var e=document.getElementById("tickets-index");e.scrollIntoView({behavior:"smooth"})},toggleFilterView(){this.isShowFilter=!this.isShowFilter},reloadData(e){e&&e=="duedate"&&(this.ticketsArray=[],this.loading=!0),this.hasDataPopulated=!0,this.getTicketList(this.paramsObj)},closeTimeline(){var e=document.getElementById("tickets-index");e.scrollIntoView({behavior:"smooth"}),this.timelineId=""},onTicketSelect(e){if($("html, body").animate({scrollTop:$("#ticket-timeline").offset().top-70},"slow"),new URLSearchParams(window.location.search).get("timelineId")){const s="timelineId",c=e,i=new URLSearchParams(window.location.search);i.set(s,c);const o=`${window.location.origin}${window.location.pathname}?${i.toString()}`;window.history.replaceState(null,null,o)}else{const s="timelineId",c=e,i=window.location.href,o=i.includes("?")?"&":"?",h=`${i}${o}${s}=${c}`;window.history.replaceState(null,null,h)}this.timelineId=e,this.counter+=1},refreshTickets(){this.getRefreshList(),window.emitter.emit("unCheckTicket"),window.emitter.emit("refreshTicket")},onDelete(){S.post("/ticket-archive/delete-ticket/?ticket_ids="+this.selectedTickets).then(e=>{this.selectedTickets=[],x(e,"inbox"),this.refreshArchive(),this.onClose()}).catch(e=>{this.loading=!1,L(e,"inbox")})},doSearch(e,t){let s=this.formatSearchFilter(),c=t.replace(s,""),i=decodeURIComponent(c).replace(/[^\x00-\x7F]/g,"");this.commonActions(),this.paramsObj.page=1,this.paramsObj["search-query"]=i.trim(),this.paramsObj.short_code=this.searchFilter,this.archive?this.getArchiveList(this.paramsObj):this.getTicketList(this.paramsObj),this.pagination=1},onPagination(e){this.archive?this.getArchiveList(this.paramsObj,e):this.getTicketList(this.paramsObj,e),this.hasDataPopulated=!0,document.getElementById("tickets-index").scrollIntoView({behavior:"smooth"})},getTicketList(e,t=""){let s="";if(!this.isApplyClicked){var c=location.search.substring(1);c.length!==0&&(this.url_params=JSON.parse('{"'+decodeURIComponent(c).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"').replace(/%2F/g,"/")+'"}')),s={...this.handleUrlParamsInTicketFilter(s),...e},e=s||e}let i=this.activePage;i=i==="trash"?"deleted":i,S.get("/api/agent/ticket-list?category="+i,{params:e}).then(o=>{this.ticketResponse=o.data.data,this.perpage=parseInt(this.ticketResponse.per_page),this.ticketsArray=o.data.data.tickets,this.next_page=o.data.data.next_page_url,this.prev_page=o.data.data.prev_page_url,this.sourceType=this.ticketResponse.category==="deleted"?"trash":this.ticketResponse.category,this.loading=!1,this.hasDataPopulated=!1,!this.ticketsArray.length&&this.pagination!=1&&(this.pagination=1,this.paramsObj.page=1,this.getTicketList(this.paramsObj))}).catch(o=>{this.loading=!1,L(o,"inbox"),this.hasDataPopulated=!1})},getPageNumberFromUrl(e){const t=/[?&]page=(\d+)/,s=e.match(t);return s?parseInt(s[1]):null},getArchiveList(e,t=""){let s="";if(!this.isApplyClicked){var c=location.search.substring(1);c.length!==0&&(this.url_params=JSON.parse('{"'+decodeURIComponent(c).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"').replace(/%2F/g,"/")+'"}')),s={...this.handleUrlParamsInTicketFilter(s),...e},e=s||e}let i=this.activePage;if(i=i==="trash"?"deleted":i,t==="next"&&this.next_page){const o=this.getPageNumberFromUrl(this.next_page);e.page=o}if(t==="previous"&&this.prev_page){const o=this.getPageNumberFromUrl(this.prev_page);e.page=o}S.get("ticket-archive/view-tickets"+i,{params:e}).then(o=>{this.ticketResponse=o.data.data,this.perpage=parseInt(this.ticketResponse.per_page),this.ticketsArray=o.data.data.tickets,this.next_page=o.data.data.next_page_url,this.prev_page=o.data.data.prev_page_url,this.loading=!1,this.hasDataPopulated=!1,!this.ticketsArray.length&&this.pagination!=1&&(this.pagination=1,this.paramsObj.page=1,this.getArchiveList(this.paramsObj))}).catch(o=>{this.loading=!1,this.hasDataPopulated=!1})},backUpStart(){S.get("ticket-archive/ticket-archive").then(e=>{this.loading=!1,this.refreshArchive(),x(e,"inbox"),e.data.data}).catch(e=>{this.loading=!1,L(e,"inbox")})},refreshIndex(){this.hasDataPopulated=!0,this.paramsObj.page=1,this.getTicketList(this.paramsObj),window.emitter.emit("updateAgentSidebar"),this.pagination=1},commonActions(){this.selectedTickets=[],this.hasDataPopulated=!0;var e=document.getElementById("ticket-list-body");e.scrollIntoView({behavior:"smooth"})},getRefreshList(){this.pagination=this.pagination,this.paramsObj.page=this.pagination,this.commonActions(),this.archive?this.getArchiveList(this.paramsObj):this.getTicketList(this.paramsObj)},pageChanged(e){this.commonActions();let t="";e==="next"&&this.next_page&&(t=this.getPageNumberFromUrl(this.next_page)),e==="previous"&&this.prev_page&&(t=this.getPageNumberFromUrl(this.prev_page)),this.paramsObj.page=t,this.archive?this.getArchiveList(this.paramsObj):this.getTicketList(this.paramsObj)},handlePageCount(e){this.commonActions(),this.paramsObj.page=1,this.paramsObj.limit=e,this.archive?this.getArchiveList(this.paramsObj):this.getTicketList(this.paramsObj),this.pagination=1},sorting(e){this.commonActions(),this.paramsObj.answered="",this.paramsObj["sort-field"]=e.value,this.paramsObj["sort-order"]=e.order,this.archive?this.getArchiveList(this.paramsObj):this.getTicketList(this.paramsObj)},filtering(e){this.commonActions(),this.paramsObj.answered=e.value,this.archive?this.getArchiveList(this.paramsObj):this.getTicketList(this.paramsObj)},appendSelect(e,t){t?this.selectedTickets.push(e):this.selectedTickets.splice(this.selectedTickets.indexOf(e),1)},setFilter(e,t,s){this.commonActions(),this.isApplyClicked=s;const c=["due-on","created-at","updated-at"];for(const i in e)e.hasOwnProperty(i)&&c.includes(i)&&(e[i]=e[i]);this.pagination=1,e.category==""&&(e.category=this.url_params["show[]"]),this.paramsObj=JSON.parse(JSON.stringify(e)),this.setParamsAndApplyFilter(this.paramsObj,t)},handleUrlParamsInTicketFilter(e){return te(this.url_params["filter-by-url"])?this.url_params:e},setParamsAndApplyFilter(e,t=!1){if(!this.isApplyClicked){let s=location.search.substring(1);s.length!==0&&(this.url_params=JSON.parse('{"'+decodeURIComponent(s).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"').replace(/%2F/g,"/")+'"}')),e=this.handleUrlParamsInTicketFilter(e)}if(this.url_params["show[]"]=="trash"&&(this.url_params["show[]"]="deleted",this.deleteForver=!0),typeof e>"u"){let s=JSON.parse(JSON.stringify(this.paramsObj));s.category=s.category!==void 0?s.category:this.url_params["show[]"],s.filter_id=J(this.currentPath()),this.getTicketList(s)}else{t&&window.emitter.emit("hideInboxTimeline");let s=e;s.category=s.category!==void 0?s.category:this.url_params["show[]"],this.showFilter&&(s.filter_id=J(this.currentPath())),s.limit=this.perpage,this.getTicketList(s)}},getSearchShorCodes(){S.get("/filter/search-shortcodes").then(e=>{this.searchShortCode=e.data,this.loading=!1}).catch(e=>{this.loading=!1})},toggleSearchFilter(e,t){const s=this.searchFilter.indexOf(t);s!==-1?this.searchFilter.splice(s,1):this.searchFilter.push(t);let c=new RegExp("is:[^ ]+\\s","g"),i=this.search.replace(c,"");this.search=this.formatSearchFilter()+i,this.filterArray=this.searchFilter.map(o=>"is:"+o+" "),this.preventToCloseBox(e)},preventToCloseBox(e){e.stopPropagation()},formatSearchFilter(){return this.searchFilter.map(e=>"is:"+e+" ").join("")},handleKeyDown(e){e.key==="Backspace"&&this.isAllTextSelected()&&(this.search="",this.searchFilter=[],this.filterArray=[])},isAllTextSelected(){return document.activeElement.selectionStart===0&&document.activeElement.selectionEnd===this.search.length}},watch:{search(){for(let e=0;e<this.filterArray.length;e++){const t=this.filterArray[e];if(!this.search.includes(t)){let s=t.replace("is:","").trim();const c=this.searchFilter.indexOf(s);c!==-1&&this.searchFilter.splice(c,1),this.filterArray.splice(e,1),this.search=this.filterArray.filter(i=>this.filterArray.includes(i)).join(""),e--}}}},components:{BulletListLoader:De,"ticket-actions":At,"ticket-details":Ci,"per-page":Fi,"select-all":xi,"ticket-sorting":Hi,"ticket-timeline":np,"ticket-filter":tt,"simple-pagination":ot}},ee=e=>(N("data-v-0ac2055c"),e=e(),V(),e),rp={id:"tickets-index"},dp={class:"card card-light",id:"ticket-list-body"},cp={class:"card-header"},hp={class:"card-title"},up={key:0,class:"card-tools"},mp=ee(()=>a("i",{class:"glyphicon glyphicon-filter"},null,-1)),_p=[mp],pp=ee(()=>a("i",{class:"fas fa-sync-alt"},null,-1)),gp=[pp],fp={key:1,class:"card-tools"},kp=ee(()=>a("i",{class:"fas fa-archive"},null,-1)),bp=[kp],yp=ee(()=>a("i",{class:"fas fa-sync-alt"},null,-1)),vp=[yp],wp={class:"card-body"},Cp={key:0,class:"row"},Tp={class:"col-md-12"},Dp={class:"search-div form-group form-inline float-right VueTables__search"},Sp={class:"VueTables__search-field"},Mp={class:"input-group ticket-searchbar mb-3"},Ap={class:"input-group-prepend"},Ip={type:"button",class:"btn btn-default dropdown-toggle filter-ticket","data-toggle":"dropdown"},Fp={class:"dropdown-menu filter-column"},Lp=["onClick"],Rp={key:0,class:"fas fa-check"},Pp=["placeholder"],Op={class:"form-group float-left VueTables__limit"},jp={class:"VueTables__limit-field"},xp={type:"button",class:"btn btn-default btn-md bg-white cursor_def"},Np={key:1,style:{padding:"1rem"}},Vp={class:"mailbox-messages mailinbox"},Ep={key:0},Bp={class:"row ticket-box"},Up={key:0,class:"col-md-12 col-sm-12 col-12"},qp={key:0,id:"tickets-expanded"},zp={key:1},Hp={class:"text-center no-ticket-found"},Kp={key:2},Wp={class:"mailbox-controls"},Gp={class:"row"},Zp={class:"col-sm-6 pad-top-18"},Jp={class:"col-sm-6"},Yp={key:0,class:"float-right mr-2"},Qp={class:"time-ab-div"},Xp={id:"ticket-timeline",class:"row"},$p=ee(()=>a("i",{class:"fas fa-sync-alt"},null,-1)),eg=[$p],tg=ee(()=>a("i",{class:"fas fa-arrow-up"},null,-1)),sg=[tg],ig=ee(()=>a("i",{class:"fas fa-times"},null,-1)),ag=[ig];function og(e,t,s,c,i,o){const h=u("alert"),p=u("select-all"),g=u("ticket-actions"),v=u("per-page"),D=u("ticket-sorting"),b=u("BulletListLoader"),w=u("ticket-filter"),F=u("ticket-details"),U=u("simple-pagination"),I=u("ticket-timeline"),R=z("tooltip");return n(),l("div",rp,[_(h,{componentName:"inbox"}),a("div",dp,[a("div",cp,[a("h3",hp,r(e.trans("tickets")),1),!i.loading&&!s.archive?(n(),l("div",up,[k((n(),l("button",{type:"button",class:"btn btn-tool",onClick:t[0]||(t[0]=y=>o.toggleFilterView())},_p)),[[R,e.trans("filter_tickets")]]),k((n(),l("button",{type:"button",class:M(["btn btn-tool",i.hasDataPopulated?"rotating":""]),"data-card-widget":"refresh",onClick:t[1]||(t[1]=y=>o.refreshIndex())},gp,2)),[[R,e.trans("refresh")]])])):d("",!0),!i.loading&s.archive?(n(),l("div",fp,[k((n(),l("button",{type:"button",class:"btn btn-tool","data-card-widget":"backup",onClick:t[2]||(t[2]=y=>o.backUpStart())},bp)),[[R,e.trans("this_will_move_closed_tickets_to_archive")]]),k((n(),l("button",{type:"button",class:M(["btn btn-tool",i.hasDataPopulated?"rotating":""]),"data-card-widget":"refresh",onClick:t[3]||(t[3]=y=>o.refreshArchive())},vp,2)),[[R,e.trans("refresh")]])])):d("",!0)]),a("div",wp,[i.loading?d("",!0):(n(),l("div",Cp,[a("div",Tp,[a("div",Dp,[a("div",Sp,[a("div",Mp,[a("div",Ap,[a("button",Ip,r(e.lang("search_by")),1),a("div",Fp,[(n(!0),l(T,null,P(i.searchShortCode,(y,j)=>(n(),l("div",null,[a("a",{class:"dropdown-item search-filter",onClick:Y=>o.toggleSearchFilter(Y,j)},[i.searchFilter.includes(j)?(n(),l("i",Rp)):d("",!0),m("  "),a("span",{class:M(["search-text",i.searchFilter.includes(j)?"":"ml-3"])},r(y),3)],8,Lp)]))),256))])]),k(a("input",{type:"text",class:M(["form-control",{highlighted:o.isHighlighted}]),placeholder:e.lang("type_and_enter_to_search"),"onUpdate:modelValue":t[4]||(t[4]=y=>i.search=y),autocomplete:"off",onKeyup:t[5]||(t[5]=Ye(y=>o.doSearch(y,i.search),["enter"])),onKeydown:t[6]||(t[6]=y=>o.handleKeyDown(y))},null,42,Pp),[[Te,i.search]])])])]),a("div",Op,[a("div",jp,[k((n(),l("button",xp,[_(p,{tickets:i.ticketsArray,selected:i.selectedTickets},null,8,["tickets","selected"])])),[[R,e.trans("select_all_tickets")]]),i.selectedTickets.length?(n(),C(g,{key:0,archive:s.archive,selectedTickets:i.selectedTickets,loadTickets:o.refreshTickets,page:i.sourceType,tickets:i.ticketsArray},null,8,["archive","selectedTickets","loadTickets","page","tickets"])):d("",!0),i.perpage?(n(),C(v,{key:1,perpage:i.perpage,tableHeader:s.selectedColor,onTicketCount:o.handlePageCount},null,8,["perpage","tableHeader","onTicketCount"])):d("",!0),_(D,{onSort:o.sorting,onFilter:o.filtering,tableHeader:s.selectedColor},null,8,["onSort","onFilter","tableHeader"])])])])])),i.loading&&i.hasDataPopulated?(n(),l("div",Np,[_(b,{viewBox:"0 0 300 200"})])):d("",!0),a("div",Vp,[i.isShowFilter?(n(),l("div",Ep,[_(w,{onFilter:o.setFilter,showFilter:i.isShowFilter,closeFilterView:o.toggleFilterView},null,8,["onFilter","showFilter","closeFilterView"])])):d("",!0),a("div",Bp,[i.loading?d("",!0):(n(),l("div",Up,[i.ticketsArray.length>0?(n(),l("table",qp,[a("tbody",null,[(n(!0),l(T,null,P(i.ticketsArray,(y,j)=>(n(),C(F,{archive:s.archive,ticket:y,key:y.id,color:s.selectedColor,appendSelect:o.appendSelect,onSelect:o.onTicketSelect,timelineId:i.timelineId},null,8,["archive","ticket","color","appendSelect","onSelect","timelineId"]))),128))])])):d("",!0),!i.hasDataPopulated&&i.ticketsArray.length===0?(n(),l("div",zp,[a("p",Hp,r(e.trans("no-ticket-found")),1)])):d("",!0)]))])]),i.loading?d("",!0):(n(),l("div",Kp,[a("div",Wp,[a("div",Gp,[a("div",Zp,[i.ticketResponse.total==1?(n(),l(T,{key:0},[m(r(e.trans("one_record")),1)],64)):d("",!0),i.ticketResponse.total>1&&i.ticketResponse.total<=10?(n(),l(T,{key:1},[m(r(i.ticketResponse.total)+" "+r(e.trans("records")),1)],64)):d("",!0),i.ticketResponse.total>10?(n(),l(T,{key:2},[m(r(e.trans("showing"))+" "+r(i.ticketResponse.from)+" to "+r(i.ticketResponse.to)+" of "+r(i.ticketResponse.total)+" "+r(e.trans("records")),1)],64)):d("",!0)]),a("div",Jp,[i.ticketResponse.total>10?(n(),l("div",Yp,[_(U,{prev_page:i.prev_page,next_page:i.next_page,onPagination:o.pageChanged},null,8,["prev_page","next_page","onPagination"])])):d("",!0)])])])]))])]),a("div",Qp,[a("div",Xp,[i.timelineId?(n(),C(I,{ticketId:i.timelineId,archive:s.archive,updateTable:o.reloadData,key:i.counter,ref:"ticketTimeline",fromComp:"index"},he({_:2},[s.archive?void 0:{name:"headerMenu",fn:f(()=>[k((n(),l("button",{class:"btn btn-default btn-xs",onClick:t[7]||(t[7]=(...y)=>o.refreshDetails&&o.refreshDetails(...y)),href:"javascript:;"},eg)),[[R,e.trans("refresh")]]),k((n(),l("button",{type:"button",class:"btn btn-default btn-xs",onClick:t[8]||(t[8]=(...y)=>o.backToInbox&&o.backToInbox(...y))},sg)),[[R,e.trans("back_to_inbox")]]),k((n(),l("button",{type:"button",class:"btn btn-default btn-xs",onClick:t[9]||(t[9]=(...y)=>o.closeTimeline&&o.closeTimeline(...y))},ag)),[[R,e.trans("close")]])]),key:"0"}]),1032,["ticketId","archive","updateTable"])):d("",!0)])])])}const ug=A(lp,[["render",og],["__scopeId","data-v-0ac2055c"]]);export{We as A,He as T,ge as a,ug as b,np as c,qc as v};
