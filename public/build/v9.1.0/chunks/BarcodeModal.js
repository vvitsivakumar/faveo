import{a as _,Z as E,r as w,q as k,b as V,w as m,d,o as a,f as e,t as u,c as i,F as y,G as f,i as v,n as h,e as g,g as n,B as T,h as D}from"./vendor.js";import{c as M,V as R,l as x,_ as j,j as A}from"./bootstrap.js";function K(t){const{pass_code:l}=t;let o={pass_code:[l,"isRequired"]};const p=new R(x),{errors:s,isValid:r}=p.validate(o);return M.dispatch("setValidationError",s),{errors:s,isValid:r}}const q={name:"barcode-modal",description:"BarCode Modal component",props:{showModal:{type:Boolean,default:!1},onClose:{type:Function},color:{type:String,default:"#1d78ff"},buttonStyle:{type:Object,default:()=>{}},inputStyle:{type:Object,default:()=>{}},linkStyle:{type:Object,default:()=>{}},from:{type:String,default:""}},data(){return{isDisabled:!0,containerStyle:{width:"600px"},loading:!1,showBarcode:!0,btnName:"next",passwordVerified:!1,password:"",labelStyle:{visibility:"hidden"},remember:!0,verifyLoader:!1,showPasscode:!1,showKeycode:!1,pass_code:"",factorData:"",codeVerified:!1,showPasswordVerify:!1,recoveryCopied:!1,recoveryCode:"",copied:!1,downloaded:!1}},beforeMount(){this.getRequiredPass()},methods:{getUserData(){return!0},getRequiredPass(){this.loading=!0,_.get("/show/verify-password").then(t=>{this.passwordVerified=!0,this.getRecoveryCode()}).catch(t=>{this.showPasswordVerify=!0,this.loading=!1})},getRecoveryCode(){this.loading=!0,_.post("/2fa-recovery-code").then(t=>{this.recoveryCode=t.data.data.code,this.loading=!1}).catch(t=>{this.loading=!1})},printRecovery(){var t=window.open("","","left=0,top=0,width=800,height=600,toolbar=0,scrollbars=0,status=0");t.document.write(this.recoveryCode),t.document.close(),t.focus(),t.print(),setTimeout(function(){t.close()},5)},copyToClipboard(){E(this.recoveryCode),this.copied=!0,this.showCopyIconAfterCopying()},showCopyIconAfterCopying(){setTimeout(()=>{this.copied=!1},5e3)},downloadCodes(){this.downloaded=!0,setTimeout(()=>{this.downloaded=!1},5e3)},afterCopy(){this.recoveryCopied=!0,this.getBarCode()},isValid(){const{errors:t,isValid:l}=K(this.$data);return l},getBarCode(){this.loading=!0,_.post("/2fa/enable").then(t=>{this.factorData=t.data.data,this.loading=!1}).catch(t=>{this.loading=!1})},onChange(t,l){this[l]=t},validatePass(){this.verifyLoader=!0;const t={};t.password=this.password,_.post("/verify/password",t).then(l=>{this.passwordVerified=!0,this.verifyLoader=!1,this.getRecoveryCode()}).catch(l=>{this.passwordVerified=!1,this.verifyLoader=!1,this.$store.dispatch("setValidationError",{password:"This field is Required."})})},passCode(){this.showBarcode=!1,this.showPasscode=!0},barCode(){this.showPasscode=!1,this.showBarcode=!0,this.pass_code=""},keyCode(){this.showBarcode=!1,this.showPasscode=!1,this.showKeycode=!0},keyCodeReverse(){this.showBarcode=!0,this.showPasscode=!1,this.showKeycode=!1},validatePassCode(){if(this.isValid()){this.verifyLoader=!0;const t={};t.totp=this.pass_code,_.post("/2fa/setupValidate",t).then(l=>{window.emitter.emit("updateEditData",!0),this.codeVerified=!0,this.verifyLoader=!1}).catch(l=>{this.verifyLoader=!1,this.$store.dispatch("setValidationError",{pass_code:"Wrong code. Try again"})})}},triggerEvent(t){var l=t.which||t.keyCode;l===13&&(this.passwordVerified||this.validatePass(),document.getElementById("pass").value!==""&&this.validatePassCode())},onDone(){this.onClose("2faDone")}},components:{"text-field":A}},N={class:"modal-title"},F={key:0,class:"text-center"},I=e("ul",{class:"col-sm-offset-3 offset-sm-2 text-left"},[e("li",null,"Get the Authenticator App from the Play Store."),e("li",null,[n("In the App select "),e("b",null,"Set up account.")]),e("li",null,[n("Choose "),e("b",null,"Scan a barcode.")])],-1),z={class:"col-sm-offset-4",id:"barcode_scan"},O=["innerHTML"],G={class:"row"},H=e("div",{class:"col-sm-8 col-sm-offset-2 offset-sm-2 text-left"},[e("ul",null,[e("li",null,[n("Tap "),e("b",null,"Menu"),n(", then "),e("b",null,"Set up account.")]),e("li",null,[n("Tap "),e("b",null,"Enter provided key.")]),e("li",null,"Enter your email address and this key : ")])],-1),W={class:"col-sm-8 col-sm-offset-2 offset-sm-2",id:"secret_key"},U=["value","keyuplistener"],Z=e("div",{class:"col-sm-8 col-sm-offset-2 offset-sm-2 text-left"},[e("ul",null,[e("li",null,[n("Make sure "),e("b",null,"Time based"),n(" is turned on, and tap "),e("b",null,"Add"),n(" to finish.")])])],-1),J={class:"col-sm-3"},Q=["disabled","keyupListener"],X=e("i",{class:"fas fa-check"},null,-1),Y={key:1},$={key:1,class:"text-left"},ee=e("p",null,"Recovery codes are used to access your account in the event you cannot receive two-factor authentication code.Copy your recovery code before continuing two-factor authentication setup. ",-1),te={class:"card card-light"},se={class:"card-header"},oe={class:"card-title"},le={class:"card-tools"},ae=["href"],ie=e("i",{class:"fas fa-download"},null,-1),re=[ie],ne={class:"card-body"},de={class:"row"},ce={class:"col-sm-6 text-center"},ue=e("p",null,[n("Treat your recovery codes with the same level of attention as you would your password! We recommend saving them with a password manager such as "),e("a",{href:"https://lastpass.com",target:"_blank"},"Lastpass"),n(", "),e("a",{href:"https://1Password.com",target:"_blank"},"1Password"),n(", or "),e("a",{href:"https://keepersecurity.com.com",target:"_blank"},"Keeper"),n(". ")],-1),he={key:1,class:"row"},fe={key:2,class:"row"},ye=["disabled","keyupListener"],_e=e("i",{class:"fas fa-check"},null,-1),we=e("i",{class:"fas fa-arrow-right"},null,-1),me=e("i",{class:"fas fa-arrow-left"},null,-1),ve=["disabled"],ge=e("i",{class:"fas fa-arrow-right"},null,-1),pe=e("i",{class:"fas fa-check"},null,-1);function be(t,l,o,p,s,r){const b=w("text-field"),S=w("reuse-loader"),P=w("custom-loader"),B=w("modal"),L=k("focus-first-input"),C=k("tooltip");return o.showModal?(a(),V(B,{key:0,showModal:o.showModal,onClose:o.onClose,containerStyle:s.containerStyle,showCloseBtn:!0},{title:m(()=>[e("h4",N,u(t.lang("setup_authenticator")),1)]),fields:m(()=>[s.loading?d("",!0):(a(),i("div",{key:0,class:h({bar_row:o.from==="client"})},[s.passwordVerified?(a(),i("div",F,[s.recoveryCopied?(a(),i(y,{key:0},[s.showBarcode&&!s.showPasscode?(a(),i(y,{key:0},[I,e("div",z,[(a(),i("svg",{innerHTML:s.factorData.image},null,8,O))]),e("a",{href:"javascript:;",id:"scan",onClick:l[0]||(l[0]=c=>r.keyCode()),style:f(o.linkStyle)},u(t.lang("cant_scan")),5)],64)):d("",!0),s.showKeycode&&!s.showBarcode&&!s.showPasscode?(a(),i(y,{key:1},[e("div",G,[H,e("div",W,[e("input",{type:"text",value:s.factorData.secret,keyuplistener:r.triggerEvent,class:"form-control",readonly:""},null,8,U)]),Z]),e("a",{href:"javascript:;",id:"scan",onClick:l[1]||(l[1]=c=>r.keyCodeReverse()),style:f(o.linkStyle)},u(t.lang("scan_barcode")),5)],64)):d("",!0),s.showPasscode&&!s.showBarcode?(a(),i(y,{key:2},[s.codeVerified?d("",!0):v((a(),i("div",{key:0,class:h(["row",{flex_row:o.from==="client"}])},[g(b,{label:t.lang("enter_the_code_you_see_in_the_app"),value:s.pass_code,type:"text",name:"pass_code",id:"pass",placehold:"Enter Passcode...",keyupListener:r.triggerEvent,onChange:r.onChange,classname:"col-sm-9 text-left",inputStyle:o.inputStyle},null,8,["label","value","keyupListener","onChange","inputStyle"]),e("div",J,[e("button",{type:"button",class:h(["btn",[{flex_btn:o.from==="client"},{"btn-primary  pull-right float-right":o.from!=="client"},{"btn-custom  pull-right float-right":o.from==="client"}]]),id:"pass_btn",disabled:!s.pass_code,onClick:l[2]||(l[2]=c=>r.validatePassCode()),keyupListener:r.triggerEvent,style:f(o.buttonStyle)},[X,n(" "+u(t.lang("verify")),1)],14,Q)])],2)),[[L]]),s.codeVerified?(a(),i("span",Y,u(t.lang("you_are_all_set_from_now_on_you_will_use_authenticator_to_sign_in_to_your_account")),1)):d("",!0)],64)):d("",!0)],64)):(a(),i("div",$,[ee,e("div",{class:h(o.from==="client"?"":"row")},[e("div",te,[e("div",se,[e("h3",oe,u(t.trans("recovery_codes")),1),e("div",le,[v((a(),i("a",{href:t.basePath()+"/2fa/downloadRecoveryCode",class:"btn btn-tool",target:"_blank",onClick:l[3]||(l[3]=(...c)=>r.downloadCodes&&r.downloadCodes(...c))},re,8,ae)),[[C,t.trans("download")]]),v((a(),i("button",{onClick:l[4]||(l[4]=T((...c)=>r.copyToClipboard&&r.copyToClipboard(...c),["prevent"])),class:"btn btn-tool"},[e("i",{class:h(s.copied?"fas fa-check":"fas fa-clipboard")},null,2)])),[[C,t.trans("copy")]])])]),e("div",ne,[e("div",de,[(a(!0),i(y,null,D(s.recoveryCode,c=>(a(),i("div",ce,[e("p",null,u(c),1)]))),256))])])])],2),ue]))])):d("",!0),s.showPasswordVerify&&!s.passwordVerified?(a(),V(b,{key:1,label:t.lang("to_continue_first_verify"),value:s.password,type:"password",name:"password",placehold:"Enter Password...",keyupListener:r.triggerEvent,onChange:r.onChange,classname:"col-sm-12",inputStyle:o.inputStyle,autofocus:!0},null,8,["label","value","keyupListener","onChange","inputStyle"])):d("",!0)],2)),s.loading?(a(),i("div",he,[g(S,{"animation-duration":4e3,size:60,color:o.color},null,8,["color"])])):d("",!0),s.verifyLoader?(a(),i("div",fe,[g(P,{duration:4e3,color:o.color},null,8,["color"])])):d("",!0)]),controls:m(()=>[!s.passwordVerified&&!s.codeVerified?(a(),i("button",{key:0,type:"button",class:h(["btn",[{"btn-primary pull-right float-right":o.from!=="client"},{"btn-custom  pull-right float-right":o.from==="client"}]]),disabled:!s.password,onClick:l[5]||(l[5]=c=>r.validatePass()),keyupListener:r.triggerEvent,style:f(o.buttonStyle)},[_e,n(" "+u(t.lang("validate")),1)],14,ye)):d("",!0),s.passwordVerified?(a(),i(y,{key:1},[s.recoveryCopied?(a(),i(y,{key:0},[s.showBarcode||s.showKeycode&&!s.showPasscode?(a(),i("button",{key:0,class:h(["btn",[{"btn-primary pull-right float-right":o.from!=="client"},{"btn-custom  pull-right float-right":o.from==="client"}]]),onClick:l[6]||(l[6]=c=>r.passCode()),style:f(o.buttonStyle)},[n(u(t.lang("next"))+"   ",1),we],6)):d("",!0),s.showPasscode&&!s.codeVerified?(a(),i("button",{key:1,class:h(["btn",[{"btn-primary pull-right float-right":o.from!=="client"},{"btn-custom  pull-right float-right":o.from==="client"}]]),onClick:l[7]||(l[7]=c=>r.barCode()),id:"prev_btn",style:f(o.buttonStyle)},[me,n("  "+u(t.lang("previous")),1)],6)):d("",!0)],64)):(a(),i("button",{key:1,class:h(["btn",[{"btn-primary pull-right float-right":o.from!=="client"},{"btn-custom  pull-right float-right":o.from==="client"}]]),style:f(o.buttonStyle),disabled:!(s.copied||s.downloaded),onClick:l[8]||(l[8]=(...c)=>r.afterCopy&&r.afterCopy(...c))},[n(u(t.lang("next"))+"   ",1),ge],14,ve))],64)):d("",!0),s.codeVerified?(a(),i("button",{key:2,class:h(["btn btn-custom",[{"btn-primary float-right":o.from!=="client"},{"btn-custom float-right":o.from==="client"}]]),onClick:l[9]||(l[9]=c=>r.onDone()),style:f(o.buttonStyle)},[pe,n(" "+u(t.lang("done")),1)],6)):d("",!0)]),_:1},8,["showModal","onClose","containerStyle"])):d("",!0)}const Ve=j(q,[["render",be]]);export{Ve as B};
