import{_ as C,s as S,e as P,m as N,c as A}from"../chunks/bootstrap.js";import{a as q,o as s,c as a,n as v,f as e,g as u,t as c,F as f,h as g,d as r,p as I,j as x,r as m,b as D,w as H,q as O,e as k,i as $,T as F,$ as R,v as z,x as E}from"../chunks/vendor.js";import{r as W,A as G}from"../chunks/adminRouter.js";import{S as K}from"../chunks/FormGenerator.js";import"../chunks/HelpSection.js";import"../chunks/DataTableActions.js";import"../chunks/AdminNavigationBar.js";const J={name:"help-widget",props:{from:{type:String,default:""}},data(){return{monitorClass:"monitor",btnClass:"health-monitor-section",iconClass:"prime fas fa-heartbeat",widgetOpen:!1,alertList:[],loading:!0}},beforeMount(){this.getData()},methods:{toggleHealthMonitor(){this.widgetOpen=!this.widgetOpen,this.monitorClass=this.monitorClass=="monitor"?"monitor is-visible":"monitor",this.btnClass=this.btnClass=="health-monitor-section"?"health-monitor-section is-float is-visible":"health-monitor-section",this.iconClass=this.iconClass=="prime fas fa-heartbeat"?"prime fas fa-times is-active is-visible":"prime fas fa-heartbeat"},getData(){q.get("/health/system/alerts").then(t=>{this.alertList=t.data.data,this.loading=!1}).catch(t=>{this.loading=!1})}}},V=t=>(I("data-v-7aab30ba"),t=t(),x(),t),Q={class:"health-monitor"},X={class:"health-header"},Y={class:"health-option"},Z={id:"health-head"},j=V(()=>e("i",{class:"fas fa-exclamation-triangle text-white","aria-hidden":"true"},null,-1)),tt={class:"health-body card-danger-outline-left"},et={class:"card mb-2 red-body"},st={class:"card-body p-2"},at=V(()=>e("i",{class:"fas fa-exclamation-triangle","aria-hidden":"true"},null,-1)),ot=["innerHTML"],lt=V(()=>e("div",{class:"health-footer card-footer card-danger-outline-left pt-1"},null,-1)),nt={key:1,class:"monitor-tooltip"},it={class:"badge bg-gray alert-count"},ct={key:0,class:"health-tooltip"},ht={class:"health-tooltip-p"};function dt(t,o,l,b,i,_){return s(),a("div",Q,[i.widgetOpen?(s(),a("div",{key:0,class:v(i.monitorClass)},[e("div",X,[e("div",Y,[e("h5",Z,[j,u(" "+c(t.trans("needing_attention")),1)])])]),e("div",tt,[(s(!0),a(f,null,g(i.alertList,p=>(s(),a("div",et,[e("div",st,[e("h6",null,[at,u(" "),e("b",null,c(p.check),1)]),e("p",{innerHTML:p.value},null,8,ot)])]))),256))]),lt],2)):r("",!0),!i.loading&&i.alertList.length?(s(),a("div",nt,[e("a",{id:"health-sidebar",class:v(i.btnClass),onClick:o[0]||(o[0]=(...p)=>_.toggleHealthMonitor&&_.toggleHealthMonitor(...p))},[e("i",{class:v(i.iconClass)},null,2),e("span",it,c(i.alertList.length>9?"9+":i.alertList.length),1)],2),i.widgetOpen?r("",!0):(s(),a("div",ct,[e("p",ht,c(t.trans("health_monitor")),1)]))])):r("",!0)])}const rt=C(J,[["render",dt],["__scopeId","data-v-7aab30ba"]]);const _t={name:"health-table-modal",props:{showModal:{type:Boolean,default:!1},onClose:{type:Function,default:()=>{}},data:{type:Object,default:()=>{}}}},ut={class:"modal-title"},pt={id:"log_desc"},mt={class:"table table-bordered table-striped"};function ft(t,o,l,b,i,_){const p=m("modal");return l.showModal?(s(),D(p,{key:0,showModal:l.showModal,onClose:l.onClose},{title:H(()=>[e("h4",ut,c(l.data.check),1)]),fields:H(()=>[e("div",pt,[e("table",mt,[e("thead",null,[e("tr",null,[(s(!0),a(f,null,g(l.data.headers,y=>(s(),a("th",null,c(y),1))),256))])]),e("tbody",null,[(s(!0),a(f,null,g(l.data.columns,y=>(s(),a("tr",null,[(s(!0),a(f,null,g(y,w=>(s(),a("td",null,c(w),1))),256))]))),256))])])])]),_:1},8,["showModal","onClose"])):r("",!0)}const gt=C(_t,[["render",ft],["__scopeId","data-v-5b7b1391"]]);const bt={name:"system-health",data(){return{loading:!1,healthData:[],viewItem:"",showModal:!1,success:{name:"successful-checks",icon:"fas fa-check",bg_class:"success",data:[]},warning:{name:"warnings",icon:"fas fa-warning",bg_class:"warning",data:[]},danger:{name:"needing-attention",icon:"fas fa-times",bg_class:"danger",data:[]}}},beforeMount(){this.getData()},methods:{openView(t){this.viewItem=t,this.showModal=!0},onClose(t){this.viewItem="",this.showModal=!1},getData(){this.loading=!0,axios.get("/health/getServerChecks").then(t=>{this.success.data=t.data.data.Ok,this.warning.data=t.data.data.Warning,this.danger.data=t.data.data.Danger,this.healthData=[this.success,this.warning,this.danger],this.loading=!1,this.getBillHealth()}).catch(t=>{this.healthData=[this.success,this.warning,this.danger],this.loading=!1})},getBillHealth(){axios.get("/health/getServerChecks/billing").then(t=>{this.success.data.push(...t.data.data.Ok),this.warning.data.push(...t.data.data.Warning),this.danger.data.push(...t.data.data.Danger),this.healthData=[this.success,this.warning,this.danger]}).catch(t=>{this.healthData=[this.success,this.warning,this.danger]})},markResolve(t,o){o&&setTimeout(()=>{window.location.reload()},1e3),this.loading=!0;let l=t.replace(this.basePath(),"");axios.get(l).then(b=>{S(b,"system-health"),this.loading=!1,this.getData()}).catch(b=>{P(b,"system-health"),this.loading=!1})}},components:{"health-table-modal":gt}},T=t=>(I("data-v-1a480722"),t=t(),x(),t),vt={class:"col-sm-12"},yt={key:1,class:"row"},kt={class:"col-md-4 col-sm-6 col-12"},wt={class:"info-box"},Ct={class:"info-box-content"},$t={class:"info-box-number"},Ht={class:"info-box-text"},Mt={class:"card-header border-0"},Lt={class:"card-title"},Dt=T(()=>e("div",{class:"card-tools"},[e("button",{type:"button",class:"btn btn-tool","data-card-widget":"collapse"},[e("i",{class:"fas fa-minus"})])],-1)),It={class:"card-body p-2",style:{display:"block"}},xt={class:"card mb-2"},Vt={class:"card-body p-2"},Tt=["href"],St={class:"fas fa-question-circle labelColor"},Pt=["innerHTML"],At={key:0},Ot=["innerHTML"],Ut={key:1},Bt=["onClick"],Nt=T(()=>e("i",{class:"fas fa-eye"},null,-1)),qt={key:3},Ft=["onClick"],Rt=T(()=>e("i",{class:"fas fa-check"},null,-1));function zt(t,o,l,b,i,_){const p=m("alert"),y=m("reuse-loader"),w=m("router-link"),M=m("health-table-modal"),L=O("tooltip");return s(),a("div",vt,[k(p,{"component-name":"system-health"}),i.loading?(s(),D(y,{key:0})):(s(),a("div",yt,[(s(!0),a(f,null,g(this.healthData,n=>(s(),a("div",kt,[e("div",wt,[e("span",{class:v("info-box-icon bg-"+n.bg_class)},[e("i",{class:v(n.icon)},null,2)],2),e("div",Ct,[e("span",$t,c(n.data.length),1),e("span",Ht,c(t.trans(n.name)),1)])]),n.data.length?(s(),a("div",{key:0,class:v("card card-"+n.bg_class+"-outline-left")},[e("div",Mt,[e("h3",Lt,[e("i",{class:v(n.icon)},null,2),u("  "+c(t.trans(n.name)),1)]),Dt]),e("div",It,[(s(!0),a(f,null,g(n.data,h=>(s(),a("div",xt,[e("div",Vt,[e("h6",null,[e("b",null,c(h.check),1),u("  "),e("a",{href:h.tool_tip_action,target:"_blank"},[$(e("i",St,null,512),[[L,h.tool_tip_lang]])],8,Tt)]),e("p",{class:v(h.check=="db_storage"?"health_trace":""),innerHTML:h.value},null,10,Pt),h.process?(s(),a("ul",At,[(s(!0),a(f,null,g(h.process,(d,B)=>(s(),a("li",null,[e("p",null,[u(c(B)+" ",1),e("span",{innerHTML:d},null,8,Ot)])]))),256))])):r("",!0),h.info?(s(),a("p",Ut,[u(c(t.trans("click_to_check"))+" ",1),k(w,{to:"/health-check/php-info"},{default:H(()=>[u(c(t.trans("php_info")),1)]),_:1})])):r("",!0),h.columns&&h.columns.length?(s(),a("button",{key:2,class:"btn btn-primary",type:"button",onClick:d=>_.openView(h)},[Nt,u(" "+c(t.trans("view_status")),1)],8,Bt)):r("",!0),h.action?(s(),a("div",qt,[h.action?(s(),a("button",{key:0,class:"btn btn-primary",type:"button",onClick:d=>_.markResolve(h.action,h.refresh?h.refresh:"")},[Rt,u(" "+c(t.trans(h.label)),1)],8,Ft)):r("",!0)])):r("",!0)])]))),256))])],2)):r("",!0)]))),256))])),k(F,{name:"modal"},{default:H(()=>[i.showModal?(s(),D(M,{key:0,onClose:_.onClose,showModal:i.showModal,data:i.viewItem},null,8,["onClose","showModal","data"])):r("",!0)]),_:1})])}const Et=C(bt,[["render",zt],["__scopeId","data-v-1a480722"]]);const Wt={name:"health-alerts",data(){return{alertData:[],moduleLoad:!1,updateLoad:!1}},beforeMount(){this.getAlertData()},computed:{...R(["formattedTime"])},methods:{getAlertData(){this.moduleLoad=!0,axios.get("/health/check/alerts").then(t=>{this.alertData=t.data.data,this.alertData.filter(o=>o.field=="number").forEach(o=>{let l=o.value.split(" ");o.value=l[0],o.type=l[1]}),this.moduleLoad=!1}).catch(t=>{this.moduleLoad=!1})},checkValue(t){t=t||window.event;let o=t.which?t.which:t.keyCode;if(o>31&&(o<48||o>57))t.preventDefault();else return!0},onPaste(t){t=t||window.event,t.preventDefault()},updateAlerts(t){this.updateLoad=!0;let o={};o.alerts=t.map(l=>({check_id:l.id,value:l.type?(l.value?l.value:1)+" "+l.type:l.value,display:l.display?1:0})),axios.post("/api/health/alerts",o).then(l=>{S(l,"health-alerts"),this.updateLoad=!1,this.getAlertData()}).catch(l=>{P(l,"health-alerts"),this.updateLoad=!1})}},components:{"status-switch":K}},U=t=>(I("data-v-b536ab16"),t=t(),x(),t),Gt={class:"col-sm-12"},Kt={key:0,class:"row"},Jt={key:1,class:"row mt-5"},Qt={key:2,class:"card card-light"},Xt={class:"card-header"},Yt={class:"card-title"},Zt={class:"card-body"},jt={class:"row"},te={class:"col-sm-12"},ee={class:"row p-2"},se={class:"table border"},ae=["title"],oe=U(()=>e("i",{class:"fas fa-question-circle tic-pop-i h-check"},null,-1)),le=[oe],ne={class:"d-flex"},ie=["onUpdate:modelValue","disabled"],ce=["onUpdate:modelValue","disabled"],he=["value"],de={key:0,class:"card-footer"},re=U(()=>e("i",{class:"fas fa-sync-alt"},null,-1));function _e(t,o,l,b,i,_){const p=m("alert"),y=m("custom-loader"),w=m("reuse-loader"),M=m("toggle"),L=O("tooltip");return s(),a("div",Gt,[k(p,{componentName:"health-alerts"}),i.updateLoad?(s(),a("div",Kt,[k(y,{duration:4e3})])):r("",!0),i.moduleLoad?(s(),a("div",Jt,[k(w,{"animation-duration":4e3,color:"#1d78ff",size:60})])):(s(),a("div",Qt,[e("div",Xt,[e("h3",Yt,c(t.trans("alerts")),1)]),e("div",Zt,[e("div",jt,[e("div",te,[e("div",ee,[e("table",se,[e("thead",null,[e("tr",null,[e("th",null,c(t.trans("title")),1),e("th",null,c(t.trans("value")),1),e("th",null,c(t.trans("action")),1)])]),e("tbody",null,[(s(!0),a(f,null,g(i.alertData,(n,h)=>(s(),a("tr",{key:h},[e("td",null,[u(c(t.trans(n.check))+" ",1),n.type?$((s(),a("span",{key:0,class:"health-tool",title:n.type},le,8,ae)),[[L,n.type]]):r("",!0)]),e("td",ne,[n.field=="number"?$((s(),a("input",{key:0,type:"number",min:"0","onUpdate:modelValue":d=>n.value=d,max:"999",class:"form-control ml_3",onKeypress:o[0]||(o[0]=(...d)=>_.checkValue&&_.checkValue(...d)),onPaste:o[1]||(o[1]=(...d)=>_.onPaste&&_.onPaste(...d)),placeholder:"1",disabled:!n.display},null,40,ie)),[[z,n.value]]):r("",!0),u("  "),n.field=="select"?$((s(),a("select",{key:1,name:"alert-select","onUpdate:modelValue":d=>n.value=d,class:"form-control",disabled:!n.display},[(s(!0),a(f,null,g(n.option,d=>(s(),a("option",{value:d},c(d),9,he))),256))],8,ce)),[[E,n.value]]):r("",!0)]),e("td",null,[k(M,{modelValue:n.display,"onUpdate:modelValue":d=>n.display=d,class:"toggle-switch mt-2"},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])])])])])]),i.updateLoad?r("",!0):(s(),a("div",de,[e("button",{class:"btn btn-primary float-right",onClick:o[2]||(o[2]=n=>_.updateAlerts(i.alertData))},[re,u(" "+c(t.trans("update")),1)])]))]))])}const ue=C(Wt,[["render",_e],["__scopeId","data-v-b536ab16"]]);const pe={data(){return{phpInfo:""}},created(){this.fetchPhpInfo()},methods:{fetchPhpInfo(){axios.get("/health/php/info").then(t=>{this.phpInfo=t.data}).catch(t=>{console.error(t)})}}},me={class:"col-sm-12 text-md php-info"},fe=["innerHTML"];function ge(t,o,l,b,i,_){return s(),a("div",me,[e("div",{innerHTML:i.phpInfo},null,8,fe)])}const be=C(pe,[["render",ge]]);N("health-monitor",rt,"layout-loaded","monitoring-system-status");let ve={path:"/health-check",component:G,name:"Health",redirect:"/health-check/settings",children:[{path:"settings",name:"Health Check Settings",component:Et,meta:{title:"health-check",crumb:{link:{name:"admin_panel",to:"/"},active:"health-check"}}},{path:"alerts",name:"Health Check Alerts",component:ue,meta:{title:"health-check-alerts",crumb:{link:{name:"admin_panel",to:"/"},active:"health-check-alerts"}}},{path:"php-info",name:"Health Check PHP Info",component:be,meta:{title:"health-check",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"health-check",to:"/health-check/settings"},active:"php-info"}}}]};W.addRoute(ve);A.dispatch("deleteUser");A.dispatch("updateUser");
