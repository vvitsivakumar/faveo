import{f as O,M as wt,s as A,e as k,_ as D,p as G,V as Z,l as Q,c as tt,O as kt,P as Dt,j as nt,D as St,Q as X,U as $t,T as It,k as Ot,S as Rt,G as Tt}from"../chunks/bootstrap.js";import{a1 as rt,r as c,o as r,b as f,w as $,f as s,t as d,c as l,d as h,e as m,g as I,a as C,u as lt,m as dt,q as U,F as x,h as L,n as M,i as T,p as E,j as q,x as xt,s as Ft,D as ct,y as Lt,ab as F,ac as N,ad as et,ae as ut,af as B,ag as H,ah as W,ai as z,aj as ht,ak as pt,al as At,am as Ut,an as Pt,ao as Mt,ap as jt,aq as Et,C as qt,ar as Vt,G as Nt}from"../chunks/vendor.js";import{a as mt,c as _t,u as Bt,r as Ht,A as Wt}from"../chunks/agentRouter.js";import{S as gt,t as ft,h as Y,g as yt,c as zt,p as Kt,d as Yt,_ as Jt}from"../chunks/SDReports.js";import{C as Xt,T as at}from"../chunks/FormGenerator.js";import{a as Gt,e as Zt}from"../chunks/DataTableActions.js";import{r as Qt,A as te}from"../chunks/adminRouter.js";import"../chunks/HelpSection.js";import"../chunks/LoginLogs.js";import"../chunks/BarcodeModal.js";import"../chunks/TicketsIndex.js";import"../chunks/Loader.js";import"../chunks/approvalTicketRules.js";import"../chunks/PermaLink.js";import"../chunks/AdminNavigationBar.js";const ee=(t={})=>{let e=[];for(const a in t)if(t.hasOwnProperty(a)&&bt(t[a])){let n={};n.key=a,n.value=t[a],e.push(n)}return e},st=(t={})=>{let e={};for(const a in t)t.hasOwnProperty(a)&&bt(t[a])&&(e[a]=t[a]);return e},bt=t=>t===0||O(t),ae=(t="n*1")=>{const e=t.split("*")[1];return"col-md-"+12/Number(e)},se={class:"modal-title"},oe={key:0},re={key:1,class:"row"},ie=s("i",{class:"fas fa-trash"},null,-1),ne={__name:"ReportDeleteModal",props:{showModal:{type:Boolean,default:!1},onClose:{type:Function},reportId:{type:Number,default:""},reportType:{type:String,default:""},type:{type:String,default:""}},emits:["refreshReportHomePage"],setup(t,{emit:e}){const a=t,n=rt(!1),o=rt({width:"500px"}),i=()=>{n.value=!0;let u="";u=a.reportType==="ServiceDesk Analysis"?"service-desk/api/report/delete/":"api/report/",C.delete(u+a.reportId).then(p=>{n.value=!1,a.onClose(),window.emitter.emit("refreshReportHomePage",a.type),window.emitter.emit("updateAgentSidebar"),A(p,"report-home-page")}).catch(p=>{a.onClose(),k(p,"report-home-page"),n.value=!1})};return(u,p)=>{const v=c("reuse-loader");return t.showModal?(r(),f(wt,{key:0,showModal:t.showModal,onClose:t.onClose,containerStyle:o.value},{title:$(()=>[s("h4",se,d(u.trans("delete")),1)]),fields:$(()=>[n.value?h("",!0):(r(),l("span",oe,d(u.trans("are_you_sure_you_want_to_delete_this_report")),1)),n.value?(r(),l("div",re,[m(v,{duration:4e3})])):h("",!0)]),controls:$(()=>[s("button",{type:"button",id:"submit_btn",onClick:i,class:"btn btn-danger"},[ie,I(" "+d(u.trans("delete")),1)])]),_:1},8,["showModal","onClose","containerStyle"])):h("",!0)}}};const le={name:"report-home-page",components:{SaveReportModal:gt,"report-delete-modal":ne},setup(){const t=lt();return{formattedTime:dt(()=>t.getters.formattedTime)}},data:()=>({reportList:[],isLoading:!1,showDeleteModal:!1,showEditModal:!1,reportData:"",reportId:"",reportType:"",refreshReport:!1,from:"",type:""}),beforeMount(){let t=window.location.pathname;this.type="";const e=t.indexOf("/reports/");e!==-1&&(this.type=t.substring(e+9)),this.getReportList(this.type)},created(){window.emitter.on("refreshReportHomePage",()=>this.refreshReport=!0)},methods:{viewReport(t){return t.replace(/^\/?reports\//,"")},editReport(t,e){this.from=e==="ServiceDesk Analysis"?"sd_report_home":"report-list";let a={};a.include_filters=1,C.get("api/agent/report-config/"+t,{params:a}).then(n=>{this.reportData=n.data.data,this.showEditModal=!0}).catch(n=>{k(n,"report-home-page")}).finally(n=>{this.isLoading=!1})},getIconClass(t){return t=="fa fa-support fa-stack-1x"?"fas fa-life-ring fa-stack-1x":t=="fa fa-bank fa-stack-1x"?"fas fa-university  fa-stack-1x":t},getReportList(t){let e="";(t==="public"||t==="private"||t==="default")&&(e=`is_${t}=1`),this.isLoading=!0,C.get(`api/agent/report-list?${e}`).then(a=>{a.data.data?this.reportList=a.data.data:this.$router.push({path:"/reports"})}).catch(a=>{k(a,"report-home-page")}).finally(a=>{this.isLoading=!1})},subString(t,e){return G(t,e)},deleteCustomReport(t,e){this.reportId=t,this.reportType=e,this.showDeleteModal=!0},onClose(){this.showEditModal=!1},closeDeleteModal(){this.showDeleteModal=!1}},watch:{refreshReport(t,e){t===!0&&this.getReportList(this.type),this.refreshReport=!1}}},ot=t=>(E("data-v-87812038"),t=t(),q(),t),de={class:"col-sm-12"},ce={key:1},ue={class:"card-header"},he={class:"card-title"},pe={class:"card-body"},me={class:"row"},_e={class:"card report-body bg-light d-flex flex-fill"},ge={class:"card-header text-muted border-bottom-0 pb-0 row"},fe={class:"card-title col-sm-12"},ye={class:"row"},be={class:"col-sm-11 p-0"},ve={class:"fa-stack fa-1x resize-icon"},Ce={class:"badge-style"},we={key:0,class:"badge badge-info"},ke={key:1,class:"badge badge-success"},De={key:2,class:"badge badge-danger"},Se={class:"col-sm-1 p-0"},$e={class:"card-tools float-right"},Ie={class:"btn-group"},Oe={key:0,type:"button",class:"btn btn-tool","data-toggle":"dropdown"},Re=ot(()=>s("i",{class:"fas fa-ellipsis-v"},null,-1)),Te=[Re],xe={class:"dropdown-menu dropdown-menu-right custom-dropdown-menu"},Fe=["onClick"],Le=ot(()=>s("i",{class:"fas fa-edit"},null,-1)),Ae=["onClick"],Ue=ot(()=>s("i",{class:"fas fa-trash"},null,-1)),Pe={class:"card-body pt-1"},Me={class:"row"},je={class:"col-sm-12"},Ee={class:"text-muted text-sm"};function qe(t,e,a,n,o,i){const u=c("alert"),p=c("custom-loader"),v=c("router-link"),_=c("save-report-modal"),R=c("report-delete-modal"),S=U("tooltip");return r(),l("div",de,[m(u,{componentName:"report-home-page"}),t.isLoading?(r(),f(p,{key:0,duration:4e3})):h("",!0),t.reportList.length>0?(r(),l("div",ce,[(r(!0),l(x,null,L(t.reportList,y=>(r(),l("div",{class:"card card-light",key:y.id},[s("div",ue,[s("h3",he,d(y.category),1)]),s("div",pe,[s("div",me,[(r(!0),l(x,null,L(y.reports,b=>(r(),l("div",{class:"col-sm-4",key:b.id},[s("div",_e,[s("div",ge,[s("div",fe,[s("div",ye,[s("div",be,[s("div",ve,[s("i",{class:M(i.getIconClass(b.icon_class))},null,2)]),m(v,{to:i.viewReport(b.view_url),class:"text-header"},{default:$(()=>[s("b",null,d(b.name),1)]),_:2},1032,["to"]),s("sup",Ce,[b.is_default?(r(),l("span",we,d(t.lang("default")),1)):b.is_public?(r(),l("span",ke,d(t.lang("public")),1)):(r(),l("span",De,d(t.lang("private")),1))])]),s("div",Se,[s("div",$e,[s("div",Ie,[s("span",null,[b.is_default?h("",!0):T((r(),l("button",Oe,Te)),[[S,t.trans("action")]]),s("div",xe,[s("a",{class:"dropdown-item text-dark",href:"javascript:;",onClick:w=>i.editReport(b.id,b.category)},[Le,I(" "+d(t.trans("edit")),1)],8,Fe),s("a",{class:"dropdown-item text-dark",href:"javascript:;",onClick:w=>i.deleteCustomReport(b.id,b.category)},[Ue,I(" "+d(t.trans("delete")),1)],8,Ae)])])])])])])])]),s("div",Pe,[s("div",Me,[s("div",je,[s("p",Ee,d(i.subString(b.description,180)),1)])])])])]))),128))])])]))),128)),t.showEditModal?(r(),f(_,{key:0,"on-close":i.onClose,from:t.from,"report-data-obj":t.reportData,"modal-mode":"update"},null,8,["on-close","from","report-data-obj"])):h("",!0),t.showDeleteModal?(r(),f(R,{key:1,showModal:t.showDeleteModal,type:t.type,"on-close":i.closeDeleteModal,"report-id":t.reportId,"report-type":t.reportType},null,8,["showModal","type","on-close","report-id","report-type"])):h("",!0)])):h("",!0)])}const it=D(le,[["render",qe],["__scopeId","data-v-87812038"]]);const Ve={name:"InfiniteDropdown",props:{id:{type:String,default:""},label:{type:String,default:""},api:{type:String,default:""},limit:{type:Number,default:10},nameKey:{type:String,default:"name"},eventKey:{type:String,required:!0}},mounted(){const t=document.querySelector("#infinite-list");t&&t.addEventListener("scroll",e=>{t.scrollTop+t.clientHeight>=t.scrollHeight&&this.loadMore()})},computed:{dropdownTitle(){return this.selectedEntry?G(this.selectedEntry,20):this.trans(this.label)},dropdownTitleNonTruncated(){return this.selectedEntry?this.selectedEntry:this.trans(this.label)}},data(){return{loading:!1,page:1,payload:[],selectedEntry:"",searchQuery:"",lastPage:1}},methods:{async getData(){this.loading=!0;try{let t=await axios.get(`${this.api}?search_query=${this.searchQuery}&limit=${this.limit}&page=${this.page}`);this.payload=[...this.payload,...t.data.data],this.payload.map(e=>{e.is_default&&(this.selectedEntry=e.name)}),this.page=t.data.current_page,this.lastPage=t.data.last_page}catch{this.payload=null}finally{this.loading=!1}},loadMore(){this.page>=this.lastPage||(this.page++,this.getData())},itemSelected(t){this.selectedEntry=t[this.nameKey],window.emitter.emit(this.eventKey,{...t,type:this.eventKey})},dropdownItemName(t){return G(t,20)}}},Ne={class:"infinite-dropdown"},Be=["id","title"],He={id:"infinite-list",class:"dropdown-menu dropdown-menu-right",style:{"max-height":"20vh","overflow-y":"auto"}},We=["id","onClick","title"],ze={key:1,class:"dropdown-item",href:"javascript:;"};function Ke(t,e,a,n,o,i){const u=c("reuse-loader");return r(),l("div",Ne,[s("button",{type:"button",class:"btn btn-xs btn-default dropdown-toggle","data-toggle":"dropdown",onClickOnce:e[0]||(e[0]=(...p)=>i.getData&&i.getData(...p)),id:a.id,title:i.dropdownTitleNonTruncated},d(t.trans("ratings")),41,Be),s("div",He,[o.loading?(r(),f(u,{key:0,"animation-duration":4e3,color:"#1d78ff",size:20})):(r(),l(x,{key:1},[o.payload.length?(r(!0),l(x,{key:0},L(o.payload,p=>(r(),l("a",{class:M(["dropdown-item",o.selectedEntry===p[a.nameKey]?"active":""]),href:"javascript:;",key:p[a.nameKey],id:a.id,onClick:v=>i.itemSelected(p),title:p[a.nameKey]},d(i.dropdownItemName(p[a.nameKey])),11,We))),128)):(r(),l("a",ze,d(t.trans("no-records")),1))],64))])])}const Ye=D(Ve,[["render",Ke],["__scopeId","data-v-4dd871f7"]]);function Je(t){const{name:e,equation:a}=t;let n={name:[e,"isRequired","max(60)"],equation:[a,"isRequired","max(200)"]};const o=new Z(Q),{errors:i,isValid:u}=o.validate(n);return tt.dispatch("setValidationError",i),{errors:i,isValid:u}}const Xe={name:"custom-report-column",description:"handles adding custom columns in reports",props:{closeView:{type:Function,required:!0},column:{type:Object,default:()=>({})},isEditing:{type:Boolean,default:!1},addCustomColumnUrl:{type:String,required:!0},shortCodeUrl:{type:String,required:!0}},data(){return{id:0,name:"",equation:"",isTimestamp:!1,timestampFormats:["F j, Y g:i  a","Y-m-d g:i a","d-m-Y g:i a","m-d-Y g:i a","F j, Y","Y-m-d","d-m-Y","m-d-Y","g:i  a"],selectedTimestampFormat:"",loading:!1,shortCodes:[]}},beforeMount(){this.getShortCodes(),this.selectedTimestampFormat=this.timestampFormats[0],this.isEditing&&this.populateColumnData()},methods:{getTimestampExample(){return kt(Dt(this.selectedTimestampFormat))},populateColumnData(){this.id=this.column.id,this.name=this.column.label,this.equation=this.column.equation,this.isTimestamp=this.column.is_timestamp,this.selectedTimestampFormat=this.column.timestamp_format?this.column.timestamp_format:this.timestampFormats[0]},isValid(){const{errors:t,isValid:e}=Je(this.$data);return!!e},onSubmit(){if(this.isValid()){this.loading=!0;let t={name:this.name,equation:this.equation,is_timestamp:this.isTimestamp,id:this.id};this.isTimestamp&&(t.timestamp_format=this.selectedTimestampFormat),C.post(this.addCustomColumnUrl,t).then(e=>{setTimeout(()=>this.closeView(),2e3),A(e,"custom-report-column"),window.emitter.emit("refresh-report")}).catch(e=>{k(e,"custom-report-column")}).finally(e=>{this.loading=!1,this.hasDataPopulated=!0})}},getShortCodes(){C.get(this.shortCodeUrl).then(t=>{this.shortCodes=t.data.data}).catch(t=>{k(t)})},onChange(t,e){this[e]=t}},computed:{isDisabled(){return this.name===""||this.equation===""||this.loading}},components:{"text-field":nt,checkbox:Xt,"dynamic-select":St}},Ge={id:"custom-report-column"},Ze={class:"modal-title"},Qe={id:"link-container",refs:"modalBodyRef"},ta={id:"short-code-container"},ea={class:"card card-light"},aa={class:"card-header"},sa={class:"card-title"},oa={class:"card-body"},ra={key:1,id:"report-shortcode-list",class:"row"},ia={class:"col col-sm-6"},na={class:"row"},la={class:"col-sm-6"},da={for:"timestamp_format"},ca=["value"],ua=["disabled"],ha=s("span",{class:"fas fa-sync"},null,-1);function pa(t,e,a,n,o,i){const u=c("custom-loader"),p=c("alert"),v=c("loader"),_=c("text-field"),R=c("checkbox"),S=c("modal"),y=U("focus-first-input");return r(),l("div",Ge,[m(S,{showModal:!0,onClose:a.closeView,modalBodyClass:"custom-column-modal-body"},{title:$(()=>[s("h4",Ze,d(t.lang("custom_column")),1),o.loading?(r(),f(u,{key:0})):h("",!0)]),alert:$(()=>[m(p,{componentName:"custom-report-column"})]),fields:$(()=>[T((r(),l("div",Qe,[s("div",ta,[s("div",ea,[s("div",aa,[s("h3",sa,d(t.lang("list_of_available_shortcodes")),1)]),s("div",oa,[o.shortCodes.length?(r(),l("ul",ra,[(r(!0),l(x,null,L(o.shortCodes,b=>(r(),l("li",ia,d(b),1))),256))])):(r(),f(v,{key:0}))])])]),m(_,{label:t.lang("column_name"),value:o.name,name:"name",required:!0,onChange:i.onChange,placehold:t.lang("enter_a_value"),classname:"col-sm-12",hint:t.lang("report_custom_column_name_hint")},null,8,["label","value","onChange","placehold","hint"]),m(_,{label:t.lang("equation"),value:o.equation,name:"equation",required:!0,onChange:i.onChange,placehold:t.lang("enter_a_value"),classname:"col-sm-12",type:"textarea",hint:t.lang("report_custom_column_equation_hint")},null,8,["label","value","onChange","placehold","hint"]),m(R,{name:"isTimestamp",value:o.isTimestamp,label:t.lang("is_timestamp"),onChange:i.onChange,classname:"col-sm-12"},null,8,["value","label","onChange"]),T(s("div",na,[s("div",la,[s("label",da,d(t.lang("timestamp_format")),1),T(s("select",{id:"timestamp_format",class:"form-control",name:"timestamp_format","onUpdate:modelValue":e[0]||(e[0]=b=>o.selectedTimestampFormat=b)},[(r(!0),l(x,null,L(o.timestampFormats,(b,w)=>(r(),l("option",{key:w,value:b},d(b),9,ca))),128))],512),[[xt,o.selectedTimestampFormat]])]),m(_,{name:"timestamp_format_example",label:t.lang("preview"),value:i.getTimestampExample(),classname:"col-sm-6",disabled:!0,onChange:()=>{}},null,8,["label","value"])],512),[[Ft,o.isTimestamp]])])),[[y]])]),controls:$(()=>[s("button",{type:"button",id:"custom-column-submit",onClick:e[1]||(e[1]=(...b)=>i.onSubmit&&i.onSubmit(...b)),disabled:i.isDisabled,class:"btn btn-primary update-btn"},[ha,I(" "+d(t.lang("submit")),1)],8,ua)]),_:1},8,["onClose"])])}const ma=D(Xe,[["render",pa]]);const _a={name:"column-list",data(){return{loading:!1,hasDataPopulated:!1,columns:[],column:{},showAddCustomColumn:!1,isEditingCustomColumn:!1,showLoader:!1,next_page:!0,max_count:0,saveColumnsData:[]}},props:{tableColumns:{type:Array,required:!0},addCustomColumnUrl:{type:String,required:!0},deleteCustomColumnUrl:{type:String,required:!0},shortCodeUrl:{type:String,required:!0},subReportId:{type:Number,required:!0},reportIndex:{type:Number,required:!0},reportId:{type:Number,required:!0}},beforeMount(){this.hasDataPopulated=!1,this.columns=this.tableColumns,this.saveColumnsData=this.tableColumns,this.tableColumns.length>0&&this.getInitialColumns()},created(){window.emitter.on("refresh-report",this.getInitialColumns)},computed:{parsedColumns(){return this.columns.forEach(t=>{t.is_visible=!!t.is_visible}),this.columns}},methods:{getDataFromServer(){this.loading=!0,C.get("api/agent/report-columns/"+this.subReportId).then(t=>{this.columns=t.data.data,window.emitter.emit("onColumnUpdate",{columns:this.columns})}).catch(t=>{k(t,"tabular-report-layout")}).finally(t=>{this.loading=!1,this.hasDataPopulated=!0})},saveColumns(){this.columns.forEach((t,e)=>{t.order=e+1}),this.saveColumnsData.forEach(t=>{let e=this.columns.find(a=>a.id===t.id);e&&(t.order=e.order)}),this.saveColumnsData.sort((t,e)=>t.order-e.order),this.loading=!0,C.post("api/agent/report-columns/"+this.subReportId,this.saveColumnsData).then(t=>{window.emitter.emit("onReportsColumnUpdate",this.saveColumnsData),A(t,"tabular-report-layout")}).catch(t=>{k(t,"tabular-report-layout")}).finally(()=>{this.loading=!1})},onDelete(t){this.loading=!0,C.delete(this.deleteCustomColumnUrl+"/"+t).then(e=>{A(e,"tabular-report-layout"),this.getInitialColumns()}).catch(e=>{k(e,"tabular-report-layout")}).finally(()=>{this.loading=!1})},onLabelClick(t,e){this.saveColumnsData.length===1&&element.is_visible||(e.is_visible=!e.is_visible,this.handelSaveColumns(e)),this.preventToCloseBox(t)},preventToCloseBox(t){t.stopPropagation()},checkBoxClicked(t){t.is_visible=!t.is_visible,this.handelSaveColumns(t)},onEdit(t){this.showAddCustomColumn=!0,this.isEditingCustomColumn=!0,this.column=t},hideCustomColumn(){this.showAddCustomColumn=!1,this.isEditingCustomColumn=!1,this.column={}},getInitialColumns(){this.columns=[],this.page=1,this.getColumns()},getColumns(t,e=!1){this.showLoader=!0,C.get("api/agent/report-columns/paginate/"+this.reportId,{params:{page:this.page}}).then(a=>{this.max_count=a.data.data.max_count,e?this.columns=a.data.data.report_columns.data:this.columns.push(...a.data.data.report_columns.data),this.columns.map(n=>{n.is_visible=!!n.is_visible}),t&&t.loaded(),this.next_page=a.data.data.report_columns.next_page_url!==null,this.next_page?this.page++:t&&t.complete(),this.showLoader=!1}).catch(a=>{this.showLoader=!1,k(a,"tabular-report-layout")})},handelSaveColumns(t){const e=this.saveColumnsData.findIndex(a=>a.id===t.id);e===-1&&t.is_visible?this.saveColumnsData.push(t):e!==-1&&!t.is_visible&&this.saveColumnsData.splice(e,1)}},components:{"custom-column":ma,"draggable-element":ct}},P=t=>(E("data-v-ca6cfa7c"),t=t(),q(),t),ga={id:"column-list"},fa={class:"btn-group float-right"},ya={type:"button",class:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-expanded":"true",id:"dropdown-menu-columns"},ba=P(()=>s("i",{class:"fas fa-columns"},null,-1)),va={class:"dropdown-menu dropdown-menu-right",role:"menu","x-placement":"bottom-end","aria-labelledby":"dropdown-menu-columns",id:"scrollable-ul"},Ca=["onClick","value","onUpdate:modelValue","disabled"],wa=["onClick"],ka=["onClick"],Da=P(()=>s("i",{class:"fas fa-trash"},null,-1)),Sa=[Da],$a=["onClick"],Ia=P(()=>s("i",{class:"fas fa-edit"},null,-1)),Oa=[Ia],Ra=P(()=>s("i",{class:"fas fa-arrows-alt-v","aria-hidden":"true"},null,-1)),Ta=[Ra],xa=P(()=>s("span",null,null,-1)),Fa=P(()=>s("span",null,null,-1)),La={key:1,class:"mb-3"},Aa={class:"column-list-btn-element",slot:"footer"},Ua=["disabled"],Pa=P(()=>s("i",{class:"fas fa-sync"},null,-1)),Ma=P(()=>s("i",{class:"glyphicon glyphicon-plus"},null,-1));function ja(t,e,a,n,o,i){const u=c("draggable-element"),p=c("infinite-loading"),v=c("reuse-loader"),_=c("custom-column"),R=c("custom-loader"),S=U("tooltip");return r(),l("span",ga,[s("div",fa,[s("button",ya,[ba,I(" "+d(t.lang("columns")),1)]),s("div",va,[m(u,{list:i.parsedColumns,handle:".drag-btn",class:"report-column-element",itemKey:"id"},{item:$(({element:y,index:b})=>[(r(),l("a",{href:"javascript:;",class:"dropdown-item report-column-list",key:y.id},[T(s("input",{type:"checkbox",class:"form-check-input",onClick:w=>i.checkBoxClicked(y),value:y.key,"onUpdate:modelValue":w=>y.is_visible=w,disabled:o.saveColumnsData.length===1&&y.is_visible},null,8,Ca),[[Lt,y.is_visible],[S,o.saveColumnsData.length===1&&y.is_visible?t.trans("atleast_one_column_needs_to_be_selected"):""]]),T((r(),l("span",{onClick:w=>i.onLabelClick(w,y),class:"column-label"},[I("  "+d(y.label),1)],8,wa)),[[S,y.hover?y.hover:""]]),y.is_custom?(r(),l("button",{key:0,class:"btn btn-danger btn-xs float-right",onClick:()=>i.onDelete(y.id)},Sa,8,ka)):h("",!0),y.is_custom?(r(),l("button",{key:1,class:"btn btn-primary btn-xs float-right margin-horizontal-5",onClick:()=>i.onEdit(y)},Oa,8,$a)):h("",!0),s("span",{class:"float-right margin-horizontal-5 drag-btn",title:"Move this column",onClick:e[0]||(e[0]=(...w)=>i.preventToCloseBox&&i.preventToCloseBox(...w))},Ta)]))]),_:1},8,["list"]),o.next_page&&!o.showLoader?(r(),f(p,{key:0,onInfinite:i.getColumns},{spinner:$(()=>[xa]),complete:$(()=>[Fa]),_:1},8,["onInfinite"])):h("",!0),o.showLoader?(r(),l("div",La,[m(v,{"animation-duration":4e3,size:20})])):h("",!0),s("div",Aa,[T((r(),l("button",{type:"button",id:"save-columns",class:"btn btn-sm btn-primary mb-1",onClick:e[1]||(e[1]=(...y)=>i.saveColumns&&i.saveColumns(...y)),disabled:o.saveColumnsData.length>o.max_count},[Pa,I(" "+d(t.lang("apply")),1)],8,Ua)),[[S,o.saveColumnsData.length>o.max_count&&!o.showLoader?t.trans("column-tooltip")+o.max_count+" "+t.trans("columns"):""]]),s("button",{class:"btn btn-sm btn-primary mb-1",id:"add-custom-column",onClick:e[2]||(e[2]=()=>o.showAddCustomColumn=!0)},[Ma,I(" "+d(t.lang("add_custom_column")),1)])])])]),o.showAddCustomColumn?(r(),f(_,{key:0,"add-custom-column-url":a.addCustomColumnUrl,"short-code-url":a.shortCodeUrl,column:o.column,closeView:i.hideCustomColumn,isEditing:o.isEditingCustomColumn},null,8,["add-custom-column-url","short-code-url","column","closeView","isEditing"])):h("",!0),o.loading&&o.hasDataPopulated?(r(),f(R,{key:1})):h("",!0)])}const Ea=D(_a,[["render",ja],["__scopeId","data-v-ca6cfa7c"]]);const qa={name:"tabular-report-layout",description:"Common layout component for tabular reports",props:{dataUrl:{type:String,required:!0},tableColumns:{type:Array,required:!0},exportUrl:{type:String,required:!0},subReportId:{type:Number,required:!0},addCustomColumnUrl:{type:String,required:!0},deleteCustomColumnUrl:{type:String,required:!0},shortCodeUrl:{type:String,required:!0},filterParams:{type:Object,default:()=>{}},reportIndex:{type:Number,required:!0},reportId:{type:Number,required:!0}},data(){return{isLoading:!1,columns:[],visibleColumns:{},show_pagination:!0}},created(){window.emitter.on("onReportsColumnUpdate",this.onColumnUpdate)},beforeMount(){this.columns=this.tableColumns,this.updateVisibleColumns()},methods:{onColumnUpdate(t){this.columns=t,this.updateVisibleColumns()},updateVisibleColumns(){this.visibleColumns={},this.columns.map(t=>{O(t.is_visible)&&(this.visibleColumns[t.key]=t.label)})}},components:{"ticket-filter":at,"dynamic-datatable":mt,"column-list":Ea}},Va={class:"tabular-layout"},Na={class:"column-list-right"};function Ba(t,e,a,n,o,i){const u=c("alert"),p=c("column-list"),v=c("dynamic-datatable");return r(),l("div",Va,[m(u,{componentName:"tabular-report-layout"}),s("div",Na,[m(p,{"table-columns":o.columns,"sub-report-id":a.subReportId,"add-custom-column-url":a.addCustomColumnUrl,"delete-custom-column-url":a.deleteCustomColumnUrl,"short-code-url":a.shortCodeUrl,"report-index":a.reportIndex,"report-id":a.reportId},null,8,["table-columns","sub-report-id","add-custom-column-url","delete-custom-column-url","short-code-url","report-index","report-id"])]),s("div",null,[o.columns.length?(r(),f(v,{key:0,show_pagination:o.show_pagination,"data-url":a.dataUrl,columns:o.visibleColumns,columnsMeta:o.columns,filterParams:a.filterParams},null,8,["show_pagination","data-url","columns","columnsMeta","filterParams"])):h("",!0)])])}const Ha=D(qa,[["render",Ba],["__scopeId","data-v-5ea837ff"]]);F.register(N,et,ut,B,H,W);F.register(z);const Wa={name:"App",props:{chartData:{type:Object},redirectUrls:{type:Array,default:()=>[]},chartOptions:{type:Object,default:null},labelString:{type:String,default:()=>""},chartId:{type:String,required:!0},chartTitle:{type:Object,default:function(){return{display:!1}}}},components:{Bar:ht},data(){return{options:{responsive:!0,title:this.chartTitle,plugins:{datalabels:{color:"#000",anchor:"end",clamp:!0,align:"top"},legend:!1},layout:{padding:{left:0,right:0,top:24,bottom:0}},scales:{y:{beginAtZero:!0,title:{display:!0,text:this.labelString},border:{display:!1},grid:{display:!0,drawOnChartArea:!0,drawTicks:!0},ticks:{precision:0}},x:{border:{display:!1},grid:{display:!0,drawOnChartArea:!0,drawTicks:!0},ticks:{callback:function(t,e){return ft(this.getLabelForValue(t))}}}},maintainAspectRatio:!1,onClick:this.clickHandler,onHover:this.onHover}}},beforeMount(){this.chartOptions!==null&&(this.options=this.chartOptions)},mounted(){setTimeout(()=>{F.defaults.plugins.datalabels.display=!0},1e3)},methods:{clickHandler(t,e){if(O(e)&&O(this.redirectUrls)){const a=this.redirectUrls[e[0].index];if(O(a)){let n=JSON.parse('{"'+decodeURIComponent(a.split("?")[1]).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');this.$router.push({path:a.replace(this.basePath(),""),query:n})}}},onHover(t,e,a){Y(e,this.chartId,this.redirectUrls)}}},za={class:"h-300"};function Ka(t,e,a,n,o,i){const u=c("Bar");return r(),l("div",za,[m(u,{data:a.chartData,options:o.options,id:a.chartId},null,8,["data","options","id"])])}const Ya=D(Wa,[["render",Ka],["__scopeId","data-v-ea8a1df8"]]);F.register(N,et,ut,B,H,W);F.register(z);const Ja={name:"App",props:{chartData:{type:Object},redirectUrls:{type:Array,default:()=>[]},chartOptions:{type:Object,default:null},labelString:{type:String,default:()=>""},chartId:{type:String,required:!0},chartTitle:{type:Object,default:function(){return{display:!1}}}},components:{Bar:ht},data(){return{options:{indexAxis:"y",responsive:!0,title:this.chartTitle,plugins:{datalabels:{color:"#000",anchor:"end",clamp:!0,align:"right"},legend:!1},layout:{padding:{left:0,right:24,top:0,bottom:0}},scales:{y:{beginAtZero:!0,title:{display:!0,text:this.labelString},border:{display:!1},grid:{display:!0,drawOnChartArea:!0,drawTicks:!0}},x:{border:{display:!1},grid:{display:!0,drawOnChartArea:!0,drawTicks:!0},ticks:{precision:0,callback:function(t,e){return ft(this.getLabelForValue(t))}}}},maintainAspectRatio:!1,onClick:this.clickHandler,onHover:this.onHover}}},beforeMount(){this.chartOptions!==null&&(this.options=this.chartOptions)},mounted(){setTimeout(()=>{F.defaults.plugins.datalabels.display=!0},1e3)},methods:{clickHandler(t,e){if(O(e)&&O(this.redirectUrls)){const a=this.redirectUrls[e[0].index];if(O(a)){let n=JSON.parse('{"'+decodeURIComponent(a.split("?")[1]).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');this.$router.push({path:a.replace(this.basePath(),""),query:n})}}},onHover(t,e,a){Y(e,this.chartId,this.redirectUrls)}}},Xa={class:"h-300"};function Ga(t,e,a,n,o,i){const u=c("Bar");return r(),l("div",Xa,[m(u,{data:a.chartData,options:o.options,id:a.chartId},null,8,["data","options","id"])])}const Za=D(Ja,[["render",Ga],["__scopeId","data-v-d6e1b4c8"]]);F.register(B,H,W,pt,N);F.register(z);const Qa={components:{Doughnut:At},props:{chartId:{type:String,required:!0},chartData:{type:Object},redirectUrls:{type:Array,default:()=>[]},labelString:{type:String,default:()=>""},chartTitle:{type:Object,default:function(){return{display:!1}}}},mounted(){setTimeout(()=>{F.defaults.plugins.datalabels.display=!0},1e3)},methods:{clickHandler(t,e){if(O(e)&&O(this.redirectUrls)){const a=this.redirectUrls[e[0].index];if(O(a)){let n=JSON.parse('{"'+decodeURIComponent(a.split("?")[1]).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');this.$router.push({path:a.replace(this.basePath(),""),query:n})}}},dataLabelFormatter(t,e){return yt(t,e)},onHover(t,e){Y(e,this.chartId,this.redirectUrls)}}};function ts(t,e,a,n,o,i){const u=c("Doughnut");return r(),l("div",null,[m(u,{id:a.chartId,data:a.chartData,options:{responsive:!0,title:this.chartTitle,plugins:{datalabels:{display:"auto",color:"#6c757d",anchor:"end",clamp:!0,align:"start",offset:10,font:{weight:"bold"},formatter:this.dataLabelFormatter},legend:{display:!0,position:"top"}},maintainAspectRatio:!1,onClick:this.clickHandler,onHover:this.onHover}},null,8,["id","data","options"])])}const es=D(Qa,[["render",ts]]);F.register(B,H,W,pt,N);F.register(z);const as={components:{Pie:Ut},props:{chartId:{type:String,required:!0},chartData:{type:Object},redirectUrls:{type:Array,default:()=>[]},labelString:{type:String,default:()=>""},chartTitle:{type:Object,default:function(){return{display:!1}}}},mounted(){setTimeout(()=>{F.defaults.plugins.datalabels.display=!0},1e3)},methods:{clickHandler(t,e){if(O(e)&&O(this.redirectUrls)){const a=this.redirectUrls[e[0].index];if(O(a)){let n=JSON.parse('{"'+decodeURIComponent(a.split("?")[1]).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');this.$router.push({path:a.replace(this.basePath(),""),query:n})}}},dataLabelFormatter(t,e){return yt(t,e)},onHover(t,e){Y(e,this.chartId,this.redirectUrls)}}};function ss(t,e,a,n,o,i){const u=c("Pie");return r(),l("div",null,[m(u,{id:a.chartId,data:a.chartData,options:{responsive:!0,title:this.chartTitle,plugins:{datalabels:{display:"auto",color:"#6c757d",anchor:"end",clamp:!0,align:"start",offset:10,font:{weight:"bold"},formatter:this.dataLabelFormatter},legend:{display:!0,position:"top"}},maintainAspectRatio:!1,onClick:this.clickHandler,onHover:this.onHover}},null,8,["id","data","options"])])}const os=D(as,[["render",ss]]);F.register(N,et,Pt,Mt,B,H,W);F.register(z);const rs={components:{Line:jt},props:{chartData:{type:Object},redirectUrls:{type:Array,default:()=>[]},chartOptions:{type:Object,default:null},labelString:{type:String,default:()=>""},chartTitle:{type:Object,default:function(){return{display:!1}}},chartId:{type:String,required:!0}},data(){return{datacollection:{labels:this.chartData.labels,datasets:this.chartData.data},options:{responsive:!0,title:this.chartTitle,plugins:{datalabels:{display:!1,color:"#000",anchor:"end",clamp:!0,align:"right"}},layout:{padding:{left:0,right:0,top:24,bottom:0}},scales:{y:{beginAtZero:!0,title:{display:!0,text:this.chartData.dataLabel},border:{display:!1},grid:{display:!0,drawOnChartArea:!0,drawTicks:!0},ticks:{precision:0},min:0},x:{border:{display:!1},grid:{display:!1,drawOnChartArea:!1,drawTicks:!1},title:{display:!0,text:this.chartData.categoryLabel}}},onHover:this.onHover,maintainAspectRatio:!1,onClick:this.clickHandler}}},beforeMount(){this.chartOptions!==null&&(this.options=this.chartOptions),this.chartData.data.forEach(t=>{t.tension=.3})},mounted(){setTimeout(()=>{F.defaults.plugins.datalabels.display=!0},1e3)},methods:{clickHandler(t,e,a){if(O(e)&&O(this.chartData.redirectURLs)){const n=this.chartData.redirectURLs[e[0].datasetIndex][e[0].index];if(O(n)){let o=JSON.parse('{"'+decodeURIComponent(n.split("?")[1]).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');this.$router.push({path:n.replace(this.basePath(),""),query:o})}}},onHover(t,e){try{const a=document.getElementById(this.chartId);let n=e[0].datasetIndex;a.style.cursor="default",typeof n<"u"&&this.chartData.redirectURLs[n][e[0].index]&&(a.style.cursor="pointer")}catch{}}}},is={class:"h-300"};function ns(t,e,a,n,o,i){const u=c("Line");return r(),l("div",is,[m(u,{data:o.datacollection,options:o.options,id:a.chartId},null,8,["data","options","id"])])}const ls=D(rs,[["render",ns],["__scopeId","data-v-586ee229"]]);const ds={name:"faveo-chart",components:{BarChart:Ya,HorizontalBarChart:Za,DoughnutChart:es,PieChart:os,LineChart:ls},props:{chartData:{type:[Object,Array],required:!0},chartType:{type:String,required:!0,validator:function(t){return["bar","horizontal_bar","pie","doughnut","line","area"].indexOf(t)!==-1}}},data:function(){return{}},methods:{getCategoryChartData(){return{labels:this.chartData.labels,datasets:[{backgroundColor:X(this.chartData.labels.length),borderColor:this.chartType==="doughnut"||this.chartType==="pie"?X(this.chartData.labels.length):$t(this.chartData.labels.length),borderWidth:2,label:this.chartData.axisLabel,data:this.chartData.data,barThickness:30}]}},getTimeChartData(){let t=[],e=[];for(let a=0;a<this.chartData.data.length;a++){const n=X();let o={fill:!1,label:this.chartData.data[a].label,borderColor:n,backgroundColor:n,pointBorderColor:n,pointBackgroundColor:n,pointBorderWidth:1,pointHoverRadius:5,pointHoverBackgroundColor:"#fff",pointHoverBorderColor:n,pointHoverBorderWidth:2,pointRadius:3,pointHitRadius:5,data:this.chartData.data[a].values};t.push(o);let i=this.chartData.data[a].redirectTo;e.push(i)}return{data:t,labels:this.chartData.labels,categoryLabel:this.chartData.categoryLabel,dataLabel:this.chartData.dataLabel,redirectURLs:JSON.parse(JSON.stringify(e))}}},computed:{getChartTitleObj:function(){let t={display:!1};return this.chartData.labels.length===0&&(t={display:!0,text:"No Data Available",fontSize:14,padding:15}),t}}},cs={class:"faveo-chart"};function us(t,e,a,n,o,i){const u=c("bar-chart"),p=c("horizontal-bar-chart"),v=c("pie-chart"),_=c("doughnut-chart"),R=c("line-chart");return r(),l("div",cs,[a.chartType==="bar"?(r(),f(u,{key:0,"chart-id":a.chartData.chartId,"chart-data":i.getCategoryChartData(),"redirect-urls":a.chartData.redirectURLs,"label-string":a.chartData.axisLabel,"chart-title":i.getChartTitleObj},null,8,["chart-id","chart-data","redirect-urls","label-string","chart-title"])):h("",!0),a.chartType==="horizontal_bar"?(r(),f(p,{key:1,"chart-id":a.chartData.chartId,"chart-data":i.getCategoryChartData(),"redirect-urls":a.chartData.redirectURLs,"label-string":a.chartData.axisLabel,"chart-title":i.getChartTitleObj},null,8,["chart-id","chart-data","redirect-urls","label-string","chart-title"])):h("",!0),a.chartType==="pie"?(r(),f(v,{key:2,"chart-id":a.chartData.chartId,"chart-data":i.getCategoryChartData(),"redirect-urls":a.chartData.redirectURLs,"chart-title":i.getChartTitleObj},null,8,["chart-id","chart-data","redirect-urls","chart-title"])):h("",!0),a.chartType==="doughnut"?(r(),f(_,{key:3,"chart-id":a.chartData.chartId,"chart-data":i.getCategoryChartData(),"redirect-urls":a.chartData.redirectURLs,"chart-title":i.getChartTitleObj},null,8,["chart-id","chart-data","redirect-urls","chart-title"])):h("",!0),a.chartType==="line"?(r(),f(R,{key:4,"chart-id":a.chartData.data[0].chartId,"chart-labels":a.chartData.labels,"chart-data":i.getTimeChartData(),"redirect-urls":a.chartData.redirectURLs,"chart-title":i.getChartTitleObj},null,8,["chart-id","chart-labels","chart-data","redirect-urls","chart-title"])):h("",!0)])}const vt=D(ds,[["render",us],["__scopeId","data-v-491670a7"]]);const hs={name:"time-series-chart",components:{"faveo-chart":vt,"data-widget":_t},props:{chartDataApi:{type:String,required:!0},dataWidgetApi:{type:String,default:()=>{}},categories:{type:Array,default:()=>[]},defaultCategory:{type:String,default:()=>""},categoryPrefix:{type:String,default:()=>"view_by"},filterParams:{type:Object,default:()=>{}},reportIndex:{type:Number,required:!0}},data:()=>({chartApiData:null,isLoading:!0,chartData:{},selectedCategory:"",dataWidgetData:null}),beforeMount(){this.selectedCategory=this.defaultCategory,this.getDataFromServer()},methods:{onCategoryChange(t){this.selectedCategory=t,this.$emit("updateChangedValue",this.selectedCategory,this.reportIndex,"selected_view_by"),this.getDataFromServer()},getDataFromServer(){this.isLoading=!0,O(this.dataWidgetApi)&&C.get(this.dataWidgetApi,{params:this.getUrlParams()}).then(t=>{this.dataWidgetData=t.data.data,this.updateDataCount("widget",this.dataWidgetData)}).catch(t=>{k(t,"category-based-report")}),C.get(this.chartDataApi,{params:this.getUrlParams()}).then(t=>{this.chartApiData=t.data.data,this.processChartData(),this.updateDataCount("chart",this.chartApiData)}).catch(t=>{k(t,"category-based-report"),this.isLoading=!1})},updateDataCount(t,e){let a=!1,n=!1;t==="chart"&&(a=e.every(o=>o.data.length===0)),t==="widget"&&(n=e.every(o=>o.value===0)),this.$emit("showReports",!(a||n))},processChartData(){try{const t=zt(this.chartApiData.data);this.chartData={data:Kt(this.chartApiData.data,t),labels:t,categoryLabel:this.chartApiData.categoryLabel,dataLabel:this.chartApiData.dataLabel,panelTitle:this.chartApiData.name}}catch(t){console.error("TimeSeriesChart | processChartData ",t)}this.isLoading=!1},getUrlParams(){let t=st(this.filterParams);return t[this.categoryPrefix]=this.selectedCategory,t}},watch:{filterParams(){this.getDataFromServer()}}},ps=t=>(E("data-v-9d6450d3"),t=t(),q(),t),ms={class:"row"},_s={class:"col-md-12"},gs={class:"card card-light",id:"chart-panel-main"},fs={class:"card-header"},ys={class:"card-title"},bs={class:"card-tools"},vs={key:0,class:"btn-group"},Cs={type:"button",class:"btn btn-tool dropdown-toggle","data-toggle":"dropdown","aria-expanded":"true"},ws=ps(()=>s("i",{class:"fas fa-eye"},null,-1)),ks={class:"dropdown-menu dropdown-menu-right",role:"menu","x-placement":"bottom-end"},Ds=["onClick"],Ss={class:"card-body"},$s={key:1},Is={key:0};function Os(t,e,a,n,o,i){const u=c("loader"),p=c("data-widget"),v=c("faveo-chart");return r(),l("div",ms,[s("div",_s,[s("div",gs,[s("div",fs,[s("h3",ys,d(t.chartApiData?t.chartApiData.name:""),1),s("div",bs,[a.categories.length?(r(),l("div",vs,[s("button",Cs,[ws,I(" "+d(t.lang(a.categoryPrefix))+" ",1),s("label",null,d(t.lang(t.selectedCategory)),1)]),s("div",ks,[(r(!0),l(x,null,L(a.categories,(_,R)=>(r(),l("a",{key:R,class:M([t.selectedCategory===_?"active text-light":"text-dark","dropdown-item"]),onClick:S=>i.onCategoryChange(_),href:"javascript:;"},d(t.lang(a.categoryPrefix)+t.lang(_)),11,Ds))),128))])])):h("",!0)])]),s("div",Ss,[t.isLoading?(r(),f(u,{key:0})):(r(),l("div",$s,[a.dataWidgetApi?(r(),l("section",Is,[m(p,{"data-widget-data":t.dataWidgetData},null,8,["data-widget-data"])])):h("",!0),m(v,{"chart-data":t.chartData,"chart-type":"line"},null,8,["chart-data"])]))])])])])}const Ct=D(hs,[["render",Os],["__scopeId","data-v-9d6450d3"]]);const Rs={name:"category-based-report",components:{"ticket-filter":at,"time-series-chart":Ct,"faveo-chart":vt,"data-widget":_t},props:{categoryChartDataApi:{type:String,default:()=>""},timeSeriesChartDataApi:{type:String,default:()=>""},widgetDataApi:{type:String,default:()=>{}},categories:{type:Array,default:()=>[]},defaultCategory:{type:[Number,String],default:()=>{}},categoryPrefix:{type:String,default:""},defaultChartType:{type:String,default:"bar"},layoutClass:{type:String,required:!0},filterParams:{type:Object,default:()=>{}},reportIndex:{type:Number,required:!0}},data:()=>({selectedChartType:"",selectedCategory:"",chartTypes:["bar","horizontal_bar","pie","doughnut"],isLoading:!0,chartApiData:null,dataWidgetData:null,reportId:null}),beforeMount(){this.selectedCategory=this.defaultCategory,this.selectedChartType=this.defaultChartType,this.getDataFromServer()},methods:{getColumnClass(){return getColumnClass()},getDataFromServer(){this.isLoading=!0,O(this.widgetDataApi)&&C.get(this.widgetDataApi,{params:this.getUrlParams()}).then(t=>{this.dataWidgetData=t.data.data,this.updateDataCount("widget",this.dataWidgetData)}).catch(t=>{k(t,"category-based-report")}),C.get(this.categoryChartDataApi,{params:this.getUrlParams()}).then(t=>{this.chartApiData=Yt(t.data.data),this.isLoading=!1,this.updateDataCount("chart",this.chartApiData)}).catch(t=>{k(t,"category-based-report")})},updateDataCount(t,e){let a=!1,n=!1;t==="chart"&&(a=e.every(o=>o.data.length===0)),t==="widget"&&(n=e.every(o=>o.value===0)),this.$emit("showReports",!(a||n))},onCategoryChange(t){this.selectedCategory=t,this.$emit("updateChangedValue",this.selectedCategory,this.reportIndex,"selected_view_by"),this.getDataFromServer()},onChangeChartType(t){this.selectedChartType=t,this.$emit("updateChangedValue",this.selectedChartType,this.reportIndex,"selected_chart_type")},getUrlParams(){let t=st(this.filterParams);return typeof this.categoryPrefix<"u"&&(t[this.categoryPrefix]=this.selectedCategory),t}},watch:{filterParams(){this.getDataFromServer()}}},Ts={class:"row mb-3"},xs={class:"col-sm-12"},Fs={key:0,class:"btn-group float-right"},Ls={type:"button",class:"btn btn-sm btn-default dropdown-toggle text-capitalize","data-toggle":"dropdown",id:"category-dropdown"},As={class:"dropdown-menu dropdown-menu-right",style:{},"aria-labelledby":"category-dropdown"},Us=["onClick"],Ps={class:"float-right btn-group"},Ms={class:"btn btn-sm btn-default dropdown-toggle",id:"chart-type-dropdown","data-toggle":"dropdown"},js={class:"dropdown-menu dropdown-menu-right",style:{},"aria-labelledby":"chart-type-dropdown"},Es=["onClick"],qs={class:"data-widget"},Vs={class:"row"},Ns={class:"card card-light"},Bs={class:"card-header"},Hs={class:"card-title"},Ws={class:"card-body"};function zs(t,e,a,n,o,i){const u=c("loader"),p=c("data-widget"),v=c("faveo-chart");return r(),l("div",null,[t.isLoading?(r(),f(u,{key:0,duration:4e3})):h("",!0),s("div",Ts,[s("div",xs,[a.categories&&a.categories.length?(r(),l("div",Fs,[s("button",Ls,d(t.lang(a.categoryPrefix))+" "+d(t.selectedCategory),1),s("div",As,[(r(!0),l(x,null,L(a.categories,(_,R)=>(r(),l("a",{key:R,class:M(["dropdown-item text-capitalize",t.selectedCategory===_?"active":""]),onClick:S=>i.onCategoryChange(_),href:"javascript:;"},d(t.lang(a.categoryPrefix))+" "+d(_),11,Us))),128))])])):h("",!0),s("div",Ps,[s("button",Ms,d(t.lang("chart_type")),1),s("div",js,[(r(!0),l(x,null,L(t.chartTypes,_=>(r(),l("a",{key:_,class:M(["dropdown-item",t.selectedChartType===_?"active":""]),href:"javascript:;",onClick:R=>i.onChangeChartType(_)},d(t.lang(a.categoryPrefix))+" "+d(t.lang(_)),11,Es))),128))])])])]),s("div",qs,[a.widgetDataApi?(r(),f(p,{key:0,"data-widget-data":t.dataWidgetData},null,8,["data-widget-data"])):h("",!0)]),s("div",Vs,[(r(!0),l(x,null,L(t.chartApiData,_=>(r(),l("div",{class:M(a.layoutClass),key:_.id},[s("div",Ns,[s("div",Bs,[s("h3",Hs,d(_.panelTitle),1)]),s("div",Ws,[m(v,{"chart-data":_,"chart-type":t.selectedChartType},null,8,["chart-data","chart-type"])])])],2))),128))])])}const Ks=D(Rs,[["render",zs],["__scopeId","data-v-36a6e65b"]]),Ys={name:"report-entry-page",components:{"ticket-filter":at,"tabular-report-layout":Ha,"time-series-chart":Ct,"category-based-report":Ks,"save-report-modal":gt,"tool-tip":It,InfiniteDropdown:Ye},data:()=>({reportConfigObj:null,clonedReportConfigOnj:null,isLoading:!0,openSaveReportModal:!1,modalMode:"",filterParams:{},isShowFilter:!1,dataCount:0,randKey:Math.floor(Math.random()*11111),customFilters:[],reportId:"",requiredPayload:[],scheduleData:"",showReport:!1,filterId:""}),beforeMount(){window.location.pathname.split("/").includes("rating-in-depth")&&this.customFilters.push({eventKey:"rating",label:this.trans("rating_default_rating"),api:"ratings-list",limit:5}),this.dashboardInit()},created(){window.emitter.on("onReportsColumnUpdate",this.onColumnUpdate),window.emitter.on("refreshReportEntryPage",this.dashboardInit),window.emitter.on("dataCount",this.getCount),window.emitter.on("rating",t=>{this.customFilterHandler(t)})},computed:{showExportButton:function(){if(this.reportConfigObj&&Array.isArray(this.reportConfigObj.sub_reports)){for(let t=0;t<this.reportConfigObj.sub_reports.length;t++)if(this.reportConfigObj.sub_reports[t].data_type==="datatable")return!0}return!1}},methods:{getCount(t){this.dataCount=t},toggleFilterView(){this.isShowFilter=!this.isShowFilter},dashboardInit(){this.getReportConfiguration(Ot(window.location.pathname))},getLayoutClass(t){return ae(t)},getReportConfiguration(t){this.isLoading=!0;let e=st(this.filterParams);e.include_filters=1,this.reportId=t,C.get("api/agent/report-config/"+t,{params:e}).then(a=>{this.reportConfigObj=a.data.data,this.scheduleData=a.data.data,this.clonedReportConfigOnj=JSON.parse(JSON.stringify(this.reportConfigObj)),this.filterId=a.data.data.filter_id,this.updateFilterObj()}).catch(a=>{k(a,"report-entry-page")}).finally(a=>{this.isLoading=!1})},updateFilterObj(){let t={};Array.isArray(this.reportConfigObj.filters)&&this.reportConfigObj.filters.forEach(e=>{t[e.key]=e.value}),this.filterParams=t},exportReport(){const t={...this.filterParams,total:this.dataCount};this.isLoading=!0,C.post(this.reportConfigObj.export_url,t).then(e=>{A(e,"tabular-report-layout")}).catch(e=>{k(e,"tabular-report-layout")}).finally(()=>{this.isLoading=!1})},forkUpdateAction(t){window.emitter.emit("performApplyAction"),this.modalMode=t,this.openSaveReportModal=!0},closeSaveReportModal(){this.openSaveReportModal=!1},setFilter(t){this.filterParams=JSON.parse(JSON.stringify(t)),this.clonedReportConfigOnj.filters=ee(this.filterParams),this.schedulePayload=this.clonedReportConfigOnj.filters},updateChangedValue(t,e,a){this.clonedReportConfigOnj.sub_reports[e][a]=t},onColumnUpdate(){window.emitter.emit("refreshData")},customFilterHandler(t){t.type==="rating"&&(this.reportConfigObj.sub_reports.forEach(e=>{let a=e.data_url,n=e.data_widget_url,o="?rating_id=",i=a.indexOf(o),u=n.indexOf(o);i>0&&(a=a.substring(0,i)),u>0&&(n=n.substring(0,u));let p=`?rating_id=${t.id}`;e.data_url=a+p,e.data_widget_url=n+p}),this.randKey++)},scheduleList(){this.requiredPayload=JSON.stringify(this.filterParams),this.$router.push({path:"/reports/schedule/add/"+this.scheduleData.type+"/"+this.reportId,query:{params:this.requiredPayload}})},async exportGraphicalReport(){const t=new FormData,e=document.getElementById("hd-report-template"),a=e.querySelectorAll(".btn-group");this.isShowFilter===!0&&(this.isShowFilter=!1),a.forEach(o=>{o.style.display="none"}),e.querySelectorAll("h3").forEach(o=>{o.style.whiteSpace="nowrap"});try{const o=await Et(e);a.forEach(p=>{p.style.display="block"});const i=await fetch(o).then(p=>p.blob());t.append("report_id",this.reportId),t.append("image",i,"report.png"),this.isLoading=!0;const u=await C.post("api/export/graphical-report",t);A(u,"report-entry-page"),this.isLoading=!1}catch(o){this.isLoading=!1,k(o,"report-entry-page")}},handleExport(t){this.showReport=t}}},Js={class:"col-sm-12",id:"hd-report-template"},Xs={key:1,class:"card card-light report-box-primary"},Gs={class:"card-header"},Zs={class:"card-title"},Qs=["href"],to={class:"card-tools"},eo={class:"btn-group"},ao=s("i",{class:"glyphicon glyphicon-filter"},null,-1),so=[ao],oo=s("i",{class:"fas fa-paper-plane","aria-hidden":"true"},null,-1),ro=[oo],io=s("i",{class:"fas fa-paper-plane","aria-hidden":"true"},null,-1),no=[io],lo=s("i",{class:"fas fa-calendar","aria-hidden":"true"},null,-1),co=[lo],uo={class:"card-body"},ho=s("i",{class:"fas fa-edit","aria-hidden":"true"},null,-1),po=s("i",{class:"fas fa-clone","aria-hidden":"true"},null,-1);function mo(t,e,a,n,o,i){const u=c("alert"),p=c("custom-loader"),v=c("tool-tip"),_=c("infinite-dropdown"),R=c("ticket-filter"),S=c("tabular-report-layout"),y=c("category-based-report"),b=c("time-series-chart"),w=c("save-report-modal"),j=U("tooltip");return r(),l("div",Js,[m(u,{componentName:"report-entry-page"}),t.isLoading?(r(),f(p,{key:0,duration:4e3})):h("",!0),t.reportConfigObj?(r(),l("div",Xs,[s("div",Gs,[s("h3",Zs,[I(d(t.reportConfigObj.name)+" ",1),t.reportConfigObj.helplink?(r(),l("a",{key:0,href:t.reportConfigObj.helplink,target:"__blank"},[m(v,{slot:"headerTooltip",message:t.lang("click_to_see_how_to_read_this_report"),size:"medium"},null,8,["message"])],8,Qs)):h("",!0)]),s("div",to,[s("div",eo,[t.customFilters.length?(r(!0),l(x,{key:0},L(t.customFilters,g=>(r(),f(_,qt({key:g.label,"event-key":g.eventKey,api:g.api,limit:g.limit,id:g.label,label:g.label},{[Vt(g.eventKey)]:i.customFilterHandler}),null,16,["event-key","api","limit","id","label"]))),128)):h("",!0),T((r(),l("button",{type:"button",class:"btn btn-tool",onClick:e[0]||(e[0]=g=>i.toggleFilterView())},so)),[[j,t.lang("report_config_filter")]]),i.showExportButton&&t.dataCount?T((r(),l("button",{key:1,id:"export-report",class:"btn btn-tool",onClick:e[1]||(e[1]=(...g)=>i.exportReport&&i.exportReport(...g))},ro)),[[j,t.lang("export")]]):h("",!0),!i.showExportButton&&t.showReport?T((r(),l("button",{key:2,id:"graphical-report",class:"btn btn-tool",onClick:e[2]||(e[2]=(...g)=>i.exportGraphicalReport&&i.exportGraphicalReport(...g))},no)),[[j,t.lang("export")]]):h("",!0),i.showExportButton&&t.dataCount?T((r(),l("button",{key:3,id:"schedule-report",class:"btn btn-tool",onClick:e[3]||(e[3]=g=>i.scheduleList())},co)),[[j,t.lang("schedule")]]):h("",!0)])])]),s("div",uo,[t.isShowFilter?(r(),f(R,{key:0,onFilter:i.setFilter,isApplyOnlyMode:!0,"prefilled-filter-object":t.filterParams,"filter-dependencies-api-endpoint":"/api/agent/filter-dependencies",showFilter:t.isShowFilter,closeFilterView:i.toggleFilterView,filterNumber:t.filterId},{"filter-operation-btn-group":$(()=>[t.reportConfigObj.is_default?h("",!0):(r(),l("button",{key:0,class:"btn btn-primary",onClick:e[4]||(e[4]=g=>i.forkUpdateAction("update"))},[ho,I("  "+d(t.lang("edit")),1)])),s("button",{class:"btn btn-primary",onClick:e[5]||(e[5]=g=>i.forkUpdateAction("fork"))},[po,I("  "+d(t.lang("fork")),1)])]),_:1},8,["onFilter","prefilled-filter-object","showFilter","closeFilterView","filterNumber"])):h("",!0),(r(),l("div",{key:t.randKey},[(r(!0),l(x,null,L(t.reportConfigObj.sub_reports,(g,J)=>(r(),l("section",{key:g.id},[g.data_type==="datatable"?(r(),f(S,{key:0,"data-url":g.data_url,"table-columns":g.columns,"sub-report-id":g.id,"export-url":t.reportConfigObj.export_url,"add-custom-column-url":g.add_custom_column_url,"delete-custom-column-url":"api/delete-custom-column","short-code-url":"api/report-shortcodes/"+t.reportConfigObj.type,filterParams:t.filterParams,"report-index":J,"report-id":t.reportId},null,8,["data-url","table-columns","sub-report-id","export-url","add-custom-column-url","short-code-url","filterParams","report-index","report-id"])):h("",!0),g.data_type==="category-chart"?(r(),f(y,{key:1,"category-chart-data-api":g.data_url,"widget-data-api":g.data_widget_url,categories:g.list_view_by,"default-category":g.selected_view_by,"default-chart-type":g.selected_chart_type,"category-prefix":"view_by","layout-class":i.getLayoutClass(g.layout),filterParams:t.filterParams,"report-index":J,onUpdateChangedValue:i.updateChangedValue,onShowReports:i.handleExport},null,8,["category-chart-data-api","widget-data-api","categories","default-category","default-chart-type","layout-class","filterParams","report-index","onUpdateChangedValue","onShowReports"])):h("",!0),g.data_type==="time-series-chart"?(r(),f(b,{key:2,"chart-data-api":g.data_url,"data-widget-api":g.data_widget_url,categories:g.list_view_by,"default-category":g.selected_view_by,filterParams:t.filterParams,"report-index":J,onUpdateChangedValue:i.updateChangedValue,onShowReports:i.handleExport},null,8,["chart-data-api","data-widget-api","categories","default-category","filterParams","report-index","onUpdateChangedValue","onShowReports"])):h("",!0)]))),128))]))])])):h("",!0),t.openSaveReportModal?(r(),f(w,{key:2,onClose:i.closeSaveReportModal,reportDataObj:t.clonedReportConfigOnj,"modal-mode":t.modalMode},null,8,["onClose","reportDataObj","modal-mode"])):h("",!0)])}const _o=D(Ys,[["render",mo]]),go={name:"data-table-user",description:"Contains user name",props:{data:{type:Object,required:!0}},data(){return{base:window.axios.defaults.baseURL}}},fo={class:"btn-group"};function yo(t,e,a,n,o,i){const u=c("router-link");return r(),l("div",fo,[m(u,{id:"user",to:"/user/"+a.data.user.id},{default:$(()=>[I(d(a.data.user.first_name)+" "+d(a.data.user.last_name),1)]),_:1},8,["to"])])}const bo=D(go,[["render",yo]]);const vo={name:"report-exports",description:"Exports table component",setup(){const t=lt();return{formattedTime:dt(()=>t.getters.formattedTime)}},data(){let t=new URLSearchParams(window.location.search);const e=this;return{base:window.axios.defaults.baseURL,columns:["file","ext","type","user","created_at","action"],options:{texts:{filter:"",limit:""},headings:{file:this.trans("filename"),ext:this.trans("format"),type:this.trans("type"),user:this.trans("user"),created_at:this.trans("created_at"),action:this.trans("action")},templates:{action:(a,n)=>e.h(Gt,{data:n}),user:(a,n)=>e.h(bo,{data:n}),created_at:(a,n)=>e.formattedTime(n.created_at),ext(a,n){return n.ext.toUpperCase()}},sortable:["file","ext","type","created_at"],filterable:["file","ext","type","created_at"],pagination:{chunk:5,nav:"scroll"},requestAdapter(a){return{sort_by:a.orderBy?a.orderBy:"created_at",order:a.ascending?"desc":"asc",search:a.query.trim(),page:a.page,per_page:a.limit,type:t.get("type"),"user-filter":t.get("user-filter")}},responseAdapter({data:a}){return{data:a.data.data.map(n=>(n.delete_url=window.axios.defaults.baseURL+"/report/api/agent/export/delete/"+n.id,n.download_check_url="/report/api/agent/export/download/"+n.hash,n.deleteMessage="are_you_sure_you_want_to_delete_this_report",n)),count:a.data.total}}},apiUrl:"/report/api/agent/exports/"}}},Co={class:"col-sm-12"},wo={class:"card card-light"},ko={class:"card-header"},Do={class:"card-title"},So={class:"card-body"};function $o(t,e,a,n,o,i){const u=c("alert"),p=c("data-table");return r(),l("div",Co,[m(u,{componentName:"dataTableModal"}),s("div",wo,[s("div",ko,[s("h3",Do,d(t.lang("reports")),1)]),s("div",So,[m(p,{url:o.apiUrl,dataColumns:o.columns,option:o.options},null,8,["url","dataColumns","option"])])])])}const Io=D(vo,[["render",$o],["__scopeId","data-v-ca49225e"]]);function Oo(t){const{records:e}=t;let a={records:[e,"isRequired","minValue(1)"]};const n=new Z(Q),{errors:o,isValid:i}=n.validate(a);return tt.dispatch("setValidationError",o),{errors:o,isValid:i}}const Ro={name:"reports-settings",description:"reports settings page",components:{"static-select":Rt},beforeMount(){this.getInitialValues()},data:()=>({records:0,loading:!1,isDisabled:!1,elements:[{id:200,name:200},{id:400,name:400},{id:600,name:600},{id:800,name:800},{id:1e3,name:1e3},{id:1200,name:1200},{id:1400,name:1400},{id:1600,name:1600},{id:1800,name:1800},{id:2e3,name:2e3},{id:2200,name:2200},{id:2400,name:2400},{id:2600,name:2600},{id:2800,name:2800},{id:3e3,name:3e3}]}),methods:{getInitialValues(){this.loading=!0,this.isDisabled=!0,C.get("/api/report-settings").then(t=>{this.records=t.data.data.records_per_file,this.loading=!1,this.isDisabled=!1}).catch(t=>k(t))},isValid(){const{errors:t,isValid:e}=Oo(this.$data);return!!e},onChange(t,e){this[e]=t},initialState(){this.loading=!1,this.isDisabled=!1},onSubmit(){this.isValid()&&(this.loading=!0,this.isDisabled=!0,C.post("/api/report-settings",{records_per_file:this.records}).then(t=>{A(t),this.initialState()}).catch(t=>{k(t),this.initialState()}))}}},To={class:"col-sm-12"},xo={class:"row"},Fo={key:0,class:"row",slot:"fields"},Lo={class:"card-footer"},Ao=["disabled"],Uo=s("i",{class:"fas fa-save","aria-hidden":"true"},null,-1);function Po(t,e,a,n,o,i){const u=c("alert"),p=c("static-select"),v=c("custom-loader"),_=c("faveo-box");return r(),l("div",To,[m(u),m(_,{title:t.trans("settings")},{actions:$(()=>[s("div",Lo,[s("button",{type:"button",id:"submit_btn",onClick:e[0]||(e[0]=R=>i.onSubmit()),class:"btn btn-primary",disabled:t.isDisabled},[Uo,I(" "+d(t.trans("submit")),1)],8,Ao)])]),default:$(()=>[s("div",xo,[m(p,{label:t.trans("record_per_export"),value:t.records,name:"records",classname:"col-sm-6",elements:t.elements,onChange:i.onChange,type:"number",required:!0,hint:t.trans("record_per_export_tooltip")},null,8,["label","value","elements","onChange","hint"]),t.loading===!0?(r(),l("div",Fo,[m(v,{duration:4e3})])):h("",!0)])]),_:1},8,["title"])])}const Mo=D(Ro,[["render",Po]]);const jo={name:"AllScheduleList",description:"Schedule list component",data(){return{columns:[],hasDataPopulated:!1,visibleColumns:{},staticColumns:["actions"],reportType:"schedule-report",apiUrl:"/schedules",filterOptions:[{section:[{name:"report_type",url:"/api/report-types",label:"report_type"},{name:"user_id",url:"/api/dependency/users",label:"notify_assign"},{name:"scheduled_by",label:"schedule_by",type:"static-select",elements:[{id:"daily",name:"Daily"},{id:"weekly",name:"Weekly"},{id:"monthly",name:"Monthly"}]}]},{section:[{name:"executed_at",type:"time",label:"execute_at",timeOptions:{start:"00:00",step:"00:30",end:"23:30"},range:!0,placeholder:"select_date"},{name:"status",label:"status",type:"static-select",elements:[{id:1,name:"Active"},{id:0,name:"Inactive"}]},{name:"created_at",type:"date",label:["created_at","created_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},range:!0}]},{section:[{name:"updated_at",type:"date",label:["updated_at","updated_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},range:!0}]}],options:{},isShowFilter:!1,appliedFilters:{},columnData:null,scheduleData:"",loading:!0,newReportId:"",deleteMessage:"are_you_sure_you_want_to_delete_this_schedule_report"}},created(){window.emitter.on("onColumnUpdate",this.onColumnUpdate),window.emitter.on("updateFilter",this.updateFilter)},beforeMount(){this.filterData(),this.getScheduleData()},methods:{handleScheduleByChanged(t){if(this.filterOptions[2].section){const e=this.filterOptions[2].section.findIndex(a=>a.name==="monthly");e!==-1&&this.filterOptions[2].section.splice(e,1)}if(this.filterOptions[2].section){const e=this.filterOptions[2].section.findIndex(a=>a.name==="weekly");e!==-1&&this.filterOptions[2].section.splice(e,1)}if(t==="Monthly"){const e={name:"monthly",label:"monthly",className:"col-sm-4",isMultiple:!0,elements:[...Array.from({length:31},(a,n)=>({id:n+1,name:n+1}))]};this.filterOptions[2].section||(this.filterOptions[2].section=[]),this.filterOptions[2].section.push(e)}if(t==="Weekly"){const e={name:"weekly",label:"weekly",className:"col-sm-4",isMultiple:!0,elements:[{id:"Monday",name:"Monday"},{id:"Tuesday",name:"Tuesday"},{id:"Wednesday",name:"Wednesday"},{id:"Thursday",name:"Thursday"},{id:"Friday",name:"Friday"},{id:"Saturday",name:"Saturday"},{id:"Sunday",name:"Sunday"}]};this.filterOptions[2].section||(this.filterOptions[2].section=[]),this.filterOptions[2].section.push(e)}},updateFilter(t){this.filterOptions.map(function(e){e.section.map(function(a){t.name==a.name&&(a.value=t.value)})})},updateFilterMeta(t){this.filterOptions.map(function(e){e.section.map(function(a){a.value=t[a.name]?t[a.name]:""})})},getScheduleData(){this.hasDataPopulated=!1,C.get("api/agent/report-config/schedule-report").then(t=>{this.newReportId=t.data.data.id,this.columnData=t.data.data.sub_reports,this.hasDataPopulated=!0,this.columnData.forEach(e=>{e.columns.forEach(a=>{}),this.columns=e.columns}),this.columns.map(e=>{e.is_visible=!!e.is_visible}),this.updateVisibleColumns()}).catch(t=>{this.hasDataPopulated=!0,this.columns=[],k(t)})},onColumnUpdate(t){this.columns=t,this.updateVisibleColumns()},updateVisibleColumns(){this.visibleColumns={},this.columns.map(t=>{O(t.is_visible)&&(this.visibleColumns[t.key]=t.label)})},filterData(){this.filterOptions.map(function(t){t.section.map(function(e){e.elements=e.type==="static-select"?e.elements:[],e.isMultiple=e.type!=="static-select",e.isPrepopulate=!1,e.value="",e.className="col-sm-4"})})},selectedFilters(t){return t==="closeEvent"?this.isShowFilter=!1:t==="resetEvent"?this.resetFilter():this.applyFilter(t)},resetFilter(){this.apiUrl="/schedules",this.filterOptions=this.filterOptions.map(function(t){return t.section.map(function(e){e.elements=e.type==="static-select"?e.elements:[],e.isMultiple=e.type!=="static-select",e.isPrepopulate=!1,e.value="",e.className="col-sm-4"}),t})},applyFilter(t){t.scheduled_by===null&&this.filterOptions[2].section[1]&&this.filterOptions[2].section.splice(1,1),this.updateFilterMeta(t),this.appliedFilters=t;let e="/schedules?",a=Tt(this.filterOptions,t);a[a.length-1]==="&"&&(a=a.slice(0,-1)),this.apiUrl=e+a,this.isShowFilter=!1},toggleFilterView(){this.isShowFilter=!this.isShowFilter}},components:{"schedule-filter":Zt,"user-column-list":Bt,"dynamic-datatable":mt}},Eo=t=>(E("data-v-1547663d"),t=t(),q(),t),qo={class:"col-sm-12"},Vo={key:0,class:"card card-light"},No={class:"card-header"},Bo={class:"card-title"},Ho={class:"card-tools"},Wo=Eo(()=>s("span",{class:"glyphicon glyphicon-filter"},null,-1)),zo=[Wo],Ko={class:"card-body",id:"schedule_list"};function Yo(t,e,a,n,o,i){const u=c("alert"),p=c("schedule-filter"),v=c("user-column-list"),_=c("dynamic-datatable"),R=U("tooltip");return r(),l("div",qo,[m(u,{componentName:"dataTableModal"}),o.hasDataPopulated?(r(),l("div",Vo,[s("div",No,[s("h3",Bo,d(t.trans("schedule")),1),s("div",Ho,[T((r(),l("a",{id:"advance-filter-btn",class:"btn btn-tool",onClick:e[0]||(e[0]=(...S)=>i.toggleFilterView&&i.toggleFilterView(...S)),href:"javascript:;"},zo)),[[R,t.trans("filter")]])])]),s("div",Ko,[o.isShowFilter?(r(),f(p,{key:0,id:"filter-box",metaData:o.filterOptions,appliedFilters:o.appliedFilters,onSelectedFilters:i.selectedFilters,onScheduleByChanged:i.handleScheduleByChanged},null,8,["metaData","appliedFilters","onSelectedFilters","onScheduleByChanged"])):h("",!0),(r(!0),l(x,null,L(o.columnData,S=>(r(),l("section",{key:S},[m(v,{"table-columns":S.columns,reportId:S.id,columnId:o.newReportId},null,8,["table-columns","reportId","columnId"]),o.columns.length?(r(),f(_,{key:0,"data-url":o.apiUrl,columns:o.visibleColumns,columnsMeta:S.columns,staticColumns:o.staticColumns,deleteMessage:o.deleteMessage},null,8,["data-url","columns","columnsMeta","staticColumns","deleteMessage"])):h("",!0)]))),128))])])):h("",!0)])}const Jo=D(jo,[["render",Yo],["__scopeId","data-v-1547663d"]]);const Xo={props:{ticket:{type:Object,default:()=>({})}}},Go={class:"daily-widget"},Zo={class:"info-box bg-light data-widget-box"},Qo={class:"info-box-content"},tr={class:"info-box-text"};function er(t,e,a,n,o,i){return r(),l("div",Go,[s("div",Zo,[s("span",{class:"info-box-icon elevation-1 bg-light box-icon-color",style:Nt({background:a.ticket.icon_color})},[s("i",{class:M(a.ticket.icon_class)},null,2)],4),s("div",Qo,[s("span",tr,d(a.ticket.key),1)])])])}const ar=D(Xo,[["render",er],["__scopeId","data-v-0a8b61b4"]]);const sr={props:{ticket:{type:Object,default:()=>({})},removeItem:{type:Function}},methods:{onDelete(t){this.removeItem(t)}}},V=t=>(E("data-v-455a0206"),t=t(),q(),t),or={class:"daily-widget"},rr={class:"report_table"},ir={class:"report_head"},nr={class:"report_head_h4"},lr={class:"report_delete"},dr=V(()=>s("i",{class:"fas fa-trash"},null,-1)),cr=[dr],ur=V(()=>s("tr",null,[s("td",{class:"report_line",colspan:"2"},[s("hr",{class:"report_line_hr"})])],-1)),hr={class:"report_content"},pr=V(()=>s("td",null,[s("span",{class:"report_count"},"10")],-1)),mr={class:"report_content"},_r=V(()=>s("td",null,[s("span",{class:"report_count"},"03")],-1)),gr={key:1},fr={class:"report_content"},yr=V(()=>s("span",null,"→",-1)),br={key:2},vr={class:"report_content"},Cr=V(()=>s("br",null,null,-1)),wr={class:"report_content_title"},kr={class:"report_badge"},Dr={class:"report_badge_1"},Sr={class:"report_content_date"};function $r(t,e,a,n,o,i){const u=U("tooltip");return r(),l("div",or,[s("table",rr,[s("tbody",null,[s("tr",null,[s("td",ir,[s("h4",nr,d(a.ticket.key),1)]),s("td",lr,[T((r(),l("a",{class:"btn btn-default btn-sm",onClick:e[0]||(e[0]=p=>i.onDelete(a.ticket))},cr)),[[u,t.trans("delete")]])])]),ur,a.ticket.id=="system_analysis"?(r(),l(x,{key:0},[s("tr",null,[s("td",hr,d(t.trans("received_tickets")),1),pr]),s("tr",null,[s("td",mr,d(t.trans("exceptions_caught")),1),_r])],64)):a.ticket.id=="todo_list"?(r(),l("tr",gr,[s("td",fr,[yr,I(" "),s("i",null,d(t.trans("todo_eg")),1)])])):(r(),l("tr",br,[s("td",vr,[s("a",null,[s("span",null,d(t.trans("sample_report_num")),1),Cr,s("span",wr,d(t.trans("sample_report_tic")),1)]),a.ticket.id=="requires_immediate_action"?(r(),l(x,{key:0},[I("  "),s("a",kr,d(t.trans("assigned_to_me")),1),I("  "),s("a",Dr,d(t.trans("reopened")),1)],64)):h("",!0)]),s("td",Sr,[s("span",null,d(t.trans("sample_report_due")),1)])]))])])])}const Ir=D(sr,[["render",$r],["__scopeId","data-v-455a0206"]]);function Or(t){const{report_name:e}=t;let a={report_name:[e,"max(50)"]};const n=new Z(Q),{errors:o,isValid:i}=n.validate(a);return tt.dispatch("setValidationError",o),{errors:o,isValid:i}}const Rr={name:"daily-report-settings",data(){return{ticket_components:[],dragged_elements:[],loading:!1,existData:"",report_name:"",labelStyle:{display:"none"},date:"",day:"",month:"",showNameModal:!1,report_full_name:""}},mounted(){const t=["January","February","March","April","May","June","July","August","September","October","November","December"],e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],a=new Date;this.month=t[a.getMonth()],this.day=e[a.getDay()],this.date=a.getDate(),this.loadData()},methods:{onClose(){this.showNameModal=!1,this.report_name=this.report_full_name,this.report_name||(this.report_name="Daily Report")},onSave(t){this.report_full_name=t,this.report_name||(this.report_name="Daily Report"),this.isValid()&&(this.showNameModal=!1)},onChange(t,e){this[e]=t},removeItem(t){let e=this.dragged_elements.map(a=>a.id).indexOf(t.id);this.dragged_elements.splice(e,1)},onClone(t){if(!this.dragged_elements.map(e=>e.id).includes(t.id))return t},loadData(){this.loading=!0,Promise.all([this.loadTicketComponents(),this.loadExistData()]).then(t=>{[this.ticket_components,this.existData]=t,this.dragged_elements=this.existData.components,this.report_name=this.existData.name?this.existData.name:"Daily Report",this.report_full_name=this.report_name,this.loading=!1}).catch(t=>{this.loading=!1,k(t,"daily-report-settings")})},loadTicketComponents(){return C.get("/get/admin/daily-report/ticket-components-widgets").then(t=>t.data.data.components)},loadExistData(){return C.get("/get/admin/daily-report").then(t=>t.data.data)},isValid(){const{errors:t,isValid:e}=Or(this.$data);return e},onSend(){if(this.isValid()){let t=[];for(let a in this.dragged_elements)t.push({component_id:this.dragged_elements[a].id,order:parseInt(a)+1});this.loading=!0;let e={};e.report_id=this.existData.id,e.name=this.report_name?this.report_name:"Daily Report",e.component_ids=t,C.post("/api/admin/daily-report/createOrUpdateReport",e).then(a=>{this.loading=!1,A(a,"daily-report-settings"),this.loadData()}).catch(a=>{this.loading=!1,k(a,"daily-report-settings")})}}},components:{Draggable:ct,DraggableWidgets:ar,DraggedWidgets:Ir,"text-field":nt}},K=t=>(E("data-v-7338b201"),t=t(),q(),t),Tr={class:"col-sm-12"},xr={class:"row"},Fr={class:"col-sm-4"},Lr={class:"card"},Ar={class:"card-header p_18"},Ur={class:"card-title"},Pr={class:"col-sm-8"},Mr={class:"card"},jr={class:"card-header"},Er={class:"card-title mt-1"},qr={class:"card-tools"},Vr=K(()=>s("i",{class:"fas fa-save"},null,-1)),Nr={key:0,type:"button",class:"btn btn-tool rotating","data-card-widget":"refresh"},Br=K(()=>s("i",{class:"fas fa-sync-alt"},null,-1)),Hr=[Br],Wr={class:"card-body"},zr={class:"modal-title"},Kr={class:"row"},Yr=K(()=>s("i",{class:"fas fa-check"},null,-1)),Jr={class:"report_table_main"},Xr={class:"report_color_row"},Gr={class:"report_color_row_td"},Zr={class:"report_calendar"},Qr={class:"report_cal_name"},ti={class:"report_daily_head text-capitalize"},ei={class:"report_cal_edit"},ai=K(()=>s("i",{class:"fas fa-edit"},null,-1)),si=[ai],oi={class:"report_calendar_date"},ri={class:"report_calendar_day"},ii={class:"report_table_pad"},ni={class:"report_table"},li={class:"report_owner"},di={class:"report_owner_wish"},ci=K(()=>s("b",null,"XXXXXXXXXXX YYYYYYYYY",-1));function ui(t,e,a,n,o,i){const u=c("alert"),p=c("draggable-widgets"),v=c("draggable"),_=c("text-field"),R=c("modal"),S=c("dragged-widgets"),y=U("focus-first-input"),b=U("tooltip");return r(),l("div",Tr,[m(u,{componentName:"daily-report-settings"}),s("div",xr,[s("div",Fr,[s("div",Lr,[s("div",Ar,[s("h3",Ur,d(t.trans("select_widgets")),1)])]),m(v,{tag:"div",group:{name:"ticket_components",pull:"clone",put:!1},class:"draggable-list",list:o.ticket_components,animation:200,itemKey:"id",clone:i.onClone},{item:$(({element:w,index:j})=>[(r(),f(p,{ticket:w,key:w.id},null,8,["ticket"]))]),_:1},8,["list","clone"])]),s("div",Pr,[s("div",Mr,[s("div",jr,[s("h3",Er,d(t.trans("preview_of_daily_report")),1),s("div",qr,[s("button",{type:"button",class:"btn btn-default btn-sm",onClick:e[0]||(e[0]=w=>i.onSend())},[Vr,I(" "+d(t.trans("save")),1)]),o.loading?(r(),l("button",Nr,Hr)):h("",!0)])]),s("div",Wr,[o.showNameModal?(r(),f(R,{key:0,showModal:!0,onClose:i.onClose,showCloseBtn:!0},{title:$(()=>[s("h4",zr,d(t.trans("edit_report_name")),1)]),fields:$(()=>[T((r(),l("div",Kr,[m(_,{label:t.trans("report_name"),type:"text",value:o.report_name,name:"report_name",class:"col-sm-12",labelStyle:o.labelStyle,onChange:i.onChange,placehold:t.lang("enter_a_value")},null,8,["label","value","labelStyle","onChange","placehold"])])),[[y]])]),controls:$(()=>[s("button",{type:"button",onClick:e[1]||(e[1]=w=>i.onSave(o.report_name)),class:"btn btn-primary"},[Yr,I("  "+d(t.trans("proceed")),1)])]),_:1},8,["onClose"])):h("",!0),s("table",Jr,[s("tbody",null,[s("tr",Xr,[s("td",Gr,[s("tr",null,[s("td",Zr,[s("span",null,d(o.month),1)]),s("td",Qr,[s("h2",ti,d(o.report_full_name?o.report_full_name:t.trans("daily_reports")),1)]),s("td",ei,[T((r(),l("button",{class:"btn btn-sm btn-default",onClick:e[2]||(e[2]=w=>o.showNameModal=!0)},si)),[[b,t.trans("edit_report_name")]])])]),s("tr",null,[s("td",oi,[s("span",null,d(o.date),1)]),s("td",null,[s("h3",ri,d(o.day),1)])])])]),s("div",ii,[s("table",ni,[s("tbody",null,[s("tr",null,[s("td",li,[s("h5",di,[I(d(t.trans("greetings"))+", ",1),ci])])])])]),m(v,{tag:"div",group:"ticket_components",class:"draggable-list",list:o.dragged_elements,animation:200,itemKey:"id"},{item:$(({element:w,index:j})=>[(r(),f(S,{ticket:w,key:w.id,removeItem:i.removeItem},null,8,["ticket","removeItem"]))]),_:1},8,["list"])])])])])])])])])}const hi=D(Rr,[["render",ui],["__scopeId","data-v-7338b201"]]);let pi=[{path:"/reports",component:Wt,name:"Helpdesk Reports",redirect:"/reports/get",children:[{path:"get",component:it,name:"Reports Index",meta:{title:"reports",crumb:{active:"reports"}}},{path:":type",component:it,name:"Reports Index Individual",meta:{title:"reports",crumb:{active:"reports"}}},{path:":type/:id",component:_o,name:"Reports Entry",meta:{title:"from_report",crumb:{link:{name:"reports",to:"/reports/get"},active:"from_report"}}},{path:":type/:module/:id",component:Jt,name:"SD Reports",meta:{title:"from_report",crumb:{link:{name:"reports",to:"/reports/get"},active:"from_report"}},props:!0},{path:"activity-download",component:Io,name:"Reports Download",meta:{title:"activity-download",crumb:{active:"activity-download"}}},{path:"settings",component:Mo,name:"Reports Settings",meta:{title:"report-settings",crumb:{active:"report-settings"}}},{path:"schedules",component:Jo,name:"AllScheduleList",meta:{title:"schedule_list",crumb:{active:"schedule_list"}}}]}];pi.forEach(function(t){Ht.addRoute(t)});let mi=[{path:"/daily-report",component:te,name:"Daily Report Settings",redirect:"/daily-report/settings",children:[{path:"settings",component:hi,name:"DailyReport Settings",meta:{title:"daily_reports",crumb:{link:{name:"admin_panel",to:"/"},active:"daily_reports"}}}]}];mi.forEach(function(t){Qt.addRoute(t)});
