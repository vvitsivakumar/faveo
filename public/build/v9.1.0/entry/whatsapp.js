import{V as E,l as B,c as L,_ as C,e as k,s as W,j as V,D as F}from"../chunks/bootstrap.js";import{L as P,r as R,A as U}from"../chunks/adminRouter.js";import{a as q,r as d,q as v,o as i,b as f,w as u,f as o,t as S,e as l,c as h,d as _,i as b,n as N,g as O,T as M,Z as Y,B as j}from"../chunks/vendor.js";import{c as z}from"../chunks/DataTableActions.js";import{S as H}from"../chunks/FormGenerator.js";import"../chunks/HelpSection.js";import"../chunks/AdminNavigationBar.js";function I(e){const{name:t,sid:s,token:g,business_phone:a}=e;let n={name:[t,"isRequired"],sid:[s,"isRequired"],token:[g,"isRequired"],business_phone:[a,"isRequired"]};const p=new E(B),{errors:c,isValid:r}=p.validate(n);return L.dispatch("setValidationError",c),{errors:c,isValid:r}}const Z={data(){return{template:"",password:"password",name:"",sid:"",token:"",business_phone:"",webhook_url:"",app_exists:!1,required:!0,loading:!1,isLoading:!1,loadingSpeed:4e3,elements_new_ticket:[{name:"One Day",value:1},{name:"Five Days",value:5},{name:"Ten Days",value:10},{name:"Fifteen Days",value:15},{name:"Thirty Days",value:30}],containerStyle:{width:"500px"},elements_is_image_inline:[{name:"Yes",value:1},{name:"No",value:0}],new_ticket_interval:{name:"One Day",value:"1"},is_image_inline:{name:"Yes",value:1}}},methods:{resetFields(){this.name="",this.sid="",this.token="",this.business_phone="",this.is_image_inline={name:"Yes",value:1},this.new_ticket_interval="",this.template=""}}};const G={mixins:[Z],name:"whatsapp-create-edit-modal",props:{showModal:{type:Boolean,default:!1},onClose:{type:Function},title:{type:String,default:""},app_id:{type:[String,Number],default:""}},data(){return{containerStyle:{width:"800px"},loading:!1,isDisabled:!1,name:"",auth_token:"",account_sid:"",department:"",iconClass:"fas fa-save",btnName:"save"}},beforeMount(){this.app_id&&(this.iconClass="fas fa-sync",this.btnName="update",this.getData())},methods:{getData(){this.loading=!0,this.isDisabled=!0,q.get("/whatsapp/api/WhatsappNumberList/"+this.app_id).then(e=>{this.loading=!1,this.isDisabled=!1,this.name=e.data.data[0].name,this.token=e.data.data[0].token,this.sid=e.data.data[0].sid,this.business_phone=e.data.data[0].business_phone,this.is_image_inline=this.filterValues(this.elements_is_image_inline,e.data.data[0].is_image_inline),this.new_ticket_interval=this.filterValues(this.elements_new_ticket,e.data.data[0].new_ticket_interval),this.template=e.data.data[0].template,this.department=e.data.data[0].department.name}).catch(e=>{this.isDisabled=!1,this.loading=!1,k(e,"whatsapp-create-edit")})},filterValues(e,t){return e.filter(s=>{if(s.value==t)return s})[0]},onChange(e,t){this[t]=e},isValid(){const{erros:e,isValid:t}=I(this.$data);return t},onSubmit(){if(this.isValid()){this.loading=!0,this.isDisabled=!0;let e={};e.token=this.token,e.name=this.name,e.business_phone=this.business_phone,e.is_image_inline=this.is_image_inline.value,e.new_ticket_interval=this.new_ticket_interval.value,e.sid=this.sid,e.template=this.template,e.dept_id=this.department?this.department.id:null,q.post("/whatsapp/api/createOrUpdate/"+this.app_id,e).then(t=>{this.loading=!1,this.isDisabled=!1,W(t,"whatsapp-create-edit"),setTimeout(()=>{window.emitter.emit("refreshData"),this.onClose()},2e3)}).catch(t=>{this.isDisabled=!1,k(t,"whatsapp-create-edit"),this.loading=!1})}}},components:{"text-field":V,"dynamic-select":F}},J={class:"modal-title"},K={key:0,class:"row"},Q={key:1,id:"whatsapp-settings"},X={class:"row"},$={class:"row"},x={class:"row"},ee={class:"row"},te={id:"controls"},ae=["disabled"];function se(e,t,s,g,a,n){const p=d("alert"),c=d("reuse-loader"),r=d("text-field"),m=d("dynamic-select"),y=d("modal"),w=v("focus-first-input");return s.showModal?(i(),f(y,{key:0,showModal:s.showModal,onClose:s.onClose,containerStyle:a.containerStyle,class:"scrollable-area"},{title:u(()=>[o("h4",J,S(e.trans(s.title)),1)]),alert:u(()=>[l(p,{componentName:"whatsapp-create-edit"})]),fields:u(()=>[a.loading?(i(),h("div",K,[l(c,{"animation-duration":4e3,color:"#1d78ff",size:60})])):_("",!0),a.loading?_("",!0):(i(),h("div",Q,[b((i(),h("div",X,[l(r,{label:e.lang("name"),onChange:n.onChange,placehold:e.lang("enter_a_value"),value:a.name,type:"text",name:"name",required:e.required,classname:"col-sm-6",hint:e.lang("name_hint"),id:"name"},null,8,["label","onChange","placehold","value","required","hint"]),l(r,{label:e.lang("account_sid"),onChange:n.onChange,placehold:e.lang("enter_a_value"),value:e.sid,type:"text",name:"sid",required:e.required,classname:"col-sm-6",hint:e.lang("sid_hint"),id:"sid"},null,8,["label","onChange","placehold","value","required","hint"])])),[[w]]),o("div",$,[l(r,{label:e.lang("auth_token"),onChange:n.onChange,placehold:e.lang("enter_a_value"),value:e.token,type:"password",name:"token",required:e.required,classname:"col-sm-6",hint:e.lang("token_hint"),id:"token"},null,8,["label","onChange","placehold","value","required","hint"]),l(r,{label:e.lang("business_phone"),onChange:n.onChange,placehold:e.lang("enter_a_value"),value:e.business_phone,type:"text",name:"business_phone",required:e.required,classname:"col-sm-6",hint:e.lang("business_phone_hint"),id:"business_phone"},null,8,["label","onChange","placehold","value","required","hint"])]),o("div",x,[l(m,{name:"new_ticket_interval",classname:"col-sm-4",elements:e.elements_new_ticket,multiple:!1,prePopulate:!1,label:e.lang("new_ticket_interval"),value:e.new_ticket_interval,onChange:n.onChange,searchable:!1,clearable:!1},null,8,["elements","label","value","onChange"]),l(m,{label:e.lang("which_department"),multiple:!1,name:"department",strlength:"40",classname:"col-sm-4",apiEndpoint:"/api/dependency/departments",value:a.department,onChange:n.onChange,clearable:!!a.department,style:{"margin-top":"auto"}},null,8,["label","value","onChange","clearable"]),l(m,{name:"is_image_inline",classname:"col-sm-4",elements:e.elements_is_image_inline,multiple:!1,prePopulate:!1,label:e.lang("is_image_inline"),value:e.is_image_inline,onChange:n.onChange,searchable:!1,clearable:!1},null,8,["elements","label","value","onChange"])]),o("div",ee,[l(r,{label:e.lang("approved_template_for_whatsapp"),onChange:n.onChange,placehold:e.lang("enter_a_value"),value:e.template,type:"textarea",name:"template",classname:"col-sm-12",hint:e.lang("approved_template_hint"),id:"template",disabled:!1},null,8,["label","onChange","placehold","value","hint"])])]))]),controls:u(()=>[o("div",te,[o("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=D=>n.onSubmit()),disabled:a.isDisabled},[o("i",{class:N(a.iconClass)},null,2),O(" "+S(e.trans(a.btnName)),1)],8,ae)])]),_:1},8,["showModal","onClose","containerStyle"])):_("",!0)}const A=C(G,[["render",se]]),ne={name:"whatsapp-table-actions",props:{data:{type:Object,required:!0}},data(){return{showDeleteModal:!1,showEditModal:!1,title:"whatsapp_number_edit"}},methods:{onModal(e){this[e]=!0,this.$store.dispatch("unsetAlert")},onClose(){this.showEditModal=!1,this.showDeleteModal=!1,this.$store.dispatch("unsetValidationError")}},components:{"delete-modal":z,"whatsapp-create-edit-modal":A}},le=o("i",{class:"fas fa-edit"},null,-1),ie=[le],oe=o("i",{class:"fas fa-trash"},null,-1),de=[oe];function re(e,t,s,g,a,n){const p=d("whatsapp-create-edit-modal"),c=d("delete-modal"),r=v("tooltip");return i(),h("div",null,[b((i(),h("button",{class:"btn btn-default table_btn",onClick:t[0]||(t[0]=m=>n.onModal("showEditModal"))},ie)),[[r,e.lang("edit")]]),b((i(),h("button",{class:"btn btn-default table_btn",onClick:t[1]||(t[1]=m=>n.onModal("showDeleteModal"))},de)),[[r,e.lang("delete")]]),l(M,{name:"modal"},{default:u(()=>[a.showEditModal?(i(),f(p,{key:0,onClose:n.onClose,showModal:a.showEditModal,title:a.title,app_id:s.data.id},null,8,["onClose","showModal","title","app_id"])):_("",!0)]),_:1}),l(M,{name:"modal"},{default:u(()=>[a.showDeleteModal?(i(),f(c,{key:0,onClose:n.onClose,showModal:a.showDeleteModal,deleteUrl:s.data.delete_url},null,8,["onClose","showModal","deleteUrl"])):_("",!0)]),_:1})])}const he=C(ne,[["render",re]]),pe={components:{"status-switch":H},props:["data"],methods:{onChange(e,t){this.statusChange(t)},statusChange(e){axios.get("whatsapp/api/status/"+e).then(t=>{W(t,"dataTableModal"),window.emitter.emit("refreshData")}).catch(t=>{k(t,"dataTableModal")})}}},ue={class:"btn-group"};function ce(e,t,s,g,a,n){const p=d("status-switch");return i(),h("div",ue,[(i(),f(p,{name:s.data.business_phone,value:s.data.active,key:Math.random(),onChange:n.onChange},null,8,["name","value","onChange"]))])}const me=C(pe,[["render",ce]]);const _e={name:"whatsapp-number-settings",data(){return{apiUrl:"whatsapp/api/WhatsappNumberList",columns:["name","business_phone","department.name","status","actions"],options:{},showModal:!1,title:"whatsapp_create",business_phone:"",copied:!1}},beforeMount(){const e=this;this.webhook_url=this.basePath()+"/whatsapp",this.options={headings:{name:this.trans("name"),business_phone:this.trans("whatsapp_number"),status:this.trans("status"),"department.name":this.trans("department"),actions:this.trans("actions")},columnsClasses:{name:"whatsapp-name",business_phone:"whatsapp-number",status:"whatsapp-active",department:"Department",actions:"whatsapp-action"},sortIcon:{base:"glyphicon",up:"glyphicon-chevron-up",down:"glyphicon-chevron-down"},texts:{filter:"",limit:""},templates:{status:(t,s)=>e.h(me,{data:s}),actions:(t,s)=>e.h(he,{data:s})},requestAdapter(t){return{"sort-field":t.orderBy?t.orderBy:"id","sort-order":t.ascending?"desc":"asc","search-query":t.query.trim(),page:t.page,limit:t.limit}},responseAdapter({data:t}){return{data:t.data.map(s=>(s.delete_url=e.basePath()+"/whatsapp/api/WhatsappNumberDelete/"+s.id,s)),count:t.data.length}},sortable:[],filterable:!1,pagination:{chunk:5,nav:"fixed",edge:!0}}},methods:{onCopy(){Y(this.webhook_url),this.copied=!0,setTimeout(()=>{this.copied=!1},5e3)},addWhatsApp(){this.showModal=!0},onClose(){this.showModal=!1,this.$store.dispatch("unsetValidationError"),this.$store.dispatch("unsetAlert")}},components:{LabelCreateEdit:P,"Whatsapp-create-edit-modal":A,"text-field":V}},be={class:"col-sm-12"},ge={class:"row"},fe={class:"col-sm-1"},we={class:"card-tools"},ve=o("i",{class:"glyphicon glyphicon-plus"},null,-1),Ce=[ve],ye={id:"whatsapp-view"};function ke(e,t,s,g,a,n){const p=d("alert"),c=d("text-field"),r=d("data-table"),m=d("faveo-box"),y=d("Whatsapp-create-edit-modal"),w=v("tooltip"),D=v("focus-first-input");return i(),h("div",be,[l(p,{componentName:"dataTableModal"}),l(m,{title:e.trans("whats_app_number_list")},{headerMenu:u(()=>[o("div",we,[b((i(),h("button",{class:"btn btn-tool",onClick:t[1]||(t[1]=T=>n.addWhatsApp())},Ce)),[[w,e.trans("add_whatsapp_number")]])])]),default:u(()=>[b((i(),h("div",ge,[l(c,{label:e.lang("webhook_url"),value:e.webhook_url,type:"text",name:"webhook_url",placehold:e.lang("enter_a_value"),classname:"col-sm-5",hint:e.lang("webhook_url_hint"),id:"webhook_url",disabled:!0},null,8,["label","value","placehold","hint"]),o("div",fe,[b((i(),h("a",{class:"btn btn-default uri-copy",onClick:t[0]||(t[0]=j(T=>n.onCopy(),["prevent"]))},[o("span",{class:N(a.copied?"fas fa-check text-green":"fa fa-clipboard"),id:"eye"},null,2)])),[[w,a.copied?e.trans("clipboard-copy-message"):e.trans("click-to-copy")]])])])),[[D]]),o("div",ye,[l(r,{url:a.apiUrl,dataColumns:a.columns,option:a.options,scroll_to:"whatsapp-view"},null,8,["url","dataColumns","option"])])]),_:1},8,["title"]),l(M,{name:"modal"},{default:u(()=>[a.showModal?(i(),f(y,{key:0,onClose:n.onClose,showModal:a.showModal,title:a.title},null,8,["onClose","showModal","title"])):_("",!0)]),_:1})])}const Me=C(_e,[["render",ke]]);let De={path:"/whatsapp",component:U,name:"Whatsapp",redirect:"/whatsapp/settings",children:[{path:"settings",component:Me,name:"Whatsapp Settings",meta:{title:"whatsapp_config",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},active:"whatsapp_settings"}}}]};R.addRoute(De);
