import{_ as w,s as y,e as k,j as P}from"../chunks/bootstrap.js";import{a as b,r as d,o as a,b as $,w as C,f as e,t as n,c as o,e as c,d as r,n as M,g as m,q as L,i as D,F as V,h as N,T as q}from"../chunks/vendor.js";import{r as z,A as B}from"../chunks/adminRouter.js";import"../chunks/FormGenerator.js";import"../chunks/AdminNavigationBar.js";import"../chunks/DataTableActions.js";import"../chunks/HelpSection.js";const U={name:"slack-url-modal",props:{showModal:{type:Boolean,default:!1},onClose:{type:Function},data:{type:Object,default:()=>{}},title:{type:String,default:""}},data:()=>({containerStyle:{width:"600px"},loading:!1,url:"",isDisabled:!1,btnClass:"btn btn-primary",iconClass:"glyphicon glyphicon-plus",btnName:"add"}),beforeMount(){this.data&&(this.url=this.data.webhook_url),this.title=="edit"?(this.iconClass="fas fa-sync",this.btnName="update"):this.title=="delete"&&(this.iconClass="fas fa-trash",this.btnName="delete",this.btnClass="btn btn-danger")},methods:{onChange(t,s){this[s]=t},onSubmit(){if(this.url)if(this.loading=!0,this.isDisabled=!0,this.title=="delete")b.delete("/slack/delete/webhook/"+this.data.id).then(t=>{y(t,"slack-settings"),this.onClose(!0),this.loading=!1,this.isDisabled=!1}).catch(t=>{k(t,"slack-settings"),this.onClose()});else{let t={};t.webhook=this.url,this.data&&(t.id=this.data.id),b.post("/slack/update/webhook",t).then(s=>{y(s,"slack-settings"),this.onClose(!0),this.loading=!1,this.isDisabled=!1}).catch(s=>{k(s,"slack-settings"),this.onClose()})}else this.$store.dispatch("setValidationError",{url:"This field is required."})}},components:{"text-field":P}},j={class:"modal-title"},E={key:0,class:"row"},F={key:1,class:"row"},I={key:2,class:"row"},A=["disabled"];function H(t,s,h,S,l,i){const p=d("reuse-loader"),g=d("text-field"),f=d("modal");return h.showModal?(a(),$(f,{key:0,showModal:h.showModal,onClose:h.onClose,containerStyle:t.containerStyle},{title:C(()=>[e("h4",j,n(t.trans(h.title)),1)]),fields:C(()=>[t.loading?(a(),o("div",E,[c(p,{"animation-duration":4e3,color:"#1d78ff",size:t.size},null,8,["size"])])):r("",!0),!t.loading&&h.title!="delete"?(a(),o("div",F,[c(g,{label:t.trans("url"),value:t.url,type:"text",name:"url",onChange:i.onChange,placehold:t.lang("enter_a_value"),classname:"col-sm-12",required:!0},null,8,["label","value","onChange","placehold"])])):r("",!0),!t.loading&&h.title=="delete"?(a(),o("div",I,[e("span",null,n(t.trans("are_you_sure")),1)])):r("",!0)]),controls:C(()=>[e("button",{type:"button",onClick:s[0]||(s[0]=v=>i.onSubmit()),class:M(t.btnClass),disabled:t.isDisabled},[e("i",{class:M(t.iconClass)},null,2),m(" "+n(t.trans(t.btnName)),1)],10,A)]),_:1},8,["showModal","onClose","containerStyle"])):r("",!0)}const R=w(U,[["render",H]]),O={name:"slack-settings",data(){return{showModal:!1,urlList:[],action:"",loading:!0,selectedValue:""}},beforeMount(){this.getUrlList()},methods:{openModal(t,s=""){this.showModal=!0,this.action=t,this.selectedValue=s},onClose(t=!1){this.showModal=!1,this.action="",this.selectedValue="",t&&this.getUrlList()},getUrlList(){this.loading=!0,axios.get("/slack/webhooks").then(t=>{this.urlList=t.data.data,this.loading=!1}).catch(t=>{this.loading=!1})}},components:{"slack-url-create-edit-modal":R}},G={class:"col-sm-12"},J={class:"card card-light"},K={class:"card-header"},Q={class:"card-title"},W={class:"card-tools"},X=e("i",{class:"glyphicon glyphicon-plus"},null,-1),Y=[X],Z={class:"card-body"},x={key:0,class:"row"},tt={key:1,class:"row"},et={key:0,class:"col-sm-12 text-center"},st={key:1,class:"table border"},at={class:"actions-row"},ot=["onClick"],lt=e("i",{class:"fas fa-edit"},null,-1),nt=["onClick"],it=e("i",{class:"fas fa-trash"},null,-1);function dt(t,s,h,S,l,i){const p=d("alert"),g=d("reuse-loader"),f=d("slack-url-create-edit-modal"),v=L("tooltip");return a(),o("div",G,[c(p,{"component-name":"slack-settings"}),e("div",J,[e("div",K,[e("h3",Q,n(t.trans("settings")),1),e("div",W,[D((a(),o("button",{class:"btn btn-tool",onClick:s[0]||(s[0]=u=>i.openModal("create"))},Y)),[[v,t.lang("create_webhook")]])])]),e("div",Z,[l.loading?(a(),o("div",x,[c(g)])):r("",!0),l.loading?r("",!0):(a(),o("div",tt,[l.urlList.length?(a(),o("table",st,[e("thead",null,[e("tr",null,[e("th",null,n(t.trans("s.no")),1),e("th",null,n(t.trans("url")),1),e("th",null,n(t.trans("actions")),1)])]),e("tbody",null,[(a(!0),o(V,null,N(l.urlList,(u,_)=>(a(),o("tr",{key:_},[e("td",null,n(_+1),1),e("td",null,n(u.webhook_url),1),e("td",null,[e("div",at,[e("a",{href:"javascript:;",class:"btn btn-primary",onClick:T=>i.openModal("edit",u)},[lt,m(" "+n(t.trans("edit")),1)],8,ot),e("a",{href:"javascript:;",class:"btn btn-danger",onClick:T=>i.openModal("delete",u)},[it,m(" "+n(t.trans("delete")),1)],8,nt)])])]))),128))])])):(a(),o("div",et,n(t.trans("no-records")),1))]))])]),c(q,{name:"modal"},{default:C(()=>[l.showModal?(a(),$(f,{key:0,onClose:i.onClose,showModal:l.showModal,data:l.selectedValue,title:l.action},null,8,["onClose","showModal","data","title"])):r("",!0)]),_:1})])}const rt=w(O,[["render",dt]]),ct={data(){return{hasDataPopulated:!1,loading:!1,shortCodesLoader:!1,shortcodes:[],template:""}},beforeMount(){this.getInitialValues(),this.getShortCodes()},methods:{getShortCodes(){this.shortCodesLoader=!0,b.get("/slack/get/shortcodes").then(t=>{this.shortCodesLoader=!1,this.shortcodes=t.data.data}).catch(t=>{this.shortCodesLoader=!1,k(t,"slack-template")})},getInitialValues(){this.loading=!0,b.get("/slack/get/templateContent").then(t=>{this.loading=!1,this.hasDataPopulated=!0,this.template=t.data.data}).catch(t=>{this.loading=!1,this.hasDataPopulated=!0,k(t,"slack-template")})},onChange(t,s){this[s]=t},onSubmit(){if(this.template){this.loading=!0;let t={};t.body=this.template,b.post("/slack/api/update/templateContent",t).then(s=>{this.loading=!1,y(s,"slack-template"),this.getInitialValues()}).catch(s=>{this.loading=!1,k(s,"slack-template")})}else this.$store.dispatch("setValidationError",{template:"This field is required."})}}},ht={class:"col-sm-12"},ut={key:0,class:"row"},_t={key:1,class:"card card-light"},mt={class:"card-header"},pt={class:"card-title"},gt={class:"card-body"},ft={class:"row"},kt={class:"col-md-12 pl-3 pr-3"},bt={class:"card card-light"},vt={class:"card-header"},Ct={class:"card-title"},yt={class:"card-body col-md-12"},wt={key:0,class:"row"},St={key:1},Mt={class:"alert alert-info alert-dismissable"},$t=e("i",{class:"fas fa-info-circle"},null,-1),Lt=e("button",{type:"button",class:"close","data-dismiss":"alert","aria-hidden":"true"},"×",-1),Dt={key:0,class:"list-inline"},Vt={class:"list-inline-item",style:{width:"23%"}},Nt={"data-placement":"right"},Tt={class:"row"},Pt={class:"col-md-12 form-group"},qt={class:"card-footer"},zt=e("i",{class:"fas fa-sync"},null,-1);function Bt(t,s,h,S,l,i){const p=d("custom-loader"),g=d("alert"),f=d("reuse-loader"),v=d("tiny-editor-with-validation"),u=L("tooltip");return a(),o("div",ht,[!l.hasDataPopulated||l.loading?(a(),o("div",ut,[c(p,{duration:4e3})])):r("",!0),c(g,{componentName:"slack-template"}),l.hasDataPopulated?(a(),o("div",_t,[e("div",mt,[e("h3",pt,n(t.trans("template")),1)]),e("div",gt,[e("div",ft,[e("div",kt,[e("div",bt,[e("div",vt,[e("h3",Ct,n(t.trans("list-of-available-shot-codes")),1)]),e("div",yt,[l.shortCodesLoader?(a(),o("div",wt,[c(f,{"animation-duration":4e3,size:60})])):(a(),o("div",St,[e("div",Mt,[$t,m("  "),e("span",null,n(t.trans("template-short-code-tips")),1),Lt]),l.shortcodes.length?(a(),o("ul",Dt,[(a(!0),o(V,null,N(l.shortcodes,_=>(a(),o("li",Vt,[D((a(),o("span",Nt,[m(n(_.shortcode),1)])),[[u,t.trans(_.desc_lang_key),void 0,{right:!0}]])]))),256))])):r("",!0)]))])])])]),e("div",Tt,[e("div",Pt,[c(v,{value:l.template,onChange:i.onChange,name:"template",label:t.trans("template"),required:!0,classname:"col-sm-12 width55",lang:"en",convertURLs:!1},null,8,["value","onChange","label"])])])]),e("div",qt,[e("button",{class:"btn btn-primary",onClick:s[0]||(s[0]=_=>i.onSubmit())},[zt,m(" "+n(t.trans("update")),1)])])])):r("",!0)])}const Ut=w(ct,[["render",Bt]]);z.addRoute({path:"/slack",component:B,name:"Slack",redirect:"/slack/settings",children:[{path:"settings",component:rt,name:"Slack Settings",meta:{title:"slack",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},active:"slack"}}},{path:"template/settings",component:Ut,name:"Slack Template",meta:{title:"template",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},parent_link:{name:"slack",to:"/slack"},active:"template"}}}]});
