import{V as b,l as S,c as V,_ as C,e as d,s as L,j as x,D}from"../chunks/bootstrap.js";import{r as w,A as N}from"../chunks/adminRouter.js";import{a as m,r as i,q,o as n,c as l,e as o,d as p,b as B,w as v,f as r,g as E,t as A,i as H}from"../chunks/vendor.js";import"../chunks/FormGenerator.js";import"../chunks/AdminNavigationBar.js";import"../chunks/DataTableActions.js";import"../chunks/HelpSection.js";function M(e){const{survey_link:t}=e;let u={survey_link:[t,"isRequired"]};const c=new b(S),{errors:s,isValid:a}=c.validate(u);return V.dispatch("setValidationError",s),{errors:s,isValid:a}}const P={name:"lime-survey-settings",data(){return{loading:!0,survey_link:"",haspopulated:!1,statuses:[]}},beforeMount(){this.getLimeSurveyLink()},methods:{onChange(e,t){this[t]=e},getLimeSurveyLink(){this.loading=!0,m.get("/lime-survey/api/get-survey-link").then(e=>{this.loading=!1,this.haspopulated=!0,this.survey_link=e.data.data.link||"",this.statuses=e.data.data.statuses}).catch(e=>{this.loading=!1,this.haspopulated=!1,d(e,"lime-survey-settings")})},isValid(){const{errors:e,isValid:t}=M(this.$data);return t},onSubmit(){if(this.isValid()){this.loading=!0;let e={};e.survey_link=this.survey_link,this.statuses.length>0&&(e.statuses=this.statuses.map(t=>t.id)),m.post("/lime-survey/api/post-survey-link",e).then(t=>{L(t,"lime-survey-settings"),this.getLimeSurveyLink()}).catch(t=>{this.loading=!1,this.haspopulated=!0,d(t,"lime-survey-settings")})}}},components:{"text-field":x,"dynamic-select":D}},R={class:"col-sm-12"},T={key:0},j={class:"row"},F={class:"card-footer"},z=["disabled"],G=r("i",{class:"fa fa-save"},null,-1);function I(e,t,u,c,s,a){const h=i("alert"),_=i("custom-loader"),y=i("text-field"),g=i("dynamic-select"),f=i("faveo-box"),k=q("focus-first-input");return n(),l("div",R,[o(h,{componentName:"lime-survey-settings"}),s.loading?(n(),l("div",T,[o(_,{loadingSpeed:4e3})])):p("",!0),s.haspopulated?(n(),B(f,{key:1,title:e.trans("limesurvey_settings")},{actions:v(()=>[r("div",F,[r("button",{slot:"actions",type:"button",onClick:t[0]||(t[0]=O=>a.onSubmit()),disabled:s.loading,class:"btn btn-primary"},[G,E(" "+A(e.trans("save")),1)],8,z)])]),default:v(()=>[H((n(),l("div",j,[o(y,{label:e.trans("survey_link"),type:"text",value:s.survey_link,name:"survey_link",class:"col-sm-12",required:!0,onChange:a.onChange,placehold:e.lang("enter_a_value")},null,8,["label","value","onChange","placehold"]),o(g,{label:e.trans("select_status"),multiple:!0,name:"statuses",prePopulate:!0,classname:"col-sm-12",apiEndpoint:"/api/dependency/statuses",value:s.statuses,onChange:a.onChange,required:!1,hint:e.trans("limesurvey_settings_status_tooltip")},null,8,["label","value","onChange","hint"])])),[[k]])]),_:1},8,["title"])):p("",!0)])}const J=C(P,[["render",I]]);let K={path:"/lime-survey",component:N,name:"LimeSurvey",redirect:"/lime-survey/settings",children:[{path:"settings",component:J,name:"LimeSurvey Settings",meta:{title:"limesurvey",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},active:"limesurvey_settings"}}}]};w.addRoute(K);
