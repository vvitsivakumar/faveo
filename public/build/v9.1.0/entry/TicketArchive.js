import{V as q,l as P,c as D,_ as V,f as R,s as b,e as y,R as B,j as I,D as M}from"../chunks/bootstrap.js";import{r as N,A as E}from"../chunks/adminRouter.js";import{a as u,r as p,q as w,o as l,c,e as n,d as C,f as a,t as r,i as f,n as S,g as k,v as j,p as F,j as H,b as O}from"../chunks/vendor.js";import{b as U}from"../chunks/TicketsIndex.js";import"../chunks/FormGenerator.js";import"../chunks/AdminNavigationBar.js";import"../chunks/DataTableActions.js";import"../chunks/HelpSection.js";import"../chunks/Loader.js";import"../chunks/approvalTicketRules.js";function z(e){const{host:t,username:m,database:v,password:s,port:i}=e;var d={host:[t,"isRequired"],username:[m,"isRequired"],database:[v,"isRequired"],password:[s,"isRequired"],port:[i,"isRequired"]};const g=new q(P),{errors:o,isValid:_}=g.validate(d);return D.dispatch("setValidationError",o),{errors:o,isValid:_}}const J={name:"ticket-archive",data(){return{validationMessage:"",validationMessagenew:"",archiveValidation:"",isRadioButtonSelected:!1,showValidator:!1,enabled:R(this.value),inboxOptions:[{name:"Yes",value:1},{name:"No",value:0}],isActive:!1,alreadySetup:0,iconClass:"fas fa-save",hasDataPopulated:!1,loading:!1,apiEndpoint:"",host:"",database:"",username:"",password:"",port:"",noofdaysarchivetickettodelete:"",numberofdays:"",isarchivetickettodelete:"",ticketToggle:!1}},props:{classname:{type:String,default:""}},computed:{classname(){return this.ticketToggle?"class-when-enabled":"class-when-disabled"}},created(){this.getTicketArchiveSettings(),this.getBackupDatabaseSettings(),this.getValues()},methods:{validateInteger(){[101,69].includes(event.keyCode)&&event.preventDefault()},handleToggleChange(){this.noofdaysarchivetickettodelete=this.enabled?1:0},getBackupDatabaseSettings(){u.get("/ticket-archive/get-connection-details").then(e=>{let t=e.data.data;this.host=t.hostname,this.database=t.database,this.username=t.username,this.password=t.password,this.port=t.port})},getTicketArchiveSettings(){u.get("/ticket-archive/get-settings").then(e=>{let t=e.data.data;this.noofdaysarchivetickettodelete=t.no_of_days_archive_ticket_to_delete,this.numberofdays=t.no_of_days_tickets_to_delete,this.isarchivetickettodelete=t.is_archive_ticket_to_delete})},getValues(){this.title="ticket-archive",this.hasDataPopulated=!0,this.apiEndpoint="/ticket-archive/save-setting"},onChange(e,t){this[t]=e,this.isRadioButtonSelected=!0,this.showValidator=!1},isValid(){const{errors:e,isValid:t}=z(this.$data);return t},onSubmit(){if(this.isValid()){this.loading=!0;const e={};e.host=this.host,e.database=this.database,e.username=this.username,e.password=this.password,e.port=this.port,u.post(this.apiEndpoint,e).then(t=>{this.loading=!1,b(t,"ticket-archive"),this.getTicketArchiveSettings()}).catch(t=>{this.loading=!1,y(t,"ticket-archive")})}},validateSetting(){this.loading=!0;const e={};e.noofdaysarchivetickettodelete=this.noofdaysarchivetickettodelete,e.numberofdays=this.numberofdays,e.isarchivetickettodelete=this.isarchivetickettodelete,u.post("/ticket-archive/archive-setting",e).then(t=>{this.loading=!1,b(t,"ticket-archive")}).catch(t=>{this.loading=!1,t.response.data.message&&(this.showValidator=!0,this.validationMessage=t.response.data.message.numberofdays,this.archiveValidation=t.response.data.message.noofdaysarchivetickettodelete,this.validationMessagenew=t.response.data.message.isarchivetickettodelete),y(t,"ticket-archive")})}},components:{RadioButton:B,TextField:I,DynamicSelect:M}},T=e=>(F("data-v-ca819052"),e=e(),H(),e),L={class:"col-sm-12"},Y={key:0,class:"row"},G={class:"card card-light"},K={class:"card-header"},Q={class:"card-title"},W={class:"card-body"},X={class:"row"},Z={class:"row"},x={class:"row"},$={class:"card-footer"},ee={class:"card card-light"},te={class:"card-header"},ae={class:"card-title"},se={class:"card-body"},ie={class:"row"},oe={class:"col-sm-6"},ne={for:"numberofdays"},re=T(()=>a("label",{class:"is-danger",style:{"margin-right":"3px"}},"*",-1)),le={class:"info-icon"},ce=T(()=>a("i",{class:"fas fa-question-circle iconinfo",style:{color:"rgb(51, 122, 183)"}},null,-1)),de=[ce],he={class:"input-group"},ue={class:"input-group-append"},pe={class:"input-group-text"},me={key:0,class:"error-block is-danger"},ve={class:"card-footer"};function ge(e,t,m,v,s,i){const d=p("custom-loader"),g=p("alert"),o=p("text-field"),_=w("focus-first-input"),A=w("tooltip");return l(),c("div",L,[!s.hasDataPopulated||s.loading?(l(),c("div",Y,[n(d,{duration:4e3})])):C("",!0),n(g,{componentName:"ticket-archive"}),a("div",G,[a("div",K,[a("h3",Q,r(e.trans("database-connection")),1)]),a("div",W,[f((l(),c("div",X,[n(o,{label:e.trans("host"),value:s.host,hint:e.trans("host_name_added"),onChange:i.onChange,name:"host",type:"text",classname:"col-sm-6",required:!0,placehold:e.lang("enter_a_value")},null,8,["label","value","hint","onChange","placehold"]),n(o,{label:e.trans("database"),value:s.database,hint:e.trans("database_name_added"),onChange:i.onChange,name:"database",type:"text",classname:"col-sm-6",required:!0,placehold:e.lang("enter_a_value")},null,8,["label","value","hint","onChange","placehold"])])),[[_]]),a("div",Z,[n(o,{label:e.trans("username"),value:s.username,hint:e.trans("username_added"),onChange:i.onChange,name:"username",type:"text",classname:"col-sm-6",required:!0,placehold:e.lang("enter_a_username")},null,8,["label","value","hint","onChange","placehold"]),n(o,{label:e.trans("password"),value:s.password,onChange:i.onChange,hint:e.trans("password_added"),name:"password",type:"password",classname:"col-sm-6",required:!0,placehold:e.lang("enter_a_password")},null,8,["label","value","onChange","hint","placehold"])]),a("div",x,[n(o,{label:e.trans("port"),value:s.port,onChange:i.onChange,onkeypress:i.validateInteger,hint:e.trans("port_added"),name:"port",type:"number",classname:"col-sm-6",required:!0,placehold:e.lang("enter_port_number")},null,8,["label","value","onChange","onkeypress","hint","placehold"])])]),a("div",$,[a("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=h=>i.onSubmit())},[a("i",{class:S(s.iconClass)},null,2),k(" "+r(e.trans("save")),1)])])]),a("div",ee,[a("div",te,[a("h3",ae,r(e.trans("archive-setting")),1)]),a("div",se,[a("div",ie,[a("div",oe,[a("label",ne,[k(r(e.trans("number-of-days"))+" ",1),re,f((l(),c("span",le,de)),[[A,e.trans("isarchive_number_of_days")]])]),a("div",he,[f(a("input",{"onUpdate:modelValue":t[1]||(t[1]=h=>s.numberofdays=h),onChange:t[2]||(t[2]=(...h)=>i.onChange&&i.onChange(...h)),name:"numberofdays",type:"number",class:"form-control",required:!0,placeholder:"No. of days Tickets closed before today"},null,544),[[j,s.numberofdays]]),a("div",ue,[a("span",pe,r(e.trans("days_to_ticket")),1)])]),s.showValidator?(l(),c("span",me,r(s.validationMessage),1)):C("",!0)])])]),a("div",ve,[a("button",{class:"btn btn-primary",onClick:t[3]||(t[3]=h=>i.validateSetting())},[a("i",{class:S(s.iconClass)},null,2),k(" "+r(e.trans("save")),1)])])])])}const _e=V(J,[["render",ge],["__scopeId","data-v-ca819052"]]);const fe={name:"inbox-layout",description:"Inbox layout Component",props:{from:{type:String,default:""}},data(){return{ticketPage:"",counter:0}},created(){window.emitter.on("refreshTicketPage",this.reloadPage)},beforeMount(){if(this.from)this.ticketPage="filter";else{console.log(location.search,"location.search");let e=JSON.parse('{"'+decodeURIComponent(location.search.substring(1)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"').replace(/%2F/g,"/")+'"}');this.ticketPage=e["show[]"]}},methods:{reloadPage(){this.counter+=1}},components:{TicketsIndex:U}},ke={class:"col-sm-12"};function be(e,t,m,v,s,i){const d=p("tickets-index");return l(),c("div",ke,[(l(),O(d,{selectedColor:e.headerColor,ticketPage:s.ticketPage,key:s.counter,archive:!0},null,8,["selectedColor","ticketPage"]))])}const ye=V(fe,[["render",be]]);let we={path:"/tickets-archive",component:E,name:"TicketArchive",redirect:"/tickets-archive/settings",children:[{path:"show",component:ye,name:"Archived Tickets",meta:{title:"ticket-archive-show",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},active:"Archived Tickets"}}},{path:"settings",component:_e,name:"Archive Settings",meta:{title:"ticket-archive",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},active:"Archive Settings"}}}]};N.addRoute(we);
