import{V as S,l as V,c as M,_ as b,s as O,e as F,j as I,R as A,m as P}from"../chunks/bootstrap.js";import{r as U,A as x}from"../chunks/adminRouter.js";import{a as g,r as m,q as w,o,c as i,e as l,d as h,b as N,w as v,f as n,g as j,t as p,i as D,p as y,j as q,n as C,F as B,h as T}from"../chunks/vendor.js";import"../chunks/FormGenerator.js";import"../chunks/AdminNavigationBar.js";import"../chunks/DataTableActions.js";import"../chunks/HelpSection.js";function E(e){const{username:t,password:_,source:c}=e;let a={username:[t,"isRequired"],password:[_,"isRequired"],source:[c,"isRequired"]};const s=new S(V),{errors:u,isValid:r}=s.validate(a);return M.dispatch("setValidationError",u),{errors:u,isValid:r}}const H={name:"crm-settings",description:"Alliance CRM Settings page",data(){return{loading:!0,hasDataPopulated:!1,username:"",password:"",source:"",app_id:"",app_secret:"",radioOptions:[{name:"yes",value:1},{name:"no",value:0}],required_for_agents:1,required_for_clients:1}},beforeMount(){this.getInitialValues()},methods:{getInitialValues(){this.loading=!0,g.get("/alliance-crm/api/settings").then(e=>{this.loading=!1,this.hasDataPopulated=!0,this.updatesStateWithData(e.data.data)}).catch(e=>{this.loading=!1,this.hasDataPopulated=!0})},updatesStateWithData(e){const t=this,_=this.$data;Object.keys(e).map(c=>{_.hasOwnProperty(c)&&(t[c]=e[c])})},isValid(){const{errors:e,isValid:t}=E(this.$data);return t},onChange(e,t){this[t]=e},onSubmit(){if(this.isValid()){this.loading=!0;let e={};e.username=this.username,e.password=this.password,e.source=this.source,e.app_id=this.app_id||null,e.app_secret=this.app_secret||null,e.required_for_agents=this.required_for_agents,e.required_for_clients=this.required_for_clients,g.post("/alliance-crm/api/settings",e).then(t=>{this.loading=!1,this.hasDataPopulated=!0,O(t,"crm-settings"),this.getInitialValues()}).catch(t=>{this.loading=!1,this.hasDataPopulated=!0,F(t,"crm-settings")})}}},components:{"text-field":I,"radio-button":A}},L=e=>(y("data-v-c9f595d3"),e=e(),q(),e),W={class:"col-sm-12"},z={key:0},J={class:"row"},G={class:"row"},K={class:"row"},Q={class:"card-footer"},X=["disabled"],Y=L(()=>n("i",{class:"fa fa-save"},null,-1));function Z(e,t,_,c,a,s){const u=m("alert"),r=m("custom-loader"),d=m("text-field"),f=m("radio-button"),k=m("faveo-box"),R=w("focus-first-input");return o(),i("div",W,[l(u,{componentName:"crm-settings"}),a.loading?(o(),i("div",z,[l(r,{loadingSpeed:4e3})])):h("",!0),a.hasDataPopulated?(o(),N(k,{key:1,title:e.trans("alliance_crm_integration")},{actions:v(()=>[n("div",Q,[n("button",{slot:"actions",type:"button",onClick:t[0]||(t[0]=Ce=>s.onSubmit()),disabled:a.loading,class:"btn btn-primary"},[Y,j(" "+p(e.trans("save")),1)],8,X)])]),default:v(()=>[D((o(),i("div",J,[l(d,{label:e.trans("user_name"),type:"text",value:a.username,name:"username",class:"col-sm-6",required:!0,onChange:s.onChange},null,8,["label","value","onChange"]),l(d,{label:e.trans("password"),type:"password",name:"password",value:a.password,classname:"col-sm-6",required:!0,onChange:s.onChange,placehold:e.lang("enter_a_value")},null,8,["label","value","onChange","placehold"])])),[[R]]),n("div",G,[l(d,{label:e.trans("source"),type:"text",value:a.source,name:"source",class:"col-sm-6",required:!0,onChange:s.onChange,placehold:e.lang("enter_a_value")},null,8,["label","value","onChange","placehold"]),l(d,{label:e.trans("app_id"),type:"text",name:"app_id",value:a.app_id,classname:"col-sm-6",required:!1,onChange:s.onChange,placehold:e.lang("enter_a_value")},null,8,["label","value","onChange","placehold"])]),n("div",K,[l(d,{label:e.trans("app_secret"),type:"text",value:a.app_secret,name:"app_secret",class:"col-sm-6",required:!1,onChange:s.onChange},null,8,["label","value","onChange"]),l(f,{options:a.radioOptions,label:e.trans("required_for_agents"),name:"required_for_agents",value:a.required_for_agents,onChange:s.onChange,classname:"form-group col-sm-6"},null,8,["options","label","value","onChange"]),l(f,{options:a.radioOptions,label:e.trans("required_for_clients"),name:"required_for_clients",value:a.required_for_clients,onChange:s.onChange,classname:"form-group col-sm-6"},null,8,["options","label","value","onChange"])])]),_:1},8,["title"])):h("",!0)])}const $=b(H,[["render",Z],["__scopeId","data-v-c9f595d3"]]);const ee={name:"alliance-customer-timeline",props:{data:{type:String,required:!0}},data(){return{showUserData:!1,customerDataFields:{},loading:!0,userData:null,cardOpen:!1}},beforeMount(){this.userData=JSON.parse(this.data)},created(){window.emitter.on("ticket-timeline-boxes-mounted",this.updateUserData)},methods:{toggleCard(){this.cardOpen=!this.cardOpen,this.cardOpen&&this.getCustomerFromCRM()},updateUserData(e){this.userData.user.user_name!=e.user.user_name&&(this.userData=e,this.getCustomerFromCRM())},getCustomerFromCRM(){let e=this.userData.id;this.showUserData=!1,this.loading=!0,g.get("/alliance-crm/api/search-ticket-customer/"+e).then(t=>{this.showUserData=!0,this.customerDataFields=t.data.data,this.loading=!1}).catch(t=>{this.loading=!1})},ucfirst(e){return e.charAt(0).toUpperCase()+e.slice(1)}}},te=e=>(y("data-v-9db4d6f0"),e=e(),q(),e),ae={class:"card card-light"},se={class:"card-header pointer"},ne={class:"card-tools"},oe=te(()=>n("i",{class:"fas fa-sync-alt"},null,-1)),re=[oe],ie={key:0,class:"card-body"},le={key:0},ce={class:"row"},de={class:"col-md-12"},ue={key:0,class:"row"},_e={class:"col-md-6 info-row"},me={class:"col-md-6"},pe={class:"col-md-6"},he={key:1};function ge(e,t,_,c,a,s){const u=w("tooltip");return o(),i("div",ae,[n("div",se,[n("h3",{class:"card-title w_80",onClick:t[0]||(t[0]=(...r)=>s.toggleCard&&s.toggleCard(...r))},p(e.trans("alliance_crm_infomation")),1),n("div",ne,[a.cardOpen?D((o(),i("a",{key:0,class:C(["btn btn-tool",a.loading?"rotating":""]),onClick:t[1]||(t[1]=(...r)=>s.getCustomerFromCRM&&s.getCustomerFromCRM(...r)),href:"javascript:;"},re,2)),[[u,e.trans("refresh")]]):h("",!0),n("button",{type:"button",class:"btn btn-tool",onClick:t[2]||(t[2]=(...r)=>s.toggleCard&&s.toggleCard(...r))},[n("i",{class:C([{"fas fa-angle-up":a.cardOpen,"fas fa-angle-down":!a.cardOpen},"fs-25"])},null,2)])])]),a.cardOpen?(o(),i("div",ie,[a.loading?h("",!0):(o(),i("div",le,[n("div",ce,[n("div",de,[a.showUserData?(o(),i("div",ue,[(o(!0),i(B,null,T(a.customerDataFields,(r,d)=>(o(),i("div",_e,[n("div",me,[n("label",null,p(s.ucfirst(d)),1)]),n("div",pe,p(r),1)]))),256))])):(o(),i("div",he,p(e.lang("alliance_crm_infomation_description")),1))])])]))])):h("",!0)])}const fe=b(ee,[["render",ge],["__scopeId","data-v-9db4d6f0"]]);let ve={path:"/alliance-crm",component:x,name:"AllianceCRM",redirect:"/alliance-crm/settings",children:[{path:"settings",component:$,name:"AllianceCRM Settings",meta:{title:"alliance_crm_integration",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},active:"alliance_crm_integration"}}}]};U.addRoute(ve);P("alliance-customer-timeline",fe,"ticket-timeline-boxes-mounted","timeline-boxes");
