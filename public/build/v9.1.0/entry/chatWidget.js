import{_ as f,h as y,L as v,c as S}from"../chunks/bootstrap.js";import{a as p,r as g,o as i,c,f as t,G as n,d as l,g as b,i as D,v as T,e as x,t as d,F as u,h as B,b as K,N as L}from"../chunks/vendor.js";const A={name:"widget-ui",props:{whiteLabel:{type:Boolean,default:!1}},components:{"faveo-form-client-panel":y,loader:v},data(){return{originalHtml:'<p>This is <strong>HTML</strong> content with an <img src="image.jpg" alt="An image"></p>',search_text:"",showAll:!1,showBack:!1,showTicket:!1,widgetLoad:!0,widgetData:"",articleList:[],loadKb:!0,chatUrl:"",chatId:"",timeoutId:null,layoutDetails:{},widgetSource:"",apiKey:"",form_category:""}},beforeMount(){let s=new URLSearchParams(window.location.search);this.chatUrl=s.get("chat_url"),this.chatId=s.get("chat_id");let o=s.get("chat_data");this.widgetData=o?JSON.parse(o):"",this.apiKey=this.widgetData.api_key?this.widgetData.api_key:"",this.form_category=this.widgetData.form_category?this.widgetData.form_category:"",this.$store.dispatch("setApiKey",this.apiKey),this.widgetLoad=!1,this.layoutDetails={portal:{client_button_border_color:this.widgetData.color_code,client_button_color:this.widgetData.color_code,client_input_field_color:this.widgetData.color_code}},this.getKbData(),this.getSource()},methods:{getSubStr(s){if(s)return s.length>110?s.substring(0,110)+"...":s},getSource(){p.get("/api/dependency/sources?api_key="+this.apiKey).then(s=>{this.widgetSource=s.data.data.sources.find(o=>o.name==="Widget"),this.widgetSource&&this.$store.dispatch("setSource",this.widgetSource.id)}).catch(s=>{this.widgetSource=""})},handleSearch(){clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.search_text?this.getKbData("/api/search",{s:this.search_text},!0):this.getKbData()},1)},strippedText(s){return s.replace(/<\/?[^>]+(>|$)/g,"")},getKbData(s="/api/article-list-with-category",o={},h=!1){this.loadKb=!0;let _=o;p.get(this.chatUrl+s,{params:_}).then(e=>{this.loadKb=!1,this.articleList=h?e.data.data.articles.data.filter(r=>r.type):e.data.data.articles.filter(r=>r.type)}).catch(e=>{this.loadKb=!1})},showAllArticles(){this.showTicket=!1,this.showAll=this.showBack=!0,this.getKbData()},backToHome(){this.showAll=this.showBack=this.showTicket=!1},updateTicket(){this.showAll=!1,this.showTicket=this.showBack=!0}}},C={key:0,class:"widget-UI"},I={class:"dpmsg-Screen"},F={class:"dpmsg-ScreenContent"},Q={class:"scrollarea"},H={class:"scrollarea-content"},N={class:"dpmsg-ScreenHeaderTitle-pad"},U=t("i",{class:"fas fa-arrow-circle-left back-icon"},null,-1),W=[U],j={class:"block-container"},E={key:0,class:"dpmsg-Block"},V={class:"dpmsg-BlockWrapper"},q={class:"fixed-kb"},M={class:"dpmsg-QuickSearchControl"},P={class:"dpmsg-QuickSearchControl--wrapper"},z={class:"dpmsg-QuickSearchControl--label",for:"quickSearchInput"},G=t("span",{"aria-hidden":"true"},"Search",-1),O=t("i",{class:"dpmsg-Icon dpmsg-IconSearchClear"},null,-1),R={key:0,class:"text-center p-3"},J={key:1,class:"dpmsg-QuickSearchControl--hint"},X={key:0,class:"dpmsg-QuickSearchResults"},Y={class:"dpmsg-QuickSearchEntry"},Z={class:"dpmsg-QuickSearchEntryHeaderLink"},$=["title","href"],ee={class:"dpmsg-QuickSearchExcerpt"},te=t("div",{class:"dpmsg-QuickSearchEntry--divider"},null,-1),se={key:1,class:"dpmsg-Block"},oe={class:"dpmsg-BlockWrapper"},ie={key:0,class:"dpmsg-BlockText"},ae={class:"dpmsg-ScreenFooter"},ce={key:0,class:"dpmsg-ScreenFooterText"},re={class:"dpmsg-ScreenFooterText"},le=t("a",{href:"https://www.faveohelpdesk.com",target:"_blank",rel:"noreferrer noopener"},"Faveo",-1);function ne(s,o,h,_,e,r){const k=g("loader"),w=g("faveo-form-client-panel");return!e.widgetLoad&&e.widgetData?(i(),c("div",C,[t("div",I,[t("div",F,[t("div",Q,[t("div",H,[t("div",{class:"dpmsg-ScreenHeader",style:n({"background-color":e.widgetData.color_code})},[t("span",N,[e.showBack?(i(),c("a",{key:0,class:"text-white back-link",href:"javascript:;",onClick:o[0]||(o[0]=a=>r.backToHome())},W)):l("",!0),b("Get In Touch ")])],4),t("div",j,[e.showTicket?l("",!0):(i(),c("div",E,[t("div",V,[t("div",q,[t("div",{class:"dpmsg-BlockHeader",style:n({"border-bottom":"2px solid "+e.widgetData.color_code})},"KnowledgeBase",4),t("div",M,[t("div",P,[D(t("input",{class:"dpmsg-QuickSearchControl--input",id:"quickSearchInput","onUpdate:modelValue":o[1]||(o[1]=a=>e.search_text=a),type:"text",onInput:o[2]||(o[2]=(...a)=>r.handleSearch&&r.handleSearch(...a))},null,544),[[T,e.search_text]]),t("label",z,[t("i",{class:"fas fa-search",style:n({color:e.widgetData.color_code})},null,4),G]),O]),e.loadKb?(i(),c("div",R,[x(k,{color:e.widgetData.color_code,size:30},null,8,["color"])])):l("",!0),e.search_text&&!e.loadKb&&!e.articleList.length?(i(),c("div",J,[t("span",null,"No results for "+d(e.search_text),1)])):l("",!0)])]),!e.loadKb&&e.articleList.length?(i(),c("div",X,[(i(!0),c(u,null,B(e.showAll?e.articleList.slice().reverse():e.articleList.slice(0,3).reverse(),a=>(i(),c("div",Y,[t("h4",Z,[t("a",{title:a.name.length>130?a.name:"",rel:"noreferrer noopener",target:"_blank",href:e.chatUrl+"/show/"+a.slug,style:n({color:e.widgetData.color_code})},d(a.name.length>130?a.name.substring(0,130)+"...":a.name),13,$)]),t("div",ee,d(r.getSubStr(r.strippedText(a.description))),1),te]))),256)),!e.showAll&&e.articleList.length>3?(i(),c("a",{key:0,class:"dpmsg-QuickSearchFooter",href:"javascript:;",onClick:o[3]||(o[3]=a=>r.showAllArticles()),style:n({color:e.widgetData.color_code})},"See more results",4)):l("",!0)])):l("",!0)])])),e.showAll?l("",!0):(i(),c("div",se,[t("div",oe,[t("div",{class:"dpmsg-BlockHeader",style:n({"border-bottom":"2px solid "+e.widgetData.color_code})},"Submit a Ticket",4),e.showTicket?l("",!0):(i(),c("div",ie,"Submit an enquiry via our contact form")),e.showTicket?l("",!0):(i(),c("a",{key:1,class:"dpmsg-Button Button-FullWidth Button--primary",onClick:o[4]||(o[4]=a=>r.updateTicket()),title:"Submit an enquiry via our contact form",href:"javascript:;",style:n({background:e.widgetData.color_code})},"Submit a New ticket",4)),e.showTicket?(i(),K(w,{key:2,panel:"client",category:"ticket",layout:e.layoutDetails,isInlineForm:!1,formId:"chat-widget",apiKey:e.apiKey,form_category:e.form_category},null,8,["layout","apiKey","form_category"])):l("",!0)])]))])])])]),t("div",ae,[h.whiteLabel?(i(),c("span",ce,d(s.trans("all_rights_reserved")),1)):(i(),c(u,{key:1},[t("span",re,d(s.trans("powered_by"))+"Â ",1),le],64))])])])):l("",!0)}const de=f(A,[["render",ne]]),m=L({components:{"chat-widget":de}});Object.assign(m._context,app._context);m.use(S).mount("#chat-widget");
