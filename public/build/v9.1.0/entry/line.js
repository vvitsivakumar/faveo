import{V as B,l as F,c as R,_ as T,e as k,s as L,j as S,D as U,N as O}from"../chunks/bootstrap.js";import{L as P,r as j,A as Y}from"../chunks/adminRouter.js";import{a as $,r as o,q as M,o as i,b as v,w as c,f as n,t as C,e as r,c as d,d as b,i as _,n as N,g as w,T as q,Z as z,B as H,p as Z,j as G}from"../chunks/vendor.js";import{S as J}from"../chunks/FormGenerator.js";import{c as K}from"../chunks/DataTableActions.js";import"../chunks/HelpSection.js";import"../chunks/AdminNavigationBar.js";const Q={data(){return{template:"",password:"password",name:"",channel_id:"",channelAccessToken:"",channel_secret:"",webhook_url:"",app_exists:!1,required:!0,loading:!1,isLoading:!1,loadingSpeed:4e3,elements_new_ticket:[{name:"One Day",value:1},{name:"Five Days",value:5},{name:"Ten Days",value:10},{name:"Fifteen Days",value:15},{name:"Thirty Days",value:30}],containerStyle:{width:"500px"},elements_is_image_inline:[{name:"Yes",value:1},{name:"No",value:0}],new_ticket_interval:{name:"One Day",value:"1"},is_image_inline:{name:"Yes",value:1}}},methods:{resetFields(){this.name="",this.channel_id="",this.channelAccessToken="",this.channel_secret="",this.is_image_inline={name:"Yes",value:1},this.new_ticket_interval="",this.template=""}}};function W(e){const{name:t,channel_id:a,channelAccessToken:g,channel_secret:s}=e;let l={name:[t,"isRequired"],channel_id:[a,"isRequired"],channelAccessToken:[g,"isRequired"],channel_secret:[s,"isRequired"]};const m=new B(F),{errors:u,isValid:h}=m.validate(l);return R.dispatch("setValidationError",u),{errors:u,isValid:h}}const X={mixins:[Q],name:"line-create-edit-modal",props:{showModal:{type:Boolean,default:!1},onClose:{type:Function},title:{type:String,default:""},app_id:{type:[String,Number],default:""}},data(){return{containerStyle:{width:"800px"},loading:!1,isDisabled:!1,name:"",auth_token:"",account_sid:"",department:"",iconClass:"fas fa-save",btnName:"save"}},beforeMount(){this.app_id&&(this.iconClass="fas fa-sync",this.btnName="update",this.getData())},methods:{getData(){this.loading=!0,this.isDisabled=!0,$.get("/line/api/line/"+this.app_id).then(e=>{this.loading=!1,this.isDisabled=!1;const t=e.data.data;this.name=t.name,this.channelAccessToken=t.channelAccessToken,this.channel_id=t.channel_Id,this.channel_secret=t.channel_secret,this.is_image_inline=this.filterValues(this.elements_is_image_inline,t.is_image_inline),this.new_ticket_interval=this.filterValues(this.elements_new_ticket,t.new_ticket_interval),this.department=t.department.name}).catch(e=>{this.isDisabled=!1,this.loading=!1,k(e,"line-create-edit")})},filterValues(e,t){return e.filter(a=>{if(a.value==t)return a})[0]},onChange(e,t){this[t]=e},isValid(){const{erros:e,isValid:t}=W(this.$data);return t},onSubmit(){if(this.isValid()){this.loading=!0,this.isDisabled=!0;let e={};e.name=this.name,e.channelAccessToken=this.channelAccessToken,e.channel_id=this.channel_id,e.new_ticket_interval=this.new_ticket_interval.value,e.channel_secret=this.channel_secret,e.dept_id=this.department?this.department.id:null,$.post("/line/api/lineCreateOrUpdate/"+this.app_id,e).then(t=>{this.loading=!1,this.isDisabled=!1,L(t,"line-create-edit"),setTimeout(()=>{window.emitter.emit("refreshData"),this.onClose()},2e3)}).catch(t=>{this.isDisabled=!1,k(t,"line-create-edit"),this.loading=!1})}}},components:{"text-field":S,"dynamic-select":U,"number-field":O}},x={class:"modal-title"},ee={key:0,class:"row"},te={key:1,id:"line-settings"},ne={class:"row"},ae={class:"row"},se={class:"row"},le={id:"controls"},ie=["disabled"];function oe(e,t,a,g,s,l){const m=o("alert"),u=o("reuse-loader"),h=o("text-field"),p=o("number-field"),f=o("dynamic-select"),D=o("modal"),y=M("focus-first-input");return a.showModal?(i(),v(D,{key:0,showModal:a.showModal,onClose:a.onClose,containerStyle:s.containerStyle,class:"scrollable-area"},{title:c(()=>[n("h4",x,C(e.trans(a.title)),1)]),alert:c(()=>[r(m,{componentName:"line-create-edit"})]),fields:c(()=>[s.loading?(i(),d("div",ee,[r(u,{"animation-duration":4e3,color:"#1d78ff",size:60})])):b("",!0),s.loading?b("",!0):(i(),d("div",te,[_((i(),d("div",ne,[r(h,{label:e.trans("name"),onChange:l.onChange,value:s.name,type:"text",name:"name",required:e.required,classname:"col-sm-6",hint:e.trans("name_hint"),id:"name"},null,8,["label","onChange","value","required","hint"]),r(p,{label:e.trans("channel_id"),onChange:l.onChange,value:e.channel_id,type:"number",name:"channel_id",required:e.required,classname:"col-sm-6",hint:e.trans("channel_id_added"),id:"channel_id"},null,8,["label","onChange","value","required","hint"])])),[[y]]),n("div",ae,[r(h,{label:e.trans("channel_access_token"),onChange:l.onChange,value:e.channelAccessToken,type:"password",name:"channelAccessToken",required:e.required,classname:"col-sm-6",hint:e.trans("line_token_hint"),id:"channelAccessToken"},null,8,["label","onChange","value","required","hint"]),r(h,{label:e.trans("channel_secret"),onChange:l.onChange,value:e.channel_secret,type:"text",name:"channel_secret",required:e.required,classname:"col-sm-6",hint:e.trans("channel_secret_hint"),id:"channel_secret"},null,8,["label","onChange","value","required","hint"])]),n("div",se,[r(f,{name:"new_ticket_interval",classname:"col-sm-6",elements:e.elements_new_ticket,multiple:!1,prePopulate:!1,label:e.trans("new_ticket_interval"),value:e.new_ticket_interval,onChange:l.onChange,searchable:!1,clearable:!1},null,8,["elements","label","value","onChange"]),r(f,{label:e.trans("which_department_line"),multiple:!1,name:"department",strlength:"40",classname:"col-sm-6",apiEndpoint:"/api/dependency/departments",value:s.department,onChange:l.onChange,clearable:!!s.department,style:{"margin-top":"auto"}},null,8,["label","value","onChange","clearable"])])]))]),controls:c(()=>[n("div",le,[n("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=A=>l.onSubmit()),disabled:s.isDisabled},[n("i",{class:N(s.iconClass)},null,2),w(" "+C(e.trans(s.btnName)),1)],8,ie)])]),_:1},8,["showModal","onClose","containerStyle"])):b("",!0)}const E=T(X,[["render",oe],["__scopeId","data-v-d8a0baaa"]]),re={components:{"status-switch":J},props:["data"],methods:{onChange(e,t){this.statusChange(this.data.channel_Id,t)},statusChange(e){axios.get("line/api/status/"+e).then(t=>{L(t,"dataTableModal"),window.emitter.emit("refreshData")}).catch(t=>{k(t,"dataTableModal")})}}},de={class:"btn-group"};function ce(e,t,a,g,s,l){const m=o("status-switch");return i(),d("div",de,[(i(),v(m,{name:a.data.business_phone,value:a.data.active,key:Math.random(),onChange:l.onChange},null,8,["name","value","onChange"]))])}const he=T(re,[["render",ce]]),me={name:"line-table-actions",props:{data:{type:Object,required:!0}},data(){return{showDeleteModal:!1,showEditModal:!1,title:"line_number_edit"}},methods:{onModal(e){this[e]=!0,this.$store.dispatch("unsetAlert")},onClose(){this.showEditModal=!1,this.showDeleteModal=!1,this.$store.dispatch("unsetValidationError")}},components:{"delete-modal":K,"line-create-edit-modal":E}},_e=n("i",{class:"fas fa-edit"},null,-1),ue=[_e],pe=n("i",{class:"fas fa-trash"},null,-1),fe=[pe];function be(e,t,a,g,s,l){const m=o("line-create-edit-modal"),u=o("delete-modal"),h=M("tooltip");return i(),d("div",null,[_((i(),d("button",{class:"btn btn-default table_btn",onClick:t[0]||(t[0]=p=>l.onModal("showEditModal"))},ue)),[[h,e.lang("edit")]]),_((i(),d("button",{class:"btn btn-default table_btn",onClick:t[1]||(t[1]=p=>l.onModal("showDeleteModal"))},fe)),[[h,e.lang("delete")]]),r(q,{name:"modal"},{default:c(()=>[s.showEditModal?(i(),v(m,{key:0,onClose:l.onClose,showModal:s.showEditModal,title:s.title,app_id:a.data.id},null,8,["onClose","showModal","title","app_id"])):b("",!0)]),_:1}),r(q,{name:"modal"},{default:c(()=>[s.showDeleteModal?(i(),v(u,{key:0,onClose:l.onClose,showModal:s.showDeleteModal,deleteUrl:a.data.delete_url},null,8,["onClose","showModal","deleteUrl"])):b("",!0)]),_:1})])}const ve=T(me,[["render",be]]),ge={name:"LineTemplate",components:{"text-field":S},props:{showTemplateModal:{type:Boolean,default:!1},onClose:{type:Function}},data(){return{template:"",id:"",loading:!0}},beforeMount(){this.getTemplateValue()},methods:{getTemplateValue(){axios.get("/line/template/get").then(e=>{this.loading=!1;const t=e.data.data;this.template=t.template,this.id=t.id}).catch(e=>{this.loading=!1,k(e)})},onChange(e,t){this[t]=e},addToDescription(e){this.template+=" "+e+" "},onSubmit(){this.loading=!0;let e={template:this.template,id:this.id};this.$store.dispatch("unsetValidationError"),axios.post("/line/template/store",e).then(t=>{this.loading=!1,L(t,"LineTemplate"),setTimeout(()=>{window.emitter.emit("refreshData"),this.onClose()},3e3)}).catch(t=>{this.loading=!1,k(t,"LineTemplate")})}}},we={class:"modal-title"},Ce={class:"row"},ye={class:"col-md-12"},ke={class:"card card-light"},Me={class:"card-header"},Te={class:"card-title"},De={class:"card-body col-md-12"},qe={class:"alert alert-dismissable alert-info"},Le=n("i",{class:"fas fa-info-circle mr-2"},null,-1),Se=n("button",{type:"button",class:"close","data-dismiss":"alert","aria-hidden":"true"},"Ã—",-1),Ae={class:"list-inline"},Ve={"data-placement":"right"},$e={"data-placement":"right"},Ne={"data-placement":"right"},Ee={"data-placement":"right"},Ie={class:"row"},Be={id:"controls"},Fe=n("i",{class:"fas fa-save"},null,-1);function Re(e,t,a,g,s,l){const m=o("alert"),u=o("text-field"),h=o("modal"),p=M("tooltip");return a.showTemplateModal?(i(),v(h,{key:0,showModal:a.showTemplateModal,onClose:a.onClose,class:"scrollable-area"},{title:c(()=>[n("h4",we,C(e.trans("line_template")),1)]),alert:c(()=>[r(m,{componentName:"LineTemplate"})]),fields:c(()=>[n("div",Ce,[n("div",ye,[n("div",ke,[n("div",Me,[n("h3",Te,C(e.trans("list-of-available-shot-codes")),1)]),n("div",De,[n("div",qe,[Le,n("span",null,[n("small",null,C(e.trans("template-shortcode-tips")),1)]),Se]),n("ul",Ae,[n("li",{class:"list-inline-item",style:{width:"23%",cursor:"pointer"},onClick:t[0]||(t[0]=f=>l.addToDescription("{{$ticket_number}}"))},[_((i(),d("span",Ve,[w("{{$ticket_number}}")])),[[p,e.trans("ticket_number_tooltip"),void 0,{right:!0}]])]),n("li",{class:"list-inline-item",style:{width:"23%",cursor:"pointer"},onClick:t[1]||(t[1]=f=>l.addToDescription("{{$ticket_status}}"))},[_((i(),d("span",$e,[w("{{$ticket_status}}")])),[[p,e.trans("ticket_status_tooltip"),void 0,{right:!0}]])]),n("li",{class:"list-inline-item",style:{width:"23%",cursor:"pointer"},onClick:t[2]||(t[2]=f=>l.addToDescription("{{$ticket_requester}}"))},[_((i(),d("span",Ne,[w("{{$ticket_requester}}")])),[[p,e.trans("ticket_requester_tooltip"),void 0,{right:!0}]])]),n("li",{class:"list-inline-item",style:{width:"23%",cursor:"pointer"},onClick:t[3]||(t[3]=f=>l.addToDescription("{{$company_name}}"))},[_((i(),d("span",Ee,[w("{{$company_name}}")])),[[p,e.trans("company_name_tooltip"),void 0,{right:!0}]])])])])])])]),n("div",Ie,[r(u,{id:"template",label:e.trans("template_content"),value:s.template,required:!0,onChange:l.onChange,type:"textarea",name:"template",classname:"col-sm-12"},null,8,["label","value","onChange"])])]),controls:c(()=>[n("div",Be,[n("button",{class:"btn btn-primary",onClick:t[4]||(t[4]=f=>l.onSubmit())},[Fe,w(" "+C(e.trans("save")),1)])])]),_:1},8,["showModal","onClose"])):b("",!0)}const Ue=T(ge,[["render",Re]]);const Oe={name:"line-number-settings",data(){return{apiUrl:"line/api/lineApiList",columns:["name","channel_Id","department.name","status","actions"],options:{},showModal:!1,title:"line_create",business_phone:"",copied:!1,showTemplateModal:!1}},beforeMount(){const e=this;this.webhook_url=this.basePath()+"/line-webhook",this.options={headings:{name:this.trans("name"),channel_Id:this.trans("channel_Id"),status:this.trans("status"),"department.name":this.trans("department"),actions:this.trans("actions")},columnsClasses:{name:"line-name",channel_id:"channel-id",status:"line-active",department:"Department",actions:"line-action"},sortIcon:{base:"glyphicon",up:"glyphicon-chevron-up",down:"glyphicon-chevron-down"},texts:{filter:"",limit:""},templates:{status:(t,a)=>e.h(he,{data:a}),"department.name":function(t,a){return a.department?a.department.name:"--"},actions:(t,a)=>e.h(ve,{data:a})},requestAdapter(t){return{"search-query":t.query.trim(),sort_field:t.orderBy?t.orderBy:"id",sort_order:t.ascending?"asc":"desc",page:t.page,limit:t.limit}},responseAdapter({data:t}){return{data:t.data.data.map(a=>(a.delete_url=e.basePath()+"/line/api/lineDeleteCredentials/"+a.id,a)),count:t.data.total}},sortable:["name","channel_id"],filterable:["name","channel_id"],pagination:{chunk:5,nav:"fixed",edge:!0}}},methods:{viewTemplateModal(){this.showTemplateModal=!0},onCopy(){z(this.webhook_url),this.copied=!0,setTimeout(()=>{this.copied=!1},5e3)},addLine(){this.showModal=!0},onClose(){this.showModal=!1,this.showCreateEditModal=!1,this.showTemplateModal=!1,this.$store.dispatch("unsetValidationError"),this.$store.dispatch("unsetAlert")}},components:{LineTemplate:Ue,LabelCreateEdit:P,"line-create-edit-modal":E,"text-field":S}},I=e=>(Z("data-v-f4f6f96f"),e=e(),G(),e),Pe={class:"col-sm-12"},je={class:"row"},Ye={class:"col-sm-1"},ze={class:"card-tools cursor-pointer"},He=I(()=>n("i",{class:"glyphicon glyphicon-plus"},null,-1)),Ze=[He],Ge=I(()=>n("i",{class:"fa-solid fa-bolt"},null,-1)),Je=[Ge],Ke={id:"line-view"};function Qe(e,t,a,g,s,l){const m=o("alert"),u=o("text-field"),h=o("data-table"),p=o("faveo-box"),f=o("line-create-edit-modal"),D=o("LineTemplate"),y=M("tooltip"),A=M("focus-first-input");return i(),d("div",Pe,[r(m,{componentName:"dataTableModal"}),r(p,{title:e.trans("line_list")},{headerMenu:c(()=>[n("div",ze,[_((i(),d("button",{class:"btn btn-tool",onClick:t[1]||(t[1]=V=>l.addLine())},Ze)),[[y,e.trans("add_line_number")]]),_((i(),d("button",{class:"btn btn-tool",onClick:t[2]||(t[2]=V=>l.viewTemplateModal())},Je)),[[y,e.trans("line_template_tooltip")]])])]),default:c(()=>[_((i(),d("div",je,[r(u,{label:e.trans("webhook_url"),value:e.webhook_url,type:"text",name:"webhook_url",classname:"col-sm-5",hint:e.trans("webhook_info_url"),id:"webhook_url",disabled:!0},null,8,["label","value","hint"]),n("div",Ye,[_((i(),d("a",{class:"btn btn-default uri-copy",onClick:t[0]||(t[0]=H(V=>l.onCopy(),["prevent"])),style:{"margin-top":"30px"}},[n("span",{class:N(s.copied?"fas fa-check text-green":"fa fa-clipboard"),id:"eye"},null,2)])),[[y,s.copied?e.trans("clipboard-copy-message"):e.trans("click-to-copy")]])])])),[[A]]),n("div",Ke,[r(h,{url:s.apiUrl,dataColumns:s.columns,option:s.options,scroll_to:"line-view"},null,8,["url","dataColumns","option"])])]),_:1},8,["title"]),r(q,{name:"modal"},{default:c(()=>[s.showModal?(i(),v(f,{key:0,onClose:l.onClose,showModal:s.showModal,title:s.title},null,8,["onClose","showModal","title"])):b("",!0)]),_:1}),s.showTemplateModal?(i(),v(D,{key:0,onClose:l.onClose,showTemplateModal:s.showTemplateModal},null,8,["onClose","showTemplateModal"])):b("",!0)])}const We=T(Oe,[["render",Qe],["__scopeId","data-v-f4f6f96f"]]);let Xe={path:"/line",component:Y,name:"Line",redirect:"/line/settings",children:[{path:"settings",component:We,name:"Line Settings",meta:{title:"line_config",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},active:"line_settings"}}}]};j.addRoute(Xe);
