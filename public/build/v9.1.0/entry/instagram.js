import{_ as E,R as z,j as F,D as L,f as H,e as M,s as V,T as R}from"../chunks/bootstrap.js";import{a as D,r as l,q as I,o as i,b as f,w as d,f as s,t as h,e as r,c,d as _,i as m,n as O,g as k,T as A,u as j,m as P,p as Z,j as G,Z as J,B as U}from"../chunks/vendor.js";import{r as K,A as Q}from"../chunks/adminRouter.js";import{c as W}from"../chunks/DataTableActions.js";import"../chunks/FormGenerator.js";import"../chunks/AdminNavigationBar.js";import"../chunks/HelpSection.js";const X={name:"InstagramCreateEdit",description:"This component handles creation of facebook pages required for Instagram integration",components:{"radio-button":z,"text-field":F,"dynamic-select":L},props:{showCreateEditModal:{type:H,default:!1},title:{type:String,default:""},onClose:{type:Function},app_id:{type:[String,Number],default:""}},data(){return{containerStyle:{width:"800px"},page_title:"facebook_page_edit",btnName:"save",iconClass:"fas fa-save",hasDataPopulated:!0,id:"",loadingSpeed:4e3,loading:!1,required:!0,page_access_token:"",new_ticket_interval:"",page_name:"",page_id:"",status:1,statusOptions:[{name:"Active",value:1},{name:"Inactive",value:0}],elements_new_ticket:[{name:"One Day",value:1},{name:"Five Days",value:5},{name:"Ten Days",value:10},{name:"Fifteen Days",value:15},{name:"Thirty Days",value:30}]}},beforeMount(){this.app_id&&(this.hasDataPopulated=!1,this.getInitialValues(this.app_id))},methods:{getInitialValues(e){this.loading=!0,D.get("/instagram/page/info/"+e).then(t=>{this.loading=!1,this.hasDataPopulated=!0;const o=t.data.data;this.id=o.id,this.page_access_token=o.page_access_token,this.page_id=o.instagram_page_id,this.page_name=o.page_name,this.status=o.active,this.new_ticket_interval=this.filterValues(this.elements_new_ticket,o.new_ticket_interval)}).catch(t=>{this.loading=!1,this.hasDataPopulated=!0,M(t)})},filterValues(e,t){return e.find(o=>o.value===t)},onChange(e,t){this[t]=e},onSubmit(){this.loading=!0;let e={id:this.id,page_id:this.page_id,page_access_token:this.page_access_token,page_name:this.page_name,new_ticket_interval:this.new_ticket_interval?this.new_ticket_interval.value:null,active:this.status,platform:"instagram"};this.$store.dispatch("unsetValidationError"),D.post("/instagram/page/store/",e).then(t=>{this.loading=!1,V(t,"InstagramCreateEdit"),setTimeout(()=>{window.emitter.emit("refreshData"),this.onClose()},3e3)}).catch(t=>{this.loading=!1,M(t,"InstagramCreateEdit")})}}},Y={class:"modal-title"},x={key:0,class:"row"},ee={key:1,id:"instagram-settings"},te={class:"row"},ae={class:"row"},se={class:"row"},ne={id:"controls"};function oe(e,t,o,y,a,n){const b=l("alert"),v=l("custom-loader"),p=l("text-field"),g=l("dynamic-select"),u=l("radio-button"),S=l("modal"),T=I("focus-first-input");return o.showCreateEditModal?(i(),f(S,{key:0,showModal:o.showCreateEditModal,onClose:o.onClose,containerStyle:a.containerStyle,class:"scrollable-area"},{title:d(()=>[s("h4",Y,h(e.trans(o.title)),1)]),alert:d(()=>[r(b,{componentName:"InstagramCreateEdit"})]),fields:d(()=>[!a.hasDataPopulated||a.loading===!0?(i(),c("div",x,[r(v,{duration:a.loadingSpeed},null,8,["duration"])])):_("",!0),a.loading!==!0?(i(),c("div",ee,[m((i(),c("div",te,[r(p,{label:e.lang("facebook_page_name"),onChange:n.onChange,placehold:e.lang("enter_a_value"),value:a.page_name,type:"text",name:"page_name",required:a.required,classname:"col-sm-6",hint:e.lang("facebook_page_name_hint"),id:"facebook_page_name"},null,8,["label","onChange","placehold","value","required","hint"]),r(p,{label:e.lang("facebook_page_id"),onChange:n.onChange,placehold:e.lang("enter_a_value"),value:a.page_id,type:"text",name:"page_id",required:a.required,classname:"col-sm-6",hint:e.lang("facebook_page_id_hint"),id:"page_id"},null,8,["label","onChange","placehold","value","required","hint"])])),[[T]]),s("div",ae,[r(p,{label:e.lang("facebook_page_access_token"),onChange:n.onChange,placehold:e.lang("enter_a_value"),value:a.page_access_token,type:"password",name:"page_access_token",required:a.required,classname:"col-sm-6",hint:e.lang("facebook_page_access_token_hint"),id:"facebook_page_access_token"},null,8,["label","onChange","placehold","value","required","hint"]),r(g,{name:"new_ticket_interval",classname:"col-sm-6",elements:a.elements_new_ticket,multiple:!1,prePopulate:!1,label:e.lang("facebook_new_ticket_interval"),value:a.new_ticket_interval,onChange:n.onChange,clearable:!1,searchable:!1,hint:e.lang("facebook_new_ticket_interval_hint"),required:a.required,placeholder:e.lang("facebook_new_ticket_interval_placeholder")},null,8,["elements","label","value","onChange","hint","required","placeholder"])]),s("div",se,[r(u,{id:"status",name:"status",classname:"form-group col-sm-6",options:a.statusOptions,label:e.lang("status"),value:a.status,onChange:n.onChange},null,8,["options","label","value","onChange"])])])):_("",!0)]),controls:d(()=>[s("div",ne,[s("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=w=>n.onSubmit())},[s("i",{class:O(a.iconClass)},null,2),k(" "+h(e.lang(a.btnName)),1)])])]),_:1},8,["showModal","onClose","containerStyle"])):_("",!0)}const N=E(X,[["render",oe]]),ie={name:"instagram-table-actions",props:{data:{type:Object,required:!0}},data(){return{showDeleteModal:!1,showEditModal:!1,title:"facebook_page_edit"}},methods:{onModal(e){this[e]=!0,this.$store.dispatch("unsetAlert")},onClose(){this.showEditModal=!1,this.showDeleteModal=!1,this.$store.dispatch("unsetValidationError")}},components:{"delete-modal":W,"instagram-create-edit-modal":N}},le=s("i",{class:"fas fa-edit"},null,-1),re=[le],de=s("i",{class:"fas fa-trash"},null,-1),ce=[de];function _e(e,t,o,y,a,n){const b=l("instagram-create-edit-modal"),v=l("delete-modal"),p=I("tooltip");return i(),c("div",null,[m((i(),c("button",{class:"btn btn-default table_btn",onClick:t[0]||(t[0]=g=>n.onModal("showEditModal"))},re)),[[p,e.lang("edit")]]),m((i(),c("button",{class:"btn btn-default table_btn",onClick:t[1]||(t[1]=g=>n.onModal("showDeleteModal"))},ce)),[[p,e.lang("delete")]]),r(A,{name:"modal"},{default:d(()=>[a.showEditModal?(i(),f(b,{key:0,onClose:n.onClose,showCreateEditModal:a.showEditModal,title:a.title,app_id:o.data.id},null,8,["onClose","showCreateEditModal","title","app_id"])):_("",!0)]),_:1}),r(A,{name:"modal"},{default:d(()=>[a.showDeleteModal?(i(),f(v,{key:0,onClose:n.onClose,showModal:a.showDeleteModal,deleteUrl:o.data.delete_url},null,8,["onClose","showModal","deleteUrl"])):_("",!0)]),_:1})])}const me=E(ie,[["render",_e]]),pe={name:"InstagramTemplate",components:{"text-field":F},props:{showTemplateModal:{type:Boolean,default:!1},onClose:{type:Function}},data(){return{template:"",id:"",loading:!0}},beforeMount(){this.getTemplateValue()},methods:{getTemplateValue(){axios.get("/instagram/template/get").then(e=>{this.loading=!1;const t=e.data.data;this.template=t.template,this.id=t.id}).catch(e=>{this.loading=!1,M(e)})},onChange(e,t){this[t]=e},addToDescription(e){this.template+=" "+e+" "},onSubmit(){this.loading=!0;let e={template:this.template,id:this.id};this.$store.dispatch("unsetValidationError"),axios.post("/instagram/template/store",e).then(t=>{this.loading=!1,V(t,"InstagramTemplate"),setTimeout(()=>{window.emitter.emit("refreshData"),this.onClose()},3e3)}).catch(t=>{this.loading=!1,M(t,"InstagramTemplate")})}}},ge={class:"modal-title"},ue={class:"row"},he={class:"col-md-12"},fe={class:"card card-light"},be={class:"card-header"},ve={class:"card-title"},ke={class:"card-body col-md-12"},ye={class:"alert alert-dismissable alert-info"},we=s("i",{class:"fas fa-info-circle mr-2"},null,-1),Ce=s("button",{type:"button",class:"close","data-dismiss":"alert","aria-hidden":"true"},"×",-1),Me={class:"list-inline"},Ie={"data-placement":"right"},Se={"data-placement":"right"},Te={"data-placement":"right"},De={"data-placement":"right"},Ee={class:"row"},qe={id:"controls"},Ve=s("i",{class:"fas fa-save"},null,-1);function Ae(e,t,o,y,a,n){const b=l("alert"),v=l("text-field"),p=l("modal"),g=I("tooltip");return o.showTemplateModal?(i(),f(p,{key:0,showModal:o.showTemplateModal,onClose:o.onClose,class:"scrollable-area"},{title:d(()=>[s("h4",ge,h(e.trans("instagram_template")),1)]),alert:d(()=>[r(b,{componentName:"InstagramTemplate"})]),fields:d(()=>[s("div",ue,[s("div",he,[s("div",fe,[s("div",be,[s("h3",ve,h(e.trans("list-of-available-shot-codes")),1)]),s("div",ke,[s("div",ye,[we,s("span",null,[s("small",null,h(e.trans("template-shortcode-tips")),1)]),Ce]),s("ul",Me,[s("li",{class:"list-inline-item",style:{width:"23%",cursor:"pointer"},onClick:t[0]||(t[0]=u=>n.addToDescription("{{$ticket_number}}"))},[m((i(),c("span",Ie,[k("{{$ticket_number}}")])),[[g,e.trans("ticket_number_tooltip"),void 0,{right:!0}]])]),s("li",{class:"list-inline-item",style:{width:"23%",cursor:"pointer"},onClick:t[1]||(t[1]=u=>n.addToDescription("{{$ticket_status}}"))},[m((i(),c("span",Se,[k("{{$ticket_status}}")])),[[g,e.trans("ticket_status_tooltip"),void 0,{right:!0}]])]),s("li",{class:"list-inline-item",style:{width:"23%",cursor:"pointer"},onClick:t[2]||(t[2]=u=>n.addToDescription("{{$ticket_requester}}"))},[m((i(),c("span",Te,[k("{{$ticket_requester}}")])),[[g,e.trans("ticket_requester_tooltip"),void 0,{right:!0}]])]),s("li",{class:"list-inline-item",style:{width:"23%",cursor:"pointer"},onClick:t[3]||(t[3]=u=>n.addToDescription("{{$company_name}}"))},[m((i(),c("span",De,[k("{{$company_name}}")])),[[g,e.trans("company_name_tooltip"),void 0,{right:!0}]])])])])])])]),s("div",Ee,[r(v,{id:"template",label:e.trans("template_content"),value:a.template,required:!0,onChange:n.onChange,type:"textarea",name:"template",classname:"col-sm-12"},null,8,["label","value","onChange"])])]),controls:d(()=>[s("div",qe,[s("button",{class:"btn btn-primary",onClick:t[4]||(t[4]=u=>n.onSubmit())},[Ve,k(" "+h(e.trans("save")),1)])])]),_:1},8,["showModal","onClose"])):_("",!0)}const Pe=E(pe,[["render",Ae]]);const Ne={name:"InstagramSettings",description:"Component listing all facebook pages required for Instagram integration",setup(){const e=j();return{formattedTime:P(()=>e.getters.formattedTime),formattedDate:P(()=>e.getters.formattedDate)}},components:{"Instagram-create-edit-modal":N,"Instagram-template-modal":Pe,"text-field":F},data(){return{apiUrl:"/instagram/page/list",loading:!1,columns:["page_name","page_id","status","action"],options:{},dataTableVisible:!0,duration:4e3,showCreateEditModal:!1,showTemplateModal:!1,title:"facebook_page_create"}},methods:{addFacebookPage(){this.showCreateEditModal=!0},viewTemplateModal(){this.showTemplateModal=!0},onClose(){this.showCreateEditModal=!1,this.showTemplateModal=!1,this.$store.dispatch("unsetValidationError"),this.$store.dispatch("unsetAlert")}},beforeMount(){const e=this;this.options={headings:{page_name:e.lang("name"),page_id:e.lang("instagram_account_id"),status:e.lang("status"),action:e.lang("actions")},columnsClasses:{page_name:"page-name",page_id:"page-id",status:"page-status",action:"page-action"},sortIcon:{base:"glyphicon",up:"glyphicon-chevron-up",down:"glyphicon-chevron-down"},texts:{filter:"",limit:""},templates:{status:function(t,o){let y=e.h("span",{class:o.active===1?"btn btn-success btn-xs pointer_normal":"btn btn-danger btn-xs pointer_normal"},o.active===1?"Active":"Inactive");return e.h("a",{class:"pointer_normal"},[y])},action:(t,o)=>e.h(me,{data:o})},requestAdapter(t){return{search:t.query.trim(),sort_field:t.orderBy?t.orderBy:"id",sort_order:t.ascending?"asc":"desc",page:t.page,limit:t.limit}},responseAdapter({data:t}){return{data:t.data.data.map(o=>(o.delete_url=e.basePath()+"/instagram/page/delete/"+o.id,o)),count:t.data.total}},sortable:["page_name","page_id"],filterable:["page_name","page_id"],pagination:{chunk:5,nav:"fixed",edge:!0}}}},B=e=>(Z("data-v-ba95c82c"),e=e(),G(),e),Fe={class:"col-sm-12"},Be={key:0,class:"row"},Ue={class:"card-tools"},Le=B(()=>s("i",{class:"glyphicon glyphicon-plus"},null,-1)),Oe=[Le],je=B(()=>s("i",{class:"fas fa-shield-alt"},null,-1)),$e=B(()=>s("i",{class:"fa-solid fa-bolt"},null,-1)),ze=[$e],He={id:"pageList"};function Re(e,t,o,y,a,n){const b=l("custom-loader"),v=l("alert"),p=l("router-link"),g=l("data-table"),u=l("faveo-box"),S=l("Instagram-create-edit-modal"),T=l("Instagram-template-modal"),w=I("tooltip");return i(),c("div",Fe,[a.loading?(i(),c("div",Be,[r(b,{duration:a.duration},null,8,["duration"])])):_("",!0),r(v,{componentName:"dataTableModal"}),r(u,{title:e.trans("facebook_pages_list")},{headerMenu:d(()=>[s("div",Ue,[m((i(),c("button",{class:"btn btn-tool",onClick:t[0]||(t[0]=q=>n.addFacebookPage())},Oe)),[[w,e.trans("facebook_add_page")]]),m((i(),f(p,{to:"/instagram/security-settings",class:"btn btn-tool"},{default:d(()=>[je]),_:1})),[[w,e.trans("instagram_go_to_security_settings")]]),m((i(),c("button",{class:"btn btn-tool",onClick:t[1]||(t[1]=q=>n.viewTemplateModal())},ze)),[[w,e.trans("instagram_template_tooltip")]])])]),default:d(()=>[s("div",He,[a.dataTableVisible?(i(),f(g,{key:0,url:a.apiUrl,dataColumns:a.columns,option:a.options,scroll_to:"pageList"},null,8,["url","dataColumns","option"])):_("",!0)])]),_:1},8,["title"]),r(A,{name:"modal"},{default:d(()=>[a.showCreateEditModal?(i(),f(S,{key:0,onClose:n.onClose,showCreateEditModal:a.showCreateEditModal,title:a.title},null,8,["onClose","showCreateEditModal","title"])):_("",!0),a.showTemplateModal?(i(),f(T,{key:1,onClose:n.onClose,showTemplateModal:a.showTemplateModal},null,8,["onClose","showTemplateModal"])):_("",!0)]),_:1})])}const Ze=E(Ne,[["render",Re],["__scopeId","data-v-ba95c82c"]]);const Ge={name:"InstagramSecuritySettings",setup(){const e=j();return{formattedTime:P(()=>e.getters.formattedTime),formattedDate:P(()=>e.getters.formattedDate)}},data(){return{app_secret:"",hub_verify_token:"",appExists:!1,loadingSpeed:4e3,showModal:!1,loading:!1,settingsId:"",containerStyle:{width:"500px"},isLoading:!1,webhookUrl:"",copied:!1}},components:{"text-field":F,"dynamic-select":L,"tool-tip":R},beforeMount(){this.getAppDetails(),this.webhookUrl=this.basePath()+"/instagram/webhook/"},methods:{redirectToPages(){this.redirect("/instagram/pages/list")},onChange(e,t){this[t]=e},async getAppDetails(){this.loading=!0;try{const t=(await D.get("/instagram/credentials/get")).data.data;t?(this.appExists=!0,this.app_secret=t.fb_secret,this.hub_verify_token=t.hub_verify_token,this.settingsId=t.id,this.loading=!1):this.handleDefaultValues()}catch{Object.assign(this.$data,this.$options.data.apply(this)),this.handleDefaultValues()}finally{this.loading=!1}},handleDefaultValues(){this.appExists=!1,this.hub_verify_token=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),this.webhookUrl=this.basePath()+"/instagram/webhook/"},onCopy(){J(this.webhookUrl),this.copied=!0,setTimeout(()=>{this.copied=!1},5e3)},deleteFacebook(){this.isLoading=!0,this.isDisabled=!0,D.delete(`/instagram/credentials/reset/${this.settingsId}`).then(e=>{V(e,"InstagramSecuritySettings")}).catch(e=>{M(e,"InstagramSecuritySettings")}).finally(()=>{this.isLoading=!1,this.showModal=!1,this.getAppDetails()})},toggleModal(){this.showModal=!this.showModal},onClose(){this.showModal=!1},submitter(){const e={fb_secret:this.app_secret,hub_verify_token:this.hub_verify_token,id:this.settingsId,platform:"instagram"};this.loading=!0,D.post("/instagram/credentials/store",e).then(t=>{V(t,"InstagramSecuritySettings"),this.$store.dispatch("unsetValidationError")}).catch(t=>{M(t,"InstagramSecuritySettings")}).finally(()=>{this.loading=!1,this.getAppDetails()})}}},Je={class:"col-sm-12"},Ke={key:0,class:"row"},Qe={class:"card-tools"},We=s("i",{class:"fa-brands fa-instagram"},null,-1),Xe={class:"row"},Ye={class:"row"},xe={class:"col-sm-1",style:{"margin-top":"30px"}},et={class:"card-footer"},tt=s("i",{class:"fas fa-save"},null,-1),at=["disabled"],st=s("i",{class:"glyphicon glyphicon-repeat"},null,-1),nt={key:0},ot={id:"H5"},it={key:1,class:"row"},lt=s("i",{class:"glyphicon glyphicon-repeat","aria-hidden":"true"},null,-1);function rt(e,t,o,y,a,n){const b=l("custom-loader"),v=l("alert"),p=l("tool-tip"),g=l("router-link"),u=l("text-field"),S=l("faveo-box"),T=l("reuse-loader"),w=l("modal"),q=I("tooltip"),$=I("focus-first-input");return i(),c("div",Je,[a.loading===!0?(i(),c("div",Ke,[r(b,{duration:a.loadingSpeed},null,8,["duration"])])):_("",!0),r(v,{componentName:"InstagramSecuritySettings"}),r(S,{title:e.lang("instagram_app_settings")},{headerTooltip:d(()=>[r(p,{message:e.lang("instagram_security_tooltip"),size:"large"},null,8,["message"])]),headerMenu:d(()=>[s("div",Qe,[m((i(),f(g,{to:"/instagram/settings",class:"btn btn-tool"},{default:d(()=>[We]),_:1})),[[q,e.lang("instagram_integration_settings")]])])]),actions:d(()=>[s("div",et,[s("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=U((...C)=>n.submitter&&n.submitter(...C),["prevent"]))},[tt,k(" "+h(e.lang("instagram_save")),1)]),s("button",{class:"btn btn-primary",onClick:t[2]||(t[2]=(...C)=>n.toggleModal&&n.toggleModal(...C)),disabled:!a.appExists},[st,k("  "+h(e.lang("instagram_reset")),1)],8,at)])]),default:d(()=>[m((i(),c("div",Xe,[r(u,{label:e.lang("instagram_verify_token"),onChange:n.onChange,placehold:e.lang("enter_a_value"),value:a.hub_verify_token,type:"text",name:"hub_verify_token",required:!0,classname:"col-sm-6",hint:e.lang("instagram_verify_token_hint"),id:"instagram_verify_token",disabled:!0},null,8,["label","onChange","placehold","value","hint"]),r(u,{label:e.lang("instagram_app_secret"),onChange:n.onChange,placehold:e.lang("enter_a_value"),value:a.app_secret,type:"password",name:"app_secret",required:!0,classname:"col-sm-6",hint:e.lang("instagram_app_secret_hint"),id:"instagram_app_secret"},null,8,["label","onChange","placehold","value","hint"])])),[[$]]),s("div",Ye,[r(u,{id:"webhook",label:e.trans("instagram_webhook_url"),hint:e.trans("instagram_webhook_url"),onChange:n.onChange,placehold:e.lang("enter_a_value"),value:a.webhookUrl,type:"text",name:"webhook",disabled:!0,classname:"col-sm-5"},null,8,["label","hint","onChange","placehold","value"]),s("div",xe,[m((i(),c("a",{class:"btn btn-default",onClick:t[0]||(t[0]=U(C=>n.onCopy(),["prevent"]))},[s("span",{class:O(a.copied?"fas fa-check text-green":"fa fa-clipboard"),id:"eye"},null,2)])),[[q,a.copied?e.trans("clipboard-copy-message"):e.trans("click-to-copy")]])])])]),_:1},8,["title"]),r(A,{name:"modal"},{default:d(()=>[a.showModal?(i(),f(w,{key:0,showModal:!0,onClose:()=>a.showModal=!1,containerStyle:a.containerStyle},{title:d(()=>[s("h4",null,h(e.lang("facebook_reset")),1)]),fields:d(()=>[a.isLoading?_("",!0):(i(),c("div",nt,[s("h5",ot,h(e.lang("facebook_reset_confirm")),1)])),a.isLoading?(i(),c("div",it,[r(T,{"animation-duration":4e3,color:"#1d78ff",size:60})])):_("",!0)]),controls:d(()=>[s("button",{type:"button",onClick:t[3]||(t[3]=(...C)=>n.deleteFacebook&&n.deleteFacebook(...C)),class:"btn btn-primary"},[lt,k("  "+h(e.lang("reset")),1)])]),_:1},8,["onClose","containerStyle"])):_("",!0)]),_:1})])}const dt=E(Ge,[["render",rt]]);let ct={path:"/instagram",component:Q,name:"Instagram",redirect:"/instagram/settings",children:[{path:"settings",component:Ze,name:"Instagram Settings",meta:{title:"instagram_integration_settings",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},active:"instagram_integration_settings"}}},{path:"security-settings",component:dt,name:"Instagram Security Settings",meta:{title:"instagram_app_settings",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},parent_link:{name:"instagram_integration_settings",to:"/instagram"},active:"instagram_app_settings"}}},{path:"integration/create",component:N,name:"Instagram Create",meta:{title:"facebook_page_create",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},parent_link:{name:"instagram_integration_settings",to:"/instagram"},active:"facebook_page_create"}}},{path:"integration/:id/edit",component:N,name:"Instagram Edit",meta:{title:"facebook_page_edit",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},parent_link:{name:"facebook_integration_settings",to:"/instagram"},active:"facebook_page_edit"}}}]};K.addRoute(ct);
