import{_ as C,s as B,e as z,V as q,l as N,c as x,k as T,S as E,j as F,m as P}from"../chunks/bootstrap.js";import{u as M,m as $,a as A,r as c,q as V,o,c as l,e as r,w as _,f as d,i as h,b as S,y as R,d as g,p as H,j as U,g as b,t as f,$ as j,F as I,h as G,n as L,G as J}from"../chunks/vendor.js";import{r as O,A as K}from"../chunks/adminRouter.js";import{a as Q}from"../chunks/DataTableActions.js";import{C as W}from"../chunks/FormGenerator.js";import"../chunks/HelpSection.js";import"../chunks/AdminNavigationBar.js";const X={name:"AzureActiveDirectoryIndex",setup(){const e=M();return{formattedTime:$(()=>e.getters.formattedTime)}},data(){let e=this;return{isLoading:!1,hideDefaultLogin:!1,columns:["app_name","app_id","created_at","updated_at","action"],options:{texts:{filter:"",limit:""},headings:{app_name:this.trans("app_name"),app_id:this.trans("app_id"),created_at:this.trans("created-at"),updated_at:this.trans("updated-at"),action:this.trans("action")},templates:{action:(t,n)=>e.h(Q,{data:n}),created_at(t,n){return e.formattedTime(n.created_at)},updated_at(t,n){return e.formattedTime(n.updated_at)}},sortable:["app_name","app_id","created_at","updated_at"],filterable:["app_name","app_id","created_at","updated_at"],pagination:{chunk:5,nav:"fixed",edge:!0},requestAdapter(t){return{sort_field:t.orderBy?t.orderBy:"id",sort_order:t.ascending?"desc":"asc",search_query:t.query.trim(),page:t.page,limit:t.limit}},responseAdapter({data:t}){return e.hideDefaultLogin=t.data.hide_default_login,{data:t.data.directories.data.map(n=>(n.edit_url="/azure-active-directory/"+n.id+"/edit",n.delete_url=this.basePath()+"/api/azure-active-directory/settings/"+n.id,n)),count:t.data.directories.total}}},apiUrl:"api/azure-active-directory/settings"}},methods:{updateHideDefaultLogin(){this.isLoading=!0;const e={hide_default_login:this.hideDefaultLogin};A.post("api/azure-active-directory/hide-default-login",e).then(t=>{B(t,"azure-list-page")}).catch(t=>{z(t,"azure-list-page")}).finally(()=>{this.isLoading=!1})}}},Y=e=>(H("data-v-a28ccb71"),e=e(),U(),e),Z={class:"col-sm-12"},ee={class:"card-tools d-flex mt-1"},te=Y(()=>d("i",{class:"glyphicon glyphicon-plus","aria-hidden":"true"},null,-1)),ae={class:"btn-tool"};function ne(e,t,n,m,a,i){const s=c("alert"),p=c("loader"),u=c("router-link"),v=c("data-table"),y=c("faveo-box"),k=V("tooltip");return o(),l("div",Z,[r(s,{componentName:"dataTableModal"}),r(y,{title:e.trans("list_of_azure_active_directories")},{headerMenu:_(()=>[d("div",ee,[h((o(),S(u,{class:"btn btn-tool",to:"/azure-active-directory/create"},{default:_(()=>[te]),_:1})),[[k,e.trans("create_new_directory")]]),h((o(),l("span",ae,[h(d("input",{class:"hide-checkbox",type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=D=>a.hideDefaultLogin=D),onChange:t[1]||(t[1]=D=>i.updateHideDefaultLogin())},null,544),[[R,a.hideDefaultLogin]])])),[[k,e.trans("hide_default_login")]])])]),default:_(()=>[r(s,{componentName:"azure-list-page"}),a.isLoading?(o(),S(p,{key:0,duration:4e3})):g("",!0),r(v,{url:a.apiUrl,dataColumns:a.columns,option:a.options},null,8,["url","dataColumns","option"])]),_:1},8,["title"])])}const ie=C(X,[["render",ne],["__scopeId","data-v-a28ccb71"]]);function oe(e){const{appName:t,appId:n,appSecret:m,tenantId:a}=e;var i={appName:[t,"isRequired"],appId:[n,"isRequired"],appSecret:[m,"isRequired"],tenantId:[a,"isRequired"]};const s=new q(N),{errors:p,isValid:u}=s.validate(i);return x.dispatch("setValidationError",p),{errors:p,isValid:u}}const re={name:"AzureActiveDirectorySettings",data:()=>({app_name:"",app_id:"",app_secret:"",tenant_id:"",login_button_label:"",hasDataPopulated:!0,loading:!1,azureAdId:null}),beforeMount(){const e=T(window.location.pathname);this.azureAdId=e||"",this.azureAdId&&this.getConfiguration()},methods:{onChange(e,t){this[t]=e},isValid(){return oe(this.$data).isValid},saveConfiguration(e=!1){this.isValid()&&(this.loading=!0,A.post("api/azure-active-directory/settings",{id:this.azureAdId,app_name:this.app_name,tenant_id:this.tenant_id,app_id:this.app_id,app_secret:this.app_secret,login_button_label:this.login_button_label,import:e}).then(t=>{this.loading=!1,this.hasDataPopulated=!0,B(t,"AzureActiveDirectorySettings"),this.azureAdId&&setTimeout(()=>{this.$router.push({name:"AzureActiveDirectory Settings"})},3e3),this.azureAdId=t.data.data.azure_ad_id,this.getConfiguration()}).catch(t=>{this.loading=!1,z(t,"AzureActiveDirectorySettings")}).finally(()=>{this.loading=!1}))},getConfiguration(){this.loading=!0,A.get("api/azure-active-directory/settings/"+this.azureAdId).then(e=>{this.app_name=e.data.data.app_name,this.tenant_id=e.data.data.tenant_id,this.app_id=e.data.data.app_id,this.app_secret=e.data.data.app_secret,this.login_button_label=e.data.data.login_button_label}).catch(e=>{z(e,"AzureActiveDirectorySettings")}).finally(()=>{this.loading=!1})}},components:{"static-select":E,"text-field":F,checkbox:W}},se={class:"col-sm-12"},le={key:0,class:"row"},de={key:1},ue={class:"row"},ce={class:"row"},pe={class:"row"},_e={class:"card-footer"},ge=["disabled"],me=d("span",{class:"fas fa-save"},null,-1),he=["disabled"],be=d("span",{class:"fas fa-save"},null,-1);function fe(e,t,n,m,a,i){const s=c("custom-loader"),p=c("alert"),u=c("text-field"),v=c("faveo-box"),y=V("focus-first-input");return o(),l("div",se,[e.hasDataPopulated===!1||e.loading===!0?(o(),l("div",le,[r(s)])):g("",!0),r(p,{componentName:"AzureActiveDirectorySettings"}),e.hasDataPopulated?(o(),l("div",de,[r(v,{title:e.lang("configuration_settings")},{actions:_(()=>[d("div",_e,[d("button",{id:"azure-settings-save",class:"btn btn-primary",onClick:t[0]||(t[0]=()=>i.saveConfiguration(!1)),disabled:e.loading},[me,b("  "+f(e.lang("save")),1)],8,ge),d("button",{id:"azure-settings-submit",class:"btn btn-primary",onClick:t[1]||(t[1]=()=>i.saveConfiguration(!0)),disabled:e.loading},[be,b("  "+f(e.lang("save_and_import")),1)],8,he)])]),default:_(()=>[h((o(),l("div",ue,[r(u,{label:e.trans("app_name"),value:e.app_name,type:"text",name:"app_name",onChange:i.onChange,placehold:e.lang("enter_a_value"),classname:"col-md-6",required:!0,id:"app-name"},null,8,["label","value","onChange","placehold"]),r(u,{label:e.lang("tenant_id"),value:e.tenant_id,type:"text",name:"tenant_id",onChange:i.onChange,placehold:e.lang("enter_a_value"),classname:"col-sm-6",required:!0,id:"tenant-id"},null,8,["label","value","onChange","placehold"])])),[[y]]),d("div",ce,[r(u,{label:e.trans("app_id"),value:e.app_id,type:"text",name:"app_id",onChange:i.onChange,placehold:e.lang("enter_a_value"),classname:"col-sm-6",required:!0,id:"app-id"},null,8,["label","value","onChange","placehold"]),r(u,{label:e.trans("app_secret"),value:e.app_secret,type:"password",name:"app_secret",onChange:i.onChange,placehold:e.lang("enter_a_value"),classname:"col-sm-6",required:!0,id:"app-secret"},null,8,["label","value","onChange","placehold"])]),d("div",pe,[r(u,{label:e.trans("login_button_label"),value:e.login_button_label,type:"text",name:"login_button_label",onChange:i.onChange,placehold:e.lang("enter_a_value"),classname:"col-sm-6",id:"login-button-label"},null,8,["label","value","onChange","placehold"]),r(u,{label:e.trans("azure_redirect_uri"),hint:e.trans("azure_redirect_uri_hint"),value:e.basePath()+"/azure-active-directory/auth-token/callback",type:"text",name:"login_button_label",onChange:i.onChange,classname:"col-sm-6",disabled:!0},null,8,["label","hint","value","onChange"])])]),_:1},8,["title"])])):g("",!0)])}const w=C(re,[["render",fe]]);const ve={props:["data"],data(){return{azureSettings:null,oauthLogin:"",oauthConfig:{"border-radius":"4px !important","border-width":"2px !important","border-color":"#BDC1CAFF !important","border-style":"solid !important"}}},beforeMount(){this.azureSettings=JSON.parse(this.data).providerData.azure_meta_settings,this.azureSettings.hide_default_login&&this.hideDefaultLogin(),this.oauthLogin=JSON.parse(this.data).login_type},methods:{azureLoginSubmit(e){window.location=e},hideDefaultLogin(){document.getElementById("user_name").style.display="none",document.getElementById("password").style.display="none",document.getElementById("remember_me").style.display="none",document.getElementById("default-login-button").style.display="none",document.getElementById("default-forgot-password").style.display="none"}},computed:{...j({buttonStyle:"getButtonStyle",linkStyle:"getLinkStyle"})}},ye={key:0,id:"azure-login"},ze=["src","alt"],Ae={class:"azure-login-block"},Ce=["id","onClick"],ke={key:0};function De(e,t,n,m,a,i){return a.azureSettings?(o(),l("div",ye,[a.azureSettings.hide_default_login?(o(),l("img",{key:0,src:e.basePath()+"/images/azure.png",style:{margin:"-60px 0 -10px 92px"},alt:e.trans("azure_active_directory"),width:"256",height:"256"},null,8,ze)):g("",!0),(o(!0),l(I,null,G(a.azureSettings.directory_settings,(s,p)=>(o(),l("span",Ae,[d("button",{id:"azure-login-button-"+p,class:L(["azure-login-button btn-block btn-flat mt-1 mb-2",a.oauthLogin==="oAuth"?"btn-light link-dark border-0 p-2":"btn btn-custom"]),style:J(a.oauthLogin==="oAuth"?"border-radius: 4px !important; border-width: 1px !important; border-color: #BDC1CAFF !important; border-style: solid !important;":e.buttonStyle),onClick:()=>i.azureLoginSubmit(s.login_url)},[d("i",{class:L(["fa fa-server",a.oauthLogin==="oAuth"?"text-info":""]),"aria-hidden":"true"},null,2),b("  "),a.oauthLogin==="oAuth"?(o(),l("strong",ke,f(s.login_button_label!==""?s.login_button_label:e.lang("login_via_azure")),1)):(o(),l(I,{key:1},[b(f(s.login_button_label!==""?s.login_button_label:e.lang("login_via_azure")),1)],64))],14,Ce)]))),256))])):g("",!0)}const Se=C(ve,[["render",De]]);let Ie={path:"/azure-active-directory",component:K,name:"Azure",redirect:"/azure-active-directory/settings",children:[{path:"settings",component:ie,name:"AzureActiveDirectory Settings",meta:{title:"azure_configuration_settings",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},active:"azure_configuration_settings"}}},{path:"create",component:w,name:"AzureActiveDirectory Create",meta:{title:"azure_configuration_settings",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},parent_link:{name:"azure_configuration_settings",to:"/azure-active-directory"},active:"create"}}},{path:":id/edit",component:w,name:"AzureActiveDirectory Edit",meta:{title:"azure_configuration_settings",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},parent_link:{name:"azure_configuration_settings",to:"/azure-active-directory"},active:"edit"}}}]};O.addRoute(Ie);P("azure-login",Se,"login-box-mounted","login-box");
